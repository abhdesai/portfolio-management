"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8039],{81350:(re,B,n)=>{n.d(B,{q:()=>J});var e=n(85960),O=n(92369),K=n(71679),x=n(61353),E=n(14607),b=n(97666),Q=n(69977),M=n(29165),T=n(13086),V=n(23940),N=n(44574),$=n(77980),z=n(84184),F=n(80932),G=n(35511),m=n(49683),R=n(95162),ee=n(95831);const j=`This user's role is not editable because it is synchronized from your auth provider.
Refer to the Grafana authentication docs for details.`,S=v=>{const u=v?.isExternallySynced;return!m.Vt.hasPermissionInMetadata(R.AccessControlAction.OrgUsersWrite,v)||u},H=O.wl.pages.UserListPage.UsersListPage,J=({users:v,orgId:u,onRoleChange:h,onRemoveUser:Y,fetchData:Z,changePage:f,page:X,totalPages:l,rolesLoading:c})=>{const[P,L]=(0,e.useState)(null),[W,w]=(0,e.useState)([]);(0,e.useEffect)(()=>{async function r(){try{if(m.Vt.hasPermission(R.AccessControlAction.ActionRolesList)){let o=await(0,F.ul)(u);w(o)}}catch{console.error("Error loading options")}}m.Vt.licensedAccessControlEnabled()&&r()},[u]);const _=(0,e.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:r}})=>r&&e.createElement(K.q,{src:r,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:r}})=>e.createElement("div",null,r),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:r}})=>r,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:r}})=>r,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:r}})=>r,sortType:(r,o)=>new Date(r.original.lastSeenAt).getTime()-new Date(o.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:r},row:{original:o}})=>{const U=S(o);return m.Vt.licensedAccessControlEnabled()?e.createElement(z.R,{userId:o.userId,roles:o.roles||[],isLoading:c,orgId:u,roleOptions:W,basicRole:r,onBasicRoleChange:C=>h(C,o),basicRoleDisabled:U,basicRoleDisabledMessage:j,width:40}):e.createElement(ee.A,{"aria-label":"Role",value:r,disabled:U,onChange:C=>h(C,o)})}},{id:"info",header:"",cell:({row:{original:r}})=>S(r)&&e.createElement(x.x,{display:"flex",alignItems:"center",marginLeft:1},e.createElement(E.u,{interactive:!0,content:e.createElement("div",null,"This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",e.createElement("a",{href:"https://grafana.com/docs/grafana/latest/administration/user-management/manage-org-users/#change-a-users-organization-permissions",rel:"noreferrer",target:"_blank"},"Grafana authentication docs"),"\xA0for details.")},e.createElement(b.J,{name:"question-circle"})))},{id:"authLabels",header:"Origin",cell:({cell:{value:r}})=>e.createElement(e.Fragment,null,Array.isArray(r)&&r.length>0&&e.createElement(G.e,{label:r[0],removeIcon:!1,count:0}))},{id:"isDisabled",header:"",cell:({cell:{value:r}})=>e.createElement(e.Fragment,null,r&&e.createElement(Q.V,{colorIndex:9,name:"Disabled"}))},{id:"delete",header:"",cell:({row:{original:r}})=>m.Vt.hasPermissionInMetadata(R.AccessControlAction.OrgUsersRemove,r)&&e.createElement(M.zx,{size:"sm",variant:"destructive",onClick:()=>{L(r)},icon:"times","aria-label":`Delete user ${r.name}`})}],[c,u,W,h]);return e.createElement(T.K,{direction:"column",gap:2,"data-testid":H.container},e.createElement(V.e,{columns:_,data:v,getRowId:r=>String(r.userId),fetchData:Z}),e.createElement(T.K,{justifyContent:"flex-end"},e.createElement(N.t,{onNavigate:f,currentPage:X,numberOfPages:l,hideWhenSinglePage:!0})),!!P&&e.createElement($.s,{body:`Are you sure you want to delete user ${P?.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{L(null)},isOpen:!0,onConfirm:()=>{P&&(Y(P),L(null))}}))}},87644:(re,B,n)=>{n.r(B),n.d(B,{UsersListPageContent:()=>ne,UsersListPageUnconnected:()=>te,default:()=>de});var e=n(85960),O=n(36752),K=n(55583),x=n(20989),E=n(49683),b=n(81350),Q=n(55855),M=n(29165),T=n(84003);const V={revokeInvite:T.GY},N=(0,O.connect)(null,V);class $ extends e.PureComponent{render(){const{invitee:s,revokeInvite:a}=this.props;return e.createElement("tr",null,e.createElement("td",null,s.email),e.createElement("td",null,s.name),e.createElement("td",{className:"text-right"},e.createElement(Q.m,{icon:"copy",variant:"secondary",size:"sm",getText:()=>s.url},"Copy Invite"),"\xA0"),e.createElement("td",null,e.createElement(M.zx,{variant:"destructive",size:"sm",icon:"times",onClick:()=>a(s.code),"aria-label":"Revoke Invite"})))}}const z=N($);class F extends e.PureComponent{render(){const{invitees:s}=this.props;return e.createElement("table",{className:"filter-table form-inline"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Email"),e.createElement("th",null,"Name"),e.createElement("th",null),e.createElement("th",{style:{width:"34px"}}))),e.createElement("tbody",{"data-testid":"InviteesTable-body"},s.map((a,i)=>e.createElement(z,{key:`${a.id}-${i}`,invitee:a}))))}}var G=n(8111),m=n(8538);const{selectAll:R,selectById:ee,selectTotal:j}=m.selectors,S=(t,s)=>s,H=(0,G.P1)([R,S],(t,s)=>{const a=new RegExp(s,"i");return t.filter(d=>a.test(d.name)||a.test(d.email))});var J=n(84933),v=n(96535),u=n(5106),h=n(67954),Y=n(95162),Z=n(56375),f=n(85445),X=n(78105),l=n(82412);function c(){return async(t,s)=>{try{t((0,l.tZ)());const{perPage:a,page:i,searchQuery:d,sort:I}=s().users,g=await(0,f.i)().get("/api/org/users/search",(0,X.y)({perpage:a,page:i,query:d,sort:I}));if(E.Vt.licensedAccessControlEnabled()){t((0,l.Fy)());const D=E.Vt.user.orgId,p=g?.orgUsers.map(A=>A.userId),y=await(0,f.i)().post("/api/access-control/users/roles/search",{userIds:p,orgId:D});g.orgUsers.forEach(A=>{A.roles=y?y[A.userId]||[]:[]}),t((0,l.BR)())}t((0,l.eT)(g))}catch{(0,l.k7)()}}}const P=(0,Z.debounce)(t=>t(c()),300);function L(t){return async s=>{await(0,f.i)().patch(`/api/org/users/${t.userId}`,{role:t.role}),s(c())}}function W(t){return async s=>{await(0,f.i)().delete(`/api/org/users/${t}`),s(c())}}function w(t){return async s=>{s((0,l.PJ)(t)),s(c())}}function _({sortBy:t}){const s=t.length?`${t[0].id}-${t[0].desc?"desc":"asc"}`:void 0;return async a=>{a((0,l.UL)(s)),a(c())}}function r(t){return async s=>{s((0,l.w4)(t)),P(s)}}const o=t=>{const s=new RegExp(t.searchQuery,"i");return t.users.filter(a=>s.test(a.login)||s.test(a.email)||s.test(a.name))},U=t=>t.searchQuery;function C(t){return{searchQuery:U(t.users),pendingInvitesCount:j(t.invites),externalUserMngLinkName:t.users.externalUserMngLinkName,externalUserMngLinkUrl:t.users.externalUserMngLinkUrl}}const ae={changeSearchQuery:r},oe=(0,O.connect)(C,ae)(({externalUserMngLinkName:t,externalUserMngLinkUrl:s,searchQuery:a,pendingInvitesCount:i,changeSearchQuery:d,onShowInvites:I,showInvites:g})=>{const D=[{label:"Users",value:"users"},{label:`Pending Invites (${i})`,value:"invites"}],y=E.Vt.hasPermission(Y.AccessControlAction.OrgUsersAdd)&&!(h.default.disableLoginForm&&h.default.externalUserMngInfo);return e.createElement("div",{className:"page-action-bar","data-testid":"users-action-bar"},e.createElement(J._,{grow:!0},e.createElement(v.H,{value:a,onChange:d,placeholder:"Search user by login, email or name"})),i>0&&e.createElement("div",{style:{marginLeft:"1rem"}},e.createElement(u.S,{value:g?"invites":"users",options:D,onChange:I})),y&&e.createElement(M.Qj,{href:"org/users/invite"},"Invite"),s&&e.createElement(M.Qj,{href:s,target:"_blank",rel:"noopener"},t))});function le(t){const s=U(t.users);return{users:o(t.users),searchQuery:U(t.users),page:t.users.page,totalPages:t.users.totalPages,perPage:t.users.perPage,invitees:H(t.invites,s),externalUserMngInfo:t.users.externalUserMngInfo,isLoading:t.users.isLoading,rolesLoading:t.users.rolesLoading}}const ce={loadUsers:c,fetchInvitees:T.nW,changePage:w,changeSort:_,updateUser:L,removeUser:W},ie=(0,O.connect)(le,ce),te=({users:t,page:s,totalPages:a,invitees:i,externalUserMngInfo:d,isLoading:I,rolesLoading:g,loadUsers:D,fetchInvitees:p,changePage:y,updateUser:A,removeUser:ue,changeSort:me})=>{const[k,ge]=(0,e.useState)(!1),se=d?(0,K.a)(d):"";(0,e.useEffect)(()=>{D(),p()},[p,D]);const Ee=(q,Pe)=>{A({...Pe,role:q})},ve=q=>ue(q.userId),he=()=>{ge(!k)},fe=()=>k?e.createElement(F,{invitees:i}):e.createElement(b.q,{users:t,orgId:E.Vt.user.orgId,rolesLoading:g,onRoleChange:Ee,onRemoveUser:ve,fetchData:me,changePage:y,page:s,totalPages:a});return e.createElement(x.T.Contents,{isLoading:!I},e.createElement(oe,{onShowInvites:he,showInvites:k}),se&&e.createElement("div",{className:"grafana-info-box",dangerouslySetInnerHTML:{__html:se}}),I&&fe())},ne=ie(te);function de(){return e.createElement(x.T,{navId:"users"},e.createElement(ne,null))}}}]);

//# sourceMappingURL=UsersListPage.50a71790d99e04527c6f.js.map