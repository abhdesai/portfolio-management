"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8808],{9581:(k,O,t)=>{t.d(O,{p:()=>E});var c=t(66681),e=t(85960),r=t(34785),z=t(90857),g=t(47257),v=t(97666),T=t(59672),U=t(25802),y=t(26469),M=t(23757),P=t(7288),p=t(29165),N=t(37565),b=t(51624),D=t(1706),G=t(20079);const A={loadingState:M.Gu.Loading,dashboardTitles:[]},j=(0,G.PH)("libraryPanels/delete/searchCompleted"),l=(n=A,h)=>j.match(h)?{...n,dashboardTitles:h.payload.dashboards.map(S=>S.title),loadingState:M.Gu.Done}:n;function C(n){return async function(h){const S=await(0,D.E8)(n.uid);h(j({dashboards:S}))}}const K=({libraryPanel:n,onDismiss:h,onConfirm:S})=>{const J=(0,g.wW)(N.J),[{dashboardTitles:B,loadingState:x},H]=(0,e.useReducer)(l,A),V=(0,e.useMemo)(()=>(0,b.tb)(H),[H]);(0,e.useEffect)(()=>{V(C(n))},[V,n]);const Q=!!B.length,q=x===M.Gu.Done;return e.createElement(P.u,{className:J.modal,title:"Delete library panel",icon:"trash-alt",onDismiss:h,isOpen:!0},q?null:e.createElement(I,null),q?e.createElement("div",null,Q?e.createElement(W,{dashboardTitles:B}):null,Q?null:e.createElement(u,null),e.createElement(P.u.ButtonRow,null,e.createElement(p.zx,{variant:"secondary",onClick:h,fill:"outline"},"Cancel"),e.createElement(p.zx,{variant:"destructive",onClick:S,disabled:Q},"Delete"))):null)},I=()=>e.createElement("span",null,"Loading library panel..."),u=()=>{const n=(0,g.wW)(N.J);return e.createElement("div",{className:n.modalText},"Do you want to delete this panel?")},W=({dashboardTitles:n})=>{const h=(0,g.wW)(N.J),S=n.length===1?"dashboard.":"dashboards.",J=`${n.length} ${S}`;return n.length===0?null:e.createElement("div",null,e.createElement("p",{className:h.textInfo},"This library panel can not be deleted because it is connected to ",e.createElement("strong",null,J)," Remove the library panel from the dashboards listed below and retry."),e.createElement("table",{className:h.myTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Dashboard name"))),e.createElement("tbody",null,n.map((B,x)=>e.createElement("tr",{key:`dash-title-${x}`},e.createElement("td",null,B))))))},E=({libraryPanel:n,onClick:h,onDelete:S,showSecondaryActions:J})=>{const[B,x]=(0,e.useState)(!1),H=()=>{S?.(n),x(!1)},V=z.config.panels[n.model.type]??(0,U.X)(n.model.type).meta;return e.createElement(e.Fragment,null,e.createElement(y.X,{isCurrent:!1,title:n.name,description:n.description,plugin:V,onClick:()=>h?.(n),onDelete:J?()=>x(!0):void 0},e.createElement(R,{libraryPanel:n})),B&&e.createElement(K,{libraryPanel:n,onConfirm:H,onDismiss:()=>x(!1)}))},L=({showSecondaryActions:n})=>{const h=(0,g.wW)(F);return e.createElement(y.X.Skeleton,{hasDelete:n},e.createElement(r.Z,{containerClassName:h.metaContainer,width:80}))};E.Skeleton=L;function R({libraryPanel:n}){const h=(0,g.wW)(F);return!n.meta?.folderUid&&!n.meta?.folderName?null:n.meta.folderUid?e.createElement("span",{className:h.metaContainer},e.createElement(T.r,{href:`/dashboards/f/${n.meta.folderUid}`},e.createElement(v.J,{name:"folder-upload",size:"sm"}),e.createElement("span",null,n.meta.folderName))):e.createElement("span",{className:h.metaContainer},e.createElement(v.J,{name:"folder",size:"sm"}),e.createElement("span",null,n.meta.folderName))}function F(n){return{metaContainer:(0,c.css)({display:"flex",alignItems:"center",color:n.colors.text.secondary,fontSize:n.typography.bodySmall.fontSize,paddingTop:n.spacing(.5),svg:{marginRight:n.spacing(.5),marginBottom:3}})}}},51624:(k,O,t)=>{t.d(O,{UO:()=>A,Xu:()=>G,tb:()=>j});var c=t(34269),e=t(16226),r=t(21964),z=t(59069),g=t(55670),v=t(25066),T=t(85431),U=t(87550),y=t(95135),M=t(24596),P=t(23136),p=t(90857),N=t(99602),b=t(1706),D=t(11386);function G(l){const C=(I,u)=>I.id===u.type,K=(I,u)=>{const W=(0,N.xW)();return I.filter(E=>{const L=W.find(R=>C(R,E));return u?!!L?.skipDataQuery:!L?.skipDataQuery})};return function(I){const u=new c.w0,W=(0,e.D)((0,b.Pq)({searchString:l.searchString,perPage:l.perPage,page:l.page,excludeUid:l.currentPanelId,sortDirection:l.sortDirection,typeFilter:l.panelFilter,folderFilterUIDs:l.folderFilterUIDs})).pipe((0,v.z)(E=>{const{elements:L}=E;if(p.config.featureToggles.vizAndWidgetSplit&&l.isWidget!==void 0){const R=K(L,l.isWidget);return(0,r.of)({...E,elements:R})}return(0,r.of)({...E,elements:L})}),(0,v.z)(({perPage:E,elements:L,page:R,totalCount:F})=>(0,r.of)((0,D.zK)({libraryPanels:L,page:R,perPage:E,totalCount:F}))),(0,T.K)(E=>(console.error(E),(0,r.of)((0,D.zK)({...D.p$,page:l.page,perPage:l.perPage})))),(0,U.x)(()=>u.unsubscribe()),(0,y.B)());u.add((0,z.T)((0,g.H)(50).pipe((0,M.h)((0,D.xU)()),(0,P.R)(W)),W).subscribe(I))}}function A(l,C){return async function(K){try{await(0,b.UO)(l),G(C)(K)}catch(I){console.error(I)}}}function j(l){return function(C){return C instanceof Function?C(l):l(C)}}},11386:(k,O,t)=>{t.d(O,{_p:()=>T,oO:()=>v,p$:()=>r,xU:()=>z,zK:()=>g});var c=t(20079),e=t(23757);const r={loadingState:e.Gu.Loading,libraryPanels:[],totalCount:0,perPage:40,page:1,numberOfPages:0,currentPanelId:void 0},z=(0,c.PH)("libraryPanels/view/initSearch"),g=(0,c.PH)("libraryPanels/view/searchCompleted"),v=(0,c.PH)("libraryPanels/view/changePage"),T=(U,y)=>{if(z.match(y))return{...U,loadingState:e.Gu.Loading};if(g.match(y)){const{libraryPanels:M,page:P,perPage:p,totalCount:N}=y.payload,b=Math.ceil(N/p);return{...U,libraryPanels:M,perPage:p,totalCount:N,loadingState:e.Gu.Done,numberOfPages:b,page:P>b?P-1:P}}return v.match(y)?{...U,page:y.payload.page}:U}},37565:(k,O,t)=>{t.d(O,{J:()=>e});var c=t(66681);function e(r){return{myTable:(0,c.css)`
      max-height: 204px;
      overflow-y: auto;
      margin-top: 11px;
      margin-bottom: 28px;
      border-radius: ${r.shape.radius.default};
      border: 1px solid ${r.colors.action.hover};
      background: ${r.colors.background.primary};
      color: ${r.colors.text.secondary};
      font-size: ${r.typography.h6.fontSize};
      width: 100%;

      thead {
        color: #538ade;
        font-size: ${r.typography.bodySmall.fontSize};
      }

      th,
      td {
        padding: 6px 13px;
        height: ${r.spacing(4)};
      }

      tbody > tr:nth-child(odd) {
        background: ${r.colors.background.secondary};
      }
    `,noteTextbox:(0,c.css)`
      margin-bottom: ${r.spacing(4)};
    `,textInfo:(0,c.css)`
      color: ${r.colors.text.secondary};
      font-size: ${r.typography.size.sm};
    `,dashboardSearch:(0,c.css)`
      margin-top: ${r.spacing(2)};
    `,modal:(0,c.css)`
      width: 500px;
    `,modalText:(0,c.css)`
      font-size: ${r.typography.h4.fontSize};
      color: ${r.colors.text.primary};
      margin-bottom: ${r.spacing(4)};
      padding-top: ${r.spacing(2)};
    `}}},63381:(k,O,t)=>{t.r(O),t.d(O,{default:()=>xe});var c=t(66681),e=t(85960),r=t(36752),z=t(47475),g=t(23757),v=t(92369),T=t(43183),U=t(90857),y=t(79055),M=t(85447),P=t(66596),p=t(20519),N=t(57445),b=t(24956),D=t(29165),G=t(7073),A=t(74042),j=t(75682),l=t(47257),C=t(33808),K=t(60484),I=t(20989),u=t(95329),W=t(1992),E=t(12537),L=t(91),R=t(50086),F=t(32737),n=t(1864),h=t(32063),S=t(96130),J=t(9561),B=t(40715),x=t(18863),H=t(85445),V=t(5192);const Q=o=>{let a;try{a=JSON.parse(o)}catch{return(0,x.t)("dashboard.validation.invalid-json","Not valid JSON")}if(a&&a.hasOwnProperty("tags"))if(Array.isArray(a.tags)){if(a.tags.some(d=>typeof d!="string"))return(0,x.t)("dashboard.validation.tags-expected-strings","tags expected array of strings")}else return(0,x.t)("dashboard.validation.tags-expected-array","tags expected array");return!0},q=o=>{const a=/(^\d+$)|dashboards\/(\d+)/.exec(o);return a&&(a[1]||a[2])?!0:(0,x.t)("dashboard.validation.invalid-dashboard-id","Could not find a valid Grafana.com ID")},de=(o,a)=>V.t.validateNewDashboardName(a,o).then(()=>!0).catch(f=>{if(f.type==="EXISTING")return f.message}),ne=o=>(0,H.i)().get(`/api/dashboards/uid/${o}`).then(a=>`Dashboard named '${a?.dashboard.title}' in folder '${a?.meta.folderTitle}' has the same UID`).catch(a=>(a.isHandled=!0,!0));var ie=t(9581);function oe({inputs:o,label:a,description:f,folderName:d}){const s=(0,l.wW)(ce);return o?.length?e.createElement("div",{className:s.spacer},e.createElement(p.g,{label:a,description:f},e.createElement(e.Fragment,null,o.map((i,X)=>{const Z=`elements[${X}]`,Y=i.state===n.KQ.New?{...i.model,meta:{...i.model.meta,folderName:d??"General"}}:{...i.model};return e.createElement("div",{className:s.item,key:Z},e.createElement(ie.p,{libraryPanel:Y,onClick:()=>{}}))})))):null}function ce(o){return{spacer:(0,c.css)`
      margin-bottom: ${o.spacing(2)};
    `,item:(0,c.css)`
      margin-bottom: ${o.spacing(1)};
    `}}const me=({register:o,errors:a,control:f,getValues:d,uidReset:s,inputs:i,initialFolderUid:X,onUidReset:Z,onCancel:Y,onSubmit:_,watch:ee})=>{const[te,Le]=(0,e.useState)(!1),Oe=ee("dataSources"),le=ee("folder");(0,e.useEffect)(()=>{te&&(a.title||a.uid)&&_(d())},[a,d,te,_]);const Te=i?.libraryPanels?.filter(m=>m.state===n.KQ.New)??[],Ue=i?.libraryPanels?.filter(m=>m.state===n.KQ.Exists)??[];return e.createElement(e.Fragment,null,e.createElement(R.D,null,"Options"),e.createElement(p.g,{label:"Name",invalid:!!a.title,error:a.title&&a.title.message},e.createElement(b.I,{...o("title",{required:"Name is required",validate:async m=>await de(m,d().folder.uid)}),type:"text","data-testid":v.wl.components.ImportDashboardForm.name})),e.createElement(p.g,{label:"Folder"},e.createElement(S.g,{render:({field:{ref:m,...$}})=>e.createElement(J.Fz,{...$,enableCreateNew:!0,initialFolderUid:X}),name:"folder",control:f})),e.createElement(p.g,{label:"Unique identifier (UID)",description:`The unique identifier (UID) of a dashboard can be used for uniquely identify a dashboard between multiple Grafana installs.
                The UID allows having consistent URLs for accessing dashboards so changing the title of a dashboard will not break any
                bookmarked links to that dashboard.`,invalid:!!a.uid,error:a.uid&&a.uid.message},e.createElement(e.Fragment,null,s?e.createElement(b.I,{...o("uid",{required:!0,validate:async m=>await ne(m)})}):e.createElement(b.I,{disabled:!0,...o("uid",{validate:async m=>await ne(m)}),addonAfter:!s&&e.createElement(D.zx,{onClick:Z},"Change uid")}))),i.dataSources&&i.dataSources.map((m,$)=>{if(m.pluginId===h.hr.type)return null;const w=`dataSources.${$}`,Me=Oe??[];return e.createElement(p.g,{label:m.label,description:m.description,key:w,invalid:a.dataSources&&!!a.dataSources[$],error:a.dataSources&&a.dataSources[$]&&"A data source is required"},e.createElement(S.g,{name:w,render:({field:{ref:Re,...Ne}})=>e.createElement(B.q,{...Ne,noDefault:!0,placeholder:m.info,pluginId:m.pluginId,current:Me[$]?.uid}),control:f,rules:{required:!0}}))}),i.constants&&i.constants.map((m,$)=>{const w=`constants.${$}`;return e.createElement(p.g,{label:m.label,error:a.constants&&a.constants[$]&&`${m.label} needs a value`,invalid:a.constants&&!!a.constants[$],key:w},e.createElement(b.I,{...o(w,{required:!0}),defaultValue:m.value}))}),e.createElement(oe,{inputs:Te,label:"New library panels",description:"List of new library panels that will get imported.",folderName:le.title}),e.createElement(oe,{inputs:Ue,label:"Existing library panels",description:"List of existing library panels. These panels are not affected by the import.",folderName:le.title}),e.createElement(A.Lh,null,e.createElement(D.zx,{type:"submit","data-testid":v.wl.components.ImportDashboardForm.submit,variant:ue(a),onClick:()=>{Le(!0)}},he(a)),e.createElement(D.zx,{type:"reset",variant:"secondary",onClick:Y},"Cancel")))};function ue(o){return o&&(o.title||o.uid)?"destructive":"primary"}function he(o){return o&&(o.title||o.uid)?"Import (Overwrite)":"Import"}const pe="dashboard_import_imported",fe=o=>{const a=L.E1.getSearchObject();return{dashboard:o.importDashboard.dashboard,meta:o.importDashboard.meta,source:o.importDashboard.source,inputs:o.importDashboard.inputs,folder:a.folderUid?{uid:String(a.folderUid)}:{uid:""}}},ge={clearLoadedDashboard:F.ys,importDashboard:F.$j},Ee=(0,r.connect)(fe,ge);class ve extends e.PureComponent{constructor(){super(...arguments),this.state={uidReset:!1},this.onSubmit=a=>{(0,T.ff)(pe),this.props.importDashboard(a)},this.onCancel=()=>{this.props.clearLoadedDashboard()},this.onUidReset=()=>{this.setState({uidReset:!0})}}render(){const{dashboard:a,inputs:f,meta:d,source:s,folder:i}=this.props,{uidReset:X}=this.state;return e.createElement(e.Fragment,null,s===n.G7.Gcom&&e.createElement("div",{style:{marginBottom:"24px"}},e.createElement("div",null,e.createElement(R.D,null,"Importing dashboard from"," ",e.createElement("a",{href:`https://grafana.com/dashboards/${a.gnetId}`,className:"external-link",target:"_blank",rel:"noreferrer"},"Grafana.com"))),e.createElement("table",{className:"filter-table form-inline"},e.createElement("tbody",null,e.createElement("tr",null,e.createElement("td",null,"Published by"),e.createElement("td",null,d.orgName)),e.createElement("tr",null,e.createElement("td",null,"Updated on"),e.createElement("td",null,(0,E.dq)(d.updatedAt)))))),e.createElement(P.l,{onSubmit:this.onSubmit,defaultValues:{...a,constants:[],dataSources:[],elements:[],folder:i},validateOnMount:!0,validateFieldsOnMount:["title","uid"],validateOn:"onChange"},({register:Z,errors:Y,control:_,watch:ee,getValues:te})=>e.createElement(me,{register:Z,errors:Y,control:_,getValues:te,uidReset:X,inputs:f,onCancel:this.onCancel,onUidReset:this.onUidReset,onSubmit:this.onSubmit,watch:ee,initialFolderUid:i.uid})))}}const re=Ee(ve);re.displayName="ImportDashboardOverview";const ae="dashboard_import_loaded",be=`{
    "title": "Example - Repeating Dictionary variables",
    "uid": "_0HnEoN4z",
    "panels": [...]
    ...
}
`,De=o=>({loadingState:o.importDashboard.state}),ye={fetchGcomDashboard:F.q_,importDashboardJson:F.nQ,cleanUpAction:W.e},Pe=(0,r.connect)(De,ye);class Ie extends e.PureComponent{constructor(a){super(a),this.fileListRenderer=(d,s)=>null,this.onFileUpload=d=>{(0,T.ff)(ae,{import_source:"json_uploaded"});try{this.props.importDashboardJson(JSON.parse(String(d)))}catch(s){s instanceof Error&&K.Z.emit(z.SI.alertError,["Import failed","JSON -> JS Serialization failed: "+s.message]);return}},this.getDashboardFromJson=d=>{(0,T.ff)(ae,{import_source:"json_pasted"}),this.props.importDashboardJson(JSON.parse(d.dashboardJson))},this.getGcomDashboard=d=>{(0,T.ff)(ae,{import_source:"gcom"});let s;const i=/(^\d+$)|dashboards\/(\d+)/.exec(d.gcomDashboard);i&&i[1]?s=i[1]:i&&i[2]&&(s=i[2]),s&&this.props.fetchGcomDashboard(s)},this.pageNav={text:"Import dashboard",subTitle:"Import dashboard from file or Grafana.com"};const{gcomDashboardId:f}=this.props.queryParams;if(f){this.getGcomDashboard({gcomDashboard:f});return}}componentWillUnmount(){this.props.cleanUpAction({cleanupAction:a=>a.importDashboard=n.wg})}renderImportForm(){const a=Ce(this.props.theme),f=()=>e.createElement(y.h,{variant:"bodySmall",href:"https://grafana.com/grafana/dashboards/",external:!0},"grafana.com/dashboards");return e.createElement(e.Fragment,null,e.createElement("div",{className:a.option},e.createElement(M.Yo,{options:{multiple:!1,accept:[".json",".txt"]},readAs:"readAsText",fileListRenderer:this.fileListRenderer,onLoad:this.onFileUpload},e.createElement(M.A_,{primaryText:(0,u.t)("dashboard-import.file-dropzone.primary-text","Upload dashboard JSON file"),secondaryText:(0,u.t)("dashboard-import.file-dropzone.secondary-text","Drag and drop here or click to browse")}))),e.createElement("div",{className:a.option},e.createElement(P.l,{onSubmit:this.getGcomDashboard,defaultValues:{gcomDashboard:""}},({register:d,errors:s})=>e.createElement(p.g,{label:e.createElement(N._,{className:a.labelWithLink,htmlFor:"url-input"},e.createElement("span",null,e.createElement(u.cC,{i18nKey:"dashboard-import.gcom-field.label"},"Find and import dashboards for common applications at ",e.createElement(f,null)))),invalid:!!s.gcomDashboard,error:s.gcomDashboard&&s.gcomDashboard.message},e.createElement(b.I,{id:"url-input",placeholder:(0,u.t)("dashboard-import.gcom-field.placeholder","Grafana.com dashboard URL or ID"),type:"text",...d("gcomDashboard",{required:(0,u.t)("dashboard-import.gcom-field.validation-required","A Grafana dashboard URL or ID is required"),validate:q}),addonAfter:e.createElement(D.zx,{type:"submit"},e.createElement(u.cC,{i18nKey:"dashboard-import.gcom-field.load-button"},"Load"))})))),e.createElement("div",{className:a.option},e.createElement(P.l,{onSubmit:this.getDashboardFromJson,defaultValues:{dashboardJson:""}},({register:d,errors:s})=>e.createElement(e.Fragment,null,e.createElement(p.g,{label:(0,u.t)("dashboard-import.json-field.label","Import via dashboard JSON model"),invalid:!!s.dashboardJson,error:s.dashboardJson&&s.dashboardJson.message},e.createElement(G.K,{...d("dashboardJson",{required:(0,u.t)("dashboard-import.json-field.validation-required","Need a dashboard JSON model"),validate:Q}),"data-testid":v.wl.components.DashboardImportPage.textarea,id:"dashboard-json-textarea",rows:10,placeholder:be})),e.createElement(A.Lh,null,e.createElement(D.zx,{type:"submit","data-testid":v.wl.components.DashboardImportPage.submit},e.createElement(u.cC,{i18nKey:"dashboard-import.form-actions.load"},"Load")),e.createElement(D.Qj,{variant:"secondary",href:`${U.config.appSubUrl}/dashboards`},e.createElement(u.cC,{i18nKey:"dashboard-import.form-actions.cancel"},"Cancel")))))))}render(){const{loadingState:a}=this.props;return e.createElement(I.T,{navId:"dashboards/browse",pageNav:this.pageNav},e.createElement(I.T.Contents,null,a===g.Gu.Loading&&e.createElement(A.wc,{justify:"center"},e.createElement(A.Lh,{justify:"center"},e.createElement(j.$,{size:"xxl"}))),[g.Gu.Error,g.Gu.NotStarted].includes(a)&&this.renderImportForm(),a===g.Gu.Done&&e.createElement(re,null)))}}const Se=(0,l.HE)(Ie),se=Pe(Se);se.displayName="DashboardImport";const xe=se,Ce=(0,C.B)(o=>({option:(0,c.css)`
      margin-bottom: ${o.spacing(4)};
      max-width: 600px;
    `,labelWithLink:(0,c.css)`
      max-width: 100%;
    `,linkWithinLabel:(0,c.css)`
      font-size: inherit;
    `}))}}]);

//# sourceMappingURL=DashboardImport.52787efc2b5225a88b20.js.map