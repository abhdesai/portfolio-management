"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1337],{53614:(ae,b,n)=>{n.r(b),n.d(b,{ServiceAccountsListPageUnconnected:()=>H,default:()=>F,getStyles:()=>U});var o=n(66681),l=n(53136),S=n.n(l),e=n(85960),p=n(36752),u=n(47257),r=n(29165),P=n(84933),w=n(96535),g=n(5106),D=n(13086),M=n(44574),O=n(77980),V=n(64409),L=n(20989),R=n(67954),i=n(49683),c=n(95162),s=n(39042),a=n(34785),I=n(97666),m=n(75064),f=n(84184),N=n(95831);const C=t=>`Edit service account's ${t} details`,y=(0,e.memo)(({serviceAccount:t,onRoleChange:J,roleOptions:ee,onRemoveButtonClick:Z,onDisable:j,onEnable:te,onAddTokenClick:Y})=>{const k=`org/serviceaccounts/${t.id}`,h=(0,u.wW)(x),K=i.Vt.hasPermissionInMetadata(c.AccessControlAction.ServiceAccountsWrite,t),_=i.Vt.hasPermission(c.AccessControlAction.ActionRolesList)&&i.Vt.hasPermission(c.AccessControlAction.ActionUserRolesList);return e.createElement("tr",{key:t.id,className:(0,o.cx)({[h.disabled]:t.isDisabled})},e.createElement("td",{className:"width-4 text-center link-td"},e.createElement("a",{href:k,"aria-label":C(t.name)},e.createElement("img",{className:"filter-table__avatar",src:t.avatarUrl,alt:`Avatar for user ${t.name}`}))),e.createElement("td",{className:"link-td max-width-10"},e.createElement("a",{className:"ellipsis",href:k,title:t.name,"aria-label":C(t.name)},t.name)),e.createElement("td",{className:"link-td max-width-10"},e.createElement("a",{className:h.accountId,href:k,title:t.login,"aria-label":C(t.name)},t.login)),i.Vt.licensedAccessControlEnabled()?e.createElement("td",null,_&&e.createElement(f.R,{userId:t.id,orgId:t.orgId,basicRole:t.role,roles:t.roles||[],onBasicRoleChange:X=>J(X,t),roleOptions:ee,basicRoleDisabled:!K,disabled:t.isDisabled,width:40})):e.createElement("td",null,e.createElement(N.A,{"aria-label":"Role",value:t.role,disabled:t.isExternal||!K||t.isDisabled,onChange:X=>J(X,t)})),e.createElement("td",{className:"link-td max-width-10"},e.createElement("a",{className:"ellipsis",href:k,title:"Tokens","aria-label":C(t.name)},e.createElement("div",{className:(0,o.cx)(h.tokensInfo,{[h.tokensInfoSecondary]:!t.tokens})},e.createElement("span",null,e.createElement(I.J,{name:"key-skeleton-alt"})),t.tokens||"No tokens"))),e.createElement("td",null,!t.isExternal&&e.createElement(D.K,{alignItems:"center",justifyContent:"flex-end"},i.Vt.hasPermission(c.AccessControlAction.ServiceAccountsWrite)&&!t.tokens&&e.createElement(r.zx,{onClick:()=>Y(t),disabled:t.isDisabled,className:h.actionButton},"Add token"),i.Vt.hasPermissionInMetadata(c.AccessControlAction.ServiceAccountsWrite,t)&&(t.isDisabled?e.createElement(r.zx,{variant:"primary",onClick:()=>te(t),className:h.actionButton},"Enable"):e.createElement(r.zx,{variant:"secondary",onClick:()=>j(t),className:h.actionButton},"Disable")),i.Vt.hasPermissionInMetadata(c.AccessControlAction.ServiceAccountsDelete,t)&&e.createElement(m.h,{className:h.deleteButton,name:"trash-alt",size:"md",onClick:()=>Z(t),tooltip:`Delete service account ${t.name}`})),t.isExternal&&e.createElement(D.K,{alignItems:"center",justifyContent:"flex-end"},e.createElement(m.h,{disabled:!0,name:"lock",size:"md",tooltip:"This is a managed service account and cannot be modified."}))))});y.displayName="ServiceAccountListItem";const B=Object.assign(y,{Skeleton:()=>{const t=(0,u.wW)(T);return e.createElement("tr",null,e.createElement("td",{className:"width-4 text-center"},e.createElement(a.Z,{containerClassName:t.blockSkeleton,circle:!0,width:25,height:25})),e.createElement("td",{className:"max-width-10"},e.createElement(a.Z,{width:100})),e.createElement("td",{className:"max-width-10"},e.createElement(a.Z,{width:100})),e.createElement("td",null,e.createElement(a.Z,{containerClassName:t.blockSkeleton,width:"100%",height:32})),e.createElement("td",{className:"max-width-10"},e.createElement(a.Z,{width:40})),e.createElement("td",null,e.createElement(D.K,{alignItems:"center",justifyContent:"flex-end"},e.createElement(a.Z,{containerClassName:t.blockSkeleton,width:102,height:32}),e.createElement(a.Z,{containerClassName:t.blockSkeleton,width:85,height:32}),e.createElement(a.Z,{containerClassName:(0,o.cx)(t.blockSkeleton,t.deleteButton),width:16,height:16}))))}}),T=t=>({blockSkeleton:(0,o.css)({display:"block",lineHeight:1}),deleteButton:(0,o.css)({marginRight:t.spacing(.5)})}),x=t=>({iconRow:(0,o.css)({svg:{marginLeft:t.spacing(.5)}}),accountId:(0,o.cx)("ellipsis",(0,o.css)({color:t.colors.text.secondary})),deleteButton:(0,o.css)({color:t.colors.text.secondary}),tokensInfo:(0,o.css)({span:{marginRight:t.spacing(1)}}),tokensInfoSecondary:(0,o.css)({color:t.colors.text.secondary}),disabled:(0,o.css)({"td a":{color:t.colors.text.secondary}}),actionButton:(0,o.css)({minWidth:85})}),A=B;var v=n(66585);function q(t){return{...t.serviceAccounts}}const G={changePage:v.oO,changeQuery:v.R5,fetchACOptions:v.bX,fetchServiceAccounts:v.Xd,deleteServiceAccount:v.yN,updateServiceAccount:v.TL,changeStateFilter:v.XE,createServiceAccountToken:v.fT},W=(0,p.connect)(q,G),Q=[{label:"All",value:c.ServiceAccountStateFilter.All},{label:"With expired tokens",value:c.ServiceAccountStateFilter.WithExpiredTokens},{label:"Disabled",value:c.ServiceAccountStateFilter.Disabled}];(R.default.featureToggles.externalServiceAccounts||R.default.featureToggles.externalServiceAuth)&&Q.push({label:"Managed",value:c.ServiceAccountStateFilter.External});const H=({page:t,changePage:J,totalPages:ee,serviceAccounts:Z,isLoading:j,roleOptions:te,query:Y,serviceAccountStateFilter:k,changeQuery:h,fetchACOptions:K,fetchServiceAccounts:_,deleteServiceAccount:X,updateServiceAccount:ne,changeStateFilter:Ee,createServiceAccountToken:ge})=>{const le=(0,u.wW)(U),[ve,se]=(0,e.useState)(!1),[fe,ce]=(0,e.useState)(!1),[he,ie]=(0,e.useState)(!1),[Se,re]=(0,e.useState)(""),[E,$]=(0,e.useState)(null);(0,e.useEffect)(()=>{_({withLoadingIndicator:!0}),i.Vt.licensedAccessControlEnabled()&&K()},[K,_]);const de=Z.length===0&&k===c.ServiceAccountStateFilter.All&&!Y,pe=async(d,Le)=>{const Re={...Le,role:d};ne(Re),i.Vt.licensedAccessControlEnabled()&&K()},De=d=>{h(d)},Ce=d=>{Ee(d)},ye=d=>{$(d),ce(!0)},Te=async()=>{E&&X(E.id),me()},xe=d=>{$(d),ie(!0)},Ae=()=>{E&&ne({...E,isDisabled:!0}),ue()},Pe=d=>{ne({...d,isDisabled:!1})},Ie=d=>{$(d),se(!0)},ke=async d=>{E&&ge(E.id,d,re)},be=()=>{se(!1),$(null),re("")},me=()=>{ce(!1),$(null)},ue=()=>{ie(!1),$(null)},Me=e.createElement("a",{className:"external-link",href:"https://grafana.com/docs/grafana/latest/administration/service-accounts/",target:"_blank",rel:"noopener noreferrer"},"documentation."),Oe=e.createElement("span",null,"Service accounts and their tokens can be used to authenticate against the Grafana API. Find out more in our"," ",Me);return e.createElement(L.T,{navId:"serviceaccounts",subTitle:Oe,actions:e.createElement(e.Fragment,null,!de&&i.Vt.hasPermission(c.AccessControlAction.ServiceAccountsCreate)&&e.createElement(r.Qj,{href:"org/serviceaccounts/create",variant:"primary"},"Add service account"))},e.createElement(L.T.Contents,null,e.createElement("div",{className:"page-action-bar"},e.createElement(P._,{grow:!0},e.createElement(w.H,{placeholder:"Search service account by name",value:Y,onChange:De,width:50})),e.createElement(g.S,{options:Q,onChange:Ce,value:k,className:le.filter})),!j&&de&&e.createElement(e.Fragment,null,e.createElement(V.Z,{title:"You haven't created any service accounts yet.",buttonIcon:"key-skeleton-alt",buttonLink:"org/serviceaccounts/create",buttonTitle:"Add service account",buttonDisabled:!i.Vt.hasPermission(c.AccessControlAction.ServiceAccountsCreate),proTip:"Remember, you can provide specific permissions for API access to other applications.",proTipLink:"",proTipLinkTitle:"",proTipTarget:"_blank"})),(j||Z.length!==0)&&e.createElement(e.Fragment,null,e.createElement("div",{className:(0,o.cx)(le.table,"admin-list-table")},e.createElement("table",{className:"filter-table filter-table--hover"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,"Account"),e.createElement("th",null,"ID"),e.createElement("th",null,"Roles"),e.createElement("th",null,"Tokens"),e.createElement("th",{style:{width:"120px"}}))),e.createElement("tbody",null,j?e.createElement(e.Fragment,null,e.createElement(A.Skeleton,null),e.createElement(A.Skeleton,null),e.createElement(A.Skeleton,null)):Z.map(d=>e.createElement(A,{serviceAccount:d,key:d.id,roleOptions:te,onRoleChange:pe,onRemoveButtonClick:ye,onDisable:xe,onEnable:Pe,onAddTokenClick:Ie})))),e.createElement(D.K,{justifyContent:"flex-end"},e.createElement(M.t,{hideWhenSinglePage:!0,currentPage:t,numberOfPages:ee,onNavigate:J})))),E&&e.createElement(e.Fragment,null,e.createElement(O.s,{isOpen:fe,body:`Are you sure you want to delete '${E.name}'${E.tokens?` and ${E.tokens} accompanying ${S()("token",E.tokens)}`:""}?`,confirmText:"Delete",title:"Delete service account",onConfirm:Te,onDismiss:me}),e.createElement(O.s,{isOpen:he,title:"Disable service account",body:`Are you sure you want to disable '${E.name}'?`,confirmText:"Disable service account",onConfirm:Ae,onDismiss:ue}),e.createElement(s.m,{isOpen:ve,token:Se,serviceAccountLogin:E.login,onCreateToken:ke,onClose:be}))))},U=t=>({table:(0,o.css)({marginTop:t.spacing(3)}),filter:(0,o.css)({margin:`0 ${t.spacing(1)}`}),row:(0,o.css)({display:"flex",alignItems:"center",height:"100% !important",a:{padding:`${t.spacing(.5)} 0 !important`}}),unitTooltip:(0,o.css)({display:"flex",flexDirection:"column"}),unitItem:(0,o.css)({cursor:"pointer",padding:t.spacing(.5,0),marginRight:t.spacing(1)}),disabled:(0,o.css)({color:t.colors.text.disabled}),link:(0,o.css)({color:"inherit",cursor:"pointer",textDecoration:"underline"}),pageHeader:(0,o.css)({display:"flex",marginBottom:t.spacing(2)}),apiKeyInfoLabel:(0,o.css)({marginLeft:t.spacing(1),lineHeight:2.2,flexGrow:1,color:t.colors.text.secondary,span:{padding:t.spacing(.5)}}),filterDelimiter:(0,o.css)({flexGrow:1})}),F=W(H)},39042:(ae,b,n)=>{n.d(b,{m:()=>V});var o=n(66681),l=n(85960),S=n(90308),e=n(90857),p=n(47257),u=n(7288),r=n(20519),P=n(24956),w=n(5106),g=n(68594),D=n(29165),M=n(55855);const O=[{label:"No expiration",value:!1},{label:"Set expiration date",value:!0}],V=({isOpen:i,token:c,serviceAccountLogin:s,onCreateToken:a,onClose:I})=>{const m=new Date;m.setDate(m.getDate()+1);const f=new Date;e.config.tokenExpirationDayLimit!==void 0&&e.config.tokenExpirationDayLimit>-1?f.setDate(f.getDate()+e.config.tokenExpirationDayLimit+1):f.setDate(864e13);const N=e.config.tokenExpirationDayLimit!==void 0&&e.config.tokenExpirationDayLimit>0,[C,y]=(0,l.useState)(""),[z,B]=(0,l.useState)(""),[T,x]=(0,l.useState)(N),[A,v]=(0,l.useState)(m),[q,G]=(0,l.useState)(A!==""),W=(0,p.wW)(R);(0,l.useEffect)(()=>{i&&y(`${s}-${(0,S.Z)()}`)},[s,i]);const Q=F=>{G(F!==""),v(F)},H=()=>{a({name:z||C,secondsToLive:T?L(A):void 0})},U=()=>{B(""),y(""),x(N),v(m),G(A!==""),I()},oe=c?"Service account token created":"Add service account token";return l.createElement(u.u,{isOpen:i,title:oe,onDismiss:U,className:W.modal,contentClassName:W.modalContent},c?l.createElement(l.Fragment,null,l.createElement(r.g,{label:"Token",description:"Copy the token now as you will not be able to see it again. Losing a token requires creating a new one."},l.createElement("div",{className:W.modalTokenRow},l.createElement(P.I,{name:"tokenValue",value:c,readOnly:!0}),l.createElement(M.m,{className:W.modalCopyToClipboardButton,variant:"primary",size:"md",icon:"copy",getText:()=>c},"Copy clipboard"))),l.createElement(u.u.ButtonRow,null,l.createElement(M.m,{variant:"primary",getText:()=>c,onClipboardCopy:U},"Copy to clipboard and close"),l.createElement(D.zx,{variant:"secondary",onClick:U},"Close"))):l.createElement("div",null,l.createElement(r.g,{label:"Display name",description:"Name to easily identify the token",required:!0},l.createElement(P.I,{name:"tokenName",value:z,placeholder:C,onChange:F=>{B(F.currentTarget.value)}})),l.createElement(r.g,{label:"Expiration"},l.createElement(w.S,{options:O,value:T,onChange:x,size:"md"})),T&&l.createElement(r.g,{label:"Expiration date"},l.createElement(g.d,{onChange:Q,value:A,placeholder:"",minDate:m,maxDate:f})),l.createElement(u.u.ButtonRow,null,l.createElement(D.zx,{onClick:H,disabled:T&&!q},"Generate token"))))},L=i=>{const c=new Date(i),s=new Date;return Math.ceil((c.getTime()-s.getTime())/1e3)},R=i=>({modal:(0,o.css)`
      width: 550px;
    `,modalContent:(0,o.css)`
      overflow: visible;
    `,modalTokenRow:(0,o.css)`
      display: flex;
    `,modalCopyToClipboardButton:(0,o.css)`
      margin-left: ${i.spacing(.5)};
    `})},66585:(ae,b,n)=>{n.d(b,{R5:()=>R,TL:()=>M,XE:()=>i,Xd:()=>g,bX:()=>w,fT:()=>V,oO:()=>c,yN:()=>O});var o=n(56375),l=n.n(o),S=n(85445),e=n(80932),p=n(41879),u=n(95162),r=n(28970);const P="/api/serviceaccounts";function w(){return async s=>{try{if(p.contextSrv.licensedAccessControlEnabled()&&p.contextSrv.hasPermission(u.AccessControlAction.ActionRolesList)){const a=await(0,e.ul)();s((0,r.Dn)(a))}}catch(a){console.error(a)}}}function g({withLoadingIndicator:s}={withLoadingIndicator:!1}){return async(a,I)=>{try{if(p.contextSrv.hasPermission(u.AccessControlAction.ServiceAccountsRead)){s&&a((0,r.pN)());const{perPage:m,page:f,query:N,serviceAccountStateFilter:C}=I().serviceAccounts,y=await(0,S.i)().get(`/api/serviceaccounts/search?perpage=${m}&page=${f}&query=${N}${L(C)}&accesscontrol=true`);if(p.contextSrv.licensedAccessControlEnabled()){a((0,r.Fy)());const z=p.contextSrv.user.orgId,B=y?.serviceAccounts.map(x=>x.id),T=await(0,S.i)().post("/api/access-control/users/roles/search",{userIds:B,orgId:z});y.serviceAccounts.forEach(x=>{x.roles=T?T[x.id]||[]:[]}),a((0,r.BR)())}a((0,r.Ub)(y))}}catch(m){console.error(m)}finally{a((0,r.dt)())}}}const D=(0,o.debounce)(s=>s(g()),500,{leading:!0});function M(s){return async a=>{await(0,S.i)().patch(`${P}/${s.id}?accesscontrol=true`,{...s}),a(g())}}function O(s){return async a=>{await(0,S.i)().delete(`${P}/${s}`),a(g())}}function V(s,a,I){return async m=>{const f=await(0,S.i)().post(`${P}/${s}/tokens`,a);I(f.key),m(g())}}const L=s=>{switch(s){case u.ServiceAccountStateFilter.WithExpiredTokens:return"&expiredTokens=true";case u.ServiceAccountStateFilter.Disabled:return"&disabled=true";case u.ServiceAccountStateFilter.External:return"&external=true";default:return""}};function R(s){return async a=>{a((0,r.aj)(s)),D(a)}}function i(s){return async a=>{a((0,r.M4)(s)),a(g())}}function c(s){return async a=>{a((0,r.PJ)(s)),a(g())}}}}]);

//# sourceMappingURL=ServiceAccountsPage.9ac6be6a40a55dce0cb7.js.map