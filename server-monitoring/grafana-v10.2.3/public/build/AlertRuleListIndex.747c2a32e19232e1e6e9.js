"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2461,4286],{95500:(_,I,t)=>{t.d(I,{x:()=>h});var n=t(85960),e=t(95162),g=t(1992);function h(y){const E=(0,e.useDispatch)(),R=(0,n.useRef)(y);R.current=y,(0,n.useEffect)(()=>()=>{E((0,g.e)({cleanupAction:R.current}))},[E])}},4860:(_,I,t)=>{t.r(I),t.d(I,{AlertRuleListUnconnected:()=>ae,default:()=>Pe});var n=t(85960),e=t(36752),g=t(91),h=t(90857),y=t(96535),E=t(27436),R=t(29165),O=t(74042),T=t(60484),U=t(20989),f=t(14914),S=t(7288);function p({onDismiss:M}){return n.createElement(S.u,{title:"Adding an Alert",isOpen:!0,onDismiss:M,onClickBackdrop:M},n.createElement(O.wc,{spacing:"sm"},n.createElement("img",{src:"public/img/alert_howto_new.png",alt:""}),n.createElement("p",null,"Alerts are added and configured in the Alert tab of any dashboard graph panel, letting you build and visualize an alert using existing queries."),n.createElement("p",null,"Remember to save the dashboard to persist your alert rule changes.")))}var v=t(83795),F=t.n(v),H=t(72435),le=t(97666);const k=({rule:M,search:b,onTogglePause:ee})=>{const Ae=`${M.url}?editPanel=${M.panelId}&tab=alert`,oe=(0,n.useCallback)(Ne=>n.createElement(F(),{key:Ne,highlightClassName:"highlight-search-match",textToHighlight:Ne,searchWords:[b]}),[b]);return n.createElement(H.Z,null,n.createElement(H.Z.Heading,null,oe(M.name)),n.createElement(H.Z.Figure,null,n.createElement(le.J,{size:"xl",name:M.stateIcon,className:`alert-rule-item__icon ${M.stateClass}`})),n.createElement(H.Z.Meta,null,n.createElement("span",{key:"state"},n.createElement("span",{key:"text",className:`${M.stateClass}`},oe(M.stateText)," "),"for ",M.stateAge),M.info?oe(M.info):null),n.createElement(H.Z.Actions,null,n.createElement(R.zx,{key:"play",variant:"secondary",icon:M.state==="paused"?"play":"pause",onClick:ee},M.state==="paused"?"Resume":"Pause"),n.createElement(R.Qj,{key:"edit",variant:"secondary",href:Ae,icon:"cog"},"Edit alert")))};var X=t(49199);const xe="grafana.legacyalerting.unifiedalertingpromo",Re=()=>n.createElement(X.b,{severity:"warning",title:"Grafana legacy alerting is deprecated and will be removed in a future release."},n.createElement("p",null,"You are using Grafana legacy alerting, which has been deprecated since Grafana 9.0. The codebase is now staying as is and will be removed in Grafana 11.0.",n.createElement("br",null),"We recommend upgrading to Grafana Alerting as soon as possible."),n.createElement("p",null,"See"," ",n.createElement("a",{href:"https://grafana.com/docs/grafana/latest/alerting/migrating-alerts/"},"how to upgrade to Grafana Alerting")," ","to learn more."));var pe=t(31135),K=t(76151);const se=M=>M.searchQuery,ue=M=>{const b=new RegExp(M.alertRules.searchQuery,"i");return M.alertRules.items.filter(ee=>b.test(ee.name)||b.test(ee.stateText)||b.test(ee.info))},z=(M,b)=>M.notificationChannel.id===b?M.notificationChannel:null;function me(M){return{alertRules:ue(M),search:se(M.alertRules),isLoading:M.alertRules.isLoading}}const Ce={getAlertRulesAsync:pe.Au,setSearchQuery:K.ql,togglePauseAlertRule:pe.en},fe=(0,e.connect)(me,Ce);class ae extends n.PureComponent{constructor(){super(...arguments),this.stateFilters=[{label:"All",value:"all"},{label:"OK",value:"ok"},{label:"Not OK",value:"not_ok"},{label:"Alerting",value:"alerting"},{label:"No data",value:"no_data"},{label:"Paused",value:"paused"},{label:"Pending",value:"pending"}],this.onStateFilterChanged=b=>{g.E1.partial({state:b.value})},this.onOpenHowTo=()=>{T.Z.publish(new f.Dn({component:p}))},this.onSearchQueryChange=b=>{this.props.setSearchQuery(b)},this.onTogglePause=b=>{this.props.togglePauseAlertRule(b.id,{paused:b.state!=="paused"})},this.alertStateFilterOption=({text:b,value:ee})=>n.createElement("option",{key:ee,value:ee},b)}componentDidMount(){this.fetchRules()}componentDidUpdate(b){b.queryParams.state!==this.props.queryParams.state&&this.fetchRules()}async fetchRules(){await this.props.getAlertRulesAsync({state:this.getStateFilter()})}getStateFilter(){return this.props.queryParams.state??"all"}render(){const{alertRules:b,search:ee,isLoading:Ae}=this.props;return n.createElement(U.T,{navId:"alert-list"},n.createElement(U.T.Contents,{isLoading:Ae},n.createElement("div",{className:"page-action-bar"},n.createElement("div",{className:"gf-form gf-form--grow"},n.createElement(y.H,{placeholder:"Search alerts",value:ee,onChange:this.onSearchQueryChange})),n.createElement("div",{className:"gf-form"},n.createElement("label",{className:"gf-form-label",htmlFor:"alert-state-filter"},"States"),n.createElement("div",{className:"width-13"},n.createElement(E.Ph,{inputId:"alert-state-filter",options:this.stateFilters,onChange:this.onStateFilterChanged,value:this.getStateFilter()}))),n.createElement("div",{className:"page-action-bar__spacer"}),h.config.unifiedAlertingEnabled&&n.createElement(R.Qj,{variant:"primary",href:"alerting/ng/new"},"Add NG Alert"),n.createElement(R.zx,{variant:"secondary",onClick:this.onOpenHowTo},"How to add an alert")),n.createElement(Re,null),n.createElement(O.wc,{spacing:"none"},b.map(oe=>n.createElement(k,{rule:oe,key:oe.id,search:ee,onTogglePause:()=>this.onTogglePause(oe)})))))}}const Pe=fe(ae)},31135:(_,I,t)=>{t.d(I,{Au:()=>E,C2:()=>O,c1:()=>U,en:()=>R,fA:()=>f,fg:()=>T,tk:()=>S});var n=t(85445),e=t(91),g=t(88492),h=t(93991),y=t(76151);function E(p){return async v=>{v((0,y.gz)());const F=await(0,n.i)().get("/api/alerts",p);v((0,y.Oc)(F))}}function R(p,v){return async F=>{await(0,n.i)().post(`/api/alerts/${p}/pause`,v);const H=e.E1.getSearchObject().state||"all";F(E({state:H.toString()}))}}function O(p){return async v=>{try{await(0,n.i)().post("/api/alert-notifications",p),v((0,g.$l)((0,h.AT)("Notification created"))),e.E1.push("/alerting/notifications")}catch(F){(0,n.kW)(F)&&v((0,g.$l)((0,h.t_)(F.data.error)))}}}function T(p){return async v=>{try{await(0,n.i)().put(`/api/alert-notifications/${p.id}`,p),v((0,g.$l)((0,h.AT)("Notification updated")))}catch(F){(0,n.kW)(F)&&v((0,g.$l)((0,h.t_)(F.data.error)))}}}function U(p){return async(v,F)=>{const H=F().notificationChannel.notificationChannel;await(0,n.i)().post("/api/alert-notifications/test",{id:H.id,...p})}}function f(){return async p=>{const F=(await(0,n.i)().get("/api/alert-notifiers")).sort((H,le)=>H.name>le.name?1:-1);p((0,y.T2)(F))}}function S(p){return async v=>{await v(f());const F=await(0,n.i)().get(`/api/alert-notifications/${p}`);v((0,y.K)(F))}}},14388:(_,I,t)=>{t.r(I),t.d(I,{default:()=>ga});var n=t(66681),e=t(85960),g=t(85954),h=t(23426),y=t(8958),E=t(47257),R=t(29165),O=t(13086),T=t(763),U=t(95162),f=t(34456),S=t(56375),p=t(30694),v=t(45220),F=t(173),H=t(69707),le=t(44839),ye=t(54635),k=t(97666),X=t(79468),xe=t(14411),Re=t(27908),pe=t(29657),K=t(23694);function se({onClose:a}){const[r,l]=(0,e.useState)("yaml");return e.createElement(pe.i,{activeTab:r,onTabChange:l,onClose:a,formatProviders:Object.values(K.uN)},e.createElement(ue,{exportFormat:r,onClose:a}))}function ue({exportFormat:a,onClose:r}){const{currentData:l="",isFetching:c}=xe.alertRuleApi.endpoints.exportRules.useQuery({format:a}),s=`alert-rules-${new Date().getTime()}`;return c?e.createElement(X.u,{text:"Loading...."}):e.createElement(Re.u,{format:a,textDefinition:l,downloadFileName:s,onClose:r})}var z=t(57297);function me({}){const[a,r]=(0,z.E$)(z.jU.CreateAlertRule),[l,c]=(0,z.E$)(z.jU.CreateExternalAlertRule),[s,o]=(0,z.E$)(z.jU.ExportGrafanaManagedRules),i=(0,p.TH)(),[u,d]=(0,v.Z)(!1),m=a&&r,D=l&&c,C=s&&o,N=[];return(m||D)&&N.push(e.createElement(H.s,{label:"New recording rule",key:"new-recording-rule",url:F.Cj.renderUrl("alerting/new/recording",{returnTo:i.pathname+i.search})})),C&&N.push(e.createElement(H.s,{label:"Export all Grafana-managed rules",key:"export-all-rules",onClick:d})),e.createElement(e.Fragment,null,(m||D)&&e.createElement(R.Qj,{href:F.Cj.renderUrl("alerting/new/alerting",{returnTo:i.pathname+i.search}),icon:"plus",onClick:()=>(0,f.PN)(f.z7.alertRuleFromScratch)},"New alert rule"),!(0,S.isEmpty)(N)&&e.createElement(le.L,{overlay:e.createElement(ye.v,null,N)},e.createElement(R.zx,{variant:"secondary"},"More",e.createElement(k.J,{name:"angle-down"}))),C&&u&&e.createElement(se,{onClose:d}))}var Ce=t(39512),fe=t(11318),ae=t(64409),Pe=t(44097);const M=()=>{const{canCreateGrafanaRules:a,canCreateCloudRules:r}=(0,Pe.B)(),l=(0,E.wW)(b);return a||r?e.createElement("div",null,e.createElement("p",null,"You haven't created any alert rules yet"),e.createElement(O.K,{gap:1},e.createElement("div",{className:l.newRuleCard},e.createElement(ae.Z,{title:"",buttonIcon:"bell",buttonLink:"alerting/new/alerting",buttonTitle:"New alert rule",proTip:"you can also create alert rules from existing panels and queries.",proTipLink:"https://grafana.com/docs/",proTipLinkTitle:"Learn more",proTipTarget:"_blank",onClick:()=>(0,f.PN)(f.z7.alertRuleFromScratch)})),e.createElement("div",{className:l.newRuleCard},e.createElement(ae.Z,{title:"",buttonIcon:"plus",buttonLink:"alerting/new/recording",buttonTitle:"New recording rule",onClick:()=>(0,f.PN)(f.z7.recordingRuleFromScratch)})))):e.createElement(fe._,{message:"No rules exist yet.",callToActionElement:e.createElement("div",null)})},b=a=>({newRuleCard:(0,n.css)`
    width: calc(50% - ${a.spacing(1)});

    > div {
      height: 100%;
    }
  `});var ee=t(60808),Ae=t(53136),oe=t.n(Ae),Ne=t(6753),mt=t(49199),Ie=t(14607),ve=t(92746),Z=t(76679),Se=t(77294),q=t(9001);function dt(){const[a,r]=(0,e.useState)(!1),[l,c]=(0,Ne.Z)("grafana.unifiedalerting.hideErrors",!1),s=(0,ve._)(m=>m.dataSources),o=(0,ve._)(m=>m.promRules),i=(0,ve._)(m=>m.rulerRules),u=(0,E.wW)(He),d=(0,e.useMemo)(()=>{const[m,D,C]=[s,o,i].map(A=>(0,Z.Eu)().reduce((x,J)=>{const ce=A[J.name]?.error;return A[J.name]&&ce&&!(0,q.m$)(A[J.name])?[...x,{dataSource:J,error:ce}]:x},[])),N=o[Z.GC]?.error,W=i[Z.GC]?.error,L=[];return N&&L.push(e.createElement(e.Fragment,null,"Failed to load Grafana rules state: ",N.message||"Unknown error.")),W&&L.push(e.createElement(e.Fragment,null,"Failed to load Grafana rules config: ",W.message||"Unknown error.")),m.forEach(({dataSource:A,error:x})=>{L.push(e.createElement(e.Fragment,null,"Failed to load the data source configuration for"," ",e.createElement("a",{href:(0,Se.__)(A),className:u.dsLink},A.name),": ",x.message||"Unknown error."))}),D.forEach(({dataSource:A,error:x})=>L.push(e.createElement(e.Fragment,null,"Failed to load rules state from"," ",e.createElement("a",{href:(0,Se.__)(A),className:u.dsLink},A.name),": ",x.message||"Unknown error."))),C.forEach(({dataSource:A,error:x})=>L.push(e.createElement(e.Fragment,null,"Failed to load rules config from"," ",e.createElement("a",{href:(0,Se.__)(A),className:u.dsLink},A.name),": ",x.message||"Unknown error."))),L},[s,o,i,u.dsLink]);return e.createElement(e.Fragment,null,!!d.length&&l&&e.createElement(gt,{count:d.length,onClick:()=>c(m=>!m)}),!!d.length&&!l&&e.createElement(mt.b,{"data-testid":"cloud-rulessource-errors",title:"Errors loading rules",severity:"error",onRemove:()=>c(!0)},a&&d.map((m,D)=>e.createElement("div",{key:D},m)),!a&&e.createElement(e.Fragment,null,e.createElement("div",null,d[0]),d.length>=2&&e.createElement(R.zx,{className:u.moreButton,fill:"text",icon:"angle-right",size:"sm",onClick:()=>r(!0)},d.length-1," more ",oe()("error",d.length-1)))))}const gt=({count:a,onClick:r})=>{const l=(0,E.wW)(He);return e.createElement("div",{className:l.floatRight},e.createElement(Ie.u,{content:"Show all errors",placement:"bottom"},e.createElement(R.zx,{fill:"text",variant:"destructive",icon:"exclamation-triangle",onClick:r},a>1?e.createElement(e.Fragment,null,a," errors"):e.createElement(e.Fragment,null,"1 error"))))},He=a=>({moreButton:(0,n.css)`
    padding: 0;
  `,floatRight:(0,n.css)`
    display: flex;
    justify-content: flex-end;
  `,dsLink:(0,n.css)`
    font-weight: ${a.typography.fontWeightBold};
  `});var we=t(53914),be=t(75682),Qe=t(44574),Ve=t(89248),Ze=t(37310),Je=t(52912),Le=t(30422),Ye=t(74042),$e=t(67192),Et=t(77980),pt=t(20420),ft=t(72142),Fe=t(5970),Xe=t(44211),ke=t(58662);function vt({folder:a,onClose:r}){const[l,c]=(0,e.useState)("yaml");return e.createElement(pe.i,{title:`Export ${a.title} rules`,activeTab:l,onTabChange:c,onClose:r,formatProviders:Object.values(K.uN)},e.createElement(ht,{folder:a,exportFormat:l,onClose:r}))}function ht({folder:a,exportFormat:r,onClose:l}){const{currentData:c="",isFetching:s}=xe.alertRuleApi.endpoints.exportRules.useQuery({folderUid:a.uid,format:r});if(s)return e.createElement(X.u,{text:"Loading...."});const o=`${a.title}-${a.uid}`;return e.createElement(Re.u,{format:r,textDefinition:c,downloadFileName:o,onClose:l})}function yt({folderUid:a,groupName:r,onClose:l}){const[c,s]=(0,e.useState)("yaml");return e.createElement(pe.i,{title:`Export ${r} rules`,activeTab:c,onTabChange:s,onClose:l,formatProviders:Object.values(K.uN)},e.createElement(Rt,{folderUid:a,groupName:r,exportFormat:c,onClose:l}))}function Rt({folderUid:a,groupName:r,exportFormat:l,onClose:c}){const{currentData:s="",isFetching:o}=xe.alertRuleApi.endpoints.exportRules.useQuery({folderUid:a,group:r,format:l});return o?e.createElement(X.u,{text:"Loading...."}):e.createElement(Re.u,{format:l,textDefinition:s,downloadFileName:r,onClose:c})}var ge=t(90504),Ct=t(68684),xt=t(70318),qe=t.n(xt),Be=t(31173),Pt=t(7288),St=t(59767),Dt=t(60956),At=t(14591);const Ot=a=>{const{group:r,namespace:l,onClose:c}=a,[s,o]=(0,e.useState)(!1),[i,u]=(0,e.useState)(r.rules),d=(0,E.wW)(Ke),m=(0,e.useCallback)(C=>{if(!C.destination||C.destination.index===C.source.index)return;const W=Tt(i,C.source.index,C.destination.index);u(W);const L=(0,Z.EG)(l.rulesSource),A=(0,S.compact)(W.map(x=>x.rulerRule));o(!0),(0,St.WI)((0,Fe.tg)({namespaceName:l.name,groupName:r.name,rulesSourceName:L,newRules:A})).unwrap().finally(()=>{o(!1)})},[r.name,l.name,l.rulesSource,i]),D=i.map(C=>({...C,uid:String((0,Dt.Om)(C.rulerRule))}));return e.createElement(Pt.u,{className:d.modal,isOpen:!0,title:e.createElement(Mt,{namespace:l,group:r}),onDismiss:c,onClickBackdrop:c},e.createElement(Be.Z5,{onDragEnd:m},e.createElement(Be.bK,{droppableId:"alert-list",mode:"standard",renderClone:(C,N,W)=>e.createElement(_e,{provided:C,rule:D[W.source.index],isClone:!0})},C=>e.createElement("div",{ref:C.innerRef,className:qe()(d.listContainer,s&&d.disabled),...C.droppableProps},D.map((N,W)=>e.createElement(Be._l,{key:N.uid,draggableId:N.uid,index:W,isDragDisabled:s},L=>e.createElement(_e,{key:N.uid,provided:L,rule:N}))),C.placeholder))))},_e=({provided:a,rule:r,isClone:l=!1,isDragging:c=!1})=>{const s=(0,E.wW)(Ke);return e.createElement("div",{className:qe()(s.listItem,l&&"isClone",c&&"isDragging"),ref:a.innerRef,...a.draggableProps,...a.dragHandleProps},(0,q.x_)(r.promRule)&&e.createElement(At.l,{state:r.promRule.state}),(0,q.OP)(r.promRule)&&e.createElement($e.C,{text:"Recording",color:"blue"}),e.createElement("div",{className:s.listItemName},r.name),e.createElement(k.J,{name:"draggabledots"}))},Mt=({namespace:a,group:r})=>{const l=(0,E.wW)(Ke);return e.createElement("div",{className:l.header},e.createElement(k.J,{name:"folder"}),(0,Z.jq)(a.rulesSource)&&e.createElement(Ie.u,{content:a.rulesSource.name,placement:"top"},e.createElement("img",{alt:a.rulesSource.meta.name,className:l.dataSourceIcon,src:a.rulesSource.meta.info.logos.small})),e.createElement("span",null,a.name),e.createElement(k.J,{name:"angle-right"}),e.createElement("span",null,r.name))},Ke=a=>({modal:(0,n.css)`
    max-width: 640px;
    max-height: 80%;
    overflow: hidden;
  `,listItem:(0,n.css)`
    display: flex;
    flex-direction: row;
    align-items: center;

    gap: ${a.spacing()};

    background: ${a.colors.background.primary};
    color: ${a.colors.text.secondary};

    border-bottom: solid 1px ${a.colors.border.medium};
    padding: ${a.spacing(1)} ${a.spacing(2)};

    &:last-child {
      border-bottom: none;
    }

    &.isClone {
      border: solid 1px ${a.colors.primary.shade};
    }
  `,listContainer:(0,n.css)`
    user-select: none;
    border: solid 1px ${a.colors.border.medium};
  `,disabled:(0,n.css)`
    opacity: 0.5;
    pointer-events: none;
  `,listItemName:(0,n.css)`
    flex: 1;

    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  `,header:(0,n.css)`
    display: flex;
    align-items: center;

    gap: ${a.spacing(1)};
  `,dataSourceIcon:(0,n.css)`
    width: ${a.spacing(2)};
    height: ${a.spacing(2)};
  `});function Tt(a,r,l){const c=Array.from(a),[s]=c.splice(r,1);return c.splice(l,0,s),c}var et=t(85701),tt=t(50657);const Ge=e.memo(({group:a,namespace:r,expandAll:l,viewMode:c})=>{const{rulesSource:s}=r,o=(0,U.useDispatch)(),i=(0,E.wW)(Nt),[u,d]=(0,e.useState)(!1),[m,D]=(0,e.useState)(!1),[C,N]=(0,e.useState)(!1),[W,L]=(0,e.useState)(void 0),[A,x]=(0,e.useState)(!l),{canEditRules:J}=(0,Pe.B)();(0,e.useEffect)(()=>{x(!l)},[l]);const{hasRuler:ce,rulerRulesLoaded:G}=(0,ft.h)(),B=a.rules[0]?.rulerRule,ne=B&&(0,q.Pc)(B)&&B.grafana_alert.namespace_uid||void 0,{folder:$}=(0,pt.W)(ne),j=ce(s)&&G(s)&&!a.rules.find(ie=>!!ie.rulerRule),Q=(0,q.Jq)(a),de=a.rules.some(ie=>(0,q.Pc)(ie.rulerRule)&&ie.rulerRule.grafana_alert.provenance),V=c==="list",P=c==="grouped",re=()=>{o((0,Fe.oE)(r,a)),D(!1)},Y=[];if(j)Y.push(e.createElement(Ye.Lh,{key:"is-deleting"},e.createElement(be.$,null),"deleting"));else if(s===Z.GC){if(ne){const ie=(0,Se.HV)(ne);$?.canSave&&(P&&!de&&(Y.push(e.createElement(ge.A,{"aria-label":"edit rule group","data-testid":"edit-group",key:"edit",icon:"pen",tooltip:"edit rule group",onClick:()=>d(!0)})),Y.push(e.createElement(ge.A,{"aria-label":"re-order rules","data-testid":"reorder-group",key:"reorder",icon:"exchange-alt",tooltip:"reorder rules",className:i.rotate90,onClick:()=>N(!0)}))),V&&(Y.push(e.createElement(ge.A,{"aria-label":"go to folder",key:"goto",icon:"folder-open",tooltip:"go to folder",to:ie,target:"__blank"})),$?.canAdmin&&Y.push(e.createElement(ge.A,{"aria-label":"manage permissions",key:"manage-perms",icon:"lock",tooltip:"manage permissions",to:ie+"/permissions",target:"__blank"})))),$&&(V?Y.push(e.createElement(ge.A,{"aria-label":"export rule folder","data-testid":"export-folder",key:"export-folder",icon:"download-alt",tooltip:"Export rules folder",onClick:()=>L("folder")})):P&&Y.push(e.createElement(ge.A,{"aria-label":"export rule group","data-testid":"export-group",key:"export-group",icon:"download-alt",tooltip:"Export rule group",onClick:()=>L("group")})))}}else J(s.name)&&ce(s)&&(Q||(Y.push(e.createElement(ge.A,{"aria-label":"edit rule group","data-testid":"edit-group",key:"edit",icon:"pen",tooltip:"edit rule group",onClick:()=>d(!0)})),Y.push(e.createElement(ge.A,{"aria-label":"re-order rules","data-testid":"reorder-group",key:"reorder",icon:"exchange-alt",tooltip:"re-order rules",className:i.rotate90,onClick:()=>N(!0)}))),Y.push(e.createElement(ge.A,{"aria-label":"delete rule group","data-testid":"delete-group",key:"delete-group",icon:"trash-alt",tooltip:"delete rule group",onClick:()=>D(!0)})));const Ee=V?e.createElement(ke.V,{namespace:r.name}):e.createElement(ke.V,{namespace:r.name,group:a.name}),Te=(ie=!1)=>{ie||(0,f.PN)(f.z7.leavingRuleGroupEdit),d(!1)};return e.createElement("div",{className:i.wrapper,"data-testid":"rule-group"},e.createElement("div",{className:i.header,"data-testid":"rule-group-header"},e.createElement(Xe.U,{size:"sm",className:i.collapseToggle,isCollapsed:A,onToggle:x,"data-testid":"group-collapse-toggle"}),e.createElement(k.J,{name:A?"folder":"folder-open"}),(0,Z.jq)(s)&&e.createElement(Ie.u,{content:s.name,placement:"top"},e.createElement("img",{alt:s.meta.name,className:i.dataSourceIcon,src:s.meta.info.logos.small})),e.createElement("div",{className:i.groupName,onClick:()=>x(!A)},Q&&e.createElement($e.C,{color:"purple",text:"Federated"})," ",Ee),e.createElement("div",{className:i.spacer}),e.createElement("div",{className:i.headerStats},e.createElement(et.Pb,{group:a})),de&&e.createElement(e.Fragment,null,e.createElement("div",{className:i.actionsSeparator},"|"),e.createElement("div",{className:i.actionIcons},e.createElement($e.C,{color:"purple",text:"Provisioned"}))),!!Y.length&&e.createElement(e.Fragment,null,e.createElement("div",{className:i.actionsSeparator},"|"),e.createElement("div",{className:i.actionIcons},e.createElement(O.K,{gap:.5},Y)))),!A&&e.createElement(tt.i,{showSummaryColumn:!0,className:i.rulesTable,showGuidelines:!0,showNextEvaluationColumn:!!a.interval,rules:a.rules}),u&&e.createElement(Ct.vq,{namespace:r,group:a,onClose:()=>Te(),folderUrl:$?.canEdit?(0,Se.aH)($):void 0}),C&&e.createElement(Ot,{group:a,namespace:r,onClose:()=>N(!1)}),e.createElement(Et.s,{isOpen:m,title:"Delete group",body:e.createElement("div",null,e.createElement("p",null,'Deleting "',e.createElement("strong",null,a.name),'" will permanently remove the group and'," ",a.rules.length," alert ",oe()("rule",a.rules.length)," belonging to it."),e.createElement("p",null,"Are you sure you want to delete this group?")),onConfirm:re,onDismiss:()=>D(!1),confirmText:"Delete"}),$&&W==="folder"&&e.createElement(vt,{folder:$,onClose:()=>L(void 0)}),$&&W==="group"&&e.createElement(yt,{folderUid:$.uid,groupName:a.name,onClose:()=>L(void 0)}))});Ge.displayName="RulesGroup";const Nt=a=>({wrapper:(0,n.css)``,header:(0,n.css)`
      display: flex;
      flex-direction: row;
      align-items: center;
      padding: ${a.spacing(1)} ${a.spacing(1)} ${a.spacing(1)} 0;
      flex-wrap: nowrap;
      border-bottom: 1px solid ${a.colors.border.weak};

      &:hover {
        background-color: ${a.components.table.rowHoverBackground};
      }
    `,headerStats:(0,n.css)`
      flex-shrink: 0;

      span {
        vertical-align: middle;
      }

      ${a.breakpoints.down("sm")} {
        order: 2;
        width: 100%;
        padding-left: ${a.spacing(1)};
      }
    `,groupName:(0,n.css)`
      margin-left: ${a.spacing(1)};
      margin-bottom: 0;
      cursor: pointer;

      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    `,spacer:(0,n.css)`
      flex: 1;
    `,collapseToggle:(0,n.css)`
      background: none;
      border: none;
      margin-top: -${a.spacing(1)};
      margin-bottom: -${a.spacing(1)};

      svg {
        margin-bottom: 0;
      }
    `,dataSourceIcon:(0,n.css)`
      width: ${a.spacing(2)};
      height: ${a.spacing(2)};
      margin-left: ${a.spacing(2)};
    `,dataSourceOrigin:(0,n.css)`
      margin-right: 1em;
      color: ${a.colors.text.disabled};
    `,actionsSeparator:(0,n.css)`
      margin: 0 ${a.spacing(2)};
    `,actionIcons:(0,n.css)`
      width: 80px;
      align-items: center;

      flex-shrink: 0;
    `,rulesTable:(0,n.css)`
      margin: ${a.spacing(2,0)};
    `,rotate90:(0,n.css)`
      transform: rotate(90deg);
    `});function at(a){return(0,e.useMemo)(()=>a.flatMap(r=>r.groups.map(l=>({namespace:r,group:l}))),[a])}const It=({namespaces:a,expandAll:r})=>{const l=(0,E.wW)(Lt),c=(0,ve._)(x=>x.dataSources),s=(0,ve._)(x=>x.promRules),o=(0,e.useMemo)(Z.Eu,[]),i=at(a),u=(0,e.useMemo)(()=>o.filter(x=>(0,Le.op)(s[x.name])||(0,Le.op)(c[x.name])),[s,c,o]),d=o.some(x=>!!s[x.name]?.result?.length),m=o.length>0,D=u.length>0,C=a.length>0,{numberOfPages:N,onPageChange:W,page:L,pageItems:A}=(0,Ze.h)(i,1,Ve.gN);return e.createElement("section",{className:l.wrapper},e.createElement("div",{className:l.sectionHeader},e.createElement("h5",null,"Mimir / Cortex / Loki"),u.length?e.createElement(X.u,{className:l.loader,text:`Loading rules from ${u.length} ${oe()("source",u.length)}`}):e.createElement("div",null)),A.map(({group:x,namespace:J})=>e.createElement(Ge,{group:x,key:`${(0,Z.v_)(J.rulesSource)}-${J.name}-${x.name}`,namespace:J,expandAll:r,viewMode:"grouped"})),!m&&e.createElement("p",null,"There are no Prometheus or Loki data sources configured."),m&&!D&&!C&&e.createElement("p",null,"No rules found."),!d&&D&&e.createElement(be.$,{size:"xl",className:l.spinner}),e.createElement(Qe.t,{className:l.pagination,currentPage:L,numberOfPages:N,onNavigate:W,hideWhenSinglePage:!0}))},Lt=a=>({loader:(0,n.css)`
    margin-bottom: 0;
  `,sectionHeader:(0,n.css)`
    display: flex;
    justify-content: space-between;
  `,wrapper:(0,n.css)`
    margin-bottom: ${a.spacing(4)};
  `,spinner:(0,n.css)`
    text-align: center;
    padding: ${a.spacing(2)};
  `,pagination:(0,Je.Z)(a)});var Oe=t(68700);const Ft=({namespaces:a,expandAll:r})=>{const l=(0,E.wW)(Wt),[c]=(0,T.K)(),{prom:s,ruler:o}=(0,ve._)(A=>({prom:A.promRules[Z.GC]||Le.oq,ruler:A.rulerRules[Z.GC]||Le.oq})),i=s.loading||o.loading,u=!!s.result||!!o.result,d=c.view==="list",m=d?(0,Oe.Kd)(a):a,D=at(m),{numberOfPages:C,onPageChange:N,page:W,pageItems:L}=(0,Ze.h)(D,1,Ve.gN);return e.createElement("section",{className:l.wrapper},e.createElement("div",{className:l.sectionHeader},e.createElement("h5",null,"Grafana"),i?e.createElement(X.u,{className:l.loader,text:"Loading..."}):e.createElement("div",null)),L.map(({group:A,namespace:x})=>e.createElement(Ge,{group:A,key:`${x.name}-${A.name}`,namespace:x,expandAll:r,viewMode:d?"list":"grouped"})),u&&m?.length===0&&e.createElement("p",null,"No rules found."),!u&&i&&e.createElement(be.$,{size:"xl",className:l.spinner}),e.createElement(Qe.t,{className:l.pagination,currentPage:W,numberOfPages:C,onNavigate:N,hideWhenSinglePage:!0}))},Wt=a=>({loader:(0,n.css)`
    margin-bottom: 0;
  `,sectionHeader:(0,n.css)`
    display: flex;
    justify-content: space-between;
    margin-bottom: ${a.spacing(1)};
  `,wrapper:(0,n.css)`
    margin-bottom: ${a.spacing(4)};
  `,spinner:(0,n.css)`
    text-align: center;
    padding: ${a.spacing(2)};
  `,pagination:(0,Je.Z)(a)}),Ut=({namespaces:a,expandAll:r})=>{const[l,c]=(0,e.useMemo)(()=>{const s=a.map(o=>({...o,groups:o.groups.sort((i,u)=>i.name.localeCompare(u.name))})).sort((o,i)=>o.name.localeCompare(i.name));return[s.filter(o=>(0,Z.HY)(o.rulesSource)),s.filter(o=>(0,Z.jq)(o.rulesSource))]},[a]);return(0,e.useEffect)(()=>{(0,f.PN)(f.z7.loadedList)},[]),e.createElement(e.Fragment,null,e.createElement(we.q,{actions:[z.jU.ViewAlertRule]},e.createElement(Ft,{namespaces:l,expandAll:r})),e.createElement(we.q,{actions:[z.jU.ViewExternalAlertRule]},e.createElement(It,{namespaces:c,expandAll:r})))};var w=t(25119);const ze=({rules:a,state:r,defaultCollapsed:l=!1})=>{const[c,s]=(0,e.useState)(l),o=(0,E.wW)(bt);return e.createElement(e.Fragment,null,e.createElement("h4",{className:o.header},e.createElement(Xe.U,{className:o.collapseToggle,size:"xxl",isCollapsed:c,onToggle:()=>s(!c)}),(0,q.SS)(r)," (",a.length,")"),!c&&e.createElement(tt.i,{className:o.rulesTable,rules:a,showGroupColumn:!0}))},bt=a=>({collapseToggle:(0,n.css)`
    vertical-align: middle;
  `,header:(0,n.css)`
    margin-top: ${a.spacing(2)};
  `,rulesTable:(0,n.css)`
    margin-top: ${a.spacing(3)};
  `}),$t=({namespaces:a})=>{const r=(0,Se.lC)((0,T.K)()[0]),l=(0,e.useMemo)(()=>{const c={[w.x_.Firing]:[],[w.x_.Inactive]:[],[w.x_.Pending]:[]};return a.forEach(s=>s.groups.forEach(o=>o.rules.forEach(i=>{i.promRule&&(0,q.x_)(i.promRule)&&c[i.promRule.state].push(i)}))),Object.values(c).forEach(s=>s.sort((o,i)=>o.name.localeCompare(i.name))),c},[a]);return e.createElement(e.Fragment,null,(!r.alertState||r.alertState===w.x_.Firing)&&e.createElement(ze,{state:w.x_.Firing,rules:l[w.x_.Firing]}),(!r.alertState||r.alertState===w.x_.Pending)&&e.createElement(ze,{state:w.x_.Pending,rules:l[w.x_.Pending]}),(!r.alertState||r.alertState===w.x_.Inactive)&&e.createElement(ze,{defaultCollapsed:r.alertState!==w.x_.Inactive,state:w.x_.Inactive,rules:l[w.x_.Inactive]}))};var Bt=t(10476),nt=t(20519),De=t(57445),We=t(5106),Kt=t(24956),Gt=t(51670),zt=t(93638),rt=t(81502),Me=t(35782),Ue=t(98724),jt=t(41460),Ht=t(75636);function lt(){const[a,r]=(0,Ht.j)(),l=a.get("search")??"",c=(0,e.useMemo)(()=>(0,Me.ug)(l),[l]),s=(0,e.useMemo)(()=>Object.values(c).some(u=>!(0,S.isEmpty)(u)),[c]),o=(0,e.useCallback)(u=>{const d=(0,Me.HY)(l,u);r({search:d})},[l,r]),i=(0,e.useCallback)(u=>{r({search:u})},[r]);return(0,e.useEffect)(()=>{const u={dataSource:a.get("dataSource")??void 0,alertState:a.get("alertState")??void 0,ruleType:a.get("ruleType")??void 0,labels:(0,Ue.Zh)(a.get("queryString")??"").map(Ue.cm)};Object.values(u).some(m=>!(0,S.isEmpty)(m))&&(r({dataSource:void 0,alertState:void 0,ruleType:void 0,queryString:void 0}),o((0,zt.Uy)(c,m=>{if(m.dataSourceNames??=u.dataSource?[u.dataSource]:[],u.alertState&&(0,w.I9)(u.alertState)&&(m.ruleState??=u.alertState),u.ruleType&&(0,q.Wd)(u.ruleType)&&(m.ruleType??=u.ruleType),m.labels.length===0&&u.labels.length>0){const D=u.labels.map(({name:C,operator:N,value:W})=>`${C}${N}${W}`);m.labels.push(...D)}})))},[a,o,c,r]),{filterState:c,hasActiveFilters:s,searchQuery:l,setSearchQuery:i,updateFilters:o}}const wt=(a,r)=>(0,e.useMemo)(()=>{const l=Qt(a,r);return l.forEach(c=>{c.groups.forEach(s=>{s.rules.forEach(o=>{(0,q.x_)(o.promRule)&&(o.instanceTotals=(0,Oe.Fm)(o.promRule),o.filteredInstanceTotals=(0,Oe.ZP)(o.promRule))}),s.totals=(0,Oe.DD)({rules:s.rules.map(o=>o.promRule).filter(o=>!!o)})})}),l},[a,r]),je=new Gt.Z({intraMode:1,intraIns:1,intraSub:1,intraTrn:1,intraDel:1}),Qt=(a,r={dataSourceNames:[],labels:[],freeFormWords:[]})=>{let l=a;const c=r.dataSourceNames;c.length&&(l=l.filter(({rulesSource:o})=>(0,Z.jq)(o)?c.includes(o.name):!0));const s=r.namespace;if(s){const o=l.map(m=>m.name),[i,u,d]=je.search(o,s);u&&d?l=d.map(m=>l[u.idx[m]]):i&&(l=i.map(m=>l[m]))}return l.reduce(Vt(r),[])},Vt=a=>(r,l)=>{const c=a.groupName;let s=l.groups;if(c){const o=s.map(m=>m.name),[i,u,d]=je.search(o,c);u&&d?s=d.map(m=>s[u.idx[m]]):i&&(s=i.map(m=>s[m]))}return s=s.reduce(Zt(a),[]),s.length&&r.push({...l,groups:s}),r},Zt=a=>{const r=a.ruleName??a.freeFormWords.join(" ");return(l,c)=>{let s=c.rules;if(r){const o=s.map(m=>m.name),[i,u,d]=je.search(o,r);u&&d?s=d.map(m=>s[u.idx[m]]):i&&(s=i.map(m=>s[m]))}return s=s.filter(o=>{const i=o.promRule,u=(0,S.chain)(a).pick(["ruleType","dataSourceNames","ruleHealth","labels","ruleState"]).omitBy(S.isEmpty).mapValues(()=>!1).value();if("ruleType"in u&&a.ruleType===i?.type&&(u.ruleType=!0),"dataSourceNames"in u&&(0,q.Pc)(o.rulerRule)&&Yt(o.rulerRule,a)&&(u.dataSourceNames=!0),"ruleHealth"in a&&i){const d=(0,q.vU)(i.health);a.ruleHealth===d&&(u.ruleHealth=!0)}if("labels"in u){const d=(0,S.compact)(a.labels.map(Jt)),m=d.length>0&&(0,Ue.eD)(o.labels,d),D=d.length>0&&i&&i.type===w.pz.Alerting&&i.alerts&&i.alerts.some(C=>(0,Ue.eD)(C.labels,d));(m||D)&&(u.labels=!0)}if("ruleState"in u){const d=o.promRule;d&&(0,q.x_)(d)&&d.state===a.ruleState&&(u.ruleState=!0)}return Object.values(u).every(d=>d===!0)}),s.length&&l.push({...c,rules:s}),l}};function Jt(a){try{return(0,jt.tC)(a)}catch{return{name:a,value:"",isRegex:!0,isEqual:!0}}}const Yt=(a,r)=>r.dataSourceNames?.length?!!a.grafana_alert.data.find(l=>{if(!l.datasourceUid)return!1;const c=(0,rt.F)().getInstanceSettings(l.datasourceUid);return c?.name&&r?.dataSourceNames?.includes(c.name)}):!0;var Xt=t(23595),kt=t(52219),qt=t(1058),st=t(92369),ot=t(32063),_t=t(27436),ea=t(15343);const ta=a=>{const r=(0,rt.F)(),[l,c]=(0,e.useState)(),s=(G,B)=>{if(B.action==="clear"&&a.onClear){a.onClear();return}const ne=G[G.length-1];let $,j;B.action==="pop-value"||B.action==="remove-value"?($=B.removedValue?.value,j="remove"):($=ne.value,j="add");const Q=r.getInstanceSettings($);Q&&(a.onChange(Q,j),c({error:void 0}))},o=()=>{const{current:G,hideTextValue:B,noDefault:ne}=a;if(!(!G&&ne))return G?.map($=>{const j=r.getInstanceSettings($);if(j)return{label:j.name.slice(0,37),value:j.name,imgUrl:j.meta.info.logos.small,hideText:B,meta:j.meta};const Q=(0,kt.BT)($);return Q===ot.hr.uid||Q===ot.hr.name?{label:Q,value:Q,hideText:B}:{label:(Q??"no name")+" - not found",value:Q??void 0,imgUrl:"",hideText:B}})},i=()=>{const{alerting:G,tracing:B,metrics:ne,mixed:$,dashboard:j,variables:Q,annotations:de,pluginId:V,type:P,filter:re,logs:Y}=a,Ee=r.getList({alerting:G,tracing:B,metrics:ne,logs:Y,dashboard:j,mixed:$,variables:Q,annotations:de,pluginId:V,filter:re,type:P}),Te=Ee.filter(Z.G_).map(te=>({value:te.name,label:`${te.name}${te.isDefault?" (default)":""}`,imgUrl:te.meta.info.logos.small,meta:te.meta})),ie=Ee.filter(te=>!(0,Z.G_)(te)).map(te=>({value:te.name,label:`${te.name}${te.isDefault?" (default)":""}`,imgUrl:te.meta.info.logos.small,meta:te.meta}));return[{label:"Data sources with configured alert rules",options:Te,expanded:!0},{label:"Other data sources",options:ie,expanded:!0}]},{autoFocus:u,onBlur:d,onClear:m,openMenuOnFocus:D,placeholder:C,width:N,inputId:W,disabled:L=!1,isLoading:A=!1}=a,x=i(),J=o(),ce=typeof m=="function";return e.createElement("div",{"data-testid":st.wl.components.DataSourcePicker.container},e.createElement(_t.NU,{isLoading:A,disabled:L,"data-testid":st.wl.components.DataSourcePicker.inputV2,inputId:W||"data-source-picker",className:"ds-picker select-container",isClearable:ce,backspaceRemovesValue:!0,onChange:s,options:x,autoFocus:u,onBlur:d,width:N,openMenuOnFocus:D,maxMenuHeight:500,placeholder:C,noOptionsMessage:"No datasources found",value:J??[],invalid:!!l?.error||!!a.invalid,getOptionLabel:G=>G.meta&&(0,qt.x)(G.meta.signature)&&G!==J?e.createElement(Ye.Lh,{align:"center",justify:"space-between",height:"auto"},e.createElement("span",null,G.label)," ",e.createElement(ea.o,{status:G.meta.signature})):G.label||""}))},ct=[{icon:"folder",label:"Grouped",value:"grouped"},{icon:"list-ul",label:"List",value:"list"},{icon:"heart-rate",label:"State",value:"state"}],aa=[{label:"Alert ",value:w.pz.Alerting},{label:"Recording ",value:w.pz.Recording}],na=[{label:"Ok",value:Me.VG.Ok},{label:"No Data",value:Me.VG.NoData},{label:"Error",value:Me.VG.Error}],ra=Object.entries(w.x_).map(([a,r])=>({label:(0,q.SS)(r),value:r})),la=({onFilterCleared:a=()=>{}})=>{const r=(0,E.wW)(sa),[l,c]=(0,T.K)(),{filterState:s,hasActiveFilters:o,searchQuery:i,setSearchQuery:u,updateFilters:d}=lt(),[m,D]=(0,e.useState)(Math.floor(Math.random()*100)),C=`dataSource-${m}`,N=`queryString-${m}`,W=(0,e.useRef)(null),{handleSubmit:L,register:A,setValue:x}=(0,Bt.cI)({defaultValues:{searchQuery:i}}),{ref:J,...ce}=A("searchQuery");(0,e.useEffect)(()=>{x("searchQuery",i)},[i,x]);const G=(P,re)=>{const Y=re==="add"?[...s.dataSourceNames].concat([P.name]):s.dataSourceNames.filter(Ee=>Ee!==P.name);d({...s,dataSourceNames:Y}),D(Ee=>Ee+1)},B=()=>{d({...s,dataSourceNames:[]}),D(P=>P+1)},ne=P=>{(0,f.PN)(f.z7.clickingAlertStateFilters),d({...s,ruleState:P}),D(re=>re+1)},$=P=>{c({view:P})},j=P=>{d({...s,ruleType:P}),D(re=>re+1)},Q=P=>{d({...s,ruleHealth:P}),D(re=>re+1)},de=()=>{u(void 0),a(),setTimeout(()=>D(m+1),100)},V=e.createElement(k.J,{name:"search"});return e.createElement("div",{className:r.container},e.createElement(O.K,{direction:"column",gap:1},e.createElement(O.K,{direction:"row",gap:1},e.createElement(nt.g,{className:r.dsPickerContainer,label:e.createElement(De._,{htmlFor:"data-source-picker"},e.createElement(O.K,{gap:.5},e.createElement("span",null,"Search by data sources"),e.createElement(Ie.u,{content:e.createElement("div",null,e.createElement("p",null,"Data sources containing configured alert rules are Mimir or Loki data sources where alert rules are stored and evaluated in the data source itself."),e.createElement("p",null,"In these data sources, you can select Manage alerts via Alerting UI to be able to manage these alert rules in the Grafana UI as well as in the data source where they were configured."))},e.createElement(k.J,{name:"info-circle",size:"sm"}))))},e.createElement(ta,{key:C,alerting:!0,noDefault:!0,placeholder:"All data sources",current:s.dataSourceNames,onChange:G,onClear:B})),e.createElement("div",null,e.createElement(De._,null,"State"),e.createElement(We.S,{options:ra,value:s.ruleState,onChange:ne})),e.createElement("div",null,e.createElement(De._,null,"Rule type"),e.createElement(We.S,{options:aa,value:s.ruleType,onChange:j})),e.createElement("div",null,e.createElement(De._,null,"Health"),e.createElement(We.S,{options:na,value:s.ruleHealth,onChange:Q}))),e.createElement(O.K,{direction:"column",gap:1},e.createElement(O.K,{direction:"row",gap:1},e.createElement("form",{className:r.searchInput,onSubmit:L(P=>{u(P.searchQuery),W.current?.blur()})},e.createElement(nt.g,{label:e.createElement(De._,{htmlFor:"rulesSearchInput"},e.createElement(O.K,{gap:.5},e.createElement("span",null,"Search"),e.createElement(Xt.z,{content:e.createElement(oa,null)},e.createElement(k.J,{name:"info-circle",size:"sm",tabIndex:0}))))},e.createElement(Kt.I,{id:"rulesSearchInput",key:N,prefix:V,ref:P=>{J(P),W.current=P},...ce,placeholder:"Search","data-testid":"search-query-input"})),e.createElement("input",{type:"submit",hidden:!0})),e.createElement("div",null,e.createElement(De._,null,"View as"),e.createElement(We.S,{options:ct,value:String(l.view??ct[0].value),onChange:$}))),o&&e.createElement("div",null,e.createElement(R.zx,{fullWidth:!1,icon:"times",variant:"secondary",onClick:de},"Clear filters")))))},sa=a=>({container:(0,n.css)`
      margin-bottom: ${a.spacing(1)};
    `,dsPickerContainer:(0,n.css)`
      width: 550px;
      flex-grow: 0;
      margin: 0;
    `,searchInput:(0,n.css)`
      flex: 1;
      margin: 0;
    `});function oa(){const a=(0,E.wW)(it);return e.createElement("div",null,e.createElement("div",null,"Search syntax allows to query alert rules by the parameters defined below."),e.createElement("hr",null),e.createElement("div",{className:a.grid},e.createElement("div",null,"Filter type"),e.createElement("div",null,"Expression"),e.createElement(he,{title:"Datasources",expr:"datasource:mimir datasource:prometheus"}),e.createElement(he,{title:"Folder/Namespace",expr:"namespace:global"}),e.createElement(he,{title:"Group",expr:"group:cpu-usage"}),e.createElement(he,{title:"Rule",expr:'rule:"cpu 80%"'}),e.createElement(he,{title:"Labels",expr:"label:team=A label:cluster=a1"}),e.createElement(he,{title:"State",expr:"state:firing|normal|pending"}),e.createElement(he,{title:"Type",expr:"type:alerting|recording"}),e.createElement(he,{title:"Health",expr:"health:ok|nodata|error"})))}function he({title:a,expr:r}){const l=(0,E.wW)(it);return e.createElement(e.Fragment,null,e.createElement("div",null,a),e.createElement("code",{className:l.code},r))}const it=a=>({grid:(0,n.css)`
    display: grid;
    grid-template-columns: max-content auto;
    gap: ${a.spacing(1)};
    align-items: center;
  `,code:(0,n.css)`
    display: block;
    text-align: center;
  `}),ca=la;var ia=t(46002);const ut={groups:Ut,state:$t},ua=ee.gr+1,ma=(0,y.Pf)(()=>{const a=(0,U.useDispatch)(),r=(0,E.wW)(da),l=(0,e.useMemo)(Z.mA,[]),[c,s]=(0,e.useState)(!1),o=(0,e.useCallback)(()=>s(!1),[]),[i]=(0,T.K)(),{filterState:u,hasActiveFilters:d}=lt(),m=ut[i.view]?i.view:"groups",D=ut[m],C=(0,ve._)(V=>V.promRules),N=(0,ve._)(V=>V.rulerRules),W=l.some(V=>C[V]?.loading||N[V]?.loading),L=Object.entries(C),A=Object.entries(N),x=L.every(([V,P])=>P.dispatched&&(P?.result!==void 0||P?.error!==void 0)),J=A.every(([V,P])=>P.dispatched&&(P?.result!==void 0||P?.error!==void 0)),ce=L.every(([V,P])=>P.dispatched&&P?.result?.length===0),G=A.every(([V,P])=>Object.entries(P?.result??{}).every(([Ee,Te])=>Te?.length===0)&&P.dispatched),B=d?void 0:ua,[ne,$]=(0,g.Z)(async()=>{W||await a((0,Fe.ei)(!1,{limitAlerts:B}))},[W,B,a]);(0,e.useEffect)(()=>{(0,f.$I)().catch(()=>{})},[]),(0,e.useEffect)(()=>{a((0,Fe.ei)(!1,{limitAlerts:B}))},[a,B]),(0,h.Z)($,ia.p4);const j=x&&ce&&L.length>0&&G&&J,Q=(0,Oe.Zo)(),de=wt(Q,u);return e.createElement(Ce.J,{pageId:"alert-list",isLoading:!1},e.createElement(dt,null),e.createElement(ca,{onFilterCleared:o}),!j&&e.createElement(e.Fragment,null,e.createElement("div",{className:r.break}),e.createElement("div",{className:r.buttonsContainer},e.createElement("div",{className:r.statsContainer},m==="groups"&&d&&e.createElement(R.zx,{className:r.expandAllButton,icon:c?"angle-double-up":"angle-double-down",variant:"secondary",onClick:()=>s(!c)},c?"Collapse all":"Expand all"),e.createElement(et.WN,{namespaces:de})),e.createElement(O.K,{direction:"row",gap:.5},e.createElement(me,null)))),j&&e.createElement(M,null),!j&&e.createElement(D,{expandAll:c,namespaces:de}))},{style:"page"}),da=a=>({break:(0,n.css)`
    width: 100%;
    height: 0;
    margin-bottom: ${a.spacing(2)};
    border-bottom: solid 1px ${a.colors.border.medium};
  `,buttonsContainer:(0,n.css)`
    margin-bottom: ${a.spacing(2)};
    display: flex;
    justify-content: space-between;
  `,statsContainer:(0,n.css)`
    display: flex;
    flex-direction: row;
    align-items: center;
  `,expandAllButton:(0,n.css)`
    margin-right: ${a.spacing(1)};
  `}),ga=ma},53914:(_,I,t)=>{t.d(I,{q:()=>y});var n=t(56375),e=t.n(n),g=t(85960),h=t(57297);const y=({actions:f,children:S})=>{const p=(0,n.filter)(f,T),v=(0,n.filter)(f,U);return p.length?g.createElement(E,{actions:p},S):v.length?g.createElement(R,{actions:v},S):null},E=({actions:f,children:S})=>{const p=(0,h.Mz)();return O(p,f)?g.createElement(g.Fragment,null,S):null},R=({actions:f,children:S})=>{const p=(0,h.K_)();return O(p,f)?g.createElement(g.Fragment,null,S):null};function O(f,S){return(0,n.chain)(f).pick(S).values().value().some(([p,v])=>v===!0)}function T(f){return Object.values(h.oI).includes(f)}function U(f){return Object.values(h.jU).includes(f)}},27908:(_,I,t)=>{t.d(I,{u:()=>f});var n=t(66681),e=t(78344),g=t.n(e),h=t(85960),y=t(53565),E=t(47257),R=t(62577),O=t(29165),T=t(55855),U=t(23694);function f({format:p,textDefinition:v,downloadFileName:F,onClose:H}){const le=(0,E.wW)(S),ye=(0,h.useCallback)(()=>{const X=new Blob([v],{type:`application/${p};charset=utf-8`});g()(X,`${F}.${p}`)},[v,F,p]),k=(0,h.useMemo)(()=>{const X=U.uN[p];return X.formatter?X.formatter(v):v},[p,v]);return h.createElement("div",{className:le.container},h.createElement("div",{className:le.content},h.createElement(y.Z,{disableWidth:!0},({height:X})=>h.createElement(R.p,{width:"100%",height:X,language:p,value:k,monacoOptions:{minimap:{enabled:!1},scrollBeyondLastLine:!1,lineNumbers:"on",readOnly:!0}}))),h.createElement("div",{className:le.actions},h.createElement(O.zx,{variant:"secondary",onClick:H},"Cancel"),h.createElement(T.m,{icon:"copy",getText:()=>v},"Copy code"),h.createElement(O.zx,{icon:"download-alt",onClick:ye},"Download")))}const S=p=>({container:(0,n.css)`
    display: flex;
    flex-direction: column;
    height: 100%;
    gap: ${p.spacing(2)};
  `,content:(0,n.css)`
    flex: 1 1 100%;
  `,actions:(0,n.css)`
    flex: 0;
    justify-content: flex-end;
    display: flex;
    gap: ${p.spacing(1)};
  `})},29657:(_,I,t)=>{t.d(I,{i:()=>h});var n=t(85960),e=t(63153),g=t(47831);function h({activeTab:y,onTabChange:E,children:R,onClose:O,formatProviders:T,title:U="Export"}){const f=Object.values(T).map(S=>({label:S.name,value:S.exportFormat}));return n.createElement(e.d,{title:U,subtitle:"Select the format and download the file or copy the contents to clipboard",tabs:n.createElement(g.mg,{tabs:f,setActiveTab:E,activeTab:y}),onClose:O,size:"md"},R)}},23694:(_,I,t)=>{t.d(I,{uN:()=>h});const n={name:"JSON",exportFormat:"json",formatter:E=>{try{return JSON.stringify(JSON.parse(E),null,4)}catch{return E}}},e={name:"YAML",exportFormat:"yaml"},g={name:"Terraform (HCL)",exportFormat:"hcl"},h={[n.exportFormat]:n,[e.exportFormat]:e,[g.exportFormat]:g},y=[n,e]},21863:(_,I,t)=>{t.d(I,{h:()=>O});var n=t(66681),e=t(85960),g=t(47257),h=t(57652),y=t(13086),E=t(97666),R=t(40377);function O({contentText:U,externalLink:f,linkText:S,title:p}){const v=(0,g.wW)(T);return e.createElement(h.P,{content:e.createElement("div",{className:v.mutedText},U),title:e.createElement(y.K,{gap:1,direction:"row"},e.createElement(E.J,{name:"question-circle"}),p),footer:f?e.createElement("a",{href:f,target:"_blank",rel:"noreferrer"},e.createElement(y.K,{direction:"row",gap:.5,alignItems:"center"},e.createElement(R.x,{color:"link"},S," ",e.createElement(E.J,{size:"sm",name:"external-link-alt"})))):void 0,closeButton:!0,placement:"bottom-start"},e.createElement("div",{className:v.helpInfo},e.createElement(y.K,{direction:"row",alignItems:"center",gap:.5},e.createElement(E.J,{name:"question-circle",size:"sm"}),e.createElement(R.x,{variant:"bodySmall",color:"primary"},"Need help?"))))}const T=U=>({mutedText:(0,n.css)`
    color: ${U.colors.text.secondary};
    font-size: ${U.typography.size.sm};
  `,helpInfo:(0,n.css)`
    cursor: pointer;
    text-decoration: underline;
  `})},78985:(_,I,t)=>{t.d(I,{z:()=>R});var n=t(66681),e=t(85960),g=t(47257),h=t(51637),y=t(40377),E=t(13086);const R=({title:T,stepNo:U,children:f,fullWidth:S=!1,description:p})=>{const v=(0,g.wW)(O);return e.createElement("div",{className:v.parent},e.createElement(h.C,{className:(0,n.cx)(S&&v.fullWidth),label:e.createElement(y.x,{variant:"h3"},U,". ",T)},e.createElement(E.K,{direction:"column"},p&&e.createElement("div",{className:v.description},p),f)))},O=T=>({parent:(0,n.css)`
    display: flex;
    flex-direction: row;
    max-width: ${T.breakpoints.values.xl}px;
    border: solid 1px ${T.colors.border.weak};
    border-radius: ${T.shape.radius.default};
    padding: ${T.spacing(2)} ${T.spacing(3)};
  `,description:(0,n.css)`
    margin-top: -${T.spacing(2)};
  `,fullWidth:(0,n.css)`
    width: 100%;
  `})},47831:(_,I,t)=>{t.d(I,{CU:()=>le,mg:()=>ye});var n=t(66681),e=t(48525),g=t(85960),h=t(10476),y=t(53565),E=t(47257),R=t(63153),O=t(70523),T=t(94439),U=t(29165),f=t(14607),S=t(97666),p=t(62577),v=t(38884),F=t(9001);const H=[{label:"Yaml",value:"yaml"}],le=({onClose:K})=>{const[se,ue]=(0,g.useState)("yaml"),{setValue:z}=(0,h.Gc)(),me=(0,E.wW)(pe),Ce=fe=>{for(const ae in fe)z(ae,fe[ae]);K()};return g.createElement(R.d,{title:"Inspect Alert rule",subtitle:g.createElement("div",{className:me.subtitle},g.createElement(ye,{tabs:H,setActiveTab:ue,activeTab:se})),onClose:K},se==="yaml"&&g.createElement(k,{onSubmit:Ce}))};function ye({tabs:K,activeTab:se,setActiveTab:ue}){return g.createElement(O.J,null,K.map((z,me)=>g.createElement(T.O,{key:`${z.value}-${me}`,label:z.label,value:z.value,onChangeTab:()=>ue(z.value),active:se===z.value})))}const k=({onSubmit:K})=>{const se=(0,E.wW)(Re),{getValues:ue}=(0,h.Gc)(),z=(0,v.yh)(ue()),[me,Ce]=(0,g.useState)((0,e.$w)(z)),fe=()=>{const ae=(0,e.zD)(me),Pe=ue(),M=xe(ae);K({...Pe,...M})};return g.createElement(g.Fragment,null,g.createElement("div",{className:se.applyButton},g.createElement(U.zx,{type:"button",onClick:fe},"Apply"),g.createElement(f.u,{content:g.createElement(X,null),theme:"info",placement:"left-start",interactive:!0},g.createElement(S.J,{name:"exclamation-triangle",size:"xl"}))),g.createElement("div",{className:se.content},g.createElement(y.Z,{disableWidth:!0},({height:ae})=>g.createElement(p.p,{width:"100%",height:ae,language:"yaml",value:me,onBlur:Ce,monacoOptions:{minimap:{enabled:!1}}}))))};function X(){return g.createElement("div",null,"The YAML content in the editor only contains alert rule configuration ",g.createElement("br",null),"To configure Prometheus, you need to provide the rest of the"," ",g.createElement("a",{href:"https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/",target:"_blank",rel:"noreferrer"},"configuration file content."))}function xe(K){return(0,F.cG)(K)?(0,v.WL)(K):(0,F.yF)(K)?(0,v.lN)(K):{}}const Re=K=>({content:(0,n.css)`
    flex-grow: 1;
    height: 100%;
    padding-bottom: 16px;
    margin-bottom: ${K.spacing(2)};
  `,applyButton:(0,n.css)`
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    flex-grow: 0;
    margin-bottom: ${K.spacing(2)};
  `}),pe=()=>({subtitle:(0,n.css)`
    display: flex;
    align-items: center;
    justify-content: space-between;
  `})},90504:(_,I,t)=>{t.d(I,{A:()=>h});var n=t(85960),e=t(14607),g=t(29165);const h=({tooltip:y,icon:E,to:R,target:O,onClick:T,className:U,tooltipPlacement:f="top",...S})=>{const p=typeof y=="string"?y:void 0;return n.createElement(e.u,{content:y,placement:f},R?n.createElement(g.Qj,{variant:"secondary",fill:"text",icon:E,href:R,size:"sm",target:O,...S,"aria-label":p}):n.createElement(g.zx,{className:U,variant:"secondary",fill:"text",size:"sm",icon:E,type:"button",onClick:T,...S,"aria-label":p}))}},75636:(_,I,t)=>{t.d(I,{j:()=>h});var n=t(85960),e=t(30694),g=t(91);function h(){const{search:y}=(0,e.TH)(),E=(0,n.useMemo)(()=>new URLSearchParams(y),[y]),R=(0,n.useCallback)((O,T)=>{g.E1.partial(O,T)},[]);return[E,R]}},23426:(_,I,t)=>{t.d(I,{Z:()=>g});var n=t(85960),e=function(h,y){var E=(0,n.useRef)(function(){});(0,n.useEffect)(function(){E.current=h}),(0,n.useEffect)(function(){if(y!==null){var R=setInterval(function(){return E.current()},y||0);return function(){return clearInterval(R)}}},[y])};const g=e}}]);

//# sourceMappingURL=AlertRuleListIndex.747c2a32e19232e1e6e9.js.map