"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[890],{76581:(V,W,a)=>{a.d(W,{i:()=>P});var p=a(66681),n=a(85960),t=a(47257);const P=({hideLine:D=!1})=>{const d=(0,t.wW)(R);return D?n.createElement("hr",{className:d.dividerHideLine}):n.createElement("hr",{className:d.divider})},R=D=>({divider:(0,p.css)({margin:D.spacing(4,0)}),dividerHideLine:(0,p.css)({border:"none",margin:D.spacing(3,0)})})},42056:(V,W,a)=>{a.d(W,{I:()=>F});var p=a(66681),n=a(85960),t=a(52219),P=a(15889),R=a(47257),D=a(81368),d=a(84933),g=a(5999),j=a(7033);function K({options:T,onOptionsChange:I}){const O=(0,R.wW)(b);return n.createElement("div",{className:O.container},n.createElement(D.Z,{className:O.row},n.createElement(d._,{tooltip:"Displays the node graph above the trace view. Default: disabled",label:"Enable node graph",labelWidth:26},n.createElement(g.x,{id:"enableNodeGraph",value:T.jsonData.nodeGraph?.enabled,onChange:L=>(0,t.tp)({onOptionsChange:I,options:T},"nodeGraph",{...T.jsonData.nodeGraph,enabled:L.currentTarget.checked})}))))}const F=({options:T,onOptionsChange:I})=>{let O=T.type;return O+=T.type==="tempo"?"/configure-tempo-data-source/#node-graph":"/#node-graph",n.createElement(P._,{title:"Node graph",description:n.createElement(j.W,{description:"Show or hide the node graph visualization.",suffix:O,feature:"the node graph"})},n.createElement(K,{options:T,onOptionsChange:I}))},b=T=>({infoText:(0,p.css)({label:"infoText",paddingBottom:T.spacing(2),color:T.colors.text.secondary}),container:(0,p.css)({label:"container",width:"100%"}),row:(0,p.css)({label:"row",alignItems:"baseline"})})},261:(V,W,a)=>{a.d(W,{Y:()=>L});var p=a(66681),n=a(85960),t=a(52219),P=a(57773),R=a(47257),D=a(81368),d=a(84933),g=a(29165),j=a(24956),K=a(40715),F=a(7033),b=a(42177),T=a(7734),I=a(29724);function O({options:l,onOptionsChange:f}){const N=(0,R.wW)(H);return n.createElement("div",{className:(0,p.css)({width:"100%"})},n.createElement(D.Z,{className:N.row},n.createElement(d._,{tooltip:"The Prometheus data source the trace is going to navigate to",label:"Data source",labelWidth:26},n.createElement(K.q,{inputId:"trace-to-metrics-data-source-picker",pluginId:"prometheus",current:l.jsonData.tracesToMetrics?.datasourceUid,noDefault:!0,width:40,onChange:y=>(0,t.tp)({onOptionsChange:f,options:l},"tracesToMetrics",{...l.jsonData.tracesToMetrics,datasourceUid:y.uid})})),l.jsonData.tracesToMetrics?.datasourceUid?n.createElement(g.zx,{type:"button",variant:"secondary",size:"sm",fill:"text",onClick:()=>{(0,t.tp)({onOptionsChange:f,options:l},"tracesToMetrics",{...l.jsonData.tracesToMetrics,datasourceUid:void 0})}},"Clear"):null),n.createElement(D.Z,null,n.createElement(b.w,{label:(0,I.mH)("start"),tooltip:(0,I.rr)("start","-2m"),value:l.jsonData.tracesToMetrics?.spanStartTimeShift||"",onChange:y=>{(0,t.tp)({onOptionsChange:f,options:l},"tracesToMetrics",{...l.jsonData.tracesToMetrics,spanStartTimeShift:y})},placeholder:"-2m",isInvalidError:I.Ny})),n.createElement(D.Z,null,n.createElement(b.w,{label:(0,I.mH)("end"),tooltip:(0,I.rr)("end","2m"),value:l.jsonData.tracesToMetrics?.spanEndTimeShift||"",onChange:y=>{(0,t.tp)({onOptionsChange:f,options:l},"tracesToMetrics",{...l.jsonData.tracesToMetrics,spanEndTimeShift:y})},placeholder:"2m",isInvalidError:I.Ny})),n.createElement(D.Z,null,n.createElement(d._,{tooltip:"Tags that will be used in the metrics query",label:"Tags",labelWidth:26},n.createElement(T.a,{values:l.jsonData.tracesToMetrics?.tags??[],onChange:y=>(0,t.tp)({onOptionsChange:f,options:l},"tracesToMetrics",{...l.jsonData.tracesToMetrics,tags:y})}))),l.jsonData.tracesToMetrics?.queries?.map((y,A)=>n.createElement("div",{key:A,className:N.queryRow},n.createElement(d._,{label:"Link Label",labelWidth:26,tooltip:"Descriptive label for the linked query"},n.createElement(j.I,{label:"Link Label",type:"text",allowFullScreen:!0,value:y.name,width:40,onChange:x=>{let U=l.jsonData.tracesToMetrics?.queries.slice()??[];U[A].name=x.currentTarget.value,(0,t.tp)({onOptionsChange:f,options:l},"tracesToMetrics",{...l.jsonData.tracesToMetrics,queries:U})}})),n.createElement(d._,{label:"Query",labelWidth:10,tooltip:"The Prometheus query that will run when navigating from a trace to metrics. Interpolate tags using the `$__tags` keyword",grow:!0},n.createElement(j.I,{label:"Query",type:"text",allowFullScreen:!0,value:y.query,onChange:x=>{const U=(l.jsonData.tracesToMetrics?.queries??[]).map((Q,Y)=>Y===A?{...Q,query:x.currentTarget.value}:Q);(0,t.tp)({onOptionsChange:f,options:l},"tracesToMetrics",{...l.jsonData.tracesToMetrics,queries:U})}})),n.createElement(g.zx,{variant:"destructive",title:"Remove query",icon:"times",type:"button",onClick:()=>{let x=l.jsonData.tracesToMetrics?.queries.slice();x?.splice(A,1),(0,t.tp)({onOptionsChange:f,options:l},"tracesToMetrics",{...l.jsonData.tracesToMetrics,queries:x})}}))),n.createElement(g.zx,{variant:"secondary",title:"Add query",icon:"plus",type:"button",onClick:()=>{(0,t.tp)({onOptionsChange:f,options:l},"tracesToMetrics",{...l.jsonData.tracesToMetrics,queries:[...l.jsonData.tracesToMetrics?.queries??[],{query:""}]})}},"Add query"))}const L=({options:l,onOptionsChange:f})=>{let N=l.type;return N+=l.type==="tempo"?"/configure-tempo-data-source/#trace-to-metrics":"/#trace-to-metrics",n.createElement(P.K,{title:"Trace to metrics",description:n.createElement(F.W,{description:"Navigate from a trace span to the selected data source's metrics.",suffix:N,feature:"trace to metrics"}),isCollapsible:!0,isInitiallyOpen:!0},n.createElement(O,{options:l,onOptionsChange:f}))},H=l=>({infoText:(0,p.css)`
    padding-bottom: ${l.spacing(2)};
    color: ${l.colors.text.secondary};
  `,row:(0,p.css)`
    label: row;
    align-items: baseline;
  `,queryRow:(0,p.css)`
    label: queryRow;
    display: flex;
    flex-flow: wrap;
  `})},29541:(V,W,a)=>{a.r(W),a.d(W,{plugin:()=>Re});var p=a(41466),n=a(66681),t=a(85960),P=a(47257);function R(){const s=(0,P.wW)(D);return t.createElement(t.Fragment,null,t.createElement("h2",{id:"jaeger-cheat-sheet"},"Jaeger Cheat Sheet"),t.createElement("p",null,"This cheat sheet provides a quick overview of the query types that are available. For more details about the Jaeger data source, check out"," ",t.createElement("a",{href:"https://grafana.com/docs/grafana/latest/datasources/jaeger",target:"_blank",rel:"noreferrer",className:s.anchorTag},"the documentation"),"."),t.createElement("hr",null),t.createElement("ul",{className:s.unorderedList},t.createElement("li",null,"Search - filter traces by service name. Addtionally, you can filter by tags or min/max duration, as well as limit the number of traces that are returned."),t.createElement("li",null,"TraceID - if you have a trace ID, simply enter the trace ID to see the trace."),t.createElement("li",null,"JSON File - you can upload a JSON file that contains a single trace to visualize it. If the file has multiple traces then the first trace is used for visualization. An example of a valid JSON file can be found in"," ",t.createElement("a",{href:"https://grafana.com/docs/grafana/latest/datasources/jaeger/#upload-json-trace-file",target:"_blank",rel:"noreferrer",className:s.anchorTag},"this section")," ","of the documentation.")))}const D=s=>({anchorTag:(0,n.css)`
    color: ${s.colors.text.link};
  `,unorderedList:(0,n.css)`
    list-style-type: none;
  `});var d=a(81368),g=a(84933),j=a(29470),K=a(7288),F=a(85447),b=a(74042),T=a(5106),I=a(29165),O=a(11248),L=a(12399),H=a(15820),l=a(27436),f=a(24956),N=a(88492),y=a(93991),A=a(59767),x=a(47670),U=a.n(x);function Q(s){if(!s)return"";const e=U().parse(s);return Object.keys(e).forEach(r=>{const o=e[r];typeof o!="string"&&(e[r]=String(o))}),JSON.stringify(e)}function Y(s){if(!s)return"";try{return U().stringify(JSON.parse(s))}catch{return s}}const k="e.g. 1.2s, 100ms, 500us",q="All",ne={label:q,value:void 0};function le({datasource:s,query:e,onChange:r}){const[o,E]=(0,t.useState)(),[c,m]=(0,t.useState)(),[u,S]=(0,t.useState)({services:!1,operations:!1}),h=(0,t.useCallback)(async(i,v,z="")=>{S(M=>({...M,[v]:!0}));try{const M=await s.metadataRequest(i);return M?M.sort().map($=>({label:$,value:$})).filter($=>$.value?(0,H.C)($.value,z).found:!1):[{label:`No ${v} found`,value:`No ${v} found`}]}catch(M){return M instanceof Error&&(0,A.WI)((0,N.$l)((0,y.t_)("Error",M))),[]}finally{S(M=>({...M,[v]:!1}))}},[s]);return(0,t.useEffect)(()=>{(async()=>{const v=await h("/api/services","services");e.service&&(0,L.J)().containsTemplate(e.service)&&v.push((0,O.E)(e.service)),E(v)})()},[s,h,e.service]),(0,t.useEffect)(()=>{const i=async()=>{const v=await h(`/api/services/${encodeURIComponent((0,L.J)().replace(e.service))}/operations`,"operations");e.operation&&(0,L.J)().containsTemplate(e.operation)&&v.push((0,O.E)(e.operation)),m([ne,...v])};e.service&&i()},[s,e.service,h,e.operation]),t.createElement("div",{className:(0,n.css)({maxWidth:"500px"})},t.createElement(d.Z,null,t.createElement(g._,{label:"Service Name",labelWidth:14,grow:!0},t.createElement(l.Ph,{inputId:"service",options:o,onOpenMenu:()=>h("/api/services","services"),isLoading:u.services,value:o?.find(i=>i?.value===e.service)||void 0,placeholder:"Select a service",onChange:i=>r({...e,service:i?.value,operation:e.service!==i?.value?void 0:e.operation}),menuPlacement:"bottom",isClearable:!0,"aria-label":"select-service-name",allowCustomValue:!0}))),t.createElement(d.Z,null,t.createElement(g._,{label:"Operation Name",labelWidth:14,grow:!0,disabled:!e.service},t.createElement(l.Ph,{inputId:"operation",options:c,onOpenMenu:()=>h(`/api/services/${encodeURIComponent((0,L.J)().replace(e.service))}/operations`,"operations"),isLoading:u.operations,value:c?.find(i=>i.value===e.operation)||null,placeholder:"Select an operation",onChange:i=>r({...e,operation:i?.value||void 0}),menuPlacement:"bottom",isClearable:!0,"aria-label":"select-operation-name",allowCustomValue:!0}))),t.createElement(d.Z,null,t.createElement(g._,{label:"Tags",labelWidth:14,grow:!0,tooltip:"Values should be in logfmt."},t.createElement(f.I,{id:"tags",value:Y(e.tags),placeholder:"http.status_code=200 error=true",onChange:i=>r({...e,tags:i.currentTarget.value})}))),t.createElement(d.Z,null,t.createElement(g._,{label:"Min Duration",labelWidth:14,grow:!0},t.createElement(f.I,{id:"minDuration",name:"minDuration",value:e.minDuration||"",placeholder:k,onChange:i=>r({...e,minDuration:i.currentTarget.value})}))),t.createElement(d.Z,null,t.createElement(g._,{label:"Max Duration",labelWidth:14,grow:!0},t.createElement(f.I,{id:"maxDuration",name:"maxDuration",value:e.maxDuration||"",placeholder:k,onChange:i=>r({...e,maxDuration:i.currentTarget.value})}))),t.createElement(d.Z,null,t.createElement(g._,{label:"Limit",labelWidth:14,grow:!0,tooltip:"Maximum number of returned results"},t.createElement(f.I,{id:"limit",name:"limit",value:e.limit||"",type:"number",onChange:i=>r({...e,limit:i.currentTarget.value?parseInt(i.currentTarget.value,10):void 0})}))))}const Ne=null;function oe({datasource:s,query:e,onChange:r,onRunQuery:o}){const[E,c]=(0,t.useState)(!1),m=(0,P.l4)(),u=(0,P.wW)(ie),S=i=>{const v={...e,query:i};r(v)},h=()=>{switch(e.queryType){case"search":return t.createElement(le,{datasource:s,query:e,onChange:r});default:return t.createElement(d.Z,null,t.createElement(g._,{label:"Trace ID",labelWidth:14,grow:!0},t.createElement(j.q,{query:e.query,onChange:S,onRunQuery:o,placeholder:"Enter a Trace ID (run with Shift+Enter)",portalOrigin:"jaeger"})))}};return t.createElement(t.Fragment,null,t.createElement(K.u,{title:"Upload trace",isOpen:E,onDismiss:()=>c(!1)},t.createElement("div",{className:(0,n.css)({padding:m.spacing(2)})},t.createElement(F.Yo,{options:{multiple:!1},onLoad:i=>{s.uploadedJson=i,r({...e,queryType:"upload"}),c(!1),o()}}))),t.createElement("div",{className:u.container},t.createElement(d.Z,null,t.createElement(g._,{label:"Query type",grow:!0},t.createElement(b.Lh,{spacing:"sm",align:"center",justify:"space-between"},t.createElement(T.S,{options:[{value:"search",label:"Search"},{value:void 0,label:"TraceID"}],value:e.queryType,onChange:i=>r({...e,queryType:i}),size:"md"}),t.createElement(I.zx,{variant:"secondary",size:"sm",onClick:()=>{c(!0)}},"Import trace")))),h()))}const ie=()=>({container:(0,n.css)`
    width: 100%;
  `});var ce=a(83743),me=a(57773),_=a(90857),de=a(42337),J=a(76581),ue=a(42056),ve=a(29724),fe=a(261),ge=a(79152),Ee=a(52219),he=a(5999);function pe({options:s,onOptionsChange:e}){return t.createElement("div",{className:ee.container},t.createElement("h3",{className:"page-heading"},"Query Trace by ID with Time Params"),t.createElement(d.Z,{className:ee.row},t.createElement(g._,{tooltip:"pass time parameters when querying trace by ID",label:"Enable Time Parameters",labelWidth:26},t.createElement(he.x,{id:"enableTraceIdTimeParams",value:s.jsonData.traceIdTimeParams?.enabled,onChange:r=>(0,Ee.tp)({onOptionsChange:e,options:s},"traceIdTimeParams",{...s.jsonData.traceIdTimeParams,enabled:r.currentTarget.checked})}))))}const ee={container:(0,n.css)`
    label: container;
    width: 100%;
  `,row:(0,n.css)`
    label: row;
    align-items: baseline;
  `},Te=({options:s,onOptionsChange:e})=>{const r=(0,P.wW)(De);return t.createElement("div",{className:r.container},t.createElement(ce.j,{dataSourceName:"Jaeger",docsLink:"https://grafana.com/docs/grafana/latest/datasources/jaeger",hasRequiredFields:!1}),t.createElement(J.i,null),t.createElement(de.E,{defaultUrl:"http://localhost:16686",dataSourceConfig:s,showAccessOptions:!1,onChange:e,secureSocksDSProxyEnabled:_.config.secureSocksDSProxyEnabled}),t.createElement(ve.dw,{options:s,onOptionsChange:e}),t.createElement(J.i,null),_.config.featureToggles.traceToMetrics?t.createElement(t.Fragment,null,t.createElement(fe.Y,{options:s,onOptionsChange:e}),t.createElement(J.i,null)):null,t.createElement(me.K,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!1},t.createElement(ue.I,{options:s,onOptionsChange:e}),t.createElement(J.i,{hideLine:!0}),t.createElement(ge.vc,{options:s,onOptionsChange:e}),t.createElement(J.i,{hideLine:!0}),t.createElement(pe,{options:s,onOptionsChange:e})))},De=s=>({container:(0,n.css)`
    label: container;
    margin-bottom: ${s.spacing(2)};
    max-width: 900px;
  `});var G=a(56375),te=a(81838),B=a(21964),X=a(98231),Me=a(85431),Ie=a(173),ye=a(13446),Se=a(38070),Pe=a(58309),Oe=a(85445),Le=a(45864),C=a(68619),Z=a(98149);function ae(s){const{nodes:e,edges:r}=Ce(s),[o,E]=(0,Z.np)();for(const c of e)o.add(c);for(const c of r)E.add(c);return[o,E]}function Ce(s){const e=[],r=[],o=We(s.spans),E=(0,Z.nO)(c=>{if(c>=s.spans.length)return;const m=s.spans[c];return{span:m,id:m.spanID,parentIds:m.references?.filter(u=>u.refType==="CHILD_OF").map(u=>u.spanID)||[]}});for(const c of s.spans){const m=s.processes[c.processID],u=E[c.spanID].children.map(z=>{const M=E[z].span;return[M.startTime,M.startTime+M.duration]}),S=(0,Z.et)(u),h=c.duration-S,i=(0,Z.fy)(c.duration/1e3,o/1e3,h/1e3);e.push({[C.z.id]:c.spanID,[C.z.title]:m?.serviceName??"",[C.z.subTitle]:c.operationName,[C.z.mainStat]:i.main,[C.z.secondaryStat]:i.secondary,[C.z.color]:h/o});const v=c.references?.find(z=>z.refType==="CHILD_OF")?.spanID;v&&E[v].span&&r.push({[C.z.id]:v+"--"+c.spanID,[C.z.target]:c.spanID,[C.z.source]:v})}return{nodes:e,edges:r}}function We(s){let e=0,r=1/0;for(const o of s)o.startTime<r&&(r=o.startTime),o.startTime+o.duration>e&&(e=o.startTime+o.duration);return e-r}var w=a(85916);class xe extends p.MF{constructor(e,r=(0,Le.$t)(),o=(0,L.J)()){super(e),this.instanceSettings=e,this.timeSrv=r,this.templateSrv=o,this.uploadedJson=null,this.nodeGraph=e.jsonData.nodeGraph,this.traceIdTimeParams=e.jsonData.traceIdTimeParams}async metadataRequest(e,r){return(await(0,te.n)(this._request(e,r,{hideFromInspector:!0}))).data.data}isSearchFormValid(e){return!!e.service}query(e){const r=e.targets[0];if(!r)return(0,B.of)({data:[se]});if(r.queryType==="search"&&!this.isSearchFormValid(r))return(0,B.of)({error:{message:"You must select a service."},data:[]});let{start:o,end:E}=this.getTimeRange();if(r.queryType!=="search"&&r.query){let u=`/api/traces/${encodeURIComponent(this.templateSrv.replace(r.query,e.scopedVars))}`;return this.traceIdTimeParams&&(u+=`?start=${o}&end=${E}`),this._request(u).pipe((0,X.U)(S=>{const h=S?.data?.data?.[0];if(!h)return{data:[se]};let i=[(0,w.xM)(h)];return this.nodeGraph?.enabled&&i.push(...ae(h)),{data:i}}))}if(r.queryType==="upload"){if(!this.uploadedJson)return(0,B.of)({data:[]});try{const u=JSON.parse(this.uploadedJson).data[0];let S=[(0,w.xM)(u)];return this.nodeGraph?.enabled&&S.push(...ae(u)),(0,B.of)({data:S})}catch{return(0,B.of)({error:{message:"The JSON file uploaded is not in a valid Jaeger format"},data:[]})}}let c=(0,G.pick)(this.applyVariables(r,e.scopedVars),["service","operation","tags","minDuration","maxDuration","limit"]),m=(0,G.pickBy)(c,G.identity);return m.operation===q&&(m=(0,G.omit)(m,"operation")),m.tags&&(m={...m,tags:Q(m.tags.toString())}),this._request("/api/traces",{...m,...this.getTimeRange(),lookback:"custom"}).pipe((0,X.U)(u=>({data:[(0,w.Wp)(u.data.data,this.instanceSettings)]})))}interpolateVariablesInQueries(e,r){return!e||e.length===0?[]:e.map(o=>({...o,datasource:this.getRef(),...this.applyVariables(o,r)}))}applyVariables(e,r){let o={...e};return e.tags&&this.templateSrv.containsTemplate(e.tags)&&(o={...e,tags:this.templateSrv.replace(e.tags,r)}),{...o,service:this.templateSrv.replace(e.service??"",r),operation:this.templateSrv.replace(e.operation??"",r),minDuration:this.templateSrv.replace(e.minDuration??"",r),maxDuration:this.templateSrv.replace(e.maxDuration??"",r)}}async testDatasource(){return(0,te.n)(this._request("/api/services").pipe((0,X.U)(e=>(e?.data?.data||[]).length>0?{status:"success",message:"Data source connected and services found."}:{status:"error",message:"Data source connected, but no services received. Verify that Jaeger is configured properly."}),(0,Me.K)(e=>{let r="Jaeger: ";return e.statusText?r+=e.statusText:r+="Cannot connect to Jaeger",e.status&&(r+=`. ${e.status}`),e.data&&e.data.message?r+=`. ${e.data.message}`:e.data&&(r+=`. ${JSON.stringify(e.data)}`),(0,B.of)({status:"error",message:r})})))}getTimeRange(){const e=this.timeSrv.timeRange();return{start:re(e.from,!1),end:re(e.to,!0)}}getQueryDisplayText(e){return e.query||""}_request(e,r,o){const E=r?Ie.Cj.serializeParams(r):"",c=`${this.instanceSettings.url}${e}${E.length?`?${E}`:""}`,m={...o,url:c};return(0,Oe.i)().fetch(m)}}function re(s,e){return typeof s=="string"&&(s=ye.parse(s,e)),s.valueOf()*1e3}const se=new Se.v({fields:[{name:"trace",type:Pe.fS.trace,values:[]}],meta:{preferredVisualisationType:"trace",custom:{traceFormat:"jaeger"}}}),Re=new p.hf(xe).setConfigEditor(Te).setQueryEditor(oe).setQueryEditorHelp(R)}}]);

//# sourceMappingURL=jaegerPlugin.4046578e48d8cae1a462.js.map