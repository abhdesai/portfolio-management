"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8648,9865],{95500:(se,w,t)=>{t.d(w,{x:()=>b});var r=t(85960),o=t(95162),e=t(1992);function b(h){const W=(0,o.useDispatch)(),E=(0,r.useRef)(h);E.current=h,(0,r.useEffect)(()=>()=>{W((0,e.e)({cleanupAction:E.current}))},[W])}},59730:(se,w,t)=>{t.r(w),t.d(w,{default:()=>$n,findRoutesMatchingFilters:()=>Bt});var r=t(66681),o=t(56375),e=t(85960),b=t(85954),h=t(47257),W=t(70523),E=t(94439),$=t(10305),p=t(79468),I=t(49199),u=t(13086),y=t(8958),A=t(763),G=t(95162),x=t(95500),Z=t(81828),J=t(46002),ne=t(58712),ue=t(20741);const de=ne.C.injectEndpoints({endpoints:n=>({contactPointsState:n.query({queryFn:async({amSourceName:a})=>{try{return{data:await(0,ue.QE)(a)}}catch(l){return{error:l}}}})})}),L=n=>{const a={receivers:{},errorCount:0},{currentData:l}=de.useContactPointsStateQuery({amSourceName:n??""},{skip:!n,pollingInterval:J.m4});return l??a};var X=t(39512),Y=t(28157),F=t(29165),pe=t(77980),c=t(59672),T=t(75064),v=t(21128),B=t(53914),M=t(57297),U=t(70335),_=t(5970),D=t(77294),Pe=t(79253);const $e=({children:n})=>{const a=(0,h.wW)(Xe);return e.createElement("div",{className:a.container},n)},Xe=n=>({container:(0,r.css)`
      background-color: ${n.colors.background.secondary};
      color: ${n.colors.text.secondary};
      padding: ${n.spacing(4)};
      text-align: center;
    `}),be=({buttonIcon:n,buttonLabel:a,buttonSize:l="lg",buttonVariant:i="primary",onButtonClick:m,text:d,href:s,showButton:C=!0})=>{const g=(0,h.wW)(ke),S={className:g.button,icon:n,size:l,variant:i};return e.createElement($e,null,e.createElement(e.Fragment,null,e.createElement("p",{className:g.text},d),C&&(s?e.createElement(F.Qj,{href:s,type:"button",...S},a):e.createElement(F.zx,{onClick:m,type:"button",...S},a))))},ke=n=>({container:(0,r.css)`
      background-color: ${n.colors.background.secondary};
      color: ${n.colors.text.secondary};
      padding: ${n.spacing(4)};
      text-align: center;
    `,text:(0,r.css)`
      margin-bottom: ${n.spacing(2)};
    `,button:(0,r.css)`
      margin: ${n.spacing(2,0,1)};
    `});var qe=t(84237),we=t(99586),bt=t(77542);const _e=({alertManagerSourceName:n,muteTimingNames:a,hideActions:l})=>{const i=(0,h.wW)(et),m=(0,v.I0)(),{currentData:d}=(0,U.W)(n,{refetchOnFocus:!0,refetchOnReconnect:!0}),s=d?.alertmanager_config,[C,g]=(0,e.useState)(""),S=(0,e.useMemo)(()=>{const Q=s?.mute_time_intervals??[],H=s?.muteTimeProvenances??{};return Q.filter(({name:f})=>a?a.includes(f):!0).map(f=>({id:f.name,data:{...f,provenance:H[f.name]}}))},[s?.mute_time_intervals,s?.muteTimeProvenances,a]),P=At(n,l,g),[O,ee]=(0,M.RA)(M.oI.CreateMuteTiming);return e.createElement("div",{className:i.container},e.createElement(u.K,{direction:"row",alignItems:"center"},e.createElement("span",null,"Enter specific time intervals when not to send notifications or freeze notifications for recurring periods of time."),e.createElement(we.L,null),!l&&S.length>0&&e.createElement(B.q,{actions:[M.oI.CreateMuteTiming]},e.createElement(F.Qj,{className:i.addMuteButton,icon:"plus",variant:"primary",href:(0,D.eQ)("alerting/routes/mute-timing/new",n)},"Add mute timing"))),S.length>0?e.createElement(Pe.t,{items:S,cols:P,pagination:{itemsPerPage:25}}):l?e.createElement(be,{text:"No mute timings configured",buttonLabel:"",showButton:!1}):e.createElement(be,{text:"You haven't created any mute timings yet",buttonLabel:"Add mute timing",buttonIcon:"plus",buttonSize:"lg",href:(0,D.eQ)("alerting/routes/mute-timing/new",n),showButton:ee}),!l&&e.createElement(pe.s,{isOpen:!!C,title:"Delete mute timing",body:`Are you sure you would like to delete "${C}"`,confirmText:"Delete",onConfirm:()=>{m((0,_.r0)(n,C)),g("")},onDismiss:()=>g("")}))};function At(n,a=!1,l){const[[i,m],[d,s]]=(0,M.o2)([M.oI.UpdateMuteTiming,M.oI.DeleteMuteTiming]),C=!a&&(m||s);return(0,e.useMemo)(()=>{const g=[{id:"name",label:"Name",renderCell:function({data:P}){return e.createElement(e.Fragment,null,P.name," ",P.provenance&&e.createElement(qe.C0,null))},size:"250px"},{id:"timeRange",label:"Time range",renderCell:({data:S})=>(0,bt.Nx)(S)}];return C&&g.push({id:"actions",label:"Actions",renderCell:function({data:P}){return P.provenance?e.createElement("div",null,e.createElement(c.r,{href:(0,D.eQ)("/alerting/routes/mute-timing/edit",n,{muteName:P.name})},e.createElement(T.h,{name:"file-alt",tooltip:"View mute timing"}))):e.createElement("div",null,e.createElement(B.q,{actions:[M.oI.UpdateMuteTiming]},e.createElement(c.r,{href:(0,D.eQ)("/alerting/routes/mute-timing/edit",n,{muteName:P.name})},e.createElement(T.h,{name:"edit",tooltip:"Edit mute timing"}))),e.createElement(B.q,{actions:[M.oI.DeleteMuteTiming]},e.createElement(T.h,{name:"trash-alt",tooltip:"Delete mute timing",onClick:()=>l(P.name)})))},size:"100px"}),g},[n,l,C])}const et=n=>({container:(0,r.css)`
    display: flex;
    flex-flow: column nowrap;
  `,addMuteButton:(0,r.css)`
    margin-bottom: ${n.spacing(2)};
    align-self: flex-end;
  `});var V=t(20519),tt=t(57445),re=t(14607),te=t(97666),ye=t(24956),ie=t(27436),$t=t(75636),Oe=t(98724);const wt=({receivers:n,onChangeReceiver:a,onChangeMatchers:l})=>{const[i,m]=(0,$t.j)(),d=(0,e.useRef)(null),{queryString:s,contactPoint:C}=Lt(i),g=(0,h.wW)(Ut),S=(0,e.useCallback)(()=>(0,o.debounce)(l,500),[l]);(0,e.useEffect)(()=>{a(C)},[C,a]),(0,e.useEffect)(()=>{const f=(0,Oe.Zh)(s??"").map(Oe.xz);S()(f)},[S,s]);const P=(0,e.useCallback)(()=>{d.current&&(d.current.value=""),m({contactPoint:void 0,queryString:void 0})},[m]),O=n.map(Ft),ee=O.find(f=>f.value===C)??null,Q=s||C,H=s&&s.length>3?(0,Oe.Zh)(s).length===0:!1;return e.createElement(u.K,{direction:"row",alignItems:"flex-start",gap:.5},e.createElement(V.g,{className:g.noBottom,label:e.createElement(tt._,null,e.createElement(u.K,{gap:.5},e.createElement("span",null,"Search by matchers"),e.createElement(re.u,{content:e.createElement("div",null,"Filter silences by matchers using a comma separated list of matchers, ie:",e.createElement("pre",null,"severity=critical, instance=~cluster-us-.+"))},e.createElement(te.J,{name:"info-circle",size:"sm"})))),invalid:H,error:H?"Query must use valid matcher syntax":null},e.createElement(ye.I,{ref:d,"data-testid":"search-query-input",placeholder:"Search",width:46,prefix:e.createElement(te.J,{name:"search"}),onChange:f=>{m({queryString:f.currentTarget.value})},defaultValue:s})),e.createElement(V.g,{label:"Search by contact point",style:{marginBottom:0}},e.createElement(ie.Ph,{id:"receiver","aria-label":"Search by contact point",value:ee,options:O,onChange:f=>{m({contactPoint:f?.value})},width:28,isClearable:!0})),Q&&e.createElement(F.zx,{variant:"secondary",icon:"times",onClick:P,style:{marginTop:19}},"Clear filters"))};function Ct(n,a){const l=[];function i(m){a(m)&&l.push(m),m.routes?.forEach(i)}return i(n),l}const Ft=n=>({label:n.name,value:n.name}),Lt=n=>({queryString:n.get("queryString")??void 0,contactPoint:n.get("contactPoint")??void 0}),Ut=()=>({noBottom:(0,r.css)`
    margin-bottom: 0;
  `});var ge=t(7288),Kt=t(75682),Fe=t(16901),Vt=t(19311),zt=t(4609),jt=t(84639),nt=t(58533),Zt=t(66564);const Qt=()=>{const{installed:n}=(0,jt.n)(nt.W.OnCall),{data:a}=zt.onCallApi.useGrafanaOnCallIntegrationsQuery(void 0,{skip:!n});return i=>{const m=a??[];if(n&&(0,Zt.Fs)(i,m))return nt.W.OnCall}},Mt=n=>{const a=Qt(),l=i=>({label:i.name,value:i.name,grafanaAppReceiverType:a(i)});return n.map(l)};var Ht=t(53136),Le=t.n(Ht),De=t(67192);const Jt=({active:n=0,suppressed:a=0,unprocessed:l=0})=>{const i=[],m=n+a+l;return n&&i.push(e.createElement(De.C,{color:"red",key:"firing",text:`${n} firing`})),a&&i.push(e.createElement(De.C,{color:"blue",key:"suppressed",text:`${a} suppressed`})),l&&i.push(e.createElement(De.C,{color:"orange",key:"unprocessed",text:`${l} unprocessed`})),i.length>1&&i.unshift(e.createElement(e.Fragment,{key:"total"},m," ",Le()("instance",m))),!!i.length?e.createElement(u.K,{gap:.5},i):null};var Pt=t(66596),Te=t(96130),Yt=t(8655),z=t(71803),Ue=t(23595),Se=t(36860);function Xt(){const n=(0,h.wW)(Tt);return e.createElement("div",null,"Prometheus duration format consist of a number followed by a time unit.",e.createElement("br",null),"Different units can be combined for more granularity.",e.createElement("hr",null),e.createElement("div",{className:n.list},e.createElement("div",{className:n.header},e.createElement("div",null,"Symbol"),e.createElement("div",null,"Time unit"),e.createElement("div",null,"Example")),e.createElement(xe,{unit:Se.t.seconds,name:"seconds",example:"20s"}),e.createElement(xe,{unit:Se.t.minutes,name:"minutes",example:"10m"}),e.createElement(xe,{unit:Se.t.hours,name:"hours",example:"4h"}),e.createElement(xe,{unit:Se.t.days,name:"days",example:"3d"}),e.createElement(xe,{unit:Se.t.weeks,name:"weeks",example:"2w"}),e.createElement("div",{className:n.examples},e.createElement("div",null,"Multiple units combined"),e.createElement("code",null,"1m30s, 2h30m20s, 1w2d"))))}function xe({unit:n,name:a,example:l}){const i=(0,h.wW)(Tt);return e.createElement(e.Fragment,null,e.createElement("div",{className:i.unit},n),e.createElement("div",null,a),e.createElement("code",null,l))}const Tt=n=>({unit:(0,r.css)`
    font-weight: ${n.typography.fontWeightBold};
  `,list:(0,r.css)`
    display: grid;
    grid-template-columns: max-content 1fr 2fr;
    gap: ${n.spacing(1,3)};
  `,header:(0,r.css)`
    display: contents;
    font-weight: ${n.typography.fontWeightBold};
  `,examples:(0,r.css)`
    display: contents;
    & > div {
      grid-column: 1 / span 2;
    }
  `}),Ae=e.forwardRef((n,a)=>e.createElement(ye.I,{suffix:e.createElement(Ue.z,{content:e.createElement(Xt,null),disabled:!1},e.createElement(te.J,{name:"info-circle",size:"lg"})),...n,ref:a}));Ae.displayName="PromDurationInput";const It=n=>({container:(0,r.css)`
      align-items: center;
      display: flex;
      flex-flow: row nowrap;

      & > * + * {
        margin-left: ${n.spacing(1)};
      }
    `,input:(0,r.css)`
      flex: 1;
    `,promDurationInput:(0,r.css)`
      max-width: ${n.spacing(32)};
    `,timingFormContainer:(0,r.css)`
      padding: ${n.spacing(1)};
    `,linkText:(0,r.css)`
      text-decoration: underline;
    `,collapse:(0,r.css)`
      border: none;
      background: none;
      color: ${n.colors.text.primary};
    `}),Ke={group_wait:"30s",group_interval:"5m",repeat_interval:"4h"},kt=({actionButtons:n,alertManagerSourceName:a,onSubmit:l,receivers:i,route:m})=>{const d=(0,h.wW)(It),[s,C]=(0,e.useState)(!1),[g,S]=(0,e.useState)((0,z.eh)(m.group_by)),P=(0,z.ZS)(m);return e.createElement(Pt.l,{defaultValues:{...P,overrideTimings:!0,overrideGrouping:!0},onSubmit:l},({register:O,control:ee,errors:Q,setValue:H,getValues:f})=>e.createElement(e.Fragment,null,e.createElement(V.g,{label:"Default contact point",invalid:!!Q.receiver,error:Q.receiver?.message},e.createElement(e.Fragment,null,e.createElement("div",{className:d.container,"data-testid":"am-receiver-select"},e.createElement(Te.g,{render:({field:{onChange:R,ref:ve,...k}})=>e.createElement(ie.Ph,{"aria-label":"Default contact point",...k,className:d.input,onChange:oe=>R((0,z.mJ)(oe)),options:i}),control:ee,name:"receiver",rules:{required:{value:!0,message:"Required."}}}),e.createElement("span",null,"or"),e.createElement(c.r,{className:d.linkText,href:(0,D.eQ)("/alerting/notifications/receivers/new",a)},"Create a contact point")))),e.createElement(V.g,{label:"Group by",description:"Group alerts when you receive a notification based on labels.","data-testid":"am-group-select"},e.createElement(Te.g,{render:({field:{onChange:R,ref:ve,...k}})=>e.createElement(ie.NU,{"aria-label":"Group by",...k,allowCustomValue:!0,className:d.input,onCreateOption:oe=>{S(K=>[...K,(0,z.T0)(oe)]),H("groupBy",[...k.value,oe])},onChange:oe=>R((0,z.bi)(oe)),options:[...z.dO,...g]}),control:ee,name:"groupBy"})),e.createElement(Yt.U,{collapsible:!0,className:d.collapse,isOpen:s,label:"Timing options",onToggle:C},e.createElement("div",{className:d.timingFormContainer},e.createElement(V.g,{label:"Group wait",description:"The waiting time until the initial notification is sent for a new group created by an incoming alert. Default 30 seconds.",invalid:!!Q.groupWaitValue,error:Q.groupWaitValue?.message,"data-testid":"am-group-wait"},e.createElement(Ae,{...O("groupWaitValue",{validate:z.Oy}),placeholder:Ke.group_wait,className:d.promDurationInput,"aria-label":"Group wait"})),e.createElement(V.g,{label:"Group interval",description:"The waiting time to send a batch of new alerts for that group after the first notification was sent. Default 5 minutes.",invalid:!!Q.groupIntervalValue,error:Q.groupIntervalValue?.message,"data-testid":"am-group-interval"},e.createElement(Ae,{...O("groupIntervalValue",{validate:z.Oy}),placeholder:Ke.group_interval,className:d.promDurationInput,"aria-label":"Group interval"})),e.createElement(V.g,{label:"Repeat interval",description:"The waiting time to resend an alert after they have successfully been sent. Default 4 hours. Should be a multiple of Group interval.",invalid:!!Q.repeatIntervalValue,error:Q.repeatIntervalValue?.message,"data-testid":"am-repeat-interval"},e.createElement(Ae,{...O("repeatIntervalValue",{validate:R=>{const ve=f("groupIntervalValue");return(0,z.eP)(R,ve)}}),placeholder:Ke.repeat_interval,className:d.promDurationInput,"aria-label":"Repeat interval"})))),e.createElement("div",{className:d.container},n)))};var qt=t(59885),at=t(5999),_t=t(74321),Ot=t(84954);function en(){const{selectedAlertmanager:n}=(0,Ot.ZA)(),{currentData:a}=(0,U.W)(n),l=a?.alertmanager_config;return(0,e.useMemo)(()=>l?.mute_time_intervals?.map(m=>({value:m.name,label:m.name,description:m.time_intervals.map(d=>(0,Oe.uK)(d)).join(", AND ")}))??[],[l])}const Dt=({actionButtons:n,receivers:a,route:l,onSubmit:i,defaults:m})=>{const d=(0,h.wW)(nn),s=(0,h.wW)(It),[C,g]=(0,e.useState)((0,z.eh)(l?.group_by)),S=en(),P=[{name:"",operator:Fe._M.equal,value:""}],O=a.sort(tn),ee={...(0,z.ZS)(l),...m},Q={...ee,object_matchers:l?ee.object_matchers:P};return e.createElement(Pt.l,{defaultValues:Q,onSubmit:i,maxWidth:"none"},({control:H,register:f,errors:R,setValue:ve,watch:k,getValues:oe})=>e.createElement(e.Fragment,null,e.createElement("input",{type:"hidden",...f("id")}),e.createElement(qt.F,{name:"object_matchers",control:H},({fields:K,append:le,remove:ae})=>e.createElement(e.Fragment,null,e.createElement(u.K,{direction:"column",alignItems:"flex-start"},e.createElement("div",null,"Matching labels"),K.length===0&&e.createElement(De.C,{color:"orange",className:d.noMatchersWarning,icon:"exclamation-triangle",text:"If no matchers are specified, this notification policy will handle all alert instances."}),K.length>0&&e.createElement("div",{className:d.matchersContainer},K.map((q,j)=>e.createElement(u.K,{direction:"row",key:q.id,alignItems:"center"},e.createElement(V.g,{label:"Label",invalid:!!R.object_matchers?.[j]?.name,error:R.object_matchers?.[j]?.name?.message},e.createElement(ye.I,{...f(`object_matchers.${j}.name`,{required:"Field is required"}),defaultValue:q.name,placeholder:"label",autoFocus:!0})),e.createElement(V.g,{label:"Operator"},e.createElement(Te.g,{render:({field:{onChange:N,ref:We,...Ce}})=>e.createElement(ie.Ph,{...Ce,className:d.matchersOperator,onChange:fe=>N(fe?.value),options:Oe.tA,"aria-label":"Operator"}),defaultValue:q.operator,control:H,name:`object_matchers.${j}.operator`,rules:{required:{value:!0,message:"Required."}}})),e.createElement(V.g,{label:"Value",invalid:!!R.object_matchers?.[j]?.value,error:R.object_matchers?.[j]?.value?.message},e.createElement(ye.I,{...f(`object_matchers.${j}.value`,{required:"Field is required"}),defaultValue:q.value,placeholder:"value"})),e.createElement(T.h,{tooltip:"Remove matcher",name:"trash-alt",onClick:()=>ae(j)},"Remove")))),e.createElement(F.zx,{className:d.addMatcherBtn,icon:"plus",onClick:()=>le(z.fx),variant:"secondary",type:"button"},"Add matcher")))),e.createElement(V.g,{label:"Contact point"},e.createElement(Te.g,{render:({field:{onChange:K,ref:le,...ae}})=>e.createElement(ie.Ph,{"aria-label":"Contact point",...ae,className:s.input,onChange:q=>K((0,z.mJ)(q)),options:O,isClearable:!0}),control:H,name:"receiver"})),e.createElement(V.g,{label:"Continue matching subsequent sibling nodes"},e.createElement(at.r,{id:"continue-toggle",...f("continue")})),e.createElement(V.g,{label:"Override grouping"},e.createElement(at.r,{id:"override-grouping-toggle",...f("overrideGrouping")})),k().overrideGrouping&&e.createElement(V.g,{label:"Group by",description:"Group alerts when you receive a notification based on labels. If empty it will be inherited from the parent policy."},e.createElement(Te.g,{rules:{validate:K=>!K||K.length===0?"At least one group by option is required.":!0},render:({field:{onChange:K,ref:le,...ae},fieldState:{error:q}})=>e.createElement(e.Fragment,null,e.createElement(ie.NU,{"aria-label":"Group by",...ae,invalid:!!q,allowCustomValue:!0,className:s.input,onCreateOption:j=>{g(N=>[...N,(0,z.T0)(j)]),ve("groupBy",[...ae.value,j])},onChange:j=>K((0,z.bi)(j)),options:[...z.dO,...C]}),q&&e.createElement(_t.S,null,q.message)),control:H,name:"groupBy"})),e.createElement(V.g,{label:"Override general timings"},e.createElement(at.r,{id:"override-timings-toggle",...f("overrideTimings")})),k().overrideTimings&&e.createElement(e.Fragment,null,e.createElement(V.g,{label:"Group wait",description:"The waiting time until the initial notification is sent for a new group created by an incoming alert. If empty it will be inherited from the parent policy.",invalid:!!R.groupWaitValue,error:R.groupWaitValue?.message},e.createElement(Ae,{...f("groupWaitValue",{validate:z.Oy}),"aria-label":"Group wait value",className:s.promDurationInput})),e.createElement(V.g,{label:"Group interval",description:"The waiting time to send a batch of new alerts for that group after the first notification was sent. If empty it will be inherited from the parent policy.",invalid:!!R.groupIntervalValue,error:R.groupIntervalValue?.message},e.createElement(Ae,{...f("groupIntervalValue",{validate:z.Oy}),"aria-label":"Group interval value",className:s.promDurationInput})),e.createElement(V.g,{label:"Repeat interval",description:"The waiting time to resend an alert after they have successfully been sent.",invalid:!!R.repeatIntervalValue,error:R.repeatIntervalValue?.message},e.createElement(Ae,{...f("repeatIntervalValue",{validate:K=>{const le=oe("groupIntervalValue");return(0,z.eP)(K,le)}}),"aria-label":"Repeat interval value",className:s.promDurationInput}))),e.createElement(V.g,{label:"Mute timings","data-testid":"am-mute-timing-select",description:"Add mute timing to policy",invalid:!!R.muteTimeIntervals},e.createElement(Te.g,{render:({field:{onChange:K,ref:le,...ae}})=>e.createElement(ie.NU,{"aria-label":"Mute timings",...ae,className:s.input,onChange:q=>K((0,z.bi)(q)),options:S}),control:H,name:"muteTimeIntervals"})),n))};function tn(n){return n.grafanaAppReceiverType===nt.W.OnCall?-1:0}const nn=n=>{const a=n.spacing(3.5);return{addMatcherBtn:(0,r.css)`
      margin-bottom: ${a};
    `,matchersContainer:(0,r.css)`
      background-color: ${n.colors.background.secondary};
      padding: ${n.spacing(1.5)} ${n.spacing(2)};
      padding-bottom: 0;
      width: fit-content;
    `,matchersOperator:(0,r.css)`
      min-width: 120px;
    `,noMatchersWarning:(0,r.css)`
      padding: ${n.spacing(1)} ${n.spacing(2)};
    `}};var St=t(7914);const an=(n=[],a,l)=>{const[i,m]=(0,e.useState)(!1),[d,s]=(0,e.useState)(),C=Mt(n),g=(0,e.useCallback)(()=>{s(void 0),m(!1)},[]),S=(0,e.useCallback)(O=>{s(O),m(!0)},[]);return[(0,e.useMemo)(()=>l?e.createElement(rt,{isOpen:i}):e.createElement(ge.u,{isOpen:i,onDismiss:g,closeOnBackdropClick:!0,closeOnEscape:!0,title:"Add notification policy"},e.createElement(Dt,{receivers:C,defaults:{groupBy:d?.group_by},onSubmit:O=>d&&a(O,d),actionButtons:e.createElement(ge.u.ButtonRow,null,e.createElement(F.zx,{type:"button",variant:"secondary",onClick:g,fill:"outline"},"Cancel"),e.createElement(F.zx,{type:"submit"},"Save policy"))})),[C,a,g,l,d,i]),S,g]},rn=(n,a,l,i)=>{const[m,d]=(0,e.useState)(!1),[s,C]=(0,e.useState)(!1),[g,S]=(0,e.useState)(),P=Mt(a),O=(0,e.useCallback)(()=>{S(void 0),d(!1)},[]),ee=(0,e.useCallback)((H,f)=>{C(f??!1),S(H),d(!0)},[]);return[(0,e.useMemo)(()=>i?e.createElement(rt,{isOpen:m}):e.createElement(ge.u,{isOpen:m,onDismiss:O,closeOnBackdropClick:!0,closeOnEscape:!0,title:"Edit notification policy"},s&&g&&e.createElement(kt,{alertManagerSourceName:n,onSubmit:l,receivers:P,route:g,actionButtons:e.createElement(ge.u.ButtonRow,null,e.createElement(F.zx,{type:"button",variant:"secondary",onClick:O,fill:"outline"},"Cancel"),e.createElement(F.zx,{type:"submit"},"Update default policy"))}),!s&&e.createElement(Dt,{receivers:P,route:g,onSubmit:l,actionButtons:e.createElement(ge.u.ButtonRow,null,e.createElement(F.zx,{type:"button",variant:"secondary",onClick:O,fill:"outline"},"Cancel"),e.createElement(F.zx,{type:"submit"},"Update policy"))})),[P,n,O,l,s,i,g,m]),ee,O]},on=(n,a)=>{const[l,i]=(0,e.useState)(!1),[m,d]=(0,e.useState)(),s=(0,e.useCallback)(()=>{d(void 0),i(!1)},[d]),C=(0,e.useCallback)(P=>{d(P),i(!0)},[]),g=(0,e.useCallback)(()=>{m&&n(m)},[n,m]);return[(0,e.useMemo)(()=>a?e.createElement(rt,{isOpen:l}):e.createElement(ge.u,{isOpen:l,onDismiss:s,closeOnBackdropClick:!0,closeOnEscape:!0,title:"Delete notification policy"},e.createElement("p",null,"Deleting this notification policy will permanently remove it."),e.createElement("p",null,"Are you sure you want to delete this policy?"),e.createElement(ge.u.ButtonRow,null,e.createElement(F.zx,{type:"button",variant:"destructive",onClick:g},"Yes, delete policy"),e.createElement(F.zx,{type:"button",variant:"secondary",onClick:s},"Cancel"))),[s,g,a,l]),C,s]},ln=()=>{const[n,a]=(0,e.useState)(!1),[l,i]=(0,e.useState)([]),[m,d]=(0,e.useState)([]),s=(0,e.useCallback)(()=>{a(!1),i([]),d([])},[]),C=(0,e.useCallback)((P,O)=>{i(P),O&&d(O),a(!0)},[]),g=(0,e.useMemo)(()=>{const P=l.flatMap(O=>O.alerts);return(0,o.groupBy)(P,O=>O.status.state)},[l]);return[(0,e.useMemo)(()=>e.createElement(ge.u,{isOpen:n,onDismiss:s,closeOnBackdropClick:!0,closeOnEscape:!0,title:e.createElement(u.K,{direction:"row",alignItems:"center",gap:1,wrap:"wrap"},e.createElement(u.K,{direction:"row",alignItems:"center",gap:.5},e.createElement(te.J,{name:"x"})," Matchers"),e.createElement(St.g,{matchers:m}))},e.createElement(u.K,{direction:"column"},e.createElement(Jt,{active:g[Fe.Z9.Active]?.length,suppressed:g[Fe.Z9.Suppressed]?.length,unprocessed:g[Fe.Z9.Unprocessed]?.length}),e.createElement("div",null,l.map((P,O)=>e.createElement(Vt.y,{key:O,alertManagerSourceName:"",group:P})))),e.createElement(ge.u.ButtonRow,null,e.createElement(F.zx,{type:"button",variant:"secondary",onClick:s},"Cancel"))),[l,s,g,m,n]),C,s]},rt=({isOpen:n})=>e.createElement(ge.u,{isOpen:n,onDismiss:()=>{},closeOnBackdropClick:!1,closeOnEscape:!1,title:e.createElement(u.K,{direction:"row",alignItems:"center",gap:.5},"Updating... ",e.createElement(Kt.$,{inline:!0}))},"Please wait while we update your notification policies.");var Ve=t(16088),sn=t(45220),Re=t(54635),cn=t(44839),xt=t(40377),mn=t(97096),ot=t(26321),un=t(5493),Rt=t(41460),Wt=t(59439),lt=t(34340),Ee=t(46911),ce=t(35855),dn=t(14411),gn=t(27908),pn=t(29657),En=t(23694);const vn=({exportFormat:n,onClose:a})=>{const{currentData:l="",isFetching:i}=dn.alertRuleApi.useExportPoliciesQuery({format:n}),m=`policies-${new Date().getTime()}`;return i?e.createElement(p.u,{text:"Loading...."}):e.createElement(gn.u,{format:n,textDefinition:l,downloadFileName:m,onClose:a})},fn=({onClose:n})=>{const[a,l]=(0,e.useState)("yaml");return e.createElement(pn.i,{activeTab:a,onTabChange:l,onClose:n,formatProviders:Object.values(En.uN)},e.createElement(vn,{exportFormat:a,onClose:n}))},Gt=({receivers:n=[],contactPointsState:a,readOnly:l=!1,provisioned:i=!1,alertGroups:m=[],alertManagerSourceName:d,currentRoute:s,routeTree:C,inheritedProperties:g,routesMatchingFilters:S=[],matchingInstancesPreview:P={enabled:!1},onEditPolicy:O,onAddPolicy:ee,onDeletePolicy:Q,onShowAlertInstances:H})=>{const f=(0,h.wW)(ze),R=s===C,[[ve,k],[oe,K],[le,ae]]=(0,M.o2)([M.oI.UpdateNotificationPolicyTree,M.oI.DeleteNotificationPolicy,M.oI.ExportNotificationPolicies]),q=s.receiver,j=s.continue??!1,N=s.group_by,We=s.mute_time_intervals??[],Ce={group_wait:s.group_wait,group_interval:s.group_interval,repeat_interval:s.repeat_interval},fe=(0,Rt.QO)(s),je=!!(fe&&fe.length),ct=!!We.length,mt=S.some(me=>me.id===s.id),Ge=[],ut=!je&&!R&&!j,Be=q??g?.receiver??"";(a?In(Be,a):[]).forEach(me=>{Ge.push(me)});const Ze=g&&Object.keys(g).length>0,dt=s.routes??[],gt=Ze&&g.group_by,Qe=(0,o.isArray)(N)&&N[0]==="...",pt=!Qe&&(0,o.isArray)(N)&&N.length>0,Et=R&&(0,o.isArray)(N)&&N.length===0,Ie=P?.groupsMap?.get(s.id),He=Ie?(0,o.sumBy)(Ie,me=>me.alerts.length):void 0,[vt,Je]=(0,sn.Z)(!1),ft=ae&&le&&R,ht=ve&&k,yt=oe&&K&&!R,Me=[];return ht&&Me.push(e.createElement(e.Fragment,{key:"edit-policy"},e.createElement(ot.Z,{shouldWrap:i,wrap:st},e.createElement(Re.v.Item,{icon:"edit",disabled:i,label:"Edit",onClick:()=>O(s,R)})))),ft&&Me.push(e.createElement(Re.v.Item,{key:"export-policy",icon:"download-alt",label:"Export",onClick:Je})),yt&&Me.push(e.createElement(e.Fragment,{key:"delete-policy"},e.createElement(Re.v.Divider,null),e.createElement(ot.Z,{shouldWrap:i,wrap:st},e.createElement(Re.v.Item,{destructive:!0,icon:"trash-alt",disabled:i,label:"Delete",onClick:()=>Q(s)})))),e.createElement(u.K,{direction:"column",gap:1.5},e.createElement("div",{className:f.policyWrapper(mt),"data-testid":R?"am-root-route-container":"am-route-container"},j&&e.createElement(yn,null),ut&&e.createElement(bn,null),e.createElement("div",{className:f.policyItemWrapper},e.createElement(u.K,{direction:"column",gap:1},e.createElement("div",null,e.createElement(u.K,{direction:"row",alignItems:"center",gap:1},R?e.createElement(An,null):je?e.createElement(St.g,{matchers:fe??[]}):e.createElement("span",{className:f.metadata},"No matchers"),e.createElement(we.L,null),Ge.length>0&&e.createElement(hn,{errors:Ge}),i&&e.createElement(qe.C0,null),!l&&e.createElement(u.K,{direction:"row",gap:.5},e.createElement(B.q,{actions:[M.oI.CreateNotificationPolicy]},e.createElement(ot.Z,{shouldWrap:i,wrap:st},e.createElement(F.zx,{variant:"secondary",icon:"plus",size:"sm",onClick:()=>ee(s),disabled:i,type:"button"},"New nested policy"))),Me.length>0&&e.createElement(cn.L,{overlay:e.createElement(Re.v,null,Me)},e.createElement(F.zx,{icon:"ellipsis-h",variant:"secondary",size:"sm",type:"button","aria-label":"more-actions","data-testid":"more-actions"}))))),e.createElement("div",{className:f.metadataRow},e.createElement(u.K,{direction:"row",alignItems:"center",gap:1},P.enabled&&e.createElement(Ee.g,{icon:"layers-alt",onClick:()=>{Ie&&H(Ie,fe)},"data-testid":"matching-instances"},e.createElement(ce.c,null,He??"-"),e.createElement("span",null,Le()("instance",He))),q&&e.createElement(Ee.g,{icon:"at","data-testid":"contact-point"},e.createElement("span",null,"Delivered to"),e.createElement(Tn,{alertManagerSourceName:d,receivers:n,contactPoint:q})),!gt&&e.createElement(e.Fragment,null,pt&&e.createElement(Ee.g,{icon:"layer-group","data-testid":"grouping"},e.createElement("span",null,"Grouped by"),e.createElement(ce.c,null,N.join(", "))),Et&&e.createElement(Ee.g,{icon:"layer-group"},e.createElement("span",null,"Single group")),Qe&&e.createElement(Ee.g,{icon:"layer-group"},e.createElement("span",null,"Not grouping"))),ct&&e.createElement(Ee.g,{icon:"calendar-slash","data-testid":"mute-timings"},e.createElement("span",null,"Muted when"),e.createElement(Mn,{timings:We,alertManagerSourceName:d})),Ce&&e.createElement(Pn,{timingOptions:R?(0,o.defaults)(Ce,Ke):Ce}),Ze&&e.createElement(e.Fragment,null,e.createElement(Ee.g,{icon:"corner-down-right-alt","data-testid":"inherited-properties"},e.createElement("span",null,"Inherited"),e.createElement(Cn,{properties:g})))))))),e.createElement("div",{className:f.childPolicies},dt.map(me=>{const Ye=(0,Wt.$2)(s,me,g);return e.createElement(Gt,{key:(0,o.uniqueId)(),routeTree:C,currentRoute:me,receivers:n,contactPointsState:a,readOnly:l||i,inheritedProperties:Ye,onAddPolicy:ee,onEditPolicy:O,onDeletePolicy:Q,onShowAlertInstances:H,alertManagerSourceName:d,alertGroups:m,routesMatchingFilters:S,matchingInstancesPreview:P})})),vt&&e.createElement(fn,{onClose:Je}))},st=n=>e.createElement(re.u,{content:"Provisioned items cannot be edited in the UI",placement:"top"},e.createElement("span",null,n)),hn=({errors:n})=>e.createElement(Ue.z,{arrow:!0,placement:"top",content:e.createElement(u.K,{direction:"column",gap:.5},n.map(a=>e.createElement(e.Fragment,{key:(0,o.uniqueId)()},a)))},e.createElement("span",null,e.createElement(De.C,{icon:"exclamation-circle",color:"red",text:Le()("error",n.length,!0)}))),yn=()=>{const n=(0,h.wW)(ze);return e.createElement(re.u,{placement:"top",content:"This route will continue matching other policies"},e.createElement("div",{className:n.gutterIcon,"data-testid":"continue-matching"},e.createElement(te.J,{name:"arrow-down"})))},bn=()=>{const n=(0,h.wW)(ze);return e.createElement(re.u,{placement:"top",content:"This policy matches all labels"},e.createElement("div",{className:n.gutterIcon,"data-testid":"matches-all"},e.createElement(te.J,{name:"exclamation-triangle"})))},An=()=>{const n=(0,h.wW)(ze);return e.createElement(e.Fragment,null,e.createElement("strong",null,"Default policy"),e.createElement("span",{className:n.metadata},"All alert instances will be handled by the default policy if no other matching policies are found."))},Cn=({properties:n})=>e.createElement(Ue.z,{arrow:!0,placement:"top",content:e.createElement(u.K,{direction:"row",gap:.5},Object.entries(n).map(([a,l])=>e.createElement(lt._,{key:a,label:On(a),value:e.createElement(ce.c,null,Dn(a,l))})))},e.createElement("div",null,e.createElement(ce.c,null,Le()("property",Object.keys(n).length,!0)))),Mn=({timings:n,alertManagerSourceName:a})=>e.createElement("div",null,e.createElement(ce.c,null,n.map(l=>e.createElement(Ve.Link,{key:l,to:(0,D.ET)(l,a)},l)))),Pn=({timingOptions:n})=>{const a=n.group_wait,l=n.group_interval;return!a&&!l?null:e.createElement(Ee.g,{icon:"hourglass","data-testid":"timing-options"},e.createElement("span",null,"Wait"),a&&e.createElement(re.u,{placement:"top",content:"How long to initially wait to send a notification for a group of alert instances."},e.createElement("span",null,e.createElement(ce.c,null,a)," ",e.createElement("span",null,"to group instances"),a&&l&&",")),l&&e.createElement(re.u,{placement:"top",content:"How long to wait before sending a notification about new alerts that are added to a group of alerts for which an initial notification has already been sent."},e.createElement("span",null,e.createElement(ce.c,null,l)," ",e.createElement("span",null,"before sending updates"))))},Tn=({alertManagerSourceName:n,contactPoint:a,receivers:l})=>{const i=l.find(s=>s.name===a);if(!i)return e.createElement(Ve.Link,{to:(0,D.GV)(a,n)},e.createElement(ce.c,null,a));if(!i.grafana_managed_receiver_configs)return e.createElement(Ve.Link,{to:(0,D.GV)(a,n)},e.createElement(ce.c,null,a));const d=(0,o.groupBy)(i.grafana_managed_receiver_configs,s=>s.type);return e.createElement(Ue.z,{arrow:!0,placement:"top",header:e.createElement(Ee.g,{icon:"at"},e.createElement("div",null,"Contact Point"),e.createElement(ce.c,null,a)),key:(0,o.uniqueId)(),content:e.createElement(u.K,{direction:"row",gap:.5},Object.entries(d).map(([s,C])=>e.createElement(lt._,{key:(0,o.uniqueId)(),label:C.length>1?C.length:void 0,icon:un.y[s],value:(0,o.upperFirst)(s)})))},e.createElement(Ve.Link,{to:(0,D.GV)(a,n)},e.createElement(ce.c,null,a)))};function In(n,a){return Object.entries(a[n]?.notifiers??[]).reduce((m=[],[d,s])=>{const C=s.filter(g=>g.lastNotifyAttemptError).map(g=>e.createElement(lt._,{icon:"at",key:(0,o.uniqueId)(),label:`Contact Point \u203A ${g.name}`,value:g.lastNotifyAttemptError}));return m.concat(C)},[])}const On=n=>{switch(n){case"receiver":return"Contact Point";case"group_by":return"Group by";case"group_interval":return"Group interval";case"group_wait":return"Group wait";case"mute_time_intervals":return"Mute timings";case"repeat_interval":return"Repeat interval";default:return n}},Dn=(n,a)=>{const l=n==="group_by"&&Array.isArray(a)&&a[0]==="...",i=n==="group_by"&&Array.isArray(a)&&a.length===0;return l?e.createElement(xt.x,{variant:"bodySmall",color:"secondary"},"Not grouping"):i?e.createElement(xt.x,{variant:"bodySmall",color:"secondary"},"Single group"):Array.isArray(a)?a.join(", "):a},ze=n=>({matcher:a=>{const{color:l,borderColor:i}=(0,mn.Bx)(a);return{wrapper:(0,r.css)`
        color: #fff;
        background: ${l};
        padding: ${n.spacing(.33)} ${n.spacing(.66)};
        font-size: ${n.typography.bodySmall.fontSize};

        border: solid 1px ${i};
        border-radius: ${n.shape.radius.default};
      `}},childPolicies:(0,r.css)`
    margin-left: ${n.spacing(4)};
    position: relative;

    &:before {
      content: '';
      position: absolute;
      height: calc(100% - 10px);

      border-left: solid 1px ${n.colors.border.weak};

      margin-top: 0;
      margin-left: -20px;
    }
  `,policyItemWrapper:(0,r.css)`
    padding: ${n.spacing(1.5)};
  `,metadataRow:(0,r.css)`
    background: ${n.colors.background.secondary};

    border-bottom-left-radius: ${n.shape.borderRadius(2)};
    border-bottom-right-radius: ${n.shape.borderRadius(2)};
  `,policyWrapper:(a=!1)=>(0,r.css)`
    flex: 1;
    position: relative;
    background: ${n.colors.background.secondary};

    border-radius: ${n.shape.radius.default};
    border: solid 1px ${n.colors.border.weak};

    ${a&&(0,r.css)`
      border-color: ${n.colors.primary.border};
    `}
  `,metadata:(0,r.css)`
    color: ${n.colors.text.secondary};

    font-size: ${n.typography.bodySmall.fontSize};
    font-weight: ${n.typography.bodySmall.fontWeight};
  `,break:(0,r.css)`
    width: 100%;
    height: 0;
    margin-bottom: ${n.spacing(2)};
  `,gutterIcon:(0,r.css)`
    position: absolute;

    top: 0;
    transform: translateY(50%);
    left: -${n.spacing(4)};

    color: ${n.colors.text.secondary};
    background: ${n.colors.background.primary};

    width: 25px;
    height: 25px;
    text-align: center;

    border: solid 1px ${n.colors.border.weak};
    border-radius: ${n.shape.radius.default};

    padding: 0;
  `});var Sn=t(78025),xn=t(30422),it=t(5476),Rn=(n=>(n.NotificationPolicies="notification_policies",n.MuteTimings="mute_timings",n))(Rn||{});const Wn=()=>{const n=(0,G.useDispatch)(),a=(0,h.wW)(Gn),{useGetAlertmanagerAlertGroupsQuery:l}=Z.alertmanagerApi,[i,m]=(0,A.K)(),{tab:d}=Bn(i),[s,C]=(0,e.useState)(d),[g,S]=(0,e.useState)(!1),[P,O]=(0,e.useState)(),[ee,Q]=(0,e.useState)([]),{getRouteGroupsMap:H}=(0,Sn.N)(),{selectedAlertmanager:f,hasConfigurationAPI:R}=(0,Ot.ZA)(),ve=L(f??""),{currentData:k,isLoading:oe,error:K}=(0,U.W)(f,{refetchOnFocus:!0,refetchOnReconnect:!0}),le=k?.alertmanager_config,{currentData:ae,refetch:q}=l({amSourceName:f??""},{skip:!f}),j=le?.receivers??[],N=(0,e.useMemo)(()=>{if(le?.route)return(0,z.br)(le.route)},[le?.route]),[{value:We,error:Ce},fe]=(0,b.Z)(H,[H]);(0,e.useEffect)(()=>{N&&ae&&fe(N,ae)},[N,ae,fe]);const je=(0,e.useMemo)(()=>N?Bt(N,{contactPointFilter:P,labelMatchersFilter:ee}):[],[P,ee,N]),ct=!!le?.route?.provenance;function mt(he){if(!N)return;const Ne=(0,it.SF)(f??"",he,N);Be(Ne)}function Ge(he){if(!N)return;const Ne=(0,it.wB)(he,N);Be(Ne)}function ut(he,Ne){if(!N)return;const wn=(0,it._P)(f??"",he,Ne,N);Be(wn)}function Be(he){k&&(S(!0),n((0,_.mM)({newConfig:{...k,alertmanager_config:{...k.alertmanager_config,route:he}},oldConfig:k,alertManagerSourceName:f,successMessage:"Updated notification policies"})).unwrap().then(()=>{f&&q(),pt(),dt(),He()}).finally(()=>{S(!1)}))}const[Nt,Ze,dt]=an(j,ut,g),[gt,Qe,pt]=rn(f??"",j,mt,g),[Et,Ie,He]=on(Ge,g),[vt,Je]=ln();if((0,x.x)(he=>he.unifiedAlerting.saveAMConfig=xn.oq),!f)return null;const ft=k?.alertmanager_config.mute_time_intervals?.length??0,ht=k&&!K&&!oe,yt=!k&&oe,Me=K&&!oe,me=s==="mute_timings",Ye=s==="notification_policies";return e.createElement(e.Fragment,null,e.createElement(W.J,null,e.createElement(E.O,{label:"Notification Policies",active:Ye,onChangeTab:()=>{C("notification_policies"),m({tab:"notification_policies"})}}),e.createElement(E.O,{label:"Mute Timings",active:me,counter:ft,onChangeTab:()=>{C("mute_timings"),m({tab:"mute_timings"})}})),e.createElement($.I,{className:a.tabContent},yt&&e.createElement(p.u,{text:"Loading Alertmanager config..."}),Me&&e.createElement(I.b,{severity:"error",title:"Error loading Alertmanager config"},K.message||"Unknown error."),ht&&e.createElement(e.Fragment,null,Ye&&e.createElement(e.Fragment,null,e.createElement(Y.u,{currentAlertmanager:f}),e.createElement(u.K,{direction:"column",gap:1},N&&e.createElement(wt,{receivers:j,onChangeMatchers:Q,onChangeReceiver:O}),N&&e.createElement(Gt,{receivers:j,routeTree:N,currentRoute:N,alertGroups:ae??[],contactPointsState:ve.receivers,readOnly:!R,provisioned:ct,alertManagerSourceName:f,onAddPolicy:Ze,onEditPolicy:Qe,onDeletePolicy:Ie,onShowAlertInstances:Je,routesMatchingFilters:je,matchingInstancesPreview:{groupsMap:We,enabled:!Ce}})),Nt,gt,Et,vt),me&&e.createElement(_e,{alertManagerSourceName:f,hideActions:!R}))))},Bt=(n,a)=>{const{contactPointFilter:l,labelMatchersFilter:i=[]}=a;let m=[];const d=(0,Wt.tK)(n),s=l?Ct(d,g=>g.receiver===l):void 0;s&&m.push(s);const C=i.length?Ct(d,g=>{const S=(0,Rt.QO)(g);return i.every(P=>S.some(O=>(0,o.isEqual)(P,O)))}):void 0;return C&&m.push(C),(0,o.intersectionBy)(...m,"id")},Gn=n=>({tabContent:(0,r.css)`
    margin-top: ${n.spacing(2)};
  `});function Bn(n){let a="notification_policies";return n.tab==="notification_policies"&&(a="notification_policies"),n.tab==="mute_timings"&&(a="mute_timings"),{tab:a}}const Nn=()=>e.createElement(X.O,{pageId:"am-routes",accessType:"notification"},e.createElement(Wn,null)),$n=(0,y.Pf)(Nn,{style:"page"})},39512:(se,w,t)=>{t.d(w,{J:()=>J,O:()=>ne});var r=t(85960),o=t(8134),e=t(20989),b=t(84954),h=t(66681),W=t(47257),E=t(84933),$=t(27436),p=t(76679);function I(L){return L.name===p.GC?"Grafana":L.name.slice(0,37)}const u=({disabled:L=!1})=>{const X=(0,W.wW)(y),{selectedAlertmanager:Y,availableAlertManagers:F,setSelectedAlertmanager:pe}=(0,b.ZA)(),c=(0,r.useMemo)(()=>F.map(T=>({label:I(T),value:T.name,imgUrl:T.imgUrl,meta:T.meta})),[F]);return r.createElement(E._,{className:X.field,label:L?"Alertmanager":"Choose Alertmanager",disabled:L||c.length===1,"data-testid":"alertmanager-picker"},r.createElement($.Ph,{"aria-label":L?"Alertmanager":"Choose Alertmanager",width:29,className:"ds-picker select-container",backspaceRemovesValue:!1,onChange:T=>{T?.value&&pe(T.value)},options:c,maxMenuHeight:500,noOptionsMessage:"No datasources found",value:Y,getOptionLabel:T=>T.label}))},y=L=>({field:(0,h.css)`
    margin: 0;
  `});var A=t(49199);const G=()=>r.createElement(A.b,{title:"No Alertmanager found",severity:"warning"},"We could not find any external Alertmanagers and you may not have access to the built-in Grafana Alertmanager."),x=()=>r.createElement(A.b,{title:"Selected Alertmanager not found.",severity:"warning"},"The selected Alertmanager no longer exists or you may not have permission to access it. You can select a different Alertmanager from the dropdown."),Z=({availableAlertManagers:L})=>{const X=L.length>0;return r.createElement("div",null,X?r.createElement(x,null):r.createElement(G,null))},J=({children:L,pageId:X,pageNav:Y,actions:F,isLoading:pe})=>r.createElement(e.T,{pageNav:Y,navId:X,actions:F},r.createElement(e.T.Contents,{isLoading:pe},L)),ne=({children:L,accessType:X,...Y})=>{const F=ue();return r.createElement(b.h5,{accessType:X},r.createElement(J,{...Y,actions:r.createElement(u,{disabled:F})},r.createElement(de,null,L)))};function ue(){const L=(0,o.Z)();return["/edit","/new"].some(Y=>L?.pathname?.includes(Y))}const de=({children:L})=>{const{availableAlertManagers:X,selectedAlertmanager:Y}=(0,b.ZA)();return Y?r.createElement(r.Fragment,null,L):r.createElement(Z,{availableAlertManagers:X})}},25661:(se,w,t)=>{t.d(w,{F:()=>h});var r=t(66681),o=t(85960),e=t(47257),b=t(79253);const h=({renderExpandedContent:E,...$})=>{const p=(0,e.wW)(W);return o.createElement(b.t,{renderExpandedContent:E?(I,u,y)=>o.createElement(o.Fragment,null,u!==y.length-1&&o.createElement("div",{className:(0,r.cx)(p.contentGuideline,p.guideline)}),E(I,u,y)):void 0,renderPrefixHeader:()=>o.createElement("div",{className:p.relative},o.createElement("div",{className:(0,r.cx)(p.headerGuideline,p.guideline)})),renderPrefixCell:(I,u,y)=>o.createElement("div",{className:p.relative},o.createElement("div",{className:(0,r.cx)(p.topGuideline,p.guideline)}),u!==y.length-1&&o.createElement("div",{className:(0,r.cx)(p.bottomGuideline,p.guideline)})),...$})},W=E=>({relative:(0,r.css)`
    position: relative;
    height: 100%;
  `,guideline:(0,r.css)`
    left: -19px;
    border-left: 1px solid ${E.colors.border.weak};
    position: absolute;

    ${E.breakpoints.down("md")} {
      display: none;
    }
  `,topGuideline:(0,r.css)`
    width: 18px;
    border-bottom: 1px solid ${E.colors.border.medium};
    top: 0;
    bottom: 50%;
  `,bottomGuideline:(0,r.css)`
    top: 50%;
    bottom: 0;
  `,contentGuideline:(0,r.css)`
    top: 0;
    bottom: 0;
    left: -49px !important;
  `,headerGuideline:(0,r.css)`
    top: -17px;
    bottom: 0;
  `})},84237:(se,w,t)=>{t.d(w,{C0:()=>W,Uv:()=>b,Xq:()=>h});var r=t(85960),o=t(49199),e=t(67192),b=(E=>(E.ContactPoint="contact point",E.Template="template",E.MuteTiming="mute timing",E.AlertRule="alert rule",E.RootNotificationPolicy="root notification policy",E))(b||{});const h=({resource:E})=>r.createElement(o.b,{title:`This ${E} cannot be edited through the UI`,severity:"info"},"This ",E," has been provisioned, that means it was created by config. Please contact your server admin to update this ",E,"."),W=()=>r.createElement(e.C,{text:"Provisioned",color:"purple"})},19311:(se,w,t)=>{t.d(w,{y:()=>c});var r=t(66681),o=t(85960),e=t(47257),b=t(13086),h=t(16901),W=t(2698),E=t(44211),$=t(46911),p=t(35855),I=t(18678),u=t(25661),y=t(30209),A=t(29165),G=t(41879),x=t(95162),Z=t(57297),J=t(76679),ne=t(77294),ue=t(87921),de=t(53914);const L=({alert:v,alertManagerSourceName:B})=>{const M=(0,e.wW)(X),_=(0,J.HY)(B)?G.contextSrv.hasPermission(x.AccessControlAction.AlertingRuleRead):!0;return o.createElement(o.Fragment,null,o.createElement("div",{className:M.actionsRow},v.status.state===h.Z9.Suppressed&&o.createElement(de.q,{actions:[Z.oI.CreateSilence,Z.oI.UpdateSilence]},o.createElement(A.Qj,{href:`${(0,ne.eQ)("/alerting/silences",B)}&silenceIds=${v.status.silencedBy.join(",")}`,className:M.button,icon:"bell",size:"sm"},"Manage silences")),v.status.state===h.Z9.Active&&o.createElement(de.q,{actions:[Z.oI.CreateSilence]},o.createElement(A.Qj,{href:(0,ne.VN)(B,v.labels),className:M.button,icon:"bell-slash",size:"sm"},"Silence")),_&&v.generatorURL&&o.createElement(A.Qj,{className:M.button,href:v.generatorURL,icon:"chart-line",size:"sm"},"See source")),Object.entries(v.annotations).map(([D,Pe])=>o.createElement(ue.a,{key:D,annotationKey:D,value:Pe})),o.createElement("div",{className:M.receivers},"Receivers:"," ",v.receivers.map(({name:D})=>D).filter(D=>!!D).join(", ")))},X=v=>({button:(0,r.css)`
    & + & {
      margin-left: ${v.spacing(1)};
    }
  `,actionsRow:(0,r.css)`
    padding: ${v.spacing(2,0)} !important;
    border-bottom: 1px solid ${v.colors.border.medium};
  `,receivers:(0,r.css)`
    padding: ${v.spacing(1,0)};
  `}),Y=({alerts:v,alertManagerSourceName:B})=>{const M=(0,e.wW)(F),U=(0,o.useMemo)(()=>[{id:"state",label:"State",renderCell:({data:D})=>o.createElement(o.Fragment,null,o.createElement(y.G,{state:D.status.state}),o.createElement("span",{className:M.duration},"for"," ",(0,I.vT)({start:new Date(D.startsAt),end:new Date(D.endsAt)}))),size:"220px"},{id:"labels",label:"Labels",renderCell:({data:{labels:D}})=>o.createElement(W.s,{labels:D,size:"sm"}),size:1}],[M]),_=(0,o.useMemo)(()=>v.map(D=>({id:D.fingerprint,data:D})),[v]);return o.createElement("div",{className:M.tableWrapper,"data-testid":"alert-group-table"},o.createElement(u.F,{cols:U,items:_,isExpandable:!0,renderExpandedContent:({data:D})=>o.createElement(L,{alert:D,alertManagerSourceName:B})}))},F=v=>({tableWrapper:(0,r.css)`
    margin-top: ${v.spacing(3)};
    ${v.breakpoints.up("md")} {
      margin-left: ${v.spacing(4.5)};
    }
  `,duration:(0,r.css)`
    margin-left: ${v.spacing(1)};
    font-size: ${v.typography.bodySmall.fontSize};
  `});var pe=t(44412);const c=({alertManagerSourceName:v,group:B})=>{const[M,U]=(0,o.useState)(!0),_=(0,e.wW)(T),D=B.receiver.name!=="NONE";return o.createElement("div",{className:_.wrapper},o.createElement("div",{className:_.header},o.createElement("div",{className:_.group,"data-testid":"alert-group"},o.createElement(E.U,{size:"sm",isCollapsed:M,onToggle:()=>U(!M),"data-testid":"alert-group-collapse-toggle"}),Object.keys(B.labels).length?o.createElement(b.K,{direction:"row",alignItems:"center"},o.createElement(W.s,{labels:B.labels,size:"sm"}),D&&o.createElement($.g,{icon:"at"},"Delivered to ",o.createElement(p.c,null,B.receiver.name))):o.createElement("span",null,"No grouping")),o.createElement(pe.Z,{group:B})),!M&&o.createElement(Y,{alertManagerSourceName:v,alerts:B.alerts}))},T=v=>({wrapper:(0,r.css)({"& + &":{marginTop:v.spacing(2)}}),header:(0,r.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",padding:`${v.spacing(1)} ${v.spacing(1)} ${v.spacing(1)} 0`,backgroundColor:v.colors.background.secondary,width:"100%"}),group:(0,r.css)({display:"flex",flexDirection:"row",alignItems:"center"}),summary:(0,r.css)({}),[h.Z9.Active]:(0,r.css)({color:v.colors.error.main}),[h.Z9.Suppressed]:(0,r.css)({color:v.colors.primary.main}),[h.Z9.Unprocessed]:(0,r.css)({color:v.colors.secondary.main})})},77542:(se,w,t)=>{t.d(w,{Nx:()=>$,kO:()=>E,ot:()=>W});var r=t(55104),o=t.n(r),e=t(85960),b=t(98724);const h=/^((([01][0-9])|(2[0-3])):[0-5][0-9])$|(^24:00$)/,W=p=>p?h.test(p):!0,E=(p,I)=>{if(!p&&!I)return!0;if(!p&&I||p&&!I)return!1;const u="HH:mm",y=o()().startOf("day").add(p,u),A=o()().startOf("day").add(I,u);return!!(p&&I&&y.isBefore(A)||p&&I&&A.isAfter(y))};function $(p){return p.time_intervals.map((u,y)=>{const{times:A,weekdays:G,days_of_month:x,months:Z,years:J,location:ne}=u,ue=(0,b.u6)(A,ne),de=(0,b.v7)(G),L=(0,b.J8)(x),X=(0,b.m8)(Z),Y=(0,b.qw)(J);return e.createElement(e.Fragment,{key:JSON.stringify(u)+y},`${ue} ${de}`,e.createElement("br",null),[L,X,Y].join(" | "),e.createElement("br",null))})}},7914:(se,w,t)=>{t.d(w,{g:()=>p});var r=t(66681),o=t(56375),e=t.n(o),b=t(85960),h=t(47257),W=t(13086),E=t(97096),$=t(23595);const p=({matchers:y})=>{const A=(0,h.wW)(u),G=5,x=(0,o.take)(y,G),Z=(0,o.takeRight)(y,y.length-G),J=Z.length>0;return b.createElement("span",{"data-testid":"label-matchers"},b.createElement(W.K,{direction:"row",gap:1,alignItems:"center",wrap:"wrap"},x.map(ne=>b.createElement(I,{key:(0,o.uniqueId)(),matcher:ne})),J&&b.createElement($.z,{arrow:!0,placement:"top",content:b.createElement(b.Fragment,null,Z.map(ne=>b.createElement(I,{key:(0,o.uniqueId)(),matcher:ne})))},b.createElement("span",null,b.createElement("div",{className:A.metadata},`and ${Z.length} more`)))))},I=({matcher:[y,A,G]})=>{const x=(0,h.wW)(u);return b.createElement("div",{className:x.matcher(y).wrapper},b.createElement(W.K,{direction:"row",gap:0,alignItems:"baseline"},y," ",A," ",G))},u=y=>({matcher:A=>{const{color:G,borderColor:x}=(0,E.Bx)(A);return{wrapper:(0,r.css)`
        color: #fff;
        background: ${G};
        padding: ${y.spacing(.33)} ${y.spacing(.66)};
        font-size: ${y.typography.bodySmall.fontSize};

        border: solid 1px ${x};
        border-radius: ${y.shape.borderRadius(2)};
      `}},metadata:(0,r.css)`
    color: ${y.colors.text.secondary};

    font-size: ${y.typography.bodySmall.fontSize};
    font-weight: ${y.typography.bodySmall.fontWeight};
  `})},30209:(se,w,t)=>{t.d(w,{G:()=>h});var r=t(85960),o=t(16901),e=t(65825);const b={[o.Z9.Active]:"bad",[o.Z9.Unprocessed]:"neutral",[o.Z9.Suppressed]:"info"},h=({state:W})=>r.createElement(e.i,{state:b[W]},W)},70335:(se,w,t)=>{t.d(w,{W:()=>o});var r=t(81828);function o(e,b){const h=r.alertmanagerApi.endpoints.getAlertmanagerConfiguration.useQuery(e??"",{...b,skip:!e});return{...h,error:h.error}}},78025:(se,w,t)=>{t.d(w,{N:()=>I});var r=t(5894),o=t(85960),e=t(45465),b=t(34456),h=t(34834);const W=()=>new h.q(new URL(t.p+t.u(3786),t.b));let E;function $(){let u;if(E===void 0)try{u=W(),E=r.Ud(u)}catch(A){A instanceof Error&&(0,e.H)(A)}return{disposeWorker:()=>{u&&E&&(E[r.Yy](),u.terminate(),E=void 0,u=void 0)}}}function p(u){if(!E)throw new Error("Route Matcher has not been initialized")}function I(){(0,o.useEffect)(()=>{const{disposeWorker:A}=$();return A},[]);const u=(0,o.useCallback)(async(A,G)=>{p(E);const x=performance.now(),Z=await E.getRouteGroupsMap(A,G),J=performance.now()-x;return(0,b.PN)(`Route Groups Matched in  ${J} ms`,{matchingTime:J.toString(),alertGroupsCount:G.length.toString(),topLevelRoutesCount:A.routes?.length.toString()??"0"}),Z},[]),y=(0,o.useCallback)(async(A,G)=>{p(E);const x=performance.now(),Z=await E.matchInstancesToRoute(A,G),J=performance.now()-x;return(0,b.PN)(`Instances Matched in  ${J} ms`,{matchingTime:J.toString(),instancesToMatchCount:G.length.toString(),topLevelRoutesCount:A.routes?.length.toString()??"0"}),Z},[]);return{getRouteGroupsMap:u,matchInstancesToRoute:y}}},71803:(se,w,t)=>{t.d(w,{Oy:()=>Y,T0:()=>ue,Yg:()=>ne,ZS:()=>J,bi:()=>X,br:()=>Z,dO:()=>G,eP:()=>pe,eh:()=>de,fx:()=>y,mJ:()=>L});var r=t(56375),o=t.n(r),e=t(16901),b=t(98724),h=t(76679),W=t(41460),E=t(5476),$=t(47689);const p=(c,T)=>Object.entries(c??{}).reduce((v,[B,M])=>[...v,{name:B,value:M,operator:T?e._M.regex:e._M.equal}],[]),I=c=>c.value,u=c=>(c??[]).map(I),y={name:"",value:"",operator:e._M.equal},A=["grafana_folder","alertname"],G=[{label:"grafana_folder",value:"grafana_folder"},{label:"alertname",value:"alertname"},{label:"Disable (...)",value:"..."}],x={id:"",overrideGrouping:!1,groupBy:A,object_matchers:[],routes:[],continue:!1,receiver:"",overrideTimings:!1,groupWaitValue:"",groupIntervalValue:"",repeatIntervalValue:"",muteTimeIntervals:[]};function Z(c){return{id:(0,r.uniqueId)("route-"),...c,routes:(c.routes??[]).map(Z)}}const J=c=>{if(!c)return x;const T="id"in c?c.id:(0,r.uniqueId)("route-");if(Object.keys(c).length===0)return{...x,id:T};const v=[];c.routes?.forEach(U=>{const _=J(U);v.push(_)});const B=c.object_matchers?.map(U=>({name:U[0],operator:U[1],value:U[2]}))??[],M=c.matchers?.map(U=>(0,b.cm)((0,W.tC)(U)))??[];return{id:T,object_matchers:[...M,...B,...p(c.match,!1),...p(c.match_re,!0)],continue:c.continue??!1,receiver:c.receiver??"",overrideGrouping:Array.isArray(c.group_by)&&c.group_by.length>0,groupBy:c.group_by??void 0,overrideTimings:[c.group_wait,c.group_interval,c.repeat_interval].some(Boolean),groupWaitValue:c.group_wait??"",groupIntervalValue:c.group_interval??"",repeatIntervalValue:c.repeat_interval??"",routes:v,muteTimeIntervals:c.mute_time_intervals??[]}},ne=(c,T,v)=>{const B=(0,E.Tx)(T.id??"",v),{overrideGrouping:M,groupBy:U,overrideTimings:_,groupWaitValue:D,groupIntervalValue:Pe,repeatIntervalValue:$e,receiver:Xe}=T,be=void 0,ke=M?U:be,we=_&&D?D:be,_e=_&&Pe?Pe:be,et=_&&$e?$e:be,V=T.object_matchers?.filter(te=>te.name&&te.value&&te.operator).map(({name:te,operator:ye,value:ie})=>[te,ye,ie]),tt=T.routes?.map(te=>ne(c,te,v)),re={...B??{},continue:T.continue,group_by:ke,object_matchers:V,match:void 0,match_re:void 0,group_wait:we,group_interval:_e,repeat_interval:et,routes:tt,mute_time_intervals:T.muteTimeIntervals,receiver:Xe};return c!==h.GC?(re.matchers=T.object_matchers?.map(({name:te,operator:ye,value:ie})=>`${te}${ye}${ie}`),re.object_matchers=void 0):(re.object_matchers=(0,W.QO)(re),re.matchers=void 0),T.receiver&&(re.receiver=T.receiver),re},ue=c=>({label:c,value:c}),de=c=>(c??[]).map(ue),L=c=>{if(c!==null)return c?I(c)??"":""},X=c=>c?u(c):[];function Y(c){return c.length===0?!0:(0,$.wd)(c)||"Invalid duration format. Must be {number}{time_unit}"}const F=c=>c.map(T=>{const[v,B,M]=T;return`${v}${B}${M}`}),pe=(c,T)=>{if(c.length===0)return!0;const v=Y(c),B=Y(T);if(v!==!0)return v;if(B!==!0)return B;const M=(0,$.Bg)(c),U=(0,$.Bg)(T);return U!==0&&M<U?"Repeat interval should be higher or equal to Group interval":!0}},5476:(se,w,t)=>{t.d(w,{SF:()=>b,Tx:()=>E,_P:()=>W,wB:()=>h});var r=t(56375),o=t.n(r),e=t(71803);const b=($,p,I)=>{if(!E(p.id??"",I))throw new Error(`No such route with ID '${p.id}'`);function y(A){let G=A;if(A.id===p.id){const x=(0,e.Yg)($,p,I);G=(0,r.omit)({...A,...x},"id")}return(0,r.omit)({...G,routes:A.routes?.map(y)},"id")}return y(I)},h=($,p)=>{if($.id===p.id)throw new Error("You cant remove the root policy");function I(u){return(0,r.omit)({...u,routes:u.routes?.reduce((y=[],A)=>(A.id===$.id||y.push(I(A)),y),[])},"id")}return I(p)},W=($,p,I,u)=>{const y=(0,e.Yg)($,p,u);function A(x){return x.id===I.id?{...x,routes:x.routes?.concat(y)}:{...x,routes:x.routes?.map(A)}}function G(x){return(0,r.omit)({...x,routes:x.routes?.map(G)},"id")}return G(A(u))};function E($,p){return p.id===$?p:p.routes?.find(I=>E($,I))}}}]);

//# sourceMappingURL=AlertAmRoutes.3cce47f9b0564e242aef.js.map