"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9782],{3703:(sn,Ve,u)=>{u.d(Ve,{D:()=>q,o:()=>N});var p=u(89306),t=u(95329);function q(oe){switch(oe){case p.sN.Logfmt:return{label:(0,t.t)("correlations.trans-details.logfmt-label","Logfmt"),value:p.sN.Logfmt,description:(0,t.t)("correlations.trans-details.logfmt-description","Parse provided field with logfmt to get variables"),expressionDetails:{show:!1},mapValueDetails:{show:!1}};case p.sN.Regex:return{label:(0,t.t)("correlations.trans-details.regex-label","Regular expression"),value:p.sN.Regex,description:(0,t.t)("correlations.trans-details.regex-description","Field will be parsed with regex. Use named capture groups to return multiple variables, or a single unnamed capture group to add variable to named map value. Regex is case insensitive."),expressionDetails:{show:!0,required:!0,helpText:(0,t.t)("correlations.trans-details.regex-expression","Use capture groups to extract a portion of the field.")},mapValueDetails:{show:!0,required:!1,helpText:(0,t.t)("correlations.trans-details.regex-map-values","Defines the name of the variable if the capture group is not named.")}};default:return{label:oe,value:oe,expressionDetails:{show:!1},mapValueDetails:{show:!1}}}}const N=()=>Object.values(p.sN).map(oe=>{const De=q(oe);return{label:De.label,value:De.value,description:De.description}})},79348:(sn,Ve,u)=>{u.r(Ve),u.d(Ve,{default:()=>Bi});var p=u(66681),t=u(85960),q=u(90857),N=u(47257),oe=u(8958),De=u(93160),We=u(6005),an=u(6119),O=u(95162),co=u(30694),rn=u(63212),uo=function(e,o){e===void 0&&(e=!0);var n=(0,t.useCallback)(function(s){var a=typeof e=="function"?e():!0;if(a)return s.preventDefault(),o&&(s.returnValue=o),o},[e,o]);(0,t.useEffect)(function(){if(e)return(0,rn.on)(window,"beforeunload",n),function(){return(0,rn.S1)(window,"beforeunload",n)}},[e,n])};const ln=uo;var po=u(86098),Nt=u(30887),P=u(43183),ho=u(74042),fe=u(14607),ge=u(97666),U=u(29165),Qe=u(7288);const go=({onSave:e,onDiscard:o,onCancel:n,message:s})=>t.createElement(Qe.u,{isOpen:!0,title:"Unsaved changes to correlation",onDismiss:n,icon:"exclamation-triangle",className:(0,p.css)({width:"600px"})},t.createElement("h5",null,s),t.createElement(Qe.u.ButtonRow,null,t.createElement(U.zx,{variant:"secondary",onClick:n,fill:"outline"},"Cancel"),t.createElement(U.zx,{variant:"destructive",onClick:o},"Continue without saving"),t.createElement(U.zx,{variant:"primary",onClick:e},"Save correlation")));var j=u(56375),mo=(e=>(e.SOURCE_TARGET_CHANGE="cause the query in the right pane to be re-ran and links added to that data",e.FULL_QUERY_LOSS="lose the changed query",e.FULL_CORR_LOSS="cause the correlation in progress to be lost",e.INVALID_VAR="remove the variables, and your changed query may no longer be valid",e))(mo||{});const fo=(e,o,n,s)=>{const a=(0,j.template)("<%= actionStr %> will <%= consequenceStr %>. Would you like to save before continuing?");let r="",i="";if(e===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE)if(r="Closing the pane",o)if(n)i="cause the correlation in progress to be lost";else if(s)i="cause the query in the right pane to be re-ran and links added to that data";else return;else if(n)i="cause the correlation in progress to be lost";else if(s)i="lose the changed query";else return;else if(e===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE)if(r="Changing the datasource",o)if(n)i="cause the correlation in progress to be lost";else return;else if(s)i="lose the changed query";else return;else if(e===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_EDITOR)if(r="Closing the editor",n)i="cause the correlation in progress to be lost";else if(s)i="remove the variables, and your changed query may no longer be valid";else return;return a({actionStr:r,consequenceStr:i})};var yo=u(36400),$e=u(95618),ue=u(7954),V=u(20764),W=u(67900),te=u(37079);const vo=({panes:e})=>{const o=(0,O.useDispatch)(),n=(0,N.wW)(Eo),s=(0,O.useSelector)(te.z7),a=(0,O.useSelector)(te.UP),[r,i]=(0,t.useState)(void 0);ln(s?.correlationDirty||!1,"Save correlation?"),ln(!s?.correlationDirty&&s?.queryEditorDirty||!1,"The query editor was changed. Save correlation before continuing?"),(0,t.useEffect)(()=>{if(s?.isExiting){const{correlationDirty:d,queryEditorDirty:f}=s;let h,y;s.postConfirmAction?(h=s.postConfirmAction.isActionLeft,y=s.postConfirmAction.action):(y=O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_EDITOR,h=!1);const E=fo(y,h,d,f);if(E!==void 0)i(E);else if(y===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE&&s.postConfirmAction){const{exploreId:b,changeDatasourceUid:v}=s?.postConfirmAction;b&&v&&(o((0,$e.zU)(b,v,{importQueries:!0})),o((0,V.Hg)({isExiting:!1})))}else if(y===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE&&s.postConfirmAction){const{exploreId:b}=s?.postConfirmAction;b!==void 0&&(o((0,V.YV)(b)),o((0,V.Hg)({isExiting:!1})))}else y===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_EDITOR&&o((0,V.Hg)({editorMode:!1}))}},[s,o,a]),(0,po.Z)(()=>{o((0,V.Hg)({editorMode:!1,isExiting:!1,correlationDirty:!1,label:void 0,description:void 0,canSave:!1})),e.forEach(d=>{o((0,ue.Oj)({exploreId:d[0],correlationEditorHelperData:void 0})),o((0,W.aA)({exploreId:d[0]}))})});const l=()=>{o((0,V.Hg)({editorMode:!0,isExiting:!1,correlationDirty:!1,label:void 0,description:void 0,canSave:!1})),e.forEach(d=>{o((0,ue.Oj)({exploreId:d[0],correlationEditorHelperData:void 0})),o((0,W.aA)({exploreId:d[0]}))})},c=d=>{i(void 0),o((0,V.YV)(d)),(0,P.ff)("grafana_explore_split_view_closed")},g=(d,f)=>{i(void 0),o((0,$e.zU)(d,f,{importQueries:!0}))},m=d=>{if(o((0,yo.Q)(s?.label,s?.description,s?.transformations)),!d&&s?.postConfirmAction!==void 0){const{exploreId:f,action:h,changeDatasourceUid:y}=s?.postConfirmAction;h===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE?(c(f),l()):h===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE&&y!==void 0&&((0,$e.zU)(f,y),l())}else o((0,V.Hg)({editorMode:!1,correlationDirty:!1,isExiting:!1}))};return t.createElement(t.Fragment,null,t.createElement(co.NL,{message:d=>d.pathname!=="/explore"&&s?.editorMode&&s?.correlationDirty?"You have unsaved correlation data. Continue?":!0}),r!==void 0&&t.createElement(go,{onDiscard:()=>{if(s?.postConfirmAction!==void 0){const{exploreId:d,action:f,changeDatasourceUid:h}=s?.postConfirmAction;f===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE?c(d):f===O.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE&&h!==void 0&&g(d,h),o((0,V.Hg)({isExiting:!1}))}else o((0,V.Hg)({editorMode:!1,correlationDirty:!1,isExiting:!1}))},onCancel:()=>{o((0,V.Hg)({isExiting:!1})),i(void 0)},onSave:()=>{m(!1)},message:r}),t.createElement("div",{className:n.correlationEditorTop},t.createElement(ho.Lh,{spacing:"md",justify:"flex-end"},t.createElement(fe.u,{content:"Correlations editor in Explore is an experimental feature."},t.createElement(ge.J,{className:n.iconColor,name:"info-circle",size:"xl"})),t.createElement(U.zx,{variant:"secondary",disabled:!s?.canSave,fill:"outline",className:s?.canSave?n.buttonColor:n.disabledButtonColor,onClick:()=>{m(!0)}},"Save"),t.createElement(U.zx,{variant:"secondary",fill:"outline",className:n.buttonColor,icon:"times",onClick:()=>{o((0,V.Hg)({isExiting:!0})),(0,P.ff)("grafana_explore_correlation_editor_exit_pressed")}},"Exit correlation editor"))))},Eo=e=>{const o=e.colors.getContrastText(e.colors.primary.main),n=Nt.lighten(e.colors.primary.main,.1),s=Nt.darken(e.colors.primary.main,.2),a=Nt.darken(o,.2);return{correlationEditorTop:(0,p.css)({backgroundColor:e.colors.primary.main,marginTop:"3px",padding:e.spacing(1)}),iconColor:(0,p.css)({color:o}),buttonColor:(0,p.css)({color:o,borderColor:o,"&:hover":{color:o,borderColor:o,backgroundColor:n}}),disabledButtonColor:(0,p.css)({color:`${a} !important`,backgroundColor:`${s} !important`})}};var zt=u(19310),rt=u(41879),it=u(63459);const bo=()=>{const[e,o]=(0,t.useState)([]),{query:n}=(0,zt.useKBar)(),s=(0,O.useDispatch)(),a=(0,O.useSelector)(te.Ky),r=(0,O.useSelector)(te.pd),i=rt.contextSrv.hasPermission(O.AccessControlAction.DataSourcesWrite);return(0,t.useEffect)(()=>{const l=Object.keys(a),c={name:"Explore",priority:zt.Priority.HIGH+1},g=[];if(r)g.push({id:"explore/run-query-left",name:"Run query (left)",keywords:"query left",perform:()=>{s((0,W.aA)({exploreId:l[0]}))},section:c}),a[1],g.push({id:"explore/run-query-right",name:"Run query (right)",keywords:"query right",perform:()=>{s((0,W.aA)({exploreId:l[1]}))},section:c}),g.push({id:"explore/split-view-close-left",name:"Close split view left",keywords:"split",perform:()=>{s((0,V.YV)(l[0]))},section:c}),g.push({id:"explore/split-view-close-right",name:"Close split view right",keywords:"split",perform:()=>{s((0,V.YV)(l[1]))},section:c});else{const m=Object.values(a).some(d=>d?.datasourceInstance?.uid===it.D);q.config.featureToggles.correlations&&i&&!m&&g.push({id:"explore/correlations-editor",name:"Correlations editor",perform:()=>{s((0,V.Hg)({editorMode:!0})),s((0,W.aA)({exploreId:l[0]}))},section:c}),g.push({id:"explore/run-query",name:"Run query",keywords:"query",perform:()=>{s((0,W.aA)({exploreId:l[0]}))},section:c}),g.push({id:"explore/split-view-open",name:"Open split view",keywords:"split",perform:()=>{s((0,V.bW)())},section:c})}o(g)},[a,r,n,s,i]),(0,zt.useRegisterActions)(n?e:[],[e,n]),null};var ye=u(36752),At=u(16293),lt=u(92369),ct=u(50263),we=u(18815),Ue=u(84513),xo=u(53565),G=u(45236),Z=u(23757),je=u(81502),Pt=u(73503),ut=u(67131),Ye=u(78e3),So=u(25002),dt=u(18435),cn=u(45220);const un=(0,t.createContext)(void 0),Co=({children:e})=>{const[o,n]=(0,t.useState)([]),s=(0,t.useCallback)(({title:r,icon:i,ref:l})=>{const c=(0,j.uniqueId)(`${r}-${i}_`);return n(g=>[...g,{id:c,title:r,icon:i,ref:l}].sort((d,f)=>{if(d.ref&&f.ref){const h=d.ref.compareDocumentPosition(f.ref);if(h===Node.DOCUMENT_POSITION_PRECEDING)return 1;if(h===Node.DOCUMENT_POSITION_FOLLOWING)return-1}return 0})),c},[]),a=(0,t.useCallback)(r=>{n(i=>i.filter(l=>l.id!==r))},[]);return t.createElement(un.Provider,{value:{outlineItems:o,register:s,unregister:a}},e)};function dn(){const e=(0,t.useContext)(un);if(!e)throw new Error("useContentOutlineContext must be used within a ContentOutlineContextProvider");return e}var wo=u(6556);function pn({title:e,icon:o,tooltip:n,className:s,...a}){const r=(0,N.wW)(To),i=(0,p.cx)(r.button,s),l=t.createElement("button",{className:i,"aria-label":n,...a},Ro(o),e);return n?t.createElement(fe.u,{content:n,placement:"bottom"},l):l}function Ro(e){return e?(0,wo.Mo)(e)?t.createElement(ge.J,{name:e,size:"lg"}):e:null}const To=e=>({button:(0,p.css)({label:"content-outline-item-button",display:"flex",flexGrow:1,alignItems:"center",height:e.spacing(e.components.height.md),padding:e.spacing(0,1),gap:e.spacing(1),color:e.colors.text.secondary,background:"transparent",border:"none",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap","&:hover":{color:e.colors.text.primary,background:e.colors.background.secondary,textDecoration:"underline"}})}),Lo=e=>({wrapper:(0,p.css)({label:"wrapper",position:"relative",display:"flex",justifyContent:"center",marginRight:e.spacing(1),height:"100%",backgroundColor:e.colors.background.primary}),content:(0,p.css)({label:"content",top:0}),buttonStyles:(0,p.css)({textAlign:"left",width:"100%",padding:e.spacing(0,1.5)})});function Fo({scroller:e,panelId:o}){const[n,s]=(0,cn.Z)(!1),a=(0,N.wW)(c=>Lo(c)),{outlineItems:r}=dn(),i=(c,g)=>{let m=0,d=c;do m+=d?.offsetTop||0,d=d?.offsetParent;while(d&&d!==e);e?.scroll({top:m,behavior:"smooth"}),(0,P.ff)("explore_toolbar_contentoutline_clicked",{item:"select_section",type:g})},l=()=>{s(),(0,P.ff)("explore_toolbar_contentoutline_clicked",{item:"outline",type:n?"minimize":"expand"})};return t.createElement(Pt.l,{className:a.wrapper,id:o},t.createElement(ct.$,null,t.createElement("div",{className:a.content},t.createElement(pn,{title:n?"Collapse outline":void 0,icon:n?"angle-left":"angle-right",onClick:l,tooltip:n?void 0:"Expand content outline",className:a.buttonStyles,"aria-expanded":n}),r.map(c=>t.createElement(pn,{key:c.id,title:n?c.title:void 0,className:a.buttonStyles,icon:c.icon,onClick:()=>i(c.ref,c.title),tooltip:n?void 0:c.title})))))}function ve({title:e,icon:o,children:n,className:s}){const{register:a,unregister:r}=dn(),i=(0,t.useRef)(null);return(0,t.useEffect)(()=>{const l=a({title:e,icon:o,ref:i.current});return()=>r(l)},[e,o,a,r]),t.createElement("div",{className:s,ref:i},n)}var hn=u(10476),Mt=u(81445),Ke=u(49199),pt=u(8655),ht=u(13086),Re=u(20519),Je=u(24956),gt=u(72435),Ge=u(75064),Io=u(81573),Ht=u(81259),Oo=u(15925),Do=u(83795),No=u.n(Do),zo=u(57445),gn=u(96130),Ne=u(27436),$t=u(3703);const mn=({label:e,tooltipText:o})=>t.createElement(ht.K,{gap:1,direction:"row",wrap:"wrap",alignItems:"flex-start"},t.createElement(zo._,null,e),t.createElement(fe.u,{content:o},t.createElement(ge.J,{name:"info-circle",size:"sm"}))),Ao=({onSave:e,onCancel:o,fieldList:n,transformationToEdit:s})=>{const[a,r]=(0,t.useState)(void 0),[i,l]=(0,t.useState)({}),[c,g]=(0,t.useState)({mapValueDetails:{show:!1},expressionDetails:{show:!1}}),[m,d]=(0,t.useState)(!1),[f,h]=(0,t.useState)(!1),{getValues:y,control:E,register:b,watch:v}=(0,hn.cI)({defaultValues:(0,t.useMemo)(()=>{if(s){const C=n[s?.field];r(C),s?.expression&&d(!0);const T=(0,$t.D)(s?.type);g({mapValueDetails:T.mapValueDetails,expressionDetails:T.expressionDetails});const w=(0,Ht.Y)({type:s?.type,expression:s?.expression,mapValue:s?.mapValue},C||"",s?.field);return l({...w}),h(!0),{type:s?.type,field:s?.field,mapValue:s?.mapValue,expression:s?.expression}}else return},[n,s])}),x=(0,t.useId)();return(0,t.useEffect)(()=>{const C=v(T=>{const w=T.expression;let I=!1;if(w!==void 0){I=!0;try{new RegExp(w)}catch{I=!1}}else I=!c.expressionDetails.show;d(I);const H=(0,Ht.Y)({type:T.type,expression:I?w:"",mapValue:T.mapValue},n[T.field]||"",T.field),M=Object.keys(H);l(M.length>0?{...H}:{}),M.length===0||!I?h(!1):h(!0)});return()=>C.unsubscribe()},[n,c.expressionDetails.show,v]),t.createElement(Qe.u,{isOpen:!0,title:`${s?"Edit":"Add"} transformation`,onDismiss:o,className:(0,p.css)({width:"700px"})},t.createElement("p",null,"A transformation extracts variables out of a single field. These variables will be available along with your field variables."),t.createElement(Re.g,{label:"Field"},t.createElement(gn.g,{control:E,render:({field:{onChange:C,ref:T,...w}})=>t.createElement(Ne.Ph,{...w,onChange:I=>{I.value&&(C(I.value),r(n[I.value]))},options:Object.entries(n).map(I=>({label:I[0],value:I[0]})),"aria-label":"field"}),name:"field"})),a&&t.createElement(t.Fragment,null,t.createElement("pre",null,t.createElement(No(),{textToHighlight:a,searchWords:[m?y("expression")??"":""],autoEscape:!1})),t.createElement(Re.g,{label:"Type"},t.createElement(gn.g,{control:E,render:({field:{onChange:C,ref:T,...w}})=>t.createElement(Ne.Ph,{...w,onChange:I=>{C(I.value);const H=(0,$t.D)(I.value);g({mapValueDetails:H.mapValueDetails,expressionDetails:H.expressionDetails})},options:(0,$t.o)(),"aria-label":"type"}),name:"type"})),c.expressionDetails.show&&t.createElement(Re.g,{label:c.expressionDetails.helpText?t.createElement(mn,{label:"Expression",tooltipText:c.expressionDetails.helpText}):"Expression",htmlFor:`${x}-expression`,required:c.expressionDetails.required},t.createElement(Je.I,{...b("expression"),id:`${x}-expression`})),c.mapValueDetails.show&&t.createElement(Re.g,{label:c.mapValueDetails.helpText?t.createElement(mn,{label:"Variable Name",tooltipText:c.mapValueDetails.helpText}):"Variable Name",htmlFor:`${x}-mapValue`},t.createElement(Je.I,{...b("mapValue"),id:`${x}-mapValue`})),Object.entries(i).length>0&&t.createElement(t.Fragment,null,"This transformation will add the following variables:",t.createElement("pre",null,Object.entries(i).map(C=>`\${${C[0]}} = ${C[1]?.value}
`)))),t.createElement(Qe.u.ButtonRow,null,t.createElement(U.zx,{variant:"secondary",onClick:o,fill:"outline"},"Cancel"),t.createElement(U.zx,{variant:"primary",onClick:()=>e(y()),disabled:!f},s?"Edit transformation":"Add transformation to correlation")))},Po=({exploreId:e,correlations:o})=>{const n=(0,O.useDispatch)(),s=(0,N.wW)(Mo),a=(0,O.useSelector)(te.Ky),r=Object.values(a),{value:i,loading:l}=(0,Mt.Z)(async()=>await(0,Oo.eo)(r[0],r[1]),[r[0]?.datasourceInstance,r[0]?.queries[0].datasource,r[1]?.datasourceInstance,r[1]?.queries[0].datasource]),{register:c,watch:g,getValues:m,setValue:d}=(0,hn.cI)(),[f,h]=(0,t.useState)(!1),[y,E]=(0,t.useState)(!1),[b,v]=(0,t.useState)(!1),[x,C]=(0,t.useState)([]),[T,w]=(0,t.useState)(void 0),I=(0,O.useSelector)(te.z7),H=(0,t.useId)();return(0,t.useEffect)(()=>(n((0,V.Hg)({canSave:!0})),()=>{n((0,V.Hg)({canSave:!1}))}),[n]),(0,t.useEffect)(()=>{!l&&i!==void 0&&!I?.correlationDirty&&m("label")!==""&&d("label",i)},[I?.correlationDirty,i,m,l,d]),(0,t.useEffect)(()=>{const M=g(A=>{let $=I?.correlationDirty||!1;!$&&(A.label!==i||A.description!=="")?$=!0:$&&A.label===i&&A.description.trim()===""&&($=!1),n((0,V.Hg)({label:A.label,description:A.description,correlationDirty:$}))});return()=>M.unsubscribe()},[I?.correlationDirty,i,n,g]),(0,t.useEffect)(()=>{const M=!I?.correlationDirty&&x.length>0?!0:I?.correlationDirty;n((0,V.Hg)({transformations:x,correlationDirty:M}));let A={};x.forEach($=>{const F=(0,Ht.Y)({type:$.type,expression:$.expression,mapValue:$.mapValue},o.vars[$.field],$.field);Object.keys(F).forEach(D=>{A[D]=F[D]?.value})}),n((0,ue.Oj)({exploreId:e,correlationEditorHelperData:{resultField:o.resultField,origVars:o.origVars,vars:{...o.origVars,...A}}}))},[n,x]),t.createElement(t.Fragment,null,b&&t.createElement(Ao,{onCancel:()=>{w(void 0),v(!1)},onSave:M=>{if(T!==void 0){const A=[...x];A[T]=M,C(A),w(void 0)}else C([...x,M]);v(!1)},fieldList:o.origVars,transformationToEdit:T!==void 0?x[T]:void 0}),t.createElement(Ke.b,{title:"Correlation details",severity:"info"},"The correlation link will appear by the ",t.createElement("code",null,o.resultField)," field. You can use the following variables to set up your correlations:",t.createElement("pre",null,Object.entries(o.vars).map(M=>`\${${M[0]}} = ${M[1]}
`)),t.createElement(pt.U,{collapsible:!0,isOpen:f,onToggle:()=>{h(!f)},label:t.createElement(ht.K,{gap:1,direction:"row",wrap:"wrap",alignItems:"center"},"Label / Description",!f&&!l&&t.createElement("span",{className:s.labelCollapseDetails},`Label: ${m("label")||i}`))},t.createElement(Re.g,{label:"Label",htmlFor:`${H}-label`},t.createElement(Je.I,{...c("label"),id:`${H}-label`,onBlur:()=>{m("label")===""&&i!==void 0&&d("label",i)}})),t.createElement(Re.g,{label:"Description",htmlFor:`${H}-description`},t.createElement(Je.I,{...c("description"),id:`${H}-description`}))),t.createElement(pt.U,{collapsible:!0,isOpen:y,onToggle:()=>{E(!y)},label:t.createElement(ht.K,{gap:1,direction:"row",wrap:"wrap",alignItems:"center"},"Transformations",t.createElement(fe.u,{content:"A transformation extracts one or more variables out of a single field."},t.createElement(ge.J,{name:"info-circle",size:"sm"})))},t.createElement(U.zx,{variant:"secondary",fill:"outline",onClick:()=>{v(!0)},className:s.transformationAction},"Add transformation"),x.map((M,A)=>{const{type:$,field:F,expression:D,mapValue:L}=M,R=[(L??"").length>0?`Variable name: ${L}`:void 0,(D??"").length>0?t.createElement(t.Fragment,null,"Expression: ",t.createElement("code",null,D)):void 0].filter(B=>B);return t.createElement(gt.Z,{key:`trans-${A}`},t.createElement(gt.Z.Heading,null,F,": ",$),R.length>0&&t.createElement(gt.Z.Meta,{className:s.transformationMeta},R),t.createElement(gt.Z.SecondaryActions,null,t.createElement(Ge.h,{key:"edit",name:"edit","aria-label":"edit transformation",onClick:()=>{w(A),v(!0)}}),t.createElement(Io.m,{"aria-label":"delete transformation",onConfirm:()=>C(x.filter((B,ee)=>A!==ee)),closeOnConfirm:!0})))}))))},Mo=e=>({labelCollapseDetails:(0,p.css)({marginLeft:e.spacing(2),...e.typography.bodySmall,fontStyle:"italic"}),transformationAction:(0,p.css)({marginBottom:e.spacing(2)}),transformationMeta:(0,p.css)({alignItems:"baseline"})});var Ee=u(85745),Ho=u(12593),$o=u(76738),Te=u(58861),Bo=u(20229),ko=u(87011);function Vo({width:e,height:o,timeZone:n,state:s,pluginId:a,frames:r,absoluteRange:i,splitOpenFn:l,eventBus:c}){const g=(0,t.useMemo)(()=>({from:(0,Ee.CQ)(i.from),to:(0,Ee.CQ)(i.to),raw:{from:(0,Ee.CQ)(i.from),to:(0,Ee.CQ)(i.to)}}),[i.from,i.to]),m=(0,Bo.pv)(a),f={dataLinkPostProcessor:(0,ko.v)(l,g),eventBus:c,eventsScope:"explore"};return t.createElement($o._w,{value:f},t.createElement(Te.fm,{title:m.name,width:e,height:o,loadingState:s},(h,y)=>t.createElement(Ho.$,{data:{series:r,state:s,timeRange:g},pluginId:a,title:"",width:h,height:y,timeZone:n})))}var Be=u(81223),Y=u(1713),fn=u(23494),Wo=u(79873),Qo=function(){var e=function(o,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,a){s.__proto__=a}||function(s,a){for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(s[r]=a[r])},e(o,n)};return function(o,n){e(o,n);function s(){this.constructor=o}o.prototype=n===null?Object.create(n):(s.prototype=n.prototype,new s)}}(),se=function(){return se=Object.assign||function(e){for(var o,n=1,s=arguments.length;n<s;n++){o=arguments[n];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e},se.apply(this,arguments)},yn={width:"100%",height:"10px",top:"0px",left:"0px",cursor:"row-resize"},vn={width:"10px",height:"100%",top:"0px",left:"0px",cursor:"col-resize"},mt={width:"20px",height:"20px",position:"absolute"},Uo={top:se(se({},yn),{top:"-5px"}),right:se(se({},vn),{left:void 0,right:"-5px"}),bottom:se(se({},yn),{top:void 0,bottom:"-5px"}),left:se(se({},vn),{left:"-5px"}),topRight:se(se({},mt),{right:"-10px",top:"-10px",cursor:"ne-resize"}),bottomRight:se(se({},mt),{right:"-10px",bottom:"-10px",cursor:"se-resize"}),bottomLeft:se(se({},mt),{left:"-10px",bottom:"-10px",cursor:"sw-resize"}),topLeft:se(se({},mt),{left:"-10px",top:"-10px",cursor:"nw-resize"})},jo=function(e){Qo(o,e);function o(){var n=e!==null&&e.apply(this,arguments)||this;return n.onMouseDown=function(s){n.props.onResizeStart(s,n.props.direction)},n.onTouchStart=function(s){n.props.onResizeStart(s,n.props.direction)},n}return o.prototype.render=function(){return t.createElement("div",{className:this.props.className||"",style:se(se({position:"absolute",userSelect:"none"},Uo[this.props.direction]),this.props.replaceStyles||{}),onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart},this.props.children)},o}(t.PureComponent),Go=function(){var e=function(o,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,a){s.__proto__=a}||function(s,a){for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(s[r]=a[r])},e(o,n)};return function(o,n){e(o,n);function s(){this.constructor=o}o.prototype=n===null?Object.create(n):(s.prototype=n.prototype,new s)}}(),be=function(){return be=Object.assign||function(e){for(var o,n=1,s=arguments.length;n<s;n++){o=arguments[n];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e},be.apply(this,arguments)},Zo={width:"auto",height:"auto"},ft=function(e,o,n){return Math.max(Math.min(e,n),o)},En=function(e,o){return Math.round(e/o)*o},Ze=function(e,o){return new RegExp(e,"i").test(o)},yt=function(e){return!!(e.touches&&e.touches.length)},qo=function(e){return!!((e.clientX||e.clientX===0)&&(e.clientY||e.clientY===0))},bn=function(e,o,n){n===void 0&&(n=0);var s=o.reduce(function(r,i,l){return Math.abs(i-e)<Math.abs(o[r]-e)?l:r},0),a=Math.abs(o[s]-e);return n===0||a<n?o[s]:e},Bt=function(e){return e=e.toString(),e==="auto"||e.endsWith("px")||e.endsWith("%")||e.endsWith("vh")||e.endsWith("vw")||e.endsWith("vmax")||e.endsWith("vmin")?e:e+"px"},vt=function(e,o,n,s){if(e&&typeof e=="string"){if(e.endsWith("px"))return Number(e.replace("px",""));if(e.endsWith("%")){var a=Number(e.replace("%",""))/100;return o*a}if(e.endsWith("vw")){var a=Number(e.replace("vw",""))/100;return n*a}if(e.endsWith("vh")){var a=Number(e.replace("vh",""))/100;return s*a}}return e},Yo=function(e,o,n,s,a,r,i){return s=vt(s,e.width,o,n),a=vt(a,e.height,o,n),r=vt(r,e.width,o,n),i=vt(i,e.height,o,n),{maxWidth:typeof s>"u"?void 0:Number(s),maxHeight:typeof a>"u"?void 0:Number(a),minWidth:typeof r>"u"?void 0:Number(r),minHeight:typeof i>"u"?void 0:Number(i)}},Ko=["as","style","className","grid","snap","bounds","boundsByDirection","size","defaultSize","minWidth","minHeight","maxWidth","maxHeight","lockAspectRatio","lockAspectRatioExtraWidth","lockAspectRatioExtraHeight","enable","handleStyles","handleClasses","handleWrapperStyle","handleWrapperClass","children","onResizeStart","onResize","onResizeStop","handleComponent","scale","resizeRatio","snapGap"],xn="__resizable_base__",Jo=function(e){Go(o,e);function o(n){var s=e.call(this,n)||this;return s.ratio=1,s.resizable=null,s.parentLeft=0,s.parentTop=0,s.resizableLeft=0,s.resizableRight=0,s.resizableTop=0,s.resizableBottom=0,s.targetLeft=0,s.targetTop=0,s.appendBase=function(){if(!s.resizable||!s.window)return null;var a=s.parentNode;if(!a)return null;var r=s.window.document.createElement("div");return r.style.width="100%",r.style.height="100%",r.style.position="absolute",r.style.transform="scale(0, 0)",r.style.left="0",r.style.flex="0 0 100%",r.classList?r.classList.add(xn):r.className+=xn,a.appendChild(r),r},s.removeBase=function(a){var r=s.parentNode;r&&r.removeChild(a)},s.ref=function(a){a&&(s.resizable=a)},s.state={isResizing:!1,width:typeof(s.propsSize&&s.propsSize.width)>"u"?"auto":s.propsSize&&s.propsSize.width,height:typeof(s.propsSize&&s.propsSize.height)>"u"?"auto":s.propsSize&&s.propsSize.height,direction:"right",original:{x:0,y:0,width:0,height:0},backgroundStyle:{height:"100%",width:"100%",backgroundColor:"rgba(0,0,0,0)",cursor:"auto",opacity:0,position:"fixed",zIndex:9999,top:"0",left:"0",bottom:"0",right:"0"},flexBasis:void 0},s.onResizeStart=s.onResizeStart.bind(s),s.onMouseMove=s.onMouseMove.bind(s),s.onMouseUp=s.onMouseUp.bind(s),s}return Object.defineProperty(o.prototype,"parentNode",{get:function(){return this.resizable?this.resizable.parentNode:null},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"window",{get:function(){return!this.resizable||!this.resizable.ownerDocument?null:this.resizable.ownerDocument.defaultView},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"propsSize",{get:function(){return this.props.size||this.props.defaultSize||Zo},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"size",{get:function(){var n=0,s=0;if(this.resizable&&this.window){var a=this.resizable.offsetWidth,r=this.resizable.offsetHeight,i=this.resizable.style.position;i!=="relative"&&(this.resizable.style.position="relative"),n=this.resizable.style.width!=="auto"?this.resizable.offsetWidth:a,s=this.resizable.style.height!=="auto"?this.resizable.offsetHeight:r,this.resizable.style.position=i}return{width:n,height:s}},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"sizeStyle",{get:function(){var n=this,s=this.props.size,a=function(l){if(typeof n.state[l]>"u"||n.state[l]==="auto")return"auto";if(n.propsSize&&n.propsSize[l]&&n.propsSize[l].toString().endsWith("%")){if(n.state[l].toString().endsWith("%"))return n.state[l].toString();var c=n.getParentSize(),g=Number(n.state[l].toString().replace("px","")),m=g/c[l]*100;return m+"%"}return Bt(n.state[l])},r=s&&typeof s.width<"u"&&!this.state.isResizing?Bt(s.width):a("width"),i=s&&typeof s.height<"u"&&!this.state.isResizing?Bt(s.height):a("height");return{width:r,height:i}},enumerable:!1,configurable:!0}),o.prototype.getParentSize=function(){if(!this.parentNode)return this.window?{width:this.window.innerWidth,height:this.window.innerHeight}:{width:0,height:0};var n=this.appendBase();if(!n)return{width:0,height:0};var s=!1,a=this.parentNode.style.flexWrap;a!=="wrap"&&(s=!0,this.parentNode.style.flexWrap="wrap"),n.style.position="relative",n.style.minWidth="100%",n.style.minHeight="100%";var r={width:n.offsetWidth,height:n.offsetHeight};return s&&(this.parentNode.style.flexWrap=a),this.removeBase(n),r},o.prototype.bindEvents=function(){this.window&&(this.window.addEventListener("mouseup",this.onMouseUp),this.window.addEventListener("mousemove",this.onMouseMove),this.window.addEventListener("mouseleave",this.onMouseUp),this.window.addEventListener("touchmove",this.onMouseMove,{capture:!0,passive:!1}),this.window.addEventListener("touchend",this.onMouseUp))},o.prototype.unbindEvents=function(){this.window&&(this.window.removeEventListener("mouseup",this.onMouseUp),this.window.removeEventListener("mousemove",this.onMouseMove),this.window.removeEventListener("mouseleave",this.onMouseUp),this.window.removeEventListener("touchmove",this.onMouseMove,!0),this.window.removeEventListener("touchend",this.onMouseUp))},o.prototype.componentDidMount=function(){if(!(!this.resizable||!this.window)){var n=this.window.getComputedStyle(this.resizable);this.setState({width:this.state.width||this.size.width,height:this.state.height||this.size.height,flexBasis:n.flexBasis!=="auto"?n.flexBasis:void 0})}},o.prototype.componentWillUnmount=function(){this.window&&this.unbindEvents()},o.prototype.createSizeForCssProperty=function(n,s){var a=this.propsSize&&this.propsSize[s];return this.state[s]==="auto"&&this.state.original[s]===n&&(typeof a>"u"||a==="auto")?"auto":n},o.prototype.calculateNewMaxFromBoundary=function(n,s){var a=this.props.boundsByDirection,r=this.state.direction,i=a&&Ze("left",r),l=a&&Ze("top",r),c,g;if(this.props.bounds==="parent"){var m=this.parentNode;m&&(c=i?this.resizableRight-this.parentLeft:m.offsetWidth+(this.parentLeft-this.resizableLeft),g=l?this.resizableBottom-this.parentTop:m.offsetHeight+(this.parentTop-this.resizableTop))}else this.props.bounds==="window"?this.window&&(c=i?this.resizableRight:this.window.innerWidth-this.resizableLeft,g=l?this.resizableBottom:this.window.innerHeight-this.resizableTop):this.props.bounds&&(c=i?this.resizableRight-this.targetLeft:this.props.bounds.offsetWidth+(this.targetLeft-this.resizableLeft),g=l?this.resizableBottom-this.targetTop:this.props.bounds.offsetHeight+(this.targetTop-this.resizableTop));return c&&Number.isFinite(c)&&(n=n&&n<c?n:c),g&&Number.isFinite(g)&&(s=s&&s<g?s:g),{maxWidth:n,maxHeight:s}},o.prototype.calculateNewSizeFromDirection=function(n,s){var a=this.props.scale||1,r=this.props.resizeRatio||1,i=this.state,l=i.direction,c=i.original,g=this.props,m=g.lockAspectRatio,d=g.lockAspectRatioExtraHeight,f=g.lockAspectRatioExtraWidth,h=c.width,y=c.height,E=d||0,b=f||0;return Ze("right",l)&&(h=c.width+(n-c.x)*r/a,m&&(y=(h-b)/this.ratio+E)),Ze("left",l)&&(h=c.width-(n-c.x)*r/a,m&&(y=(h-b)/this.ratio+E)),Ze("bottom",l)&&(y=c.height+(s-c.y)*r/a,m&&(h=(y-E)*this.ratio+b)),Ze("top",l)&&(y=c.height-(s-c.y)*r/a,m&&(h=(y-E)*this.ratio+b)),{newWidth:h,newHeight:y}},o.prototype.calculateNewSizeFromAspectRatio=function(n,s,a,r){var i=this.props,l=i.lockAspectRatio,c=i.lockAspectRatioExtraHeight,g=i.lockAspectRatioExtraWidth,m=typeof r.width>"u"?10:r.width,d=typeof a.width>"u"||a.width<0?n:a.width,f=typeof r.height>"u"?10:r.height,h=typeof a.height>"u"||a.height<0?s:a.height,y=c||0,E=g||0;if(l){var b=(f-y)*this.ratio+E,v=(h-y)*this.ratio+E,x=(m-E)/this.ratio+y,C=(d-E)/this.ratio+y,T=Math.max(m,b),w=Math.min(d,v),I=Math.max(f,x),H=Math.min(h,C);n=ft(n,T,w),s=ft(s,I,H)}else n=ft(n,m,d),s=ft(s,f,h);return{newWidth:n,newHeight:s}},o.prototype.setBoundingClientRect=function(){if(this.props.bounds==="parent"){var n=this.parentNode;if(n){var s=n.getBoundingClientRect();this.parentLeft=s.left,this.parentTop=s.top}}if(this.props.bounds&&typeof this.props.bounds!="string"){var a=this.props.bounds.getBoundingClientRect();this.targetLeft=a.left,this.targetTop=a.top}if(this.resizable){var r=this.resizable.getBoundingClientRect(),i=r.left,l=r.top,c=r.right,g=r.bottom;this.resizableLeft=i,this.resizableRight=c,this.resizableTop=l,this.resizableBottom=g}},o.prototype.onResizeStart=function(n,s){if(!(!this.resizable||!this.window)){var a=0,r=0;if(n.nativeEvent&&qo(n.nativeEvent)?(a=n.nativeEvent.clientX,r=n.nativeEvent.clientY):n.nativeEvent&&yt(n.nativeEvent)&&(a=n.nativeEvent.touches[0].clientX,r=n.nativeEvent.touches[0].clientY),this.props.onResizeStart&&this.resizable){var i=this.props.onResizeStart(n,s,this.resizable);if(i===!1)return}this.props.size&&(typeof this.props.size.height<"u"&&this.props.size.height!==this.state.height&&this.setState({height:this.props.size.height}),typeof this.props.size.width<"u"&&this.props.size.width!==this.state.width&&this.setState({width:this.props.size.width})),this.ratio=typeof this.props.lockAspectRatio=="number"?this.props.lockAspectRatio:this.size.width/this.size.height;var l,c=this.window.getComputedStyle(this.resizable);if(c.flexBasis!=="auto"){var g=this.parentNode;if(g){var m=this.window.getComputedStyle(g).flexDirection;this.flexDir=m.startsWith("row")?"row":"column",l=c.flexBasis}}this.setBoundingClientRect(),this.bindEvents();var d={original:{x:a,y:r,width:this.size.width,height:this.size.height},isResizing:!0,backgroundStyle:be(be({},this.state.backgroundStyle),{cursor:this.window.getComputedStyle(n.target).cursor||"auto"}),direction:s,flexBasis:l};this.setState(d)}},o.prototype.onMouseMove=function(n){var s=this;if(!(!this.state.isResizing||!this.resizable||!this.window)){if(this.window.TouchEvent&&yt(n))try{n.preventDefault(),n.stopPropagation()}catch{}var a=this.props,r=a.maxWidth,i=a.maxHeight,l=a.minWidth,c=a.minHeight,g=yt(n)?n.touches[0].clientX:n.clientX,m=yt(n)?n.touches[0].clientY:n.clientY,d=this.state,f=d.direction,h=d.original,y=d.width,E=d.height,b=this.getParentSize(),v=Yo(b,this.window.innerWidth,this.window.innerHeight,r,i,l,c);r=v.maxWidth,i=v.maxHeight,l=v.minWidth,c=v.minHeight;var x=this.calculateNewSizeFromDirection(g,m),C=x.newHeight,T=x.newWidth,w=this.calculateNewMaxFromBoundary(r,i);this.props.snap&&this.props.snap.x&&(T=bn(T,this.props.snap.x,this.props.snapGap)),this.props.snap&&this.props.snap.y&&(C=bn(C,this.props.snap.y,this.props.snapGap));var I=this.calculateNewSizeFromAspectRatio(T,C,{width:w.maxWidth,height:w.maxHeight},{width:l,height:c});if(T=I.newWidth,C=I.newHeight,this.props.grid){var H=En(T,this.props.grid[0]),M=En(C,this.props.grid[1]),A=this.props.snapGap||0;T=A===0||Math.abs(H-T)<=A?H:T,C=A===0||Math.abs(M-C)<=A?M:C}var $={width:T-h.width,height:C-h.height};if(y&&typeof y=="string"){if(y.endsWith("%")){var F=T/b.width*100;T=F+"%"}else if(y.endsWith("vw")){var D=T/this.window.innerWidth*100;T=D+"vw"}else if(y.endsWith("vh")){var L=T/this.window.innerHeight*100;T=L+"vh"}}if(E&&typeof E=="string"){if(E.endsWith("%")){var F=C/b.height*100;C=F+"%"}else if(E.endsWith("vw")){var D=C/this.window.innerWidth*100;C=D+"vw"}else if(E.endsWith("vh")){var L=C/this.window.innerHeight*100;C=L+"vh"}}var R={width:this.createSizeForCssProperty(T,"width"),height:this.createSizeForCssProperty(C,"height")};this.flexDir==="row"?R.flexBasis=R.width:this.flexDir==="column"&&(R.flexBasis=R.height),(0,Wo.flushSync)(function(){s.setState(R)}),this.props.onResize&&this.props.onResize(n,f,this.resizable,$)}},o.prototype.onMouseUp=function(n){var s=this.state,a=s.isResizing,r=s.direction,i=s.original;if(!(!a||!this.resizable)){var l={width:this.size.width-i.width,height:this.size.height-i.height};this.props.onResizeStop&&this.props.onResizeStop(n,r,this.resizable,l),this.props.size&&this.setState(this.props.size),this.unbindEvents(),this.setState({isResizing:!1,backgroundStyle:be(be({},this.state.backgroundStyle),{cursor:"auto"})})}},o.prototype.updateSize=function(n){this.setState({width:n.width,height:n.height})},o.prototype.renderResizer=function(){var n=this,s=this.props,a=s.enable,r=s.handleStyles,i=s.handleClasses,l=s.handleWrapperStyle,c=s.handleWrapperClass,g=s.handleComponent;if(!a)return null;var m=Object.keys(a).map(function(d){return a[d]!==!1?t.createElement(jo,{key:d,direction:d,onResizeStart:n.onResizeStart,replaceStyles:r&&r[d],className:i&&i[d]},g&&g[d]?g[d]:null):null});return t.createElement("div",{className:c,style:l},m)},o.prototype.render=function(){var n=this,s=Object.keys(this.props).reduce(function(i,l){return Ko.indexOf(l)!==-1||(i[l]=n.props[l]),i},{}),a=be(be(be({position:"relative",userSelect:this.state.isResizing?"none":"auto"},this.props.style),this.sizeStyle),{maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight,minWidth:this.props.minWidth,minHeight:this.props.minHeight,boxSizing:"border-box",flexShrink:0});this.state.flexBasis&&(a.flexBasis=this.state.flexBasis);var r=this.props.as||"div";return t.createElement(r,be({ref:this.ref,style:a,className:this.props.className},s),this.state.isResizing&&t.createElement("div",{style:this.state.backgroundStyle}),this.props.children,this.renderResizer())},o.defaultProps={as:"div",onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},enable:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},style:{},grid:[1,1],lockAspectRatio:!1,lockAspectRatioExtraWidth:0,lockAspectRatioExtraHeight:0,scale:1,resizeRatio:1,snapGap:0},o}(t.PureComponent);function Sn(e){const{width:o,children:n,onResize:s}=e,a=(0,N.l4)(),r=(0,N.wW)(_o),i=`${o+31.5}px`;return t.createElement(Jo,{className:(0,p.cx)(r.container,r.drawerActive),defaultSize:{width:i,height:`${a.components.horizontalDrawer.defaultHeight}px`},handleClasses:{top:r.rzHandle},enable:{top:!0,right:!1,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},maxHeight:"100vh",maxWidth:i,minWidth:i,onResize:s},n)}const Xo=e=>(0,p.keyframes)`
  0% {
    transform: translateY(${e.components.horizontalDrawer.defaultHeight}px);
  }

  100% {
    transform: translateY(0px);
  }
`,_o=e=>({container:(0,p.css)`
    position: fixed !important;
    bottom: 0;
    background: ${e.colors.background.primary};
    border-top: 1px solid ${e.colors.border.weak};
    margin: ${e.spacing(0,-2,0,-2)};
    box-shadow: ${e.shadows.z3};
    z-index: ${e.zIndex.navbarFixed};
  `,drawerActive:(0,p.css)`
    opacity: 1;
    animation: 0.5s ease-out ${Xo(e)};
  `,rzHandle:(0,p.css)`
    background: ${e.colors.secondary.main};
    transition: 0.3s background ease-in-out;
    position: relative;
    width: 200px !important;
    height: 7px !important;
    left: calc(50% - 100px) !important;
    top: -4px !important;
    cursor: grab;
    border-radius: ${e.shape.radius.pill};
    &:hover {
      background: ${e.colors.secondary.shade};
    }
  `});var es=u(16826),ts=u(46715),ns=u(3902),os=u(73536),ss=u(97577);function as(e){const{width:o,onClose:n,queryResponse:s,timeZone:a}=e,r=s?.series||[];let i=s?.errors;!i?.length&&s?.error&&(i=[s.error]),(0,t.useEffect)(()=>{(0,P.ff)("grafana_explore_query_inspector_opened")},[]);const l={label:"Stats",value:"stats",icon:"chart-line",content:t.createElement(os.f,{data:s,timeZone:s?.request?.timezone??Y.iT})},c={label:"JSON",value:"json",icon:"brackets-curly",content:t.createElement(ns.W,{data:s,onClose:n})},g={label:"Data",value:"data",icon:"database",content:t.createElement(es.E,{data:r,dataName:"Explore",isLoading:s.state===Z.Gu.Loading,options:{withTransforms:!1,withFieldConfig:!1},timeZone:a,app:Be.zj.Explore})},m={label:"Query",value:"query",icon:"info-circle",content:t.createElement(ss.D,{data:s,onRefreshQuery:()=>e.runQueries({exploreId:e.exploreId})})},d=[l,m,c,g];if(i?.length){const f={label:"Error",value:"error",icon:"exclamation-triangle",content:t.createElement(ts.l,{errors:i})};d.push(f)}return t.createElement(Sn,{width:o},t.createElement(fn.W,{tabs:d,onClose:n,closeIconTooltip:"Close query inspector"}))}function rs(e,{exploreId:o}){const s=e.explore.panes[o],{queryResponse:a}=s;return{queryResponse:a}}const is={runQueries:W.aA},ls=(0,ye.connect)(rs,is)(as);var cs=u(57100),us=u(2598),de=u(40235),Cn=u(82541),Et=u(15867),ds=u(37870),S=u(95329),kt=u(28878),ps=u(40715),Vt=u(92713),pe=u(21128),Wt=u(49683),hs=u(10632),wn=u(21644),Rn=u(13446),gs=u(38483),Tn=u(52152);function ms(e){const{onClick:o,isSynced:n}=e,s=()=>{const{isSynced:a}=e,r=a?"Unsync all views":"Sync all views to this time range";return t.createElement(t.Fragment,null,r)};return t.createElement(fe.u,{content:s,placement:"bottom"},t.createElement(de.h,{icon:"link",variant:n?"active":"canvas","aria-label":n?"Synced times":"Unsynced times",onClick:o}))}class fs extends t.Component{constructor(){super(...arguments),this.onMoveTimePicker=o=>{const{range:n,onChangeTime:s,timeZone:a}=this.props,{from:r,to:i}=(0,Tn.e)(o,n),l={from:(0,Ee.GY)(a,r),to:(0,Ee.GY)(a,i)};s(l)},this.onMoveForward=()=>this.onMoveTimePicker(1),this.onMoveBack=()=>this.onMoveTimePicker(-1),this.onChangeTimePicker=o=>{const n=Rn.isMathString(o.raw.from)?o.raw.from:o.from,s=Rn.isMathString(o.raw.to)?o.raw.to:o.to;this.props.onChangeTime({from:n,to:s}),(0,P.ff)("grafana_explore_time_picker_time_range_changed",{timeRangeFrom:n,timeRangeTo:s})},this.onZoom=()=>{const{range:o,onChangeTime:n,timeZone:s}=this.props,{from:a,to:r}=(0,Tn.h)(o,2),i={from:(0,Ee.GY)(s,a),to:(0,Ee.GY)(s,r)};n(i)}}render(){const{range:o,timeZone:n,fiscalYearStartMonth:s,splitted:a,syncedTimes:r,onChangeTimeSync:i,hideText:l,onChangeTimeZone:c,onChangeFiscalYearStartMonth:g}=this.props,m=a?t.createElement(ms,{onClick:i,isSynced:r}):void 0,d={value:o,timeZone:n,fiscalYearStartMonth:s,onMoveBackward:this.onMoveBack,onMoveForward:this.onMoveForward,onZoom:this.onZoom,hideText:l};return t.createElement(gs.a,{isOnCanvas:!0,...d,timeSyncButton:m,isSynced:r,widthOverride:a?window.innerWidth/2:void 0,onChange:this.onChangeTimePicker,onChangeTimeZone:c,onChangeFiscalYearStartMonth:g})}}var Ln=u(54278);function ys(e){const{start:o,pause:n,resume:s,isLive:a,isPaused:r,stop:i,splitted:l}=e,c=a&&!r?"active":"canvas",g=a?r?s:n:o;return t.createElement(Cn.h,null,t.createElement(fe.u,{content:a&&!r?t.createElement(t.Fragment,null,"Pause the live stream"):t.createElement(t.Fragment,null,"Start live stream your logs"),placement:"bottom"},t.createElement(de.h,{iconOnly:l,variant:c,icon:!a||r?"play":"pause",onClick:g},a&&r?"Paused":"Live")),t.createElement(Ln.Z,{mountOnEnter:!0,unmountOnExit:!0,timeout:100,in:a,classNames:{enter:bt.stopButtonEnter,enterActive:bt.stopButtonEnterActive,exit:bt.stopButtonExit,exitActive:bt.stopButtonExitActive}},t.createElement(fe.u,{content:t.createElement(t.Fragment,null,"Stop and exit the live stream"),placement:"bottom"},t.createElement(de.h,{variant:c,onClick:i,icon:"square-shape"}))))}const bt={stopButtonEnter:(0,p.css)`
    label: stopButtonEnter;
    width: 0;
    opacity: 0;
    overflow: hidden;
  `,stopButtonEnterActive:(0,p.css)`
    label: stopButtonEnterActive;
    opacity: 1;
    width: 32px;
  `,stopButtonExit:(0,p.css)`
    label: stopButtonExit;
    width: 32px;
    opacity: 1;
    overflow: hidden;
  `,stopButtonExitActive:(0,p.css)`
    label: stopButtonExitActive;
    opacity: 0;
    width: 0;
  `};var vs=u(58715),Es=u(73999),bs=u(26141),Fn=u(44839),xs=u(89601),Ss=u(63353);const Cs=(0,t.lazy)(()=>u.e(4520).then(u.bind(u,14520)).then(({AddToDashboard:e})=>({default:e})));function ws(e){const{exploreId:o,splitted:n}=e,[s,a]=(0,t.useState)(),[r,i]=(0,t.useState)(!1),l=Rs(e),c=Ts(l),g=(0,te.F9)(o),m=(0,O.useSelector)(g)?.queries?.length;if(c.length<=1)return rt.contextSrv.hasPermission(O.AccessControlAction.DashboardsCreate)||rt.contextSrv.hasPermission(O.AccessControlAction.DashboardsWrite)?t.createElement(t.Suspense,{fallback:null},t.createElement(Cs,{exploreId:o})):null;const d=t.createElement(Ss.G,{extensions:c,onSelect:a});return t.createElement(t.Fragment,null,t.createElement(Fn.L,{onVisibleChange:i,placement:"bottom-start",overlay:d},t.createElement(de.h,{"aria-label":"Add",icon:"plus",disabled:!m,variant:"canvas",isOpen:r},n?" ":"Add")),!!s&&!!s.path&&t.createElement(xs.F,{path:s.path,title:s.title,onDismiss:()=>a(void 0)}))}function Rs(e){const{exploreId:o,timeZone:n}=e,a=(0,O.useSelector)(te.z7)?.editorMode||!1,{queries:r,queryResponse:i,range:l}=(0,O.useSelector)((0,te.F9)(o)),c=(0,O.useSelector)((0,te.aM)(o)),g=r.map(f=>f?.datasource?.uid).filter(f=>f!==void 0),m=[...new Set(g)].length,d=rt.contextSrv.hasPermission(O.AccessControlAction.DataSourcesWrite);return(0,t.useMemo)(()=>({exploreId:o,targets:r,data:i,timeRange:l.raw,timeZone:(0,vs.Z)({timeZone:n}),shouldShowAddCorrelation:q.config.featureToggles.correlations===!0&&d&&!a&&c&&m===1}),[o,r,i,l.raw,n,d,a,c,m])}function Ts(e){return(0,t.useMemo)(()=>{const{extensions:o}=(0,bs.dj)({extensionPointId:Es.y.ExploreToolbarAction,context:e,limitPerPlugin:3});return o},[e])}var me=u(17713);function Ls(e){const o=(0,O.useDispatch)(),n=(0,t.useCallback)(()=>{o((0,W.sQ)({exploreId:e,isPaused:!0}))},[e,o]),s=(0,t.useCallback)(()=>{o((0,W.sQ)({exploreId:e,isPaused:!1}))},[e,o]),a=(0,t.useCallback)(()=>{n(),o((0,me.oz)({exploreId:e,refreshInterval:Et.dP.offOption.value})),o((0,W.aA)({exploreId:e}))},[e,o,n]),r=(0,t.useCallback)(()=>{o((0,me.oz)({exploreId:e,refreshInterval:Et.dP.liveOption.value}))},[e,o]),i=(0,t.useCallback)(()=>{o((0,W.Sv)({exploreId:e}))},[e,o]);return{pause:n,resume:s,stop:a,start:r,clear:i}}function In(e){const o=Ls(e.exploreId);return e.children(o)}const Fs=(e,o)=>({rotateIcon:(0,p.css)({"> div > svg":{transform:"rotate(180deg)"}}),toolbarButton:(0,p.css)({display:"flex",justifyContent:"center",marginRight:e.spacing(.5),width:o&&e.spacing(6)})});function Is({exploreId:e,onChangeTime:o,onContentOutlineToogle:n,isContentOutlineOpen:s}){const a=(0,pe.I0)(),r=(0,pe.v9)(te.pd),i=(0,N.wW)(Fs,r),l=(0,pe.v9)(z=>(0,dt.Z)(z.user)),c=(0,pe.v9)(z=>(0,dt.i)(z.user)),{refreshInterval:g,datasourceInstance:m,range:d,isLive:f,isPaused:h,syncedTimes:y}=(0,pe.v9)(z=>({...(0,j.pick)(z.explore.panes[e],"refreshInterval","datasourceInstance","range","isLive","isPaused"),syncedTimes:z.explore.syncedTimes}),ye.shallowEqual),E=(0,pe.v9)((0,W.$9)(e)),b=(0,pe.v9)(z=>z.explore.largerExploreId===e),v=(0,pe.v9)(z=>r||z.explore.panes[e].containerWidth<1210),x=(0,pe.v9)(z=>z.explore.panes[e].containerWidth<(r?700:800)),C=(0,pe.v9)(te.M),T=(0,pe.v9)(te.z7),w=T?.editorMode||!1,I=(0,pe.v9)((0,te.aM)(e)),H=(0,t.useMemo)(()=>I&&b||!I&&!b,[I,b]),M=E?(0,S.t)("explore.toolbar.refresh-picker-cancel","Cancel"):(0,S.t)("explore.toolbar.refresh-picker-run","Run query"),A=()=>{(0,kt.L)(u.g.location.href),(0,P.ff)("grafana_explore_shortened_link_clicked")},$=async z=>{w?T?.correlationDirty||T?.queryEditorDirty?a((0,V.Hg)({isExiting:!0,postConfirmAction:{exploreId:e,action:Vt.iJ.CHANGE_DATASOURCE,changeDatasourceUid:z.uid,isActionLeft:I}})):(I&&C.forEach(le=>{a((0,ue.Oj)({exploreId:le[0],correlationEditorHelperData:void 0}))}),a((0,$e.zU)(e,z.uid,{importQueries:!0}))):a((0,$e.zU)(e,z.uid,{importQueries:!0}))},F=(z=!1)=>a(z?(0,W.ci)(e):(0,W.aA)({exploreId:e})),D=z=>a((0,wn.YT)(z)),L=()=>{a((0,V.bW)()),(0,P.ff)("grafana_explore_split_view_opened",{origin:"menu"})},R=()=>{w?T?.correlationDirty||T?.queryEditorDirty?a((0,V.Hg)({isExiting:!0,postConfirmAction:{exploreId:e,action:Vt.iJ.CLOSE_PANE,isActionLeft:I}})):(C.forEach(z=>{a((0,ue.Oj)({exploreId:z[0],correlationEditorHelperData:void 0}))}),a((0,V.YV)(e)),(0,P.ff)("grafana_explore_split_view_closed")):(a((0,V.YV)(e)),(0,P.ff)("grafana_explore_split_view_closed"))},B=()=>{a(b?(0,V.AP)():(0,V.nL)({exploreId:e}))},ee=()=>{a((0,me.mG)(e))},J=z=>a((0,wn.rf)(z)),K=z=>{a((0,me.oz)({exploreId:e,refreshInterval:z}))},Ie=[t.createElement(hs.u,{key:"share",tooltip:(0,S.t)("explore.toolbar.copy-shortened-link","Copy shortened link"),icon:"share-alt",onClick:A,"aria-label":(0,S.t)("explore.toolbar.copy-shortened-link","Copy shortened link")}),t.createElement("div",{style:{flex:1},key:"spacer0"})];return t.createElement("div",null,g&&t.createElement(cs.F,{func:F,interval:g,loading:E}),t.createElement("div",null,t.createElement(ds.A,{actions:Ie})),t.createElement(us.X,{"aria-label":(0,S.t)("explore.toolbar.aria-label","Explore toolbar"),leftItems:[q.config.featureToggles.exploreContentOutline&&t.createElement(de.h,{key:"content-outline",variant:"canvas",tooltip:"Content outline",icon:"list-ui-alt",iconOnly:r,onClick:n,"aria-expanded":s,"aria-controls":s?"content-outline-container":void 0,className:i.toolbarButton},"Outline"),t.createElement(ps.q,{key:`${e}-ds-picker`,mixed:!w,onChange:$,current:m?.getRef(),hideTextValue:x,width:x?8:void 0})].filter(Boolean),forceShowLeftItems:!0},[r?t.createElement(Cn.h,{key:"split-controls"},t.createElement(de.h,{variant:"canvas",tooltip:b?(0,S.t)("explore.toolbar.split-narrow","Narrow pane"):(0,S.t)("explore.toolbar.split-widen","Widen pane"),onClick:B,icon:b?"gf-movepane-left":"gf-movepane-right",iconOnly:!0,className:(0,p.cx)(H&&i.rotateIcon)}),t.createElement(de.h,{tooltip:(0,S.t)("explore.toolbar.split-close-tooltip","Close split pane"),onClick:R,icon:"times",variant:"canvas"},t.createElement(S.cC,{i18nKey:"explore.toolbar.split-close"}," Close "))):t.createElement(de.h,{variant:"canvas",key:"split",tooltip:(0,S.t)("explore.toolbar.split-tooltip","Split the pane"),onClick:L,icon:"columns",disabled:f},t.createElement(S.cC,{i18nKey:"explore.toolbar.split-title"},"Split")),t.createElement(ws,{splitted:r,key:"toolbar-extension-point",exploreId:e,timeZone:l}),!f&&t.createElement(fs,{key:"timeControls",exploreId:e,range:d,timeZone:l,fiscalYearStartMonth:c,onChangeTime:o,splitted:r,syncedTimes:y,onChangeTimeSync:ee,hideText:v,onChangeTimeZone:D,onChangeFiscalYearStartMonth:J}),t.createElement(Et.dP,{key:"refreshPicker",onIntervalChanged:K,value:g,isLoading:E,text:v?void 0:M,tooltip:v?M:void 0,intervals:Wt.Vt.getValidIntervals(Et.o5),isLive:f,onRefresh:()=>F(E),noIntervalPicker:f,primary:!0,width:(v?35:108)+"px"}),m?.meta.streaming&&t.createElement(In,{key:"liveControls",exploreId:e},z=>{const le={...z,start:()=>{(0,P.ff)("grafana_explore_logs_live_tailing_clicked",{datasourceType:m?.type}),z.start()}};return t.createElement(ys,{splitted:r,isLive:f,isPaused:h,start:le.start,pause:le.pause,resume:le.resume,stop:le.stop})})].filter(Boolean)))}var Os=u(52968);function xt(e,o={}){(0,P.ff)(`grafana_flamegraph_${e}`,{app:Be.zj.Unknown,grafana_version:q.config.buildInfo.version,...o})}const Ds=e=>{const o=(0,N.wW)(n=>Ns(n));return t.createElement("div",{className:o.container},t.createElement(Os.Z,{data:e.dataFrames[0],stickyHeader:!0,getTheme:()=>q.config.theme2,onTableSymbolClick:()=>xt("table_item_selected"),onViewSelected:n=>xt("view_selected",{view:n}),onTextAlignSelected:n=>xt("text_align_selected",{align:n}),onTableSort:n=>xt("table_sort_selected",{sort:n}),disableCollapsing:!q.config.featureToggles.flameGraphItemCollapsing}))},Ns=e=>({container:(0,p.css)`
    background: ${e.colors.background.primary};
    display: flow-root;
    padding: 0 ${e.spacing(1)} ${e.spacing(1)} ${e.spacing(1)};
    border: 1px solid ${e.components.panel.borderColor};
    border-radius: ${e.shape.radius.default};
  `});var zs=u(79210),Xe=u(52077),On=u(19737),Qt=u(12537),As=u(62793),Ps=u(51994),xe=u(19593),Ms=u(23426),Hs=u(54287);const Dn=150,$s=({resetKey:e,humanize:o,className:n})=>{const[s,a]=(0,t.useState)(0);return(0,Ms.Z)(()=>a(s+Dn),Dn),(0,t.useEffect)(()=>a(0),[e]),t.createElement(Hs.q,{timeInMs:s,className:n,humanize:o})};var Le=u(3158);const Bs=e=>({logsRowsLive:(0,p.css)`
    label: logs-rows-live;
    font-family: ${e.typography.fontFamilyMonospace};
    font-size: ${e.typography.bodySmall.fontSize};
    display: flex;
    flex-flow: column nowrap;
    height: 60vh;
    overflow-y: scroll;
    :first-child {
      margin-top: auto !important;
    }
  `,logsRowFade:(0,p.css)`
    label: logs-row-fresh;
    color: ${e.colors.text};
    background-color: ${(0,On.Z)(e.colors.info.transparent).setAlpha(.25).toString()};
    animation: fade 1s ease-out 1s 1 normal forwards;
    @keyframes fade {
      from {
        background-color: ${(0,On.Z)(e.colors.info.transparent).setAlpha(.25).toString()};
      }
      to {
        background-color: transparent;
      }
    }
  `,logsRowsIndicator:(0,p.css)`
    font-size: ${e.typography.h6.fontSize};
    padding-top: ${e.spacing(1)};
    display: flex;
    align-items: center;
  `,button:(0,p.css)`
    margin-right: ${e.spacing(1)};
  `,fullWidth:(0,p.css)`
    width: 100%;
  `});class ks extends t.PureComponent{constructor(o){super(o),this.liveEndDiv=null,this.scrollContainerRef=t.createRef(),this.onScroll=n=>{const{isPaused:s,onPause:a}=this.props,{scrollTop:r,clientHeight:i,scrollHeight:l}=n.currentTarget;l-(r+i)>=5&&!s&&a()},this.rowsToRender=()=>{const{isPaused:n}=this.props;let{logRowsToRender:s=[]}=this.state;return n||(s=(0,xe.$u)(s,Y.UV.Ascending).slice(-100)),s},this.state={logRowsToRender:o.logRows}}static getDerivedStateFromProps(o,n){return o.isPaused&&o.clearedAtIndex?{logRowsToRender:(0,Le.bG)(o.clearedAtIndex,n.logRowsToRender)}:o.isPaused?null:{logRowsToRender:o.logRows}}render(){const{theme:o,timeZone:n,onPause:s,onResume:a,onClear:r,isPaused:i}=this.props,l=Bs(o),{logsRow:c,logsRowLocalTime:g,logsRowMessage:m}=(0,Ps.h)(o);return t.createElement("div",null,t.createElement("table",{className:l.fullWidth},t.createElement("tbody",{onScroll:i?void 0:this.onScroll,className:l.logsRowsLive,ref:this.scrollContainerRef},this.rowsToRender().map(d=>t.createElement("tr",{className:(0,p.cx)(c,l.logsRowFade),key:d.uid},t.createElement("td",{className:g},(0,Qt.dq)(d.timeEpochMs,{timeZone:n})),t.createElement("td",{className:m},d.hasAnsi?t.createElement(As.Q,{value:d.raw}):d.entry))),t.createElement("tr",{ref:d=>{this.liveEndDiv=d,this.liveEndDiv&&this.scrollContainerRef.current?.scrollTo&&!i&&this.scrollContainerRef.current?.scrollTo(0,this.scrollContainerRef.current.scrollHeight)}}))),t.createElement("div",{className:l.logsRowsIndicator},t.createElement(U.zx,{icon:i?"play":"pause",variant:"secondary",onClick:i?a:s,className:l.button},i?"Resume":"Pause"),t.createElement(U.zx,{icon:"trash-alt",variant:"secondary",onClick:r,className:l.button},"Clear logs"),t.createElement(U.zx,{icon:"square-shape",variant:"secondary",onClick:this.props.stopLive,className:l.button},"Exit live mode"),i||this.rowsToRender().length>0&&t.createElement("span",null,"Last line received: ",t.createElement($s,{resetKey:this.props.logRows,humanize:!0})," ago")))}}const Vs=(0,N.HE)(ks);var Nn=u(43471),Ut=u(173),Ws=u(71244),Qs=u(34364),St=u(5106),Us=u(81368),Se=u(84933),ze=u(5999),X=u(20994),Ae=u(59767),_e=u(46063);const _={showLabels:"grafana.explore.logs.showLabels",showTime:"grafana.explore.logs.showTime",wrapLogMessage:"grafana.explore.logs.wrapLogMessage",prettifyLogMessage:"grafana.explore.logs.prettifyLogMessage",logsSortOrder:"grafana.explore.logs.sortOrder",logContextWrapLogMessage:"grafana.explore.logs.logContext.wrapLogMessage"};var Ct=u(81154),wt=u(75682);const zn=({place:e})=>{const o=e==="above"?"Loading newer logs...":"Loading older logs...";return t.createElement("div",{className:js},t.createElement("div",null,o," ",t.createElement(wt.$,{inline:!0})))},js=(0,p.css)`
  display: flex;
  justify-content: center;
`;function Gs(e){return{buttons:(0,p.css)({display:"flex",gap:e.spacing(1)})}}const Zs=e=>{const o=(0,N.wW)(Gs),{wrapLines:n,onChangeWrapLines:s,onScrollCenterClick:a}=e,r=(0,t.useCallback)(i=>{const l=i.currentTarget.checked;(0,P.ff)("grafana_explore_logs_log_context_toggle_lines_clicked",{state:l}),s(l)},[s]);return t.createElement("div",{className:o.buttons},t.createElement(ze.x,{showLabel:!0,value:n,onChange:r,label:"Wrap lines"}),t.createElement(U.zx,{variant:"secondary",onClick:a},"Center matched line"))},qs=e=>({modal:(0,p.css)`
      width: 85vw;
      ${e.breakpoints.down("md")} {
        width: 100%;
      }
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    `,sticky:(0,p.css)`
      position: sticky;
      z-index: 1;
      top: -1px;
      bottom: -1px;
    `,entry:(0,p.css)`
      & > td {
        padding: ${e.spacing(1)} 0 ${e.spacing(1)} 0;
      }
      background: ${e.colors.emphasize(e.colors.background.secondary)};

      & > table {
        margin-bottom: 0;
      }

      & .log-row-menu {
        margin-top: -6px;
      }
    `,datasourceUi:(0,p.css)`
      padding-bottom: ${e.spacing(1.25)};
      display: flex;
      align-items: center;
    `,logRowGroups:(0,p.css)`
      overflow: auto;
      max-height: 75%;
      align-self: stretch;
      display: inline-block;
      border: 1px solid ${e.colors.border.weak};
      border-radius: ${e.shape.radius.default};
      & > table {
        min-width: 100%;
      }
    `,flexColumn:(0,p.css)`
      display: flex;
      flex-direction: column;
      padding: 0 ${e.spacing(3)} ${e.spacing(3)} ${e.spacing(3)};
    `,flexRow:(0,p.css)`
      display: flex;
      flex-direction: row;
      align-items: center;
      & > div:last-child {
        margin-left: auto;
      }
    `,noMarginBottom:(0,p.css)`
      & > table {
        margin-bottom: 0;
      }
    `,hidden:(0,p.css)`
      display: none;
    `,paddingTop:(0,p.css)`
      padding-top: ${e.spacing(1)};
    `,paddingBottom:(0,p.css)`
      padding-bottom: ${e.spacing(1)};
    `,link:(0,p.css)`
      color: ${e.colors.text.secondary};
      font-size: ${e.typography.bodySmall.fontSize};
      :hover {
        color: ${e.colors.text.link};
      }
    `,loadingCell:(0,p.css)`
      position: sticky;
      left: 50%;
      display: inline-block;
      transform: translateX(-50%);
    `}),An=()=>({above:{loadingState:Z.Gu.NotStarted,rows:[]},below:{loadingState:Z.Gu.NotStarted,rows:[]}}),Ys=(e,o)=>e==="above"&&o===Y.UV.Descending||e==="below"&&o===Y.UV.Ascending?G.M4.Forward:G.M4.Backward,Ks=(e,o)=>({...e,dataFrame:{...e.dataFrame,refId:`context_${o.above}_${o.below}`}}),Js=(e,o)=>e.some(n=>n.entry===o.entry&&n.timeEpochNs===o.timeEpochNs),Xs=100,_s=({row:e,open:o,logsSortOrder:n,timeZone:s,getLogRowContextUi:a,getRowContextQuery:r,onClose:i,getRowContext:l})=>{const c=(0,t.useRef)(null),g=(0,t.useRef)(null),m=(0,t.useRef)(null),d=(0,t.useRef)(null),f=(0,t.useRef)(null),h=(0,t.useRef)(null),y=(0,t.useRef)(null),E=(0,t.useRef)({above:0,below:0}),b=(0,O.useDispatch)(),v=(0,N.l4)(),x=qs(v),[C,T]=(0,t.useState)(!0),[w,I]=(0,t.useState)(An()),H=(k,ae)=>{I(ne=>{const re={...ne};return re[k]=ae(ne[k]),re})},M=(0,t.useRef)(1),[A,$]=(0,t.useState)(null),[F,D]=(0,t.useState)(X.Z.getBool(_.logContextWrapLogMessage,X.Z.getBool(_.wrapLogMessage,!0))),L=(0,t.useCallback)(()=>{const{below:k,above:ae}=w,ne=(0,xe.$u)([...k.rows,e,...ae.rows],Y.UV.Ascending),re=ne[0].timeEpochMs;let he=ne[ne.length-1].timeEpochMs;re===he&&(he+=1);const ie=(0,Ee.CQ)(re),Oe=(0,Ee.CQ)(he);return{from:ie,to:Oe,raw:{from:ie,to:Oe}}},[w,e]),R=(0,t.useCallback)(async()=>{const k=r?await r(e):null;$(k)},[e,r]),B=async()=>{await R(),I(An()),E.current={above:0,below:0},M.current+=1},ee=async(k,ae)=>{E.current[k]+=1;const ne=ae.at(k==="above"?0:-1);if(ne==null)throw new Error("should never happen. the array always contains at least 1 item (the middle row)");(0,P.ff)("grafana_explore_logs_log_context_load_more_called",{datasourceType:ne.datasourceType,above:E.current.above,below:E.current.below});const re=Ys(k,n),he=await l(Ks(ne,E.current),{limit:Xs,direction:re}),ie=(0,Ct.aB)(he.data).rows;return n===Y.UV.Ascending&&ie.reverse(),ie.filter(at=>!Js(ae,at))};(0,t.useEffect)(()=>{o&&R()},[R,o]);const[J,K]=(0,t.useState)([]),Ie=k=>{J.indexOf(k)===-1&&K([...J,k])},z=k=>{const ae=J.indexOf(k);ae>-1&&(J.splice(ae,1),K([...J]))},le=async k=>{const{below:ae,above:ne}=w;if(w[k].loadingState===Z.Gu.Loading)return;H(k,ie=>({...ie,loadingState:Z.Gu.Loading}));const he=M.current;try{const ie=[...ne.rows,e,...ae.rows],Oe=await ee(k,ie),[at,ro]=(0,j.partition)(Oe,He=>He.timeEpochNs>e.timeEpochNs),io=n===Y.UV.Ascending?ro:at,lo=n===Y.UV.Ascending?at:ro;he===M.current&&I(He=>{const Vi=io.length>0?(0,xe.$u)([...io,...He.above.rows],n):He.above.rows,Wi=lo.length>0?(0,xe.$u)([...He.below.rows,...lo],n):He.below.rows;return{above:{rows:Vi,loadingState:k==="above"?Oe.length===0?Z.Gu.Done:Z.Gu.NotStarted:He.above.loadingState},below:{rows:Wi,loadingState:k==="below"?Oe.length===0?Z.Gu.Done:Z.Gu.NotStarted:He.below.loadingState}}})}catch{H(k,ie=>({rows:ie.rows,loadingState:Z.Gu.Error}))}},Pe=async(k,ae)=>{for(const ne of k){if(!ne.isIntersecting)continue;const re=ne.target;re===h.current?le("above"):re===y.current&&le("below")}};(0,t.useEffect)(()=>{const k=c.current,ae=h.current,ne=y.current;if(k==null)return;const re=new IntersectionObserver(Pe,{root:k});return ae!=null&&re.observe(ae),ne!=null&&re.observe(ne),()=>{re.disconnect()}});const Q=(0,t.useCallback)(()=>{m.current?.scrollIntoView({block:"center"}),g.current?.scrollIntoView({block:"center"})},[m,g]);(0,t.useLayoutEffect)(()=>{const k=c.current;if(k==null)return;const ae=f.current,ne=k.clientHeight;if(f.current=ne,ae!==ne){Q();return}if(E.current.above<=1&&E.current.below<=1){Q();return}const re=d.current,he=k.scrollHeight;if(d.current=he,re!=null){const ie=k.scrollTop+(he-re);k.scrollTop=ie}},[w.above.rows,Q]),(0,Mt.Z)(R,[r,e]);const Me=w.above.loadingState,qe=w.below.loadingState;return t.createElement(Qe.u,{isOpen:o,title:"Log context",contentClassName:x.flexColumn,className:x.modal,onDismiss:i},q.config.featureToggles.logsContextDatasourceUi&&a&&t.createElement("div",{className:x.datasourceUi},a(e,B)),t.createElement("div",{className:(0,p.cx)(x.flexRow,x.paddingBottom)},t.createElement("div",null,t.createElement(Zs,{wrapLines:F,onChangeWrapLines:D,onScrollCenterClick:Q}))),t.createElement("div",{ref:c,className:x.logRowGroups},t.createElement("table",null,t.createElement("tbody",null,t.createElement("tr",null,t.createElement("td",{className:x.loadingCell},Me!==Z.Gu.Done&&Me!==Z.Gu.Error&&t.createElement("div",{ref:h},t.createElement(zn,{place:"above"})),Me===Z.Gu.Error&&t.createElement("div",null,"Error loading log more logs."),Me===Z.Gu.Done&&t.createElement("div",null,"No more logs available."))),t.createElement("tr",null,t.createElement("td",{className:x.noMarginBottom},t.createElement(_e.w,{logRows:w.above.rows,dedupStrategy:Y.Y4.none,showLabels:X.Z.getBool(_.showLabels,!1),showTime:X.Z.getBool(_.showTime,!0),wrapLogMessage:F,prettifyLogMessage:X.Z.getBool(_.prettifyLogMessage,!1),enableLogDetails:!0,timeZone:s,displayedFields:J,onClickShowField:Ie,onClickHideField:z}))),t.createElement("tr",{ref:m}),t.createElement("tr",{ref:g,className:(0,p.cx)(x.entry,C?x.sticky:null),"data-testid":"entry-row"},t.createElement("td",{className:x.noMarginBottom},t.createElement(_e.w,{logRows:[e],dedupStrategy:Y.Y4.none,showLabels:X.Z.getBool(_.showLabels,!1),showTime:X.Z.getBool(_.showTime,!0),wrapLogMessage:F,prettifyLogMessage:X.Z.getBool(_.prettifyLogMessage,!1),enableLogDetails:!0,timeZone:s,displayedFields:J,onClickShowField:Ie,onClickHideField:z,onUnpinLine:()=>T(!1),onPinLine:()=>T(!0),pinnedRowId:C?e.uid:void 0,overflowingContent:!0}))),t.createElement("tr",null,t.createElement("td",null,t.createElement(t.Fragment,null,t.createElement(_e.w,{logRows:w.below.rows,dedupStrategy:Y.Y4.none,showLabels:X.Z.getBool(_.showLabels,!1),showTime:X.Z.getBool(_.showTime,!0),wrapLogMessage:F,prettifyLogMessage:X.Z.getBool(_.prettifyLogMessage,!1),enableLogDetails:!0,timeZone:s,displayedFields:J,onClickShowField:Ie,onClickHideField:z})))),t.createElement("tr",null,t.createElement("td",{className:x.loadingCell},qe!==Z.Gu.Done&&qe!==Z.Gu.Error&&t.createElement("div",{ref:y},t.createElement(zn,{place:"below"})),qe===Z.Gu.Error&&t.createElement("div",null,"Error loading log more logs."),qe===Z.Gu.Done&&t.createElement("div",null,"No more logs available.")))))),t.createElement(Qe.u.ButtonRow,null,A?.datasource?.uid&&t.createElement(U.zx,{variant:"secondary",onClick:async()=>{let k=e.uid;e.dataFrame.refId&&(k=e.uid.replace(e.dataFrame.refId,A.refId)),b((0,V.bW)({queries:[A],range:L(),datasourceUid:A.datasource.uid,panelsState:{logs:{id:k}}})),i(),(0,P.ff)("grafana_explore_logs_log_context_open_split_view_clicked",{datasourceType:e.datasourceType,logRowUid:e.uid})}},"Open in split view")))};var Rt=u(93991),Fe=u(65512),jt=u(17765);const Pn=e=>e.status==="fulfilled";function ke(e,o){return e in o}const ea={parse:e=>{if(!e.left&&!e.right)return{to:{left:{datasource:null,queries:[],range:{from:"now-6h",to:"now"}},schemaVersion:0},error:!1};let o,n,s,a;return typeof e.left=="string"&&([o,s]=Hn(e.left)),typeof e.right=="string"?[n,a]=Hn(e.right):e.right&&(n=Tt,a=!0),o||(o=Tt),{to:{schemaVersion:0,left:o,...n&&{right:n}},error:!!s||!!a}}},Mn=(e,...o)=>o.some(n=>e.hasOwnProperty(n));var ta=(e=>(e[e.RangeFrom=0]="RangeFrom",e[e.RangeTo=1]="RangeTo",e[e.Datasource=2]="Datasource",e[e.SegmentsStart=3]="SegmentsStart",e))(ta||{});const Tt={datasource:null,queries:[],range:Le.UI};function Hn(e){let o;try{o=JSON.parse(e)}catch{return[Tt,!0]}if(!Array.isArray(o))return[{queries:[],range:Le.UI,...o},!1];if(o.length<=3)return[Tt,!0];const n={from:o[0],to:o[1]},s=o[2],a=o.slice(3),r=a.filter(l=>!Mn(l,"ui","mode","__panelsState")),i=a.find(l=>Mn(l,"__panelsState"))?.__panelsState;return[{datasource:s,queries:r,range:n,panelsState:i},!1]}const na={parse:e=>{if(!e||!e.panes||typeof e.panes!="string")return{to:{schemaVersion:1,panes:{[(0,we.z0)()]:et}},error:!1};let o;try{o=JSON.parse(e.panes)}catch{}if(o==null||typeof o!="object")return{to:{schemaVersion:1,panes:{[(0,we.z0)()]:et}},error:!0};const n=Object.entries(o).map(([s,a])=>[s,oa(a)]).reduce((s,[a,r])=>({...s,[a]:r}),{});return Object.keys(n).length||(n[(0,we.z0)()]=et),{to:{schemaVersion:1,panes:n},error:!1}},migrate:e=>({schemaVersion:1,panes:{[(0,we.z0)()]:e.left,...e.right&&{[(0,we.z0)()]:e.right}}})},et={datasource:null,queries:[],range:Le.UI};function oa(e){return!e||typeof e!="object"?et:{...et,...ke("queries",e)&&Array.isArray(e.queries)&&{queries:e.queries},...ke("datasource",e)&&typeof e.datasource=="string"&&{datasource:e.datasource},...ke("panelsState",e)&&!!e.panelsState&&typeof e.panelsState=="object"&&{panelsState:e.panelsState},...ke("range",e)&&!!e.range&&typeof e.range=="object"&&ke("from",e.range)&&ke("to",e.range)&&typeof e.range.from=="string"&&typeof e.range.to=="string"&&{range:{from:e.range.from,to:e.range.to}}}}const sa=e=>ra(e),aa=[ea,na],ra=e=>{const o=ia(e),[n,...s]=aa.slice(o),{error:a,to:r}=n.parse(e);return[s.reduce((l,c)=>c.migrate?c.migrate(l):l,r),a]};function ia(e){return!e||!("schemaVersion"in e)||!e.schemaVersion?0:typeof e.schemaVersion=="number"?e.schemaVersion:typeof e.schemaVersion=="string"?Number.parseInt(e.schemaVersion,10):0}function la(e){const{location:o}=(0,We.p)(),n=(0,O.useDispatch)(),s=(0,O.useSelector)(te.Ky),a=(0,O.useSelector)(c=>c.user.orgId),r=(0,t.useRef)(e),i=(0,t.useRef)("notstarted"),{warning:l}=(0,Rt.iG)();(0,t.useEffect)(()=>{e.panes||(i.current="notstarted",r.current=e)},[e]),(0,t.useEffect)(()=>{const c=n((0,O.addListener)({predicate:g=>[V.YV.type,V.bW.fulfilled.type,W.aA.pending.type,me.oW.type,ue.Yn.type].includes(g.type),effect:async(g,{cancelActiveListeners:m,delay:d,getState:f})=>{m(),await d(200);const h=Object.entries(f().explore.panes).reduce((y,[E,b])=>b?{...y,[E]:Ft(b)}:y,{});if(!(0,j.isEqual)(r.current.panes,JSON.stringify(h))){const y=!!r.current.panes&&Object.values(r.current.panes).filter(Boolean).length===0||i.current==="pending";r.current={panes:JSON.stringify(h)},o.partial({panes:r.current.panes},y)}}}));return()=>c()},[n,o]),(0,t.useEffect)(()=>{const c=r.current?.panes!==e.panes,[g,m]=sa(e);m&&l("Could not parse Explore URL","The requested URL contains invalid parameters, a default Explore state has been loaded.");async function d(){const f=Object.values(g.panes);if(f.length>1){const h=f.some(({range:y},E,[{range:b}])=>!(0,j.isEqual)(y,b));n((0,V.tl)({syncedTimes:!h}))}Object.entries(g.panes).forEach(([h,y],E)=>{const{datasource:b,queries:v,range:x,panelsState:C}=y,T=s[h];if(T!==void 0){const w=pa(y,Ft(T));Promise.resolve().then(async()=>{w.datasource&&b&&await n((0,$e.zU)(h,b))}).then(()=>{w.range&&n((0,me.b3)({exploreId:h,rawRange:(0,Le.dc)(x)})),w.queries&&n((0,W.SE)({exploreId:h,queries:(0,jt.Z)(v)})),(w.queries||w.range)&&n((0,W.aA)({exploreId:h})),w.panelsState&&C&&n((0,ue.Yn)({exploreId:h,panelsState:C}))})}else n((0,ue.CK)({exploreId:h,datasource:b||"",queries:(0,jt.Z)(v),range:(0,Le.dc)(x),panelsState:C,position:E,eventBridge:new At.F}))}),Object.keys(s).filter(h=>!Object.keys(g.panes).includes(h)).forEach(h=>n((0,V.YV)(h)))}!c&&i.current==="notstarted"&&(i.current="pending",n((0,V.VY)()),Promise.all(Object.entries(g.panes).map(([f,{datasource:h,queries:y,range:E,panelsState:b}])=>da(h,y,a).then(v=>Promise.resolve(v?y.length?(0,jt.Z)(y).filter(ca(v)).map(Lt(v)?j.identity:x=>({...x,datasource:v.getRef()})):(0,Fe.ak)().get(Lt(v)?void 0:v.getRef()).then(x=>[$n(x)]):[]).then(async x=>{let C=await ua(x);return!C.length&&v&&(C=[$n(Lt(v)?await(0,Fe.ak)().get():v)]),{exploreId:f,range:E,panelsState:b,queries:C,datasource:v}})))).then(async f=>{const h=await Promise.all(f.map(({exploreId:x,range:C,panelsState:T,queries:w,datasource:I})=>n((0,ue.CK)({exploreId:x,datasource:I,queries:w,range:(0,Le.dc)(C),panelsState:T,eventBridge:new At.F})).unwrap()));if(h.length>1){const x=h.some(({state:C},T,[{state:w}])=>!(0,j.isEqual)(C.range.raw,w.range.raw));n((0,V.tl)({syncedTimes:!x}))}const y=h.reduce((x,{exploreId:C,state:T})=>({...x,[C]:Ft(T)}),{}),E=o.getSearchObject();let b={};for(const[x,C]of Object.entries(E).filter(([T])=>!["schemaVersion","panes","orgId","left","right"].includes(T)))b[x]=C;const v=new URLSearchParams({schemaVersion:`${g.schemaVersion}`,panes:JSON.stringify(y),orgId:`${a}`,...b});o.replace({pathname:o.getLocation().pathname,search:v.toString()}),i.current="done"})),r.current=e,c&&i.current==="done"&&d()},[n,s,a,o,e,l])}function $n(e){return{...e.getDefaultQuery?.(Be.zj.Explore),refId:"A",datasource:e.getRef()}}function Lt(e){return e.name===it.D}function ca(e){return e&&Lt(e)?o=>!!o.datasource:o=>o.datasource?typeof o.datasource=="string"?o.datasource===e?.uid:o.datasource.uid===e?.uid:!0}async function ua(e){return(await Promise.allSettled(e.map(n=>(0,Fe.ak)().get(n.datasource).then(s=>({query:n,ds:s}))))).filter(Pn).map(({value:n})=>n.query)}async function da(e,o,n){if(e)try{return await(0,Fe.ak)().get(e)}catch{}const s=o.filter(r=>r.datasource);for(const r of s)try{return await(0,Fe.ak)().get(r.datasource)}catch{}const a=(0,we.y_)(n);return(0,Fe.ak)().get(a).catch(()=>(0,Fe.ak)().get()).catch(()=>{})}const pa=(e,o)=>{const n=!(0,j.isEqual)(o?.datasource,e?.datasource),s=!(0,j.isEqual)(o?.queries,e?.queries),a=!(0,j.isEqual)(o?.range||Le.UI,e?.range||Le.UI),r=!(0,j.isEqual)(o?.panelsState,e?.panelsState);return{datasource:n,queries:s,range:a,panelsState:r}};function Ft(e){return{datasource:e.datasourceInstance?.uid||"",queries:e.queries.map(we.uC),range:(0,Ut.R_)(e.range.raw),panelsState:Bn(e.panelsState)}}function Bn(e){let o=(0,j.mapValues)(e,n=>(0,j.isObject)(n)?Bn(n):n);if(o=(0,j.omitBy)(o,j.isEmpty),!(0,j.isEmpty)(o))return o}function ha({feedbackUrl:e}){const o=(0,N.wW)(ga);return t.createElement(ht.K,null,t.createElement("a",{href:e,className:o.link,title:"The logs table is new, please let us know how we can improve it",target:"_blank",rel:"noreferrer noopener"},t.createElement(ge.J,{name:"comment-alt-message"})," Give feedback"))}function ga(e){return{link:(0,p.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,":hover":{color:e.colors.text.link}})}}var ma=u(78344),fa=u.n(ma),Gt=u(54635),ya=u(70397),va=u(89877),Ea=u(27280);const kn=e=>({metaContainer:(0,p.css)`
    flex: 1;
    color: ${e.colors.text.secondary};
    margin-bottom: ${e.spacing(2)};
    min-width: 30%;
    display: flex;
    flex-wrap: wrap;
  `,metaItem:(0,p.css)`
    margin-right: ${e.spacing(2)};
    margin-top: ${e.spacing(.5)};
    display: flex;
    align-items: center;

    .logs-meta-item__error {
      color: ${e.colors.error.text};
    }
  `,metaLabel:(0,p.css)`
    margin-right: calc(${e.spacing(2)} / 2);
    font-size: ${e.typography.bodySmall.fontSize};
    font-weight: ${e.typography.fontWeightMedium};
  `,metaValue:(0,p.css)`
    font-family: ${e.typography.fontFamilyMonospace};
    font-size: ${e.typography.bodySmall.fontSize};
  `}),ba=(0,t.memo)(function(o){const n=(0,N.wW)(kn),{label:s,value:a}=o;return t.createElement("div",{"data-testid":"meta-info-text-item",className:n.metaItem},s&&t.createElement("span",{className:n.metaLabel},s,":"),t.createElement("span",{className:n.metaValue},a))}),Zt=(0,t.memo)(function(o){const n=(0,N.wW)(kn),{metaItems:s}=o;return t.createElement("div",{className:n.metaContainer,"data-testid":"meta-info-text"},s.map((a,r)=>t.createElement(ba,{key:`${r}-${a.label}`,label:a.label,value:a.value})))}),xa=()=>({metaContainer:(0,p.css)`
    flex: 1;
    display: flex;
    flex-wrap: wrap;
  `});var Sa=(e=>(e.Text="text",e.Json="json",e))(Sa||{});const Vn=t.memo(({meta:e,dedupStrategy:o,dedupCount:n,displayedFields:s,clearDetectedFields:a,hasUnescapedContent:r,forceEscape:i,onEscapeNewlines:l,logRows:c})=>{const g=(0,N.wW)(xa),m=h=>{switch((0,P.ff)("grafana_logs_download_logs_clicked",{app:Be.zj.Explore,format:h,area:"logs-meta-row"}),h){case"text":(0,ya.Fc)({meta:e,rows:c},"Explore");break;case"json":const y=(0,xe.Di)(c),E=new Blob([JSON.stringify(y)],{type:"application/json;charset=utf-8"}),b=`Explore-logs-${(0,Qt.dq)(new Date)}.json`;fa()(E,b);break}},d=[...e];o!==Y.Y4.none&&d.push({label:"Deduplication count",value:n,kind:G.Ku.Number}),c.some(h=>h.entry.length>Ea.n)&&d.push({label:"Info",value:"Logs with more than 100,000 characters could not be parsed and highlighted",kind:G.Ku.String}),s?.length>0&&d.push({label:"Showing only selected fields",value:Wn(s,G.Ku.LabelsMap)},{label:"",value:t.createElement(U.zx,{variant:"secondary",size:"sm",onClick:a},"Show original line")}),r&&d.push({label:"Your logs might have incorrectly escaped content",value:t.createElement(fe.u,{content:"Fix incorrectly escaped newline and tab sequences in log lines. Manually review the results to confirm that the replacements are correct.",placement:"right"},t.createElement(U.zx,{variant:"secondary",size:"sm",onClick:l},i?"Remove escaping":"Escape newlines"))});const f=t.createElement(Gt.v,null,t.createElement(Gt.v.Item,{label:"txt",onClick:()=>m("text")}),t.createElement(Gt.v.Item,{label:"json",onClick:()=>m("json")}));return t.createElement(t.Fragment,null,d&&t.createElement("div",{className:g.metaContainer},t.createElement(Zt,{metaItems:d.map(h=>({label:h.label,value:"kind"in h?Wn(h.value,h.kind):h.value}))}),t.createElement(Fn.L,{overlay:f},t.createElement(de.h,{isOpen:!1,variant:"canvas",icon:"download-alt"},"Download"))))});Vn.displayName="LogsMetaRow";function Wn(e,o){return o===G.Ku.LabelsMap?t.createElement(va.j,{labels:e}):o===G.Ku.Error?t.createElement("span",{className:"logs-meta-item__error"},e):e}var Ca=u(27737),wa=u(70991);function Ra({pages:e,currentPageIndex:o,oldestLogsFirst:n,timeZone:s,loading:a,onClick:r}){const i=m=>`${(0,Qt.dq)(m,{format:wa.U6.interval.second,timeZone:s})}`,l=(m,d)=>{if(o===d&&a)return t.createElement(wt.$,null);const f=i(n?m.logsRange.from:m.logsRange.to),h=i(n?m.logsRange.to:m.logsRange.from);return`${f} \u2014 ${h}`},c=(0,N.l4)(),g=Ta(c,a);return t.createElement(ct.$,{autoHide:!0},t.createElement("div",{className:g.pagesWrapper,"data-testid":"logsNavigationPages"},t.createElement("div",{className:g.pagesContainer},e.map((m,d)=>t.createElement("button",{type:"button","data-testid":`page${d+1}`,className:(0,p.cx)((0,U.gN)(c),g.page),key:m.queryRange.to,onClick:()=>{r(m,d+1)}},t.createElement("div",{className:(0,p.cx)(g.line,{selectedBg:o===d})}),t.createElement("div",{className:(0,p.cx)(g.time,{selectedText:o===d})},l(m,d)))))))}const Ta=(e,o)=>({pagesWrapper:(0,p.css)`
      height: 100%;
      padding-left: ${e.spacing(.5)};
      display: flex;
      flex-direction: column;
      overflow-y: scroll;
      &::after {
        content: '';
        display: block;
        background: repeating-linear-gradient(
          135deg,
          ${e.colors.background.primary},
          ${e.colors.background.primary} 5px,
          ${e.colors.background.secondary} 5px,
          ${e.colors.background.secondary} 15px
        );
        width: 3px;
        height: inherit;
        margin-bottom: 8px;
      }
    `,pagesContainer:(0,p.css)`
      display: flex;
      padding: 0;
      flex-direction: column;
    `,page:(0,p.css)`
      display: flex;
      margin: ${e.spacing(2)} 0;
      cursor: ${o?"auto":"pointer"};
      white-space: normal;
      .selectedBg {
        background: ${e.colors.primary.main};
      }
      .selectedText {
        color: ${e.colors.primary.main};
      }
    `,line:(0,p.css)`
      width: 3px;
      height: 100%;
      align-items: center;
      background: ${e.colors.text.secondary};
    `,time:(0,p.css)`
      width: 60px;
      min-height: 80px;
      font-size: ${e.v1.typography.size.sm};
      padding-left: ${e.spacing(.5)};
      display: flex;
      align-items: center;
    `});function La({absoluteRange:e,logsSortOrder:o,timeZone:n,loading:s,onChangeTime:a,scrollToTopLogs:r,visibleRange:i,queries:l,clearCache:c,addResultsToCache:g}){const[m,d]=(0,t.useState)([]),[f,h]=(0,t.useState)(0),y=(0,t.useRef)(),E=(0,t.useRef)(),b=(0,t.useRef)(0),v=o===Y.UV.Ascending,x=v?f===m.length-1:f===0,C=v?f===0:f===m.length-1,T=(0,N.l4)(),w=Ia(T,v);(0,t.useEffect)(()=>{const F={logsRange:i,queryRange:e};let D=[];if(!(0,j.isEqual)(E.current,e)||!(0,j.isEqual)(y.current,l))c(),d([F]),h(0),y.current=l,b.current=e.to-e.from;else{d(R=>(D=R.filter(B=>!(0,j.isEqual)(F.queryRange,B.queryRange)),D=[...D,F].sort((B,ee)=>H(B,ee,o)),D));const L=D.findIndex(R=>R.queryRange.to===e.to);h(L)}g()},[i,e,o,l,c,g]),(0,t.useEffect)(()=>{c()},[]);const I=(0,t.useCallback)(({from:F,to:D})=>{E.current={from:F,to:D},a({from:F,to:D})},[a]),H=(F,D,L)=>L===Y.UV.Ascending?F.queryRange.to>D.queryRange.to?1:-1:F.queryRange.to>D.queryRange.to?-1:1,M=t.createElement(U.zx,{"data-testid":"olderLogsButton",className:w.navButton,variant:"secondary",onClick:()=>{if((0,P.ff)("grafana_explore_logs_pagination_clicked",{pageType:"olderLogsButton"}),C)I({from:i.from-b.current,to:i.from});else{const F=v?-1:1;I({from:m[f+F].queryRange.from,to:m[f+F].queryRange.to})}r()},disabled:s},t.createElement("div",{className:w.navButtonContent},s?t.createElement(wt.$,null):t.createElement(ge.J,{name:v?"angle-up":"angle-down",size:"lg"}),"Older logs")),A=t.createElement(U.zx,{"data-testid":"newerLogsButton",className:w.navButton,variant:"secondary",onClick:()=>{if((0,P.ff)("grafana_explore_logs_pagination_clicked",{pageType:"newerLogsButton"}),!x){const F=v?1:-1;I({from:m[f+F].queryRange.from,to:m[f+F].queryRange.to})}r()},disabled:s||x},t.createElement("div",{className:w.navButtonContent},s&&t.createElement(wt.$,null),x||s?null:t.createElement(ge.J,{name:v?"angle-down":"angle-up",size:"lg"}),x?"Start of range":"Newer logs")),$=(0,t.useCallback)((F,D)=>{(0,P.ff)("grafana_explore_logs_pagination_clicked",{pageType:"page",pageNumber:D}),!s&&I({from:F.queryRange.from,to:F.queryRange.to}),r()},[I,s,r]);return t.createElement("div",{className:w.navContainer},v?M:A,t.createElement(Ra,{pages:m,currentPageIndex:f,oldestLogsFirst:v,timeZone:n,loading:s,onClick:$}),v?A:M,t.createElement(U.zx,{"data-testid":"scrollToTop",className:w.scrollToTopButton,variant:"secondary",onClick:r,title:"Scroll to top"},t.createElement(ge.J,{name:"arrow-up",size:"lg"})))}const Fa=(0,t.memo)(La),Ia=(e,o)=>{const n=`calc(100vh - 2*${e.spacing(2)} - 2*${Ca.$}px)`;return{navContainer:(0,p.css)`
      max-height: ${n};
      display: flex;
      flex-direction: column;
      justify-content: ${o?"flex-start":"space-between"};
      position: sticky;
      top: ${e.spacing(2)};
      right: 0;
    `,navButton:(0,p.css)`
      width: 58px;
      height: 68px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      line-height: 1;
    `,navButtonContent:(0,p.css)`
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
      white-space: normal;
    `,scrollToTopButton:(0,p.css)`
      width: 40px;
      height: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin-top: ${e.spacing(1)};
    `}};var It=u(92840);function Oa(e){return{searchWrap:(0,p.css)({padding:e.spacing(.4)})}}function Da(e){const o=(0,N.l4)(),n=Oa(o);return t.createElement(Re.g,{className:n.searchWrap},t.createElement(Je.I,{value:e.value,type:"text",placeholder:"Search fields by name",onChange:e.onChange}))}var Na=u(81838),za=u(45878),Ot=u(17338),Aa=u(6011),Qn=u(512),Un=u(58309),qt=u(63510);function Pa(e){const{timeZone:o,splitOpen:n,range:s,logsSortOrder:a,width:r,dataFrame:i,columnsWithMeta:l}=e,[c,g]=(0,t.useState)(void 0),m=(0,t.useCallback)(f=>{if(!f.length)return f;const h=(0,It.L)(f),y=h?.timeField.index,E=(0,za.aK)(f,y,a===Y.UV.Descending),[b]=(0,Ot.SM)({data:[E],timeZone:o,theme:q.config.theme2,replaceVariables:v=>v,fieldConfig:{defaults:{custom:{}},overrides:[]}});for(const v of b.fields)v.getLinks=x=>(0,Xe.a_)({field:v,rowIndex:x.valueRowIndex,splitOpenFn:n,range:s,dataFrame:E}),v.config={...v.config,custom:{inspect:!0,filterable:!0,...v.config.custom},filterable:Ma(v,h??void 0)};return b},[a,o,n,s]);if((0,t.useEffect)(()=>{(async()=>{const h=i?(0,It.L)(i):void 0;if(!h){g(void 0);return}const y=Ha(i);let E=$a(l);const b=Ba(E);if(b?y.push(b):y.push({id:"organize",options:{includeByName:{[h.bodyField.name]:!0,[h.timeField.name]:!0}}}),y.length>0){const v=await(0,Na.n)((0,Aa.H)(y,[i])),x=m(v[0]);g(x)}else g(m(i))})()},[l,i,a,m]),!c)return null;const d=f=>{const{value:h,key:y,operator:E}=f,{onClickFilterLabel:b,onClickFilterOutLabel:v}=e;!b||!v||(E===ut.PT&&b(y,h,i),E===ut.tE&&v(y,h,i))};return t.createElement(qt.i,{data:c,width:r,onCellFilterAdded:e.onClickFilterLabel&&e.onClickFilterOutLabel?d:void 0,height:e.height,footerOptions:{show:!0,reducer:["count"],countRows:!0}})}const Ma=(e,o)=>!(!o||o.bodyField.name===e.name||o.timeField.name===e.name);function Ha(e){return e.fields.filter(o=>{const n=o.typeInfo?.frame==="json.RawMessage"&&o.name==="labels"&&e?.meta?.type!==Qn.P.LogLines,s=o.name==="labels"&&o.type===Un.fS.other&&e?.meta?.type===Qn.P.LogLines;return n||s}).flatMap(o=>[{id:"extractFields",options:{format:"json",keepTime:!1,replace:!1,source:o.name}}])}function $a(e){let o={};return Object.keys(e).filter(n=>e[n].active).forEach(n=>{o[n]=!0}),o}function Ba(e){return Object.keys(e).length>0?{id:"organize",options:{includeByName:e}}:null}var ka=u(55973);function Va(e){return{labelCount:(0,p.css)({marginLeft:e.spacing(.5),marginRight:e.spacing(.5),appearance:"none",background:"none",border:"none",fontSize:e.typography.pxToRem(11)}),wrap:(0,p.css)({display:"flex",alignItems:"center",marginTop:e.spacing(1),marginBottom:e.spacing(1),justifyContent:"space-between"}),checkboxLabel:(0,p.css)({"> :first-child":{position:"sticky",left:0,bottom:0,top:0},"> span":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block",maxWidth:"100%"}}),columnWrapper:(0,p.css)({marginBottom:e.spacing(1.5),paddingLeft:e.spacing(.5)}),empty:(0,p.css)({marginBottom:e.spacing(2),marginLeft:e.spacing(1.75),fontSize:e.typography.fontSize})}}const Wa=new Intl.Collator(void 0,{sensitivity:"base"});function Qa(e){return(o,n)=>{const s=e[o],a=e[n];return s!=null&&a!=null?+(a.type==="TIME_FIELD")-+(s.type==="TIME_FIELD")||+(a.type==="BODY_FIELD")-+(s.type==="BODY_FIELD")||Wa.compare(o,n):0}}const jn=e=>{const{labels:o,valueFilter:n,toggleColumn:s}=e,a=(0,N.l4)(),r=Va(a),i=Object.keys(o).filter(l=>n(l));return i.length?t.createElement("div",{className:r.columnWrapper},i.sort(Qa(o)).map(l=>t.createElement("div",{title:`${l} appears in ${o[l]?.percentOfLinesWithLabel}% of log lines`,className:r.wrap,key:l},t.createElement(ka.X,{className:r.checkboxLabel,label:l,onChange:()=>s(l),checked:o[l]?.active??!1}),t.createElement("button",{className:r.labelCount,onClick:()=>s(l)},o[l]?.percentOfLinesWithLabel,"%")))):t.createElement("div",{className:r.empty},"No fields")};function Ua(e){return{sidebarWrap:(0,p.css)({overflowY:"scroll",height:"calc(100% - 50px)"}),columnHeaderButton:(0,p.css)({appearance:"none",background:"none",border:"none",fontSize:e.typography.pxToRem(11)}),columnHeader:(0,p.css)({display:"flex",justifyContent:"space-between",fontSize:e.typography.h6.fontSize,background:e.colors.background.secondary,position:"sticky",top:0,left:0,paddingTop:e.spacing(.75),paddingRight:e.spacing(.75),paddingBottom:e.spacing(.75),paddingLeft:e.spacing(1.5),zIndex:3,marginBottom:e.spacing(2)})}}const ja=e=>{const o=(0,N.l4)(),n=Ua(o);return t.createElement("div",{className:n.sidebarWrap},t.createElement(t.Fragment,null,t.createElement("div",{className:n.columnHeader},"Selected fields",t.createElement("button",{onClick:e.clear,className:n.columnHeaderButton},"Reset")),t.createElement(jn,{toggleColumn:e.toggleColumn,labels:e.filteredColumnsWithMeta??e.columnsWithMeta,valueFilter:s=>e.columnsWithMeta[s]?.active??!1}),t.createElement("div",{className:n.columnHeader},"Fields"),t.createElement(jn,{toggleColumn:e.toggleColumn,labels:e.filteredColumnsWithMeta??e.columnsWithMeta,valueFilter:s=>!e.columnsWithMeta[s]?.active})))};var Gn=u(51670);const Ga=new Gn.Z({intraMode:1,intraIns:1,intraSub:1,intraTrn:1,intraDel:1});function Zn(e,o,n){const[s,a,r]=Ga.search(e,o,!1,1e5);let i=[],l=new Set;if(s&&r){const c=(g,m)=>{m&&l.add(g)};for(let g=0;g<r.length;g++){let m=r[g];Gn.Z.highlight(e[a.idx[m]],a.ranges[m],c),i.push(e[a.idx[m]])}n([i,[...l]])}else o||n([[],[]])}const Ui=(0,j.debounce)(Zn,300);function Za(e){const{logsFrames:o,updatePanelState:n,panelState:s}=e,a=s?.columns,[r,i]=(0,t.useState)(void 0),[l,c]=(0,t.useState)(void 0),[g,m]=(0,t.useState)(""),d=Yn(),f=e?.panelState?.refId,[h,y]=(0,t.useState)(o.find(L=>L.refId===f)??o[0]),E=(0,t.useCallback)(L=>{const R=e.panelState?.columns;return R&&Object.values(R).forEach(B=>{L[B]&&(L[B].active=!0)}),L},[e.panelState?.columns]),b=(0,It.L)(h);if((0,t.useEffect)(()=>{if(b?.timeField.name&&b?.bodyField.name&&!a){const L={0:b?.timeField.name??"",1:b?.bodyField.name??""};n({columns:Object.values(L),visualisationType:"table",labelFieldName:b?.getLabelFieldName()??void 0})}},[b,a,n]),(0,t.useEffect)(()=>{const L=o.find(R=>R.refId===f)??o[0];L&&y(L)},[o,f]),(0,t.useEffect)(()=>{if(!r||!l)return;let L={...l},R=!1;Object.keys(r).forEach(B=>{L[B]&&L[B].active!==r[B].active&&(L[B]=r[B],R=!0)}),R&&c(L)},[r,l]),(0,t.useEffect)(()=>{if(!h.length)return;const L=h?h.length:0,R=(0,It.L)(h),B=R?.getLogFrameLabelsAsLabels(),ee=[];R&&ee.push(...R.extraFields.filter(z=>!z?.config?.custom?.hidden)),R?.severityField&&ee.push(R?.severityField),R?.bodyField&&ee.push(R?.bodyField),R?.timeField&&ee.push(R?.timeField);const J=new Map;let K={};B?.length&&L&&(B.forEach(z=>{Object.keys(z).forEach(Pe=>{if(J.has(Pe)){const Q=J.get(Pe);Q&&J.set(Pe,{percentOfLinesWithLabel:Q.percentOfLinesWithLabel+1,active:Q?.active})}else J.set(Pe,{percentOfLinesWithLabel:1,active:void 0})})}),K=Object.fromEntries(J),Object.keys(K).forEach(z=>{K[z].percentOfLinesWithLabel=qn(K[z].percentOfLinesWithLabel,L)})),ee.forEach(z=>{K[z.name]={percentOfLinesWithLabel:qn(z.values.filter(le=>le!=null).length,L),active:K[z.name]?.active}}),K=E(K),Object.keys(K).filter(z=>K[z].active).length===0&&(R?.bodyField?.name&&(K[R.bodyField.name].active=!0),R?.timeField?.name&&(K[R.timeField.name].active=!0)),R?.bodyField?.name&&R?.timeField?.name&&(K[R.bodyField.name].type="BODY_FIELD",K[R.timeField.name].type="TIME_FIELD"),i(K)},[h,E]),!r)return null;function v(L){if(r){const R=!r[L]?.active,B=Object.keys(r).filter(J=>r[J]?.active)?.length,ee={columnAction:R?"add":"remove",columnCount:R?B+1:B-1,datasourceType:e.datasourceType};(0,P.ff)("grafana_explore_logs_table_column_filter_clicked",ee)}}function x(L){(0,P.ff)("grafana_explore_logs_table_text_search_result_count",{resultCount:L,datasourceType:e.datasourceType??"unknown"})}const C=()=>{const L={...r};Object.keys(L).forEach(R=>{L[R].active=!!L[R].type}),i(L)},T=L=>{if(!r||!(L in r)){console.warn("failed to get column",r);return}const R={...r,[L]:{...r[L],active:!r[L]?.active}};if(v(L),i(R),l){const K={...l,[L]:{...l[L],active:!l[L]?.active}};c(K)}const B=Object.assign({},Object.keys(R).filter(K=>R[K]?.active)),ee={0:b?.timeField.name??"",1:b?.bodyField.name??""},J={...e.panelState,columns:Object.keys(B).length?B:ee,refId:h.refId,visualisationType:"table",labelFieldName:b?.getLabelFieldName()??void 0};n(J)},w=L=>{const R=L[0];let B={},ee=0;R.forEach(J=>{J in r&&(B[J]=r[J],ee++)}),c(B),x(ee)},I=L=>{Zn(Object.keys(r),L,w)},H=L=>{const R=L.currentTarget?.value;m(R),R?I(R):c(void 0)},M=L=>{o.find(B=>B.refId===L.value)&&y(o.find(B=>B.refId===L.value)??o[0]),e.updatePanelState({refId:L.value,labelFieldName:b?.getLabelFieldName()??void 0})},A=220,F=e.width-A,D=qa(e.theme,d,A);return t.createElement(t.Fragment,null,t.createElement("div",null,o.length>1&&t.createElement("div",null,t.createElement(Se._,{label:"Select query",htmlFor:"explore_logs_table_frame_selector",labelWidth:22,tooltip:"Select a query to visualize in the table."},t.createElement(Ne.Ph,{inputId:"explore_logs_table_frame_selector","aria-label":"Select query by name",value:h.refId,options:o.map(L=>({label:L.refId,value:L.refId})),onChange:M})))),t.createElement("div",{className:D.wrapper},t.createElement("section",{className:D.sidebar},t.createElement(Da,{value:g,onChange:H}),t.createElement(ja,{toggleColumn:T,filteredColumnsWithMeta:l,columnsWithMeta:r,clear:C})),t.createElement(Pa,{onClickFilterLabel:e.onClickFilterLabel,onClickFilterOutLabel:e.onClickFilterOutLabel,logsSortOrder:e.logsSortOrder,range:e.range,splitOpen:e.splitOpen,timeZone:e.timeZone,width:F,dataFrame:h,columnsWithMeta:r,height:d})))}const qn=(e,o)=>Math.ceil(100*e/o);function qa(e,o,n){return{wrapper:(0,p.css)({display:"flex"}),sidebar:(0,p.css)({height:o,fontSize:e.typography.pxToRem(11),overflowY:"hidden",width:n,paddingRight:e.spacing(1.5)})}}const Yn=()=>Math.max(window.innerHeight-500,500);function Yt(e){const[o,n]=(0,t.useState)(!1),s=100,{error:a,title:r,suggestedAction:i,onSuggestedAction:l,onRemove:c,severity:g="warning"}=e,m=a?.message||a?.data?.message||"",d=!o&&m.length>s,f=(0,N.l4)(),h=Ya(f);return t.createElement("div",{className:h.supplementaryErrorContainer},t.createElement(Ke.b,{title:r,severity:g,onRemove:c},t.createElement("div",{className:h.suggestedActionWrapper},d?t.createElement(U.zx,{variant:"secondary",size:"xs",onClick:()=>{n(!0)}},"Show details"):m,i&&l&&t.createElement("div",{className:h.suggestedActionWrapper},t.createElement(U.zx,{variant:"primary",size:"xs",onClick:l},i)))))}const Ya=e=>({supplementaryErrorContainer:(0,p.css)`
      width: 50%;
      min-width: ${e.breakpoints.values.sm}px;
      margin: 0 auto;
    `,suggestedActionWrapper:(0,p.css)`
      height: ${e.spacing(6)};
      button {
        position: absolute;
        right: ${e.spacing(2)};
        top: ${e.spacing(7)};
      }
    `});var Ka=u(11196);function Ja(e){const{width:o,timeZone:n,splitOpen:s,onUpdateTimeRange:a,onHiddenSeriesChanged:r,allLogsVolumeMaximum:i}=e,l=(0,N.l4)(),c=(0,N.wW)(Xa),g=parseInt(l.spacing(2).slice(0,-2),10),m=150,d=e.logsVolumeData,f=(0,xe.Js)(d?.data);let h=f?`${f.name}`:"";(0,xe.FP)(d.data)&&(h=[h,"This datasource does not support full-range histograms. The graph below is based on the logs seen in the response."].filter(j.identity).join(". "));let y=t.createElement("span",null,h);return d.state===Z.Gu.Streaming&&(y=t.createElement(t.Fragment,null,y,t.createElement(fe.u,{content:"Streaming"},t.createElement(ge.J,{name:"circle-mono",size:"md",className:c.streaming,"data-testid":"logs-volume-streaming"})))),t.createElement("div",{style:{height:m},className:c.contentContainer},t.createElement(Ka.y,{graphStyle:"lines",loadingState:d.state??Z.Gu.Done,data:d.data,height:m,width:o-g*2,absoluteRange:e.absoluteRange,onChangeTime:a,timeZone:n,splitOpenFn:s,tooltipDisplayMode:Y.f3.Multi,onHiddenSeriesChanged:r,anchorToZero:!0,yAxisMaximum:i,eventBus:e.eventBus}),y&&t.createElement("div",{className:c.extraInfoContainer},y))}const Xa=e=>({extraInfoContainer:(0,p.css)`
      display: flex;
      justify-content: end;
      position: absolute;
      right: 5px;
      top: -10px;
      font-size: ${e.typography.bodySmall.fontSize};
      color: ${e.colors.text.secondary};
    `,contentContainer:(0,p.css)`
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    `,streaming:(0,p.css)`
      color: ${e.colors.success.text};
    `});function _a(e){return!e||!e.error&&!e.errors?!1:(e.error?[e.error]:e.errors||[]).some(n=>(`${n.message||n.data?.message}`?.toLowerCase()).includes("timeout"))}const er=({logsVolumeData:e,absoluteRange:o,onUpdateTimeRange:n,width:s,onLoadLogsVolume:a,onHiddenSeriesChanged:r,eventBus:i,splitOpen:l,timeZone:c,onClose:g})=>{const{logVolumes:m,maximumValue:d,maximumRange:f}=(0,t.useMemo)(()=>{let x=-1/0;const C=(0,j.sortBy)(e?.data||[],"meta.custom.datasourceName"),T=(0,j.groupBy)(C,"meta.custom.datasourceName"),w=(0,j.mapValues)(T,H=>{const M=(0,xe._c)(H);return x=Math.max(x,M.maximum),M.dataFrames}),I=(0,xe.hY)((0,j.flatten)(Object.values(w)));return{maximumValue:x,maximumRange:I,logVolumes:w}},[e]),h=(0,N.wW)(tr),y=Object.keys(m).length,E=Object.values(m).some(x=>{const C=nr(x,o);return!(0,xe.FP)(x)&&C&&C<1}),b=_a(e),v={from:Math.max(o.from,f.from),to:Math.min(o.to,f.to)};return e?.state===Z.Gu.Loading?t.createElement("span",null,"Loading..."):b?t.createElement(Yt,{title:"The logs volume query has timed out",severity:"info",suggestedAction:"Retry",onSuggestedAction:a,onRemove:g}):e?.error!==void 0?t.createElement(Yt,{error:e.error,title:"Failed to load log volume for this query"}):y===0?t.createElement("div",{className:h.alertContainer},t.createElement(Ke.b,{severity:"info",title:"No logs volume available"},"No volume information available for the current queries and time range.")):t.createElement("div",{className:h.listContainer},Object.keys(m).map((x,C)=>{const T={data:m[x]};return t.createElement(Ja,{key:C,absoluteRange:v,allLogsVolumeMaximum:d,width:s,logsVolumeData:T,onUpdateTimeRange:n,timeZone:c,splitOpen:l,onLoadLogsVolume:a,onHiddenSeriesChanged:y>1?()=>{}:r,eventBus:i})}),E&&t.createElement("div",{className:h.extraInfoContainer},t.createElement(Se._,{label:"Reload log volume",transparent:!0},t.createElement(U.zx,{size:"xs",icon:"sync",variant:"secondary",onClick:a,id:"reload-volume"}))))},tr=e=>({listContainer:(0,p.css)`
      padding-top: 10px;
    `,extraInfoContainer:(0,p.css)`
      display: flex;
      justify-content: end;
      position: absolute;
      right: 5px;
      top: 5px;
    `,oldInfoText:(0,p.css)`
      font-size: ${e.typography.bodySmall.fontSize};
      color: ${e.colors.text.secondary};
    `,alertContainer:(0,p.css)`
      width: 50%;
      min-width: ${e.breakpoints.values.sm}px;
      margin: 0 auto;
    `});function nr(e,o){const n=e&&e[0]&&e[0].meta?.custom?.absoluteRange;return n?(o.from-o.to)/(n.from-n.to):void 0}const Kt=q.config.featureToggles.exploreScrollableLogsContainer,or=[Y.Y4.none,Y.Y4.exact,Y.Y4.numbers,Y.Y4.signature];class sr extends t.PureComponent{constructor(o){super(o),this.topLogsRef=(0,t.createRef)(),this.state={showLabels:X.Z.getBool(_.showLabels,!1),showTime:X.Z.getBool(_.showTime,!0),wrapLogMessage:X.Z.getBool(_.wrapLogMessage,!0),prettifyLogMessage:X.Z.getBool(_.prettifyLogMessage,!1),dedupStrategy:Y.Y4.none,hiddenLogLevels:[],logsSortOrder:X.Z.get(_.logsSortOrder)||Y.UV.Descending,isFlipping:!1,displayedFields:[],forceEscape:!1,contextOpen:!1,contextRow:void 0,tableFrame:void 0,visualisationType:this.props.panelState?.logs?.visualisationType??"logs",logsContainer:void 0},this.updatePanelState=n=>{const s=(0,Ae.y0)().explore.panes[this.props.exploreId];s?.panelsState&&(0,Ae.WI)((0,ue.km)(this.props.exploreId,"logs",{...s.panelsState.logs,columns:n.columns??this.props.panelState?.logs?.columns,visualisationType:n.visualisationType??this.state.visualisationType,labelFieldName:n.labelFieldName,refId:n.refId??this.props.panelState?.logs?.refId}))},this.onLogRowHover=n=>{n?this.props.eventBus.publish(new Nn.es({point:{time:n.timeEpochMs}})):this.props.eventBus.publish(new Nn.xH)},this.onLogsContainerRef=n=>{this.setState({logsContainer:n})},this.onChangeLogsSortOrder=()=>{this.setState({isFlipping:!0}),this.flipOrderTimer=window.setTimeout(()=>{this.setState(n=>{const s=n.logsSortOrder===Y.UV.Descending?Y.UV.Ascending:Y.UV.Descending;return X.Z.set(_.logsSortOrder,s),{logsSortOrder:s}})},0),this.cancelFlippingTimer=window.setTimeout(()=>this.setState({isFlipping:!1}),1e3)},this.onEscapeNewlines=()=>{this.setState(n=>({forceEscape:!n.forceEscape}))},this.onChangeVisualisation=n=>{this.setState(()=>({visualisationType:n}));const s={...this.props.panelState?.logs,visualisationType:n};this.updatePanelState(s),(0,P.ff)("grafana_explore_logs_visualisation_changed",{newVisualizationType:n,datasourceType:this.props.datasourceType??"unknown"})},this.onChangeDedup=n=>{(0,P.ff)("grafana_explore_logs_deduplication_clicked",{deduplicationType:n,datasourceType:this.props.datasourceType}),this.setState({dedupStrategy:n})},this.onChangeLabels=n=>{const{target:s}=n;if(s){const a=s.checked;this.setState({showLabels:a}),X.Z.set(_.showLabels,a)}},this.onChangeTime=n=>{const{target:s}=n;if(s){const a=s.checked;this.setState({showTime:a}),X.Z.set(_.showTime,a)}},this.onChangeWrapLogMessage=n=>{const{target:s}=n;if(s){const a=s.checked;this.setState({wrapLogMessage:a}),X.Z.set(_.wrapLogMessage,a)}},this.onChangePrettifyLogMessage=n=>{const{target:s}=n;if(s){const a=s.checked;this.setState({prettifyLogMessage:a}),X.Z.set(_.prettifyLogMessage,a)}},this.onToggleLogLevel=n=>{const s=n.map(a=>G.in[a]);this.setState({hiddenLogLevels:s})},this.onToggleLogsVolumeCollapse=n=>{this.props.onSetLogsVolumeEnabled(!n),(0,P.ff)("grafana_explore_logs_histogram_toggle_clicked",{datasourceType:this.props.datasourceType,type:n?"close":"open"})},this.onClickScan=n=>{n.preventDefault(),this.props.onStartScanning&&(this.props.onStartScanning(),(0,P.ff)("grafana_explore_logs_scanning_button_clicked",{type:"start",datasourceType:this.props.datasourceType}))},this.onClickStopScan=n=>{n.preventDefault(),this.props.onStopScanning&&this.props.onStopScanning()},this.showField=n=>{this.state.displayedFields.indexOf(n)===-1&&this.setState(a=>({displayedFields:a.displayedFields.concat(n)}))},this.hideField=n=>{this.state.displayedFields.indexOf(n)>-1&&this.setState(a=>({displayedFields:a.displayedFields.filter(r=>n!==r)}))},this.clearDetectedFields=()=>{this.setState(n=>({displayedFields:[]}))},this.onCloseContext=()=>{this.setState({contextOpen:!1,contextRow:void 0})},this.onOpenContext=(n,s)=>{this.setState({contextOpen:!0,contextRow:n}),(0,P.ff)("grafana_explore_logs_log_context_opened",{datasourceType:n.datasourceType,logRowUid:n.uid}),this.onCloseContext=()=>{this.setState({contextOpen:!1,contextRow:void 0}),(0,P.ff)("grafana_explore_logs_log_context_closed",{datasourceType:n.datasourceType,logRowUid:n.uid}),s()}},this.onPermalinkClick=async n=>{if(n.rowId===void 0)return;const s=Ft((0,Ae.y0)().explore.panes[this.props.exploreId]);s.panelsState={...this.props.panelState,logs:{id:n.uid,visualisationType:this.state.visualisationType??"logs"}},s.range={from:new Date(this.props.absoluteRange.from).toISOString(),to:new Date(this.props.absoluteRange.to).toISOString()};const a=(0,Ut.S)(s),r=/.*(?=\/explore)/.exec(`${window.location.href}`)[0],i=Ut.Cj.renderUrl(`${r}/explore`,{left:a});await(0,kt.L)(i),(0,P.ff)("grafana_explore_logs_permalink_clicked",{datasourceType:n.datasourceType??"unknown",logRowUid:n.uid,logRowLevel:n.logLevel})},this.scrollIntoView=n=>{if(q.config.featureToggles.exploreScrollableLogsContainer){this.state.logsContainer&&(this.topLogsRef.current?.scrollIntoView(),this.state.logsContainer.scroll({behavior:"smooth",top:this.state.logsContainer.scrollTop+n.getBoundingClientRect().top-window.innerHeight/2}));return}const{scrollElement:s}=this.props;s&&s.scroll({behavior:"smooth",top:s.scrollTop+n.getBoundingClientRect().top-window.innerHeight/2})},this.checkUnescapedContent=(0,Ue.Z)(n=>!!n.some(s=>s.hasUnescapedContent)),this.dedupRows=(0,Ue.Z)((n,s)=>{const a=(0,Ct.UW)(n,s),r=a.reduce((i,l)=>l.duplicates?i+l.duplicates:i,0);return{dedupedRows:a,dedupCount:r}}),this.filterRows=(0,Ue.Z)((n,s)=>(0,Ct.nu)(n,new Set(s))),this.createNavigationRange=(0,Ue.Z)(n=>{if(!n||n.length===0)return;const s=n[0].timeEpochMs,a=n[n.length-1].timeEpochMs;return a<s?{from:a,to:s}:{from:s,to:a}}),this.scrollToTopLogs=()=>{q.config.featureToggles.exploreScrollableLogsContainer?this.state.logsContainer&&this.state.logsContainer.scroll({behavior:"auto",top:0}):this.topLogsRef.current?.scrollIntoView()},this.logsVolumeEventBus=o.eventBus.newScopedBus("logsvolume",{onlyLocal:!1})}componentWillUnmount(){this.flipOrderTimer&&window.clearTimeout(this.flipOrderTimer),this.cancelFlippingTimer&&window.clearTimeout(this.cancelFlippingTimer),(this.props?.panelState?.logs?.columns||this.props?.panelState?.logs?.refId||this.props?.panelState?.logs?.labelFieldName)&&(0,Ae.WI)((0,ue.km)(this.props.exploreId,"logs",{...this.props.panelState?.logs,columns:void 0,visualisationType:this.state.visualisationType,labelFieldName:void 0,refId:void 0}))}componentDidUpdate(o){this.props.loading&&!o.loading&&this.props.panelState?.logs?.id&&(delete this.props.panelState.logs.id,(0,Ae.WI)((0,ue.km)(this.props.exploreId,"logs",{...this.props.panelState}))),this.props.panelState?.logs?.visualisationType!==o.panelState?.logs?.visualisationType&&this.setState({visualisationType:this.props.panelState?.logs?.visualisationType??"logs"})}render(){const{width:o,splitOpen:n,logRows:s,logsMeta:a,logsVolumeEnabled:r,logsVolumeData:i,loadLogsVolumeData:l,loading:c=!1,onClickFilterLabel:g,onClickFilterOutLabel:m,timeZone:d,scanning:f,scanRange:h,showContextToggle:y,absoluteRange:E,onChangeTime:b,getFieldLinks:v,theme:x,logsQueries:C,clearCache:T,addResultsToCache:w,exploreId:I,getRowContext:H,getLogRowContextUi:M,getRowContextQuery:A}=this.props,{showLabels:$,showTime:F,wrapLogMessage:D,prettifyLogMessage:L,dedupStrategy:R,hiddenLogLevels:B,logsSortOrder:ee,isFlipping:J,displayedFields:K,forceEscape:Ie,contextOpen:z,contextRow:le}=this.state,Pe=Yn(),Q=rr(x,D,Pe),Me=s&&s.length>0,qe=this.checkUnescapedContent(s),k=this.filterRows(s,B),{dedupedRows:ae,dedupCount:ne}=this.dedupRows(k,R),re=this.createNavigationRange(s),he=h?`Scanning ${Ws.describeTimeRange(h)}`:"Scanning...";return t.createElement(t.Fragment,null,H&&le&&t.createElement(_s,{open:z,row:le,onClose:this.onCloseContext,getRowContext:(ie,Oe)=>H(ie,le,Oe),getRowContextQuery:A,getLogRowContextUi:M,logsSortOrder:ee,timeZone:d}),t.createElement(Te.fm,{title:"Logs volume",collapsible:!0,collapsed:!r,onToggleCollapse:this.onToggleLogsVolumeCollapse},r&&t.createElement(er,{absoluteRange:E,width:o,logsVolumeData:i,onUpdateTimeRange:b,timeZone:d,splitOpen:n,onLoadLogsVolume:l,onHiddenSeriesChanged:this.onToggleLogLevel,eventBus:this.logsVolumeEventBus,onClose:()=>this.onToggleLogsVolumeCollapse(!0)})),t.createElement(Te.fm,{titleItems:[q.config.featureToggles.logsExploreTableVisualisation?this.state.visualisationType==="logs"?null:[t.createElement(Te.fm.TitleItem,{title:"Experimental",key:"A"},t.createElement(Qs.a,{featureState:Be.CQ.beta,tooltip:"Table view is experimental and may change in future versions"})),t.createElement(Te.fm.TitleItem,{title:"Feedback",key:"B"},t.createElement(ha,{feedbackUrl:"https://forms.gle/5YyKdRQJ5hzq4c289"}))]:null],title:"Logs",actions:t.createElement(t.Fragment,null,q.config.featureToggles.logsExploreTableVisualisation&&t.createElement("div",{className:Q.visualisationType},t.createElement(St.S,{className:Q.visualisationTypeRadio,options:[{label:"Logs",value:"logs",description:"Show results in logs visualisation"},{label:"Table",value:"table",description:"Show results in table visualisation"}],size:"sm",value:this.state.visualisationType,onChange:this.onChangeVisualisation}))),loadingState:c?Z.Gu.Loading:Z.Gu.Done},t.createElement("div",{className:Q.stickyNavigation},this.state.visualisationType!=="table"&&t.createElement("div",{className:Q.logOptions},t.createElement(Us.Z,null,t.createElement(Se._,{label:"Time",className:Q.horizontalInlineLabel,transparent:!0},t.createElement(ze.x,{value:F,onChange:this.onChangeTime,className:Q.horizontalInlineSwitch,transparent:!0,id:`show-time_${I}`})),t.createElement(Se._,{label:"Unique labels",className:Q.horizontalInlineLabel,transparent:!0},t.createElement(ze.x,{value:$,onChange:this.onChangeLabels,className:Q.horizontalInlineSwitch,transparent:!0,id:`unique-labels_${I}`})),t.createElement(Se._,{label:"Wrap lines",className:Q.horizontalInlineLabel,transparent:!0},t.createElement(ze.x,{value:D,onChange:this.onChangeWrapLogMessage,className:Q.horizontalInlineSwitch,transparent:!0,id:`wrap-lines_${I}`})),t.createElement(Se._,{label:"Prettify JSON",className:Q.horizontalInlineLabel,transparent:!0},t.createElement(ze.x,{value:L,onChange:this.onChangePrettifyLogMessage,className:Q.horizontalInlineSwitch,transparent:!0,id:`prettify_${I}`})),t.createElement(Se._,{label:"Deduplication",className:Q.horizontalInlineLabel,transparent:!0},t.createElement(St.S,{options:or.map(ie=>({label:(0,j.capitalize)(ie),value:ie,description:G.Uv[ie]})),value:R,onChange:this.onChangeDedup,className:Q.radioButtons}))),t.createElement("div",null,t.createElement(Se._,{label:"Display results",className:Q.horizontalInlineLabel,transparent:!0},t.createElement(St.S,{disabled:J,options:[{label:"Newest first",value:Y.UV.Descending,description:"Show results newest to oldest"},{label:"Oldest first",value:Y.UV.Ascending,description:"Show results oldest to newest"}],value:ee,onChange:this.onChangeLogsSortOrder,className:Q.radioButtons})))),t.createElement("div",{ref:this.topLogsRef}),t.createElement(Vn,{logRows:s,meta:a||[],dedupStrategy:R,dedupCount:ne,hasUnescapedContent:qe,forceEscape:Ie,displayedFields:K,onEscapeNewlines:this.onEscapeNewlines,clearDetectedFields:this.clearDetectedFields})),t.createElement("div",{className:(0,p.cx)(Q.logsSection,this.state.visualisationType==="table"?Q.logsTable:void 0)},this.state.visualisationType==="table"&&Me&&t.createElement("div",{className:Q.logRows,"data-testid":"logRowsTable"},t.createElement(Za,{logsSortOrder:this.state.logsSortOrder,range:this.props.range,splitOpen:this.props.splitOpen,timeZone:d,width:o-80,logsFrames:this.props.logsFrames??[],onClickFilterLabel:g,onClickFilterOutLabel:m,panelState:this.props.panelState?.logs,theme:x,updatePanelState:this.updatePanelState,datasourceType:this.props.datasourceType})),this.state.visualisationType==="logs"&&Me&&t.createElement("div",{className:Q.logRows,"data-testid":"logRows",ref:this.onLogsContainerRef},t.createElement(_e.w,{logRows:s,deduplicatedRows:ae,dedupStrategy:R,onClickFilterLabel:g,onClickFilterOutLabel:m,showContextToggle:y,showLabels:$,showTime:F,enableLogDetails:!0,forceEscape:Ie,wrapLogMessage:D,prettifyLogMessage:L,timeZone:d,getFieldLinks:v,logsSortOrder:ee,displayedFields:K,onClickShowField:this.showField,onClickHideField:this.hideField,app:Be.zj.Explore,onLogRowHover:this.onLogRowHover,onOpenContext:this.onOpenContext,onPermalinkClick:this.onPermalinkClick,permalinkedRowId:this.props.panelState?.logs?.id,scrollIntoView:this.scrollIntoView,isFilterLabelActive:this.props.isFilterLabelActive,containerRendered:!!this.state.logsContainer,onClickFilterValue:this.props.onClickFilterValue,onClickFilterOutValue:this.props.onClickFilterOutValue})),!c&&!Me&&!f&&t.createElement("div",{className:Q.logRows},t.createElement("div",{className:Q.noData},"No logs found.",t.createElement(U.zx,{size:"sm",variant:"secondary",onClick:this.onClickScan},"Scan for older logs"))),f&&t.createElement("div",{className:Q.logRows},t.createElement("div",{className:Q.noData},t.createElement("span",null,he),t.createElement(U.zx,{size:"sm",variant:"secondary",onClick:this.onClickStopScan},"Stop scan"))),t.createElement(Fa,{logsSortOrder:ee,visibleRange:re??E,absoluteRange:E,timeZone:d,onChangeTime:b,loading:c,queries:C??[],scrollToTopLogs:this.scrollToTopLogs,addResultsToCache:w,clearCache:T}))))}}const ar=(0,N.HE)(sr),rr=(e,o,n)=>({noData:(0,p.css)`
      > * {
        margin-left: 0.5em;
      }
    `,logOptions:(0,p.css)`
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      flex-wrap: wrap;
      background-color: ${e.colors.background.primary};
      padding: ${e.spacing(1,2)};
      border-radius: ${e.shape.radius.default};
      margin: ${e.spacing(0,0,1)};
      border: 1px solid ${e.colors.border.medium};
    `,headerButton:(0,p.css)`
      margin: ${e.spacing(.5,0,0,1)};
    `,horizontalInlineLabel:(0,p.css)`
      > label {
        margin-right: 0;
      }
    `,horizontalInlineSwitch:(0,p.css)`
      padding: 0 ${e.spacing(1)} 0 0;
    `,radioButtons:(0,p.css)`
      margin: 0;
    `,logsSection:(0,p.css)`
      display: flex;
      flex-direction: row;
      justify-content: space-between;
    `,logsTable:(0,p.css)({maxHeight:`${n}px`}),logRows:(0,p.css)`
      overflow-x: ${Kt?"scroll;":`${o?"unset":"scroll"};`}
      overflow-y: visible;
      width: 100%;
      ${Kt&&"max-height: calc(100vh - 170px);"}
    `,visualisationType:(0,p.css)`
      display: flex;
      flex: 1;
      justify-content: space-between;
    `,visualisationTypeRadio:(0,p.css)`
      margin: 0 0 0 ${e.spacing(1)};
    `,stickyNavigation:(0,p.css)`
      ${Kt&&"margin-bottom: 0px"}
      overflow: visible;
    `}),Jt=500,Xt=100,ir=(0,Ue.Z)(()=>({logsEnter:(0,p.css)`
      label: logsEnter;
      position: absolute;
      opacity: 0;
      height: auto;
      width: 100%;
    `,logsEnterActive:(0,p.css)`
      label: logsEnterActive;
      opacity: 1;
      transition: opacity ${Jt}ms ease-out ${Xt}ms;
    `,logsExit:(0,p.css)`
      label: logsExit;
      position: absolute;
      opacity: 1;
      height: auto;
      width: 100%;
    `,logsExitActive:(0,p.css)`
      label: logsExitActive;
      opacity: 0;
      transition: opacity ${Jt}ms ease-out ${Xt}ms;
    `}));function Kn(e){const{visible:o,children:n}=e,s=ir();return t.createElement(Ln.Z,{in:o,mountOnEnter:!0,unmountOnExit:!0,timeout:Jt+Xt,classNames:{enter:s.logsEnter,enterActive:s.logsEnterActive,exit:s.logsExit,exitActive:s.logsExitActive}},n)}class lr extends t.PureComponent{constructor(){super(...arguments),this.state={dsInstances:{}},this.onChangeTime=o=>{const{exploreId:n,updateTimeRange:s}=this.props;s({exploreId:n,absoluteRange:o})},this.getLogRowContext=async(o,n,s)=>{const{logsQueries:a}=this.props;if(!n.dataFrame.refId||!this.state.dsInstances[n.dataFrame.refId])return Promise.resolve([]);const r=this.state.dsInstances[n.dataFrame.refId];if(!(0,G.Q4)(r))return Promise.resolve([]);const i=this.getQuery(a,n,r);return i?r.getLogRowContext(o,s,i):Promise.resolve([])},this.getLogRowContextQuery=async(o,n)=>{const{logsQueries:s}=this.props;if(!o.dataFrame.refId||!this.state.dsInstances[o.dataFrame.refId])return Promise.resolve(null);const a=this.state.dsInstances[o.dataFrame.refId];if(!(0,G.Q4)(a))return Promise.resolve(null);const r=this.getQuery(s,o,a);return r&&a.getLogRowContextQuery?a.getLogRowContextQuery(o,n,r):Promise.resolve(null)},this.getLogRowContextUi=(o,n)=>{const{logsQueries:s}=this.props;if(!o.dataFrame.refId||!this.state.dsInstances[o.dataFrame.refId])return t.createElement(t.Fragment,null);const a=this.state.dsInstances[o.dataFrame.refId];if(!(0,G.Q4)(a))return t.createElement(t.Fragment,null);const r=this.getQuery(s,o,a);return r&&(0,G.xW)(a)&&a.getLogRowContextUi?a.getLogRowContextUi(o,n,r):t.createElement(t.Fragment,null)},this.showContextToggle=o=>!o?.dataFrame.refId||!this.state.dsInstances[o.dataFrame.refId]?!1:(0,G.Q4)(this.state.dsInstances[o.dataFrame.refId]),this.getFieldLinks=(o,n,s)=>{const{splitOpenFn:a,range:r}=this.props;return(0,Xe.a_)({field:o,rowIndex:n,splitOpenFn:a,range:r,dataFrame:s})},this.logDetailsFilterAvailable=()=>Object.values(this.state.dsInstances).some(o=>o?.modifyQuery||(0,G._)(o)||(0,G.Vw)(o)),this.filterValueAvailable=()=>Object.values(this.state.dsInstances).some(o=>(0,G._)(o)&&o?.getSupportedQueryModifications().includes("ADD_STRING_FILTER")),this.filterOutValueAvailable=()=>Object.values(this.state.dsInstances).some(o=>(0,G._)(o)&&o?.getSupportedQueryModifications().includes("ADD_STRING_FILTER_OUT"))}componentDidMount(){this.updateDataSourceInstances()}componentDidUpdate(o){o.logsQueries!==this.props.logsQueries&&this.updateDataSourceInstances()}updateDataSourceInstances(){const{logsQueries:o,datasourceInstance:n}=this.props;if(!o||!n)return;const s={};if(n.uid!==it.D){o.forEach(({refId:r})=>{s[r]=n}),this.setState({dsInstances:s});return}const a=[];for(const r of o){if(!r.datasource)continue;(!s[r.refId]||s[r.refId].uid!==r.datasource.uid)&&a.push(new Promise(l=>{(0,je.F)().get(r.datasource).then(c=>{l({ds:c,refId:r.refId})})}))}a.length&&Promise.all(a).then(r=>{r.forEach(({ds:i,refId:l})=>{s[l]=i}),this.setState({dsInstances:s})})}getQuery(o,n,s){return(o??[]).find(a=>a.refId===n.dataFrame.refId&&a.datasource!=null&&a.datasource.type===s.type)}render(){const{loading:o,loadingState:n,logRows:s,logsMeta:a,logsSeries:r,logsQueries:i,loadSupplementaryQueryData:l,setSupplementaryQueryEnabled:c,onClickFilterLabel:g,onClickFilterOutLabel:m,onStartScanning:d,onStopScanning:f,absoluteRange:h,timeZone:y,visibleRange:E,scanning:b,range:v,width:x,splitOpenFn:C,isLive:T,exploreId:w,addResultsToCache:I,clearCache:H,logsVolume:M,scrollElement:A}=this.props;return s?t.createElement(t.Fragment,null,t.createElement(Kn,{visible:T},t.createElement(pt.U,{label:"Logs",loading:!1,isOpen:!0},t.createElement(In,{exploreId:w},$=>t.createElement(Vs,{logRows:s,timeZone:y,stopLive:$.stop,isPaused:this.props.isPaused,onPause:$.pause,onResume:$.resume,onClear:$.clear,clearedAtIndex:this.props.clearedAtIndex})))),t.createElement(Kn,{visible:!T},t.createElement(ar,{exploreId:w,datasourceType:this.props.datasourceInstance?.type,logRows:s,logsMeta:a,logsSeries:r,logsVolumeEnabled:M.enabled,onSetLogsVolumeEnabled:$=>c(w,$,G.v8.LogsVolume),logsVolumeData:M.data,logsQueries:i,width:x,splitOpen:C,loading:o,loadingState:n,loadLogsVolumeData:()=>l(w,G.v8.LogsVolume),onChangeTime:this.onChangeTime,onClickFilterLabel:this.logDetailsFilterAvailable()?g:void 0,onClickFilterOutLabel:this.logDetailsFilterAvailable()?m:void 0,onStartScanning:d,onStopScanning:f,absoluteRange:h,visibleRange:E,timeZone:y,scanning:b,scanRange:v.raw,showContextToggle:this.showContextToggle,getRowContext:this.getLogRowContext,getRowContextQuery:this.getLogRowContextQuery,getLogRowContextUi:this.getLogRowContextUi,getFieldLinks:this.getFieldLinks,addResultsToCache:()=>I(w),clearCache:()=>H(w),eventBus:this.props.eventBus,panelState:this.props.panelState,logsFrames:this.props.logsFrames,scrollElement:A,isFilterLabelActive:this.logDetailsFilterAvailable()?this.props.isFilterLabelActive:void 0,range:v,onClickFilterValue:this.filterValueAvailable()?this.props.onClickFilterValue:void 0,onClickFilterOutValue:this.filterOutValueAvailable()?this.props.onClickFilterOutValue:void 0}))):null}}function cr(e,{exploreId:o}){const s=e.explore.panes[o],{logsResult:a,scanning:r,datasourceInstance:i,isLive:l,isPaused:c,clearedAtIndex:g,range:m,absoluteRange:d,supplementaryQueries:f}=s,h=(0,W.$9)(o)(e),y=s.panelsState,E=(0,dt.Z)(e.user),b=f[G.v8.LogsVolume];return{loading:h,logRows:a?.rows,logsMeta:a?.meta,logsSeries:a?.series,logsQueries:a?.queries,visibleRange:a?.visibleRange,scanning:r,timeZone:E,datasourceInstance:i,isLive:l,isPaused:c,clearedAtIndex:g,range:m,absoluteRange:d,logsVolume:b,panelState:y,logsFrames:s.queryResponse.logsFrames}}const ur={updateTimeRange:me.cD,addResultsToCache:W.K8,clearCache:W.LK,loadSupplementaryQueryData:W.W1,setSupplementaryQueryEnabled:W.z0},dr=(0,ye.connect)(cr,ur)(lr);function pr(e){const{queryResponse:o,timeZone:n,enabled:s,setLogsSampleEnabled:a,datasourceInstance:r,queries:i,splitOpen:l}=e,c=(0,N.wW)(hr),g=f=>{a(f),(0,P.ff)("grafana_explore_logs_sample_toggle_clicked",{datasourceType:r?.type??"unknown",type:f?"open":"close"})},m=()=>{if(!(0,G.mN)(r,G.v8.LogsSample))return null;const f=i.map(y=>r.getSupplementaryQuery({type:G.v8.LogsSample},y)).filter(y=>!!y);if(!f.length)return null;const h=()=>{l({queries:f,datasourceUid:r.uid}),(0,P.ff)("grafana_explore_logs_sample_split_button_clicked",{datasourceType:r?.type??"unknown",queriesCount:f.length})};return t.createElement(U.zx,{size:"sm",className:c.logSamplesButton,onClick:h},"Open logs in split view")};let d;if(o===void 0)d=null;else if(o.error!==void 0)d=t.createElement(Yt,{error:o.error,title:"Failed to load logs sample for this query"});else if(o.state===Z.Gu.Loading)d=t.createElement("span",null,"Logs sample is loading...");else if(o.data.length===0||o.data.every(f=>f.length===0))d=t.createElement("span",null,"No logs sample data.");else{const f=(0,Ct.aB)(o.data);d=t.createElement(t.Fragment,null,t.createElement(m,null),t.createElement("div",{className:c.logContainer},t.createElement(_e.w,{logRows:f.rows,dedupStrategy:Y.Y4.none,showLabels:X.Z.getBool(_.showLabels,!1),showTime:X.Z.getBool(_.showTime,!0),wrapLogMessage:X.Z.getBool(_.wrapLogMessage,!0),prettifyLogMessage:X.Z.getBool(_.prettifyLogMessage,!1),timeZone:n,enableLogDetails:!0})))}return o?.state!==Z.Gu.NotStarted?t.createElement(pt.U,{className:c.logsSamplePanel,label:t.createElement("div",null,"Logs sample",t.createElement(fe.u,{content:"Show log lines that contributed to visualized metrics"},t.createElement(ge.J,{name:"info-circle",className:c.infoTooltip}))),isOpen:s,collapsible:!0,onToggle:g},d):null}const hr=e=>{const o=q.config.featureToggles.exploreScrollableLogsContainer;return{logsSamplePanel:(0,p.css)`
      ${o&&"max-height: calc(100vh - 115px);"}
    `,logSamplesButton:(0,p.css)`
      position: absolute;
      top: ${e.spacing(1)};
      right: ${e.spacing(1)};
    `,logContainer:(0,p.css)`
      ${o&&"position: relative;"}
      ${o&&"height: 100%;"}
      overflow: scroll;
    `,infoTooltip:(0,p.css)`
      margin-left: ${e.spacing(1)};
    `}},gr=()=>{const e=(0,N.wW)(mr);return t.createElement(t.Fragment,null,t.createElement(Pt.l,{"data-testid":"explore-no-data",className:e.wrapper},t.createElement("span",{className:e.message},"No data")))},mr=e=>({wrapper:(0,p.css)`
    label: no-data-card;
    padding: ${e.spacing(3)};
    background: ${e.colors.background.primary};
    border-radius: ${e.shape.radius.default};
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex-grow: 1;
  `,message:(0,p.css)`
    font-size: ${e.typography.h2.fontSize};
    padding: ${e.spacing(4)};
    color: ${e.colors.text.disabled};
  `});var fr=u(11318);const yr=()=>{const e=(0,N.l4)(),o=Wt.Vt.hasPermission(O.AccessControlAction.DataSourcesCreate)&&Wt.Vt.hasPermission(O.AccessControlAction.DataSourcesWrite),n="Explore requires at least one data source. Once you have added a data source, you can query it here.",s=t.createElement(t.Fragment,null,t.createElement(ge.J,{name:"rocket"}),t.createElement(t.Fragment,null," ProTip: You can also define data sources through configuration files. "),t.createElement("a",{href:"http://docs.grafana.org/administration/provisioning/?utm_source=explore#data-sources",target:"_blank",rel:"noreferrer",className:"text-link"},"Learn more")),a=t.createElement(U.Qj,{size:"lg",href:"datasources/new",icon:"database",disabled:!o},"Add data source"),r=(0,p.css)`
    max-width: ${e.breakpoints.values.lg}px;
    margin-top: ${e.spacing(2)};
    align-self: center;
  `;return t.createElement(fr._,{callToActionElement:a,className:r,footer:s,message:n})};var _t=u(62223),vr=u(59691),Er=u(30415);const br=e=>({warningText:(0,p.css)`
    label: warningText;
    display: flex;
    align-items: center;
    font-size: ${e.typography.bodySmall.fontSize};
    color: ${e.colors.text.secondary};
  `});function xr(e){const{dataFrames:o,range:n,splitOpenFn:s,withTraceView:a,datasourceType:r}=e,i=(0,Xe.u8)(n,s),l=(0,N.l4)(),c=(0,N.wW)(br),g=(0,Ot.SM)({fieldConfig:{defaults:{},overrides:[]},data:o,replaceVariables:T=>T,theme:l}),{nodes:m}=(0,Er.Y)(g),[d,f]=(0,cn.Z)(!0),h=()=>{f(),(0,P.ff)("grafana_traces_node_graph_panel_clicked",{datasourceType:r,grafana_version:q.config.buildInfo.version,isExpanded:!open})},{height:y}=(0,_t.Z)(),E=(0,t.useRef)(null),[b,v]=(0,t.useState)(250);(0,t.useEffect)(()=>{if(E.current){const{top:T}=E.current.getBoundingClientRect();v(T)}},[E]);const x=y-b-32,C=a&&m[0]?.length>1e3?t.createElement("span",{className:c.warningText}," (",m[0].length," nodes, can be slow to load)"):null;return t.createElement(Te.fm,{title:"Node graph",titleItems:C,collapsible:!!a,collapsed:a?d:!1,onToggleCollapse:a?h:void 0},t.createElement("div",{ref:E,style:a?{height:500}:{minHeight:600,height:x}},t.createElement(vr.E,{dataFrames:g,getLinks:i})))}function Sr(e,{exploreId:o}){return{range:e.explore.panes[o].range}}const Cr=(0,ye.connect)(Sr,{})(xr);var tt=u(8111),wr=u(21871),Rr=u(37667);const Tr=e=>{const o=(0,te.F9)(e);return{getQueries:(0,tt.P1)(o,n=>n.queries),getQueryResponse:(0,tt.P1)(o,n=>n.queryResponse),getHistory:(0,tt.P1)(o,n=>n.history),getEventBridge:(0,tt.P1)(o,n=>n.eventBridge),getDatasourceInstanceSettings:(0,tt.P1)(o,n=>(0,Fe.ak)().getInstanceSettings(n.datasourceInstance?.uid))}},Lr=({exploreId:e})=>{const o=(0,O.useDispatch)(),{getQueries:n,getDatasourceInstanceSettings:s,getQueryResponse:a,getHistory:r,getEventBridge:i}=(0,t.useMemo)(()=>Tr(e),[e]),l=(0,O.useSelector)(n),c=(0,O.useSelector)(s),g=(0,O.useSelector)(a),m=(0,O.useSelector)(r),d=(0,O.useSelector)(i),f=(0,t.useCallback)(()=>{o((0,W.aA)({exploreId:e}))},[o,e]),h=(0,t.useCallback)(x=>{o((0,W.qV)({exploreId:e,queries:x}))},[o,e]),y=(0,t.useCallback)(x=>{h([...l,{...x,refId:(0,wr.Hs)(l)}])},[h,l]),E=()=>{(0,P.ff)("grafana_explore_query_row_copy")},b=()=>{(0,P.ff)("grafana_explore_query_row_remove")},v=x=>{(0,P.ff)("grafana_query_row_toggle",x===void 0?{}:{queryEnabled:x})};return t.createElement(Rr.l,{dsSettings:c,queries:l,onQueriesChange:h,onAddQuery:y,onRunQueries:f,onQueryCopied:E,onQueryRemoved:b,onQueryToggled:v,data:g,app:Be.zj.Explore,history:m,eventBus:d})};var Dt=u(12399),en=u(67954),Fr=u(89248),Ir=u(403),Jn=u(56917),Or=u(17683),Dr=u(61420);const nt={wrapper:(0,p.css)`
    height: 100%;
    overflow: scroll;
  `,switchWrapper:(0,p.css)`
    display: flex;
    flex-direction: row;
    margin-bottom: 0;
  `,switchLabel:(0,p.css)`
    margin-left: 15px;
    margin-bottom: 0;
  `,switch:(0,p.css)`
    margin-left: 10px;
  `,resultCount:(0,p.css)`
    margin-bottom: 4px;
  `,header:(0,p.css)`
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    font-size: 12px;
    line-height: 1.25;
  `},Nr=480,zr=2,Ar=e=>{const{tableResult:o}=e,n=(0,j.cloneDeep)(o),s=(0,t.useRef)(null),a=n.fields.filter(h=>h.name.includes("Value")),r=(0,Jn.u)(n),{width:i}=(0,_t.Z)(),[l,c]=(0,t.useState)(i<=Nr||a.length>zr),g=()=>{c(!l);const h={isExpanded:!l};(0,P.ff)("grafana_explore_prometheus_instant_query_ui_raw_toggle_expand",h)};(0,t.useEffect)(()=>{s.current?.resetAfterIndex(0,!0)},[l]);const m=h=>{if(h<10){let b=0;for(let v=0;v<h;v++)b+=d(v,!0);return Math.min(600,b)}return 600},d=(h,y)=>{if(!y)return 32;const v=r[h];return 1.5*32+(Object.keys(v).length-a.length)*22},f=`isExpandedView ${(0,t.useId)()}`;return t.createElement("section",null,t.createElement("header",{className:nt.header},t.createElement(Re.g,{className:nt.switchWrapper,label:"Expand results",htmlFor:"isExpandedView"},t.createElement("div",{className:nt.switch},t.createElement(ze.r,{onChange:g,id:f,value:l,label:"Expand results"}))),t.createElement("div",{className:nt.resultCount},"Result series: ",r.length)),t.createElement("div",{role:"table"},t.createElement(t.Fragment,null,a.length>1&&!l&&t.createElement(Or.I,{valueLabels:a,expanded:l}),t.createElement(Ir.S_,{ref:s,itemCount:r.length,className:nt.wrapper,itemSize:h=>d(h,l),height:m(r.length),width:"100%"},({index:h,style:y})=>{let E;return l&&(E=a.filter(b=>{const v=r[h][b.name];return v&&v!==Jn.T})),t.createElement("div",{role:"row",style:{...y,overflow:"hidden"}},t.createElement(Dr.ZP,{isExpandedView:l,valueLabels:E,totalNumberOfValues:a.length,listKey:r[h].__name__,listItemData:r[h]}))}))))};function Pr(e,{exploreId:o}){const s=e.explore.panes[o],{tableResult:a,rawPrometheusResult:r,range:i,queryResponse:l}=s,c=r?[r]:[],g=(a?.length??0)>0&&r?a:c;return{loading:l.state,tableResult:g,range:i}}const Mr=(0,ye.connect)(Pr,{});class Hr extends t.PureComponent{constructor(o){super(o),this.onChangeResultsStyle=n=>{this.setState({resultsStyle:n})},this.renderLabel=()=>{const n=(0,p.css)({display:"flex",justifyContent:"space-between",flex:"1"}),s=Vt.zN.map(a=>({value:a,label:a[0].toUpperCase()+a.slice(1).replace(/_/," ")}));return t.createElement("div",{className:n},t.createElement(St.S,{onClick:()=>{const a={state:this.state.resultsStyle===O.TABLE_RESULTS_STYLE.table?O.TABLE_RESULTS_STYLE.raw:O.TABLE_RESULTS_STYLE.table};(0,P.ff)("grafana_explore_prometheus_instant_query_ui_toggle_clicked",a)},size:"sm",options:s,value:this.state?.resultsStyle,onChange:this.onChangeResultsStyle}))},o.showRawPrometheus&&(this.state={resultsStyle:O.TABLE_RESULTS_STYLE.raw})}getTableHeight(){const{tableResult:o}=this.props;return!o||o.length===0?200:Math.max(Math.min(600,o[0].length*35)+35)}render(){const{loading:o,onCellFilterAdded:n,tableResult:s,width:a,splitOpenFn:r,range:i,ariaLabel:l,timeZone:c}=this.props,g=this.getTableHeight(),m=a-en.config.theme.panelPadding*2-Fr.QO;let d=s;const f=(0,Xe.qQ)(r,i);d?.length&&(d=(0,Ot.SM)({data:d,timeZone:c,theme:en.config.theme2,replaceVariables:(0,Dt.J)().replace.bind((0,Dt.J)()),fieldConfig:{defaults:{},overrides:[]},dataLinkPostProcessor:f}));const h=d?.filter(v=>!!v&&v.length!==0),y=this.state.resultsStyle===O.TABLE_RESULTS_STYLE.raw?"Raw":"Table",E=this.state?.resultsStyle!==void 0?this.renderLabel():"Table",b=!this.state?.resultsStyle||this.state?.resultsStyle===O.TABLE_RESULTS_STYLE.table;return t.createElement(Te.fm,{title:y,actions:E,loadingState:o},h?.length&&t.createElement(t.Fragment,null,b&&t.createElement(qt.i,{ariaLabel:l,data:h[0],width:m,height:g,onCellFilterAdded:n}),this.state?.resultsStyle===O.TABLE_RESULTS_STYLE.raw&&t.createElement(Ar,{tableResult:h[0]})),!h?.length&&t.createElement(Zt,{metaItems:[{value:"0 series returned"}]}))}}const $r=Mr(Hr);var Br=u(19547);const kr=e=>{const o={transition:`opacity ${e.duration}ms linear`,opacity:0},n={exited:{opacity:0,display:"none"},entering:{opacity:0},entered:{opacity:1},exiting:{opacity:0}};return t.createElement(Br.ZP,{in:e.in,timeout:e.duration,unmountOnExit:e.unmountOnExit||!1,onExited:e.onExited},s=>t.createElement("div",{style:{...o,...n[s]}},e.children))},Vr=e=>{const{queryError:o}=e,n=!!o,s=n?100:10,a=o?"Query error":"Unknown error",r=o?.message||o?.data?.message||null;return t.createElement(kr,{in:n,duration:s},t.createElement(Ke.b,{severity:"error",title:a,topSpacing:2},r))};function Wr(e){const o=(0,O.useSelector)(s=>s.explore.panes[e.exploreId].queryResponse),n=o?.state===Z.Gu.Error?o?.error:void 0;return n?.refId?null:t.createElement(Vr,{queryError:n})}var Ce=u(55756),ce=u(85563),Qr=u(34407),Xn=u(96535),ot=u(2384),Ur=u(7073),jr=u(79468),tn=u(88492),st=u(14914);function Gr(e,{exploreId:o}){const n=e.explore,{datasourceInstance:s}=n.panes[o];return{exploreId:o,datasourceInstance:s}}const Zr={changeDatasource:$e.zU,deleteHistoryItem:Ce.NV,commentHistoryItem:Ce.Ff,starHistoryItem:Ce.ev,setQueries:W.KO},qr=(0,ye.connect)(Gr,Zr),Yr=e=>{const o="240px",n="170px",s=e.colors.background.secondary;return{queryCard:(0,p.css)`
      position: relative;
      display: flex;
      flex-direction: column;
      border: 1px solid ${e.colors.border.weak};
      margin: ${e.spacing(1)} 0;
      background-color: ${s};
      border-radius: ${e.shape.radius.default};
      .starred {
        color: ${e.v1.palette.orange};
      }
    `,cardRow:(0,p.css)`
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: ${e.spacing(1)};
      border-bottom: none;
      :first-of-type {
        border-bottom: 1px solid ${e.colors.border.weak};
        padding: ${e.spacing(.5,1)};
      }
      img {
        height: ${e.typography.fontSize}px;
        max-width: ${e.typography.fontSize}px;
        margin-right: ${e.spacing(1)};
      }
    `,queryActionButtons:(0,p.css)`
      max-width: ${n};
      display: flex;
      justify-content: flex-end;
      font-size: ${e.typography.size.base};
      button {
        margin-left: ${e.spacing(1)};
      }
    `,queryContainer:(0,p.css)`
      font-weight: ${e.typography.fontWeightMedium};
      width: calc(100% - ${o});
    `,updateCommentContainer:(0,p.css)`
      width: calc(100% + ${o});
      margin-top: ${e.spacing(1)};
    `,comment:(0,p.css)`
      overflow-wrap: break-word;
      font-size: ${e.typography.bodySmall.fontSize};
      font-weight: ${e.typography.fontWeightRegular};
      margin-top: ${e.spacing(.5)};
    `,commentButtonRow:(0,p.css)`
      > * {
        margin-top: ${e.spacing(1)};
        margin-right: ${e.spacing(1)};
      }
    `,textArea:(0,p.css)`
      width: 100%;
    `,runButton:(0,p.css)`
      max-width: ${n};
      display: flex;
      justify-content: flex-end;
      button {
        height: auto;
        padding: ${e.spacing(.5,2)};
        line-height: 1.4;
        span {
          white-space: normal !important;
        }
      }
    `,loader:(0,p.css)`
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: ${e.colors.background.secondary};
    `}};function Kr(e){const{queryHistoryItem:o,commentHistoryItem:n,starHistoryItem:s,deleteHistoryItem:a,changeDatasource:r,exploreId:i,datasourceInstance:l,setQueries:c}=e,[g,m]=(0,t.useState)(!1),[d,f]=(0,t.useState)(o.comment),{value:h,loading:y}=(0,Mt.Z)(async()=>{let F;try{F=await(0,je.F)().get(o.datasourceUid)}catch{}return{datasourceInstance:F,queries:await Promise.all(o.queries.map(async D=>{let L;if(F?.meta.mixed)try{L=await(0,je.F)().get(D.datasource)}catch{}else L=F;return{query:D,datasource:L}}))}},[o.datasourceUid,o.queries]),E=(0,N.wW)(Yr),b=async()=>{const F=o.queries,D=o.datasourceUid!==l?.uid;D&&await r(i,o.datasourceUid),c(i,F),(0,P.ff)("grafana_explore_query_history_run",{queryHistoryEnabled:q.config.queryHistoryEnabled,differentDataSource:D})},v=async()=>{const F=[...o.queries.map(L=>L.datasource?.type||"unknown")];if((0,P.ff)("grafana_explore_query_history_copy_query",{datasources:F,mixed:!!h?.datasourceInstance?.meta.mixed}),y||!h)return;const D=h.queries.map(L=>(0,ce.OH)(L.query,L.datasource)).join(`
`);(0,we.n9)(D),(0,Ae.WI)((0,tn.$l)((0,Rt.AT)((0,S.t)("explore.rich-history-notification.query-copied","Query copied to clipboard"))))},x=async()=>{const F=(0,ce.t2)(o);await(0,kt.L)(F)},C=()=>{const F=D=>{a(D),(0,Ae.WI)((0,tn.$l)((0,Rt.AT)((0,S.t)("explore.rich-history-notification.query-deleted","Query deleted")))),(0,P.ff)("grafana_explore_query_history_deleted",{queryHistoryEnabled:q.config.queryHistoryEnabled})};o.starred?(0,ot.N$)().publish(new st.VJ({title:(0,S.t)("explore.rich-history-card.delete-query-confirmation-title","Delete"),text:(0,S.t)("explore.rich-history-card.delete-starred-query-confirmation-text","Are you sure you want to permanently delete your starred query?"),yesText:(0,S.t)("explore.rich-history-card.confirm-delete","Delete"),icon:"trash-alt",onConfirm:()=>F(o.id)})):F(o.id)},T=()=>{s(o.id,!o.starred),(0,P.ff)("grafana_explore_query_history_starred",{queryHistoryEnabled:q.config.queryHistoryEnabled,newValue:!o.starred})},w=()=>m(!g),I=()=>{n(o.id,d),m(!1),(0,P.ff)("grafana_explore_query_history_commented",{queryHistoryEnabled:q.config.queryHistoryEnabled})},H=()=>{m(!1),f(o.comment)},M=F=>{F.key==="Enter"&&(F.shiftKey||F.ctrlKey)&&I(),F.key==="Escape"&&H()},A=t.createElement("div",{className:E.updateCommentContainer,"aria-label":d?(0,S.t)("explore.rich-history-card.update-comment-form","Update comment form"):(0,S.t)("explore.rich-history-card.add-comment-form","Add comment form")},t.createElement(Ur.K,{onKeyDown:M,value:d,placeholder:d?void 0:(0,S.t)("explore.rich-history-card.optional-description","An optional description of what the query does."),onChange:F=>f(F.currentTarget.value),className:E.textArea}),t.createElement("div",{className:E.commentButtonRow},t.createElement(U.zx,{onClick:I},t.createElement(S.cC,{i18nKey:"explore.rich-history-card.save-comment"},"Save comment")),t.createElement(U.zx,{variant:"secondary",onClick:H},t.createElement(S.cC,{i18nKey:"explore.rich-history-card.cancel"},"Cancel")))),$=t.createElement("div",{className:E.queryActionButtons},t.createElement(Ge.h,{name:"comment-alt",onClick:w,tooltip:o.comment?.length>0?(0,S.t)("explore.rich-history-card.edit-comment-tooltip","Edit comment"):(0,S.t)("explore.rich-history-card.add-comment-tooltip","Add comment")}),t.createElement(Ge.h,{name:"copy",onClick:v,tooltip:(0,S.t)("explore.rich-history-card.copy-query-tooltip","Copy query to clipboard")}),h?.datasourceInstance&&t.createElement(Ge.h,{name:"share-alt",onClick:x,tooltip:t.createElement(S.cC,{i18nKey:"explore.rich-history-card.copy-shortened-link-tooltip"},"Copy shortened link to clipboard")}),t.createElement(Ge.h,{name:"trash-alt",title:(0,S.t)("explore.rich-history-card.delete-query-title","Delete query"),tooltip:(0,S.t)("explore.rich-history-card.delete-query-tooltip","Delete query"),onClick:C}),t.createElement(Ge.h,{name:o.starred?"favorite":"star",iconType:o.starred?"mono":"default",onClick:T,tooltip:o.starred?(0,S.t)("explore.rich-history-card.unstar-query-tooltip","Unstar query"):(0,S.t)("explore.rich-history-card.star-query-tooltip","Star query")}));return t.createElement("div",{className:E.queryCard},t.createElement("div",{className:E.cardRow},t.createElement(_n,{dsApi:h?.datasourceInstance,size:"sm"}),$),t.createElement("div",{className:(0,p.cx)(E.cardRow)},t.createElement("div",{className:E.queryContainer},h?.queries.map((F,D)=>t.createElement(Xr,{query:F,key:`${F}-${D}`,showDsInfo:h?.datasourceInstance?.meta.mixed})),!g&&o.comment&&t.createElement("div",{"aria-label":(0,S.t)("explore.rich-history-card.query-comment-label","Query comment"),className:E.comment},o.comment),g&&A),!g&&t.createElement("div",{className:E.runButton},t.createElement(U.zx,{variant:"secondary",onClick:b,disabled:!h?.datasourceInstance||h.queries.some(F=>!F.datasource)},l?.uid===o.datasourceUid?t.createElement(S.cC,{i18nKey:"explore.rich-history-card.run-query-button"},"Run query"):t.createElement(S.cC,{i18nKey:"explore.rich-history-card.switch-datasource-button"},"Switch data source and run query")))),y&&t.createElement(jr.u,{text:(0,S.t)("explore.rich-history-card.loading-text","loading..."),className:E.loader}))}const Jr=e=>({queryRow:(0,p.css)`
    border-top: 1px solid ${e.colors.border.weak};
    display: flex;
    flex-direction: row;
    padding: 4px 0px;
    gap: 4px;
    :first-child {
      border-top: none;
    }
  `,dsInfoContainer:(0,p.css)`
    display: flex;
    align-items: center;
  `,queryText:(0,p.css)`
    word-break: break-all;
  `}),Xr=({query:e,showDsInfo:o=!1})=>{const n=(0,N.wW)(Jr);return t.createElement("div",{className:n.queryRow},o&&t.createElement("div",{className:n.dsInfoContainer},t.createElement(_n,{dsApi:e.datasource,size:"md"}),": "),t.createElement("span",{"aria-label":(0,S.t)("explore.rich-history-card.query-text-label","Query text"),className:n.queryText},(0,ce.OH)(e.query,e.datasource)))},_r=e=>o=>(0,p.css)`
  display: flex;
  align-items: center;
  font-size: ${o.typography[e==="sm"?"bodySmall":"body"].fontSize};
  font-weight: ${o.typography.fontWeightMedium};
  white-space: nowrap;
`;function _n({dsApi:e,size:o}){const n=(0,t.useCallback)(a=>_r(o)(a),[o]),s=(0,N.wW)(n);return t.createElement("div",{className:s},t.createElement("img",{src:e?.meta.info.logos.small||"public/img/icn-datasource.svg",alt:e?.type||(0,S.t)("explore.rich-history-card.datasource-not-exist","Data source does not exist anymore"),"aria-label":(0,S.t)("explore.rich-history-card.datasource-icon-label","Data source icon")}),t.createElement("div",{"aria-label":(0,S.t)("explore.rich-history-card.datasource-name-label","Data source name")},e?.name||(0,S.t)("explore.rich-history-card.datasource-not-exist","Data source does not exist anymore")))}const eo=qr(Kr),ei=(e,o)=>({container:(0,p.css)`
      display: flex;
    `,labelSlider:(0,p.css)`
      font-size: ${e.typography.bodySmall.fontSize};
      &:last-of-type {
        margin-top: ${e.spacing(3)};
      }
      &:first-of-type {
        font-weight: ${e.typography.fontWeightMedium};
        margin-bottom: ${e.spacing(2)};
      }
    `,containerContent:(0,p.css)`
      /* 134px is based on the width of the Query history tabs bar, so the content is aligned to right side of the tab */
      width: calc(100% - 134px);
    `,containerSlider:(0,p.css)`
      width: 129px;
      margin-right: ${e.spacing(1)};
    `,fixedSlider:(0,p.css)`
      position: fixed;
    `,slider:(0,p.css)`
      bottom: 10px;
      height: ${o-180}px;
      width: 129px;
      padding: ${e.spacing(1)} 0;
    `,selectors:(0,p.css)`
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    `,filterInput:(0,p.css)`
      margin-bottom: ${e.spacing(1)};
    `,multiselect:(0,p.css)`
      width: 100%;
      margin-bottom: ${e.spacing(1)};
    `,sort:(0,p.css)`
      width: 170px;
    `,sessionName:(0,p.css)`
      display: flex;
      align-items: flex-start;
      justify-content: flex-start;
      margin-top: ${e.spacing(3)};
      h4 {
        margin: 0 10px 0 0;
      }
    `,heading:(0,p.css)`
      font-size: ${e.typography.h4.fontSize};
      margin: ${e.spacing(2,.25,1,.25)};
    `,footer:(0,p.css)`
      height: 60px;
      margin: ${e.spacing(3)} auto;
      display: flex;
      justify-content: center;
      font-weight: ${e.typography.fontWeightLight};
      font-size: ${e.typography.bodySmall.fontSize};
      a {
        font-weight: ${e.typography.fontWeightMedium};
        margin-left: ${e.spacing(.25)};
      }
    `,queries:(0,p.css)`
      font-size: ${e.typography.bodySmall.fontSize};
      font-weight: ${e.typography.fontWeightRegular};
      margin-left: ${e.spacing(.5)};
    `});function ti(e){const{queries:o,totalQueries:n,loading:s,richHistorySearchFilters:a,updateFilters:r,clearRichHistoryResults:i,loadMoreRichHistory:l,richHistorySettings:c,exploreId:g,height:m,activeDatasourceInstance:d}=e,f=(0,N.wW)(ei,m),h=(0,ce.DR)();if((0,t.useEffect)(()=>{const v=!c.activeDatasourceOnly&&c.lastUsedDatasourceFilters?c.lastUsedDatasourceFilters:[d],x={search:"",sortOrder:ce.As.Descending,datasourceFilters:v,from:0,to:c.retentionPeriod,starred:!1};return r(x),()=>{i()}},[]),!a)return t.createElement("span",null,t.createElement(S.cC,{i18nKey:"explore.rich-history-queries-tab.loading"},"Loading..."),";");const y=(0,ce.k4)(o,a.sortOrder),E=no(),b=o.length&&o.length!==n;return t.createElement("div",{className:f.container},t.createElement("div",{className:f.containerSlider},t.createElement("div",{className:f.fixedSlider},t.createElement("div",{className:f.labelSlider},t.createElement(S.cC,{i18nKey:"explore.rich-history-queries-tab.filter-history"},"Filter history")),t.createElement("div",{className:f.labelSlider},(0,ce.bQ)(a.from)),t.createElement("div",{className:f.slider},t.createElement(Qr.U,{tooltipAlwaysVisible:!1,min:0,max:c.retentionPeriod,value:[a.from,a.to],orientation:"vertical",formatTooltipResult:ce.bQ,reverse:!0,onAfterChange:v=>{r({from:v[0],to:v[1]})}})),t.createElement("div",{className:f.labelSlider},(0,ce.bQ)(a.to)))),t.createElement("div",{className:f.containerContent,"data-testid":"query-history-queries-tab"},t.createElement("div",{className:f.selectors},!c.activeDatasourceOnly&&t.createElement(Ne.NU,{className:f.multiselect,options:h.map(v=>({value:v.name,label:v.name})),value:a.datasourceFilters,placeholder:(0,S.t)("explore.rich-history-queries-tab.filter-placeholder","Filter queries for data sources(s)"),"aria-label":(0,S.t)("explore.rich-history-queries-tab.filter-aria-label","Filter queries for data sources(s)"),onChange:v=>{r({datasourceFilters:v.map(x=>x.value)})}}),t.createElement("div",{className:f.filterInput},t.createElement(Xn.H,{escapeRegex:!1,placeholder:(0,S.t)("explore.rich-history-queries-tab.search-placeholder","Search queries"),value:a.search,onChange:v=>r({search:v})})),t.createElement("div",{"aria-label":(0,S.t)("explore.rich-history-queries-tab.sort-aria-label","Sort queries"),className:f.sort},t.createElement(Ne.Ph,{value:E.filter(v=>v.value===a.sortOrder),options:E,placeholder:(0,S.t)("explore.rich-history-queries-tab.sort-placeholder","Sort queries by"),onChange:v=>r({sortOrder:v.value})}))),s&&t.createElement("span",null,t.createElement(S.cC,{i18nKey:"explore.rich-history-queries-tab.loading-results"},"Loading results...")),!s&&Object.keys(y).map(v=>t.createElement("div",{key:v},t.createElement("div",{className:f.heading},v," ",t.createElement("span",{className:f.queries},b?t.createElement(S.cC,{i18nKey:"explore.rich-history-queries-tab.displaying-partial-queries",defaults:"Displaying {{ count }} queries",values:{count:y[v].length}}):t.createElement(S.cC,{i18nKey:"explore.rich-history-queries-tab.displaying-queries",defaults:"{{ count }} queries",values:{count:y[v].length}}))),y[v].map(x=>t.createElement(eo,{queryHistoryItem:x,key:x.id,exploreId:g})))),b?t.createElement("div",null,t.createElement(S.cC,{i18nKey:"explore.rich-history-queries-tab.showing-queries",defaults:"Showing {{ shown }} of {{ total }} <0>Load more</0>",values:{shown:o.length,total:n},components:[t.createElement(U.zx,{onClick:l,key:"loadMoreButton"},"Load more")]})):null,t.createElement("div",{className:f.footer},q.config.queryHistoryEnabled?"":(0,S.t)("explore.rich-history-queries-tab.history-local","The history is local to your browser and is not shared with others."))))}var ni=u(14551);const oi=e=>({container:(0,p.css)`
      font-size: ${e.typography.bodySmall.fontSize};
    `,spaceBetween:(0,p.css)`
      margin-bottom: ${e.spacing(3)};
    `,input:(0,p.css)`
      max-width: 200px;
    `,bold:(0,p.css)`
      font-weight: ${e.typography.fontWeightBold};
    `,bottomMargin:(0,p.css)`
      margin-bottom: ${e.spacing(1)};
    `}),to=[{value:2,label:(0,S.t)("explore.rich-history-settings-tab.retention-period.2-days","2 days")},{value:5,label:(0,S.t)("explore.rich-history-settings-tab.retention-period.5-days","5 days")},{value:7,label:(0,S.t)("explore.rich-history-settings-tab.retention-period.1-week","1 week")},{value:14,label:(0,S.t)("explore.rich-history-settings-tab.retention-period.2-weeks","2 weeks")}];function si(e){const{retentionPeriod:o,starredTabAsFirstTab:n,activeDatasourceOnly:s,onChangeRetentionPeriod:a,toggleStarredTabAsFirstTab:r,toggleactiveDatasourceOnly:i,deleteRichHistory:l}=e,c=(0,N.wW)(oi),g=to.find(d=>d.value===o),m=()=>{(0,ot.N$)().publish(new st.VJ({title:(0,S.t)("explore.rich-history-settings-tab.delete-title","Delete"),text:(0,S.t)("explore.rich-history-settings-tab.delete-confirm-text","Are you sure you want to permanently delete your query history?"),yesText:(0,S.t)("explore.rich-history-settings-tab.delete-confirm","Delete"),icon:"trash-alt",onConfirm:()=>{l(),(0,Ae.WI)((0,tn.$l)((0,Rt.AT)((0,S.t)("explore.rich-history-settings-tab.query-history-deleted","Query history deleted"))))}}))};return t.createElement("div",{className:c.container},(0,Ye.X)().changeRetention?t.createElement(Re.g,{label:(0,S.t)("explore.rich-history-settings-tab.history-time-span","History time span"),description:(0,S.t)("explore.rich-history-settings-tab.history-time-span-description","Select the period of time for which Grafana will save your query history. Up to {{MAX_HISTORY_ITEMS}} entries will be stored.",{MAX_HISTORY_ITEMS:ni.H6})},t.createElement("div",{className:c.input},t.createElement(Ne.Ph,{value:g,options:to,onChange:a}))):t.createElement(Ke.b,{severity:"info",title:(0,S.t)("explore.rich-history-settings-tab.history-time-span","History time span")},(0,S.t)("explore.rich-history-settings-tab.alert-info","Grafana will keep entries up to {{optionLabel}}.Starred entries won't be deleted.",{optionLabel:g?.label})),t.createElement(Se._,{label:(0,S.t)("explore.rich-history-settings-tab.change-default-tab","Change the default active tab from \u201CQuery history\u201D to \u201CStarred\u201D"),className:c.spaceBetween},t.createElement(ze.x,{id:"explore-query-history-settings-default-active-tab",value:n,onChange:r})),(0,Ye.X)().onlyActiveDataSource&&t.createElement(Se._,{label:(0,S.t)("explore.rich-history-settings-tab.only-show-active-datasource","Only show queries for data source currently active in Explore"),className:c.spaceBetween},t.createElement(ze.x,{id:"explore-query-history-settings-data-source-behavior",value:s,onChange:i})),(0,Ye.X)().clearHistory&&t.createElement("div",null,t.createElement("div",{className:c.bold},t.createElement(S.cC,{i18nKey:"explore.rich-history-settings-tab.clear-query-history"},"Clear query history")),t.createElement("div",{className:c.bottomMargin},t.createElement(S.cC,{i18nKey:"explore.rich-history-settings-tab.clear-history-info"},"Delete all of your query history, permanently.")),t.createElement(U.zx,{variant:"destructive",onClick:m},t.createElement(S.cC,{i18nKey:"explore.rich-history-settings-tab.clear-query-history-button"},"Clear query history"))))}const ai=e=>({container:(0,p.css)`
      display: flex;
    `,containerContent:(0,p.css)`
      width: 100%;
    `,selectors:(0,p.css)`
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    `,multiselect:(0,p.css)`
      width: 100%;
      margin-bottom: ${e.spacing(1)};
    `,filterInput:(0,p.css)`
      margin-bottom: ${e.spacing(1)};
    `,sort:(0,p.css)`
      width: 170px;
    `,footer:(0,p.css)`
      height: 60px;
      margin-top: ${e.spacing(3)};
      display: flex;
      justify-content: center;
      font-weight: ${e.typography.fontWeightLight};
      font-size: ${e.typography.bodySmall.fontSize};
      a {
        font-weight: ${e.typography.fontWeightMedium};
        margin-left: ${e.spacing(.25)};
      }
    `});function ri(e){const{updateFilters:o,clearRichHistoryResults:n,loadMoreRichHistory:s,activeDatasourceInstance:a,richHistorySettings:r,queries:i,totalQueries:l,loading:c,richHistorySearchFilters:g,exploreId:m}=e,d=(0,N.wW)(ai),f=(0,ce.DR)();if((0,t.useEffect)(()=>{const y=r.activeDatasourceOnly&&r.lastUsedDatasourceFilters?r.lastUsedDatasourceFilters:[a],E={search:"",sortOrder:ce.As.Descending,datasourceFilters:y,from:0,to:r.retentionPeriod,starred:!0};return o(E),()=>{n()}},[]),!g)return t.createElement("span",null,t.createElement(S.cC,{i18nKey:"explore.rich-history-starred-tab.loading"},"Loading..."),";");const h=no();return t.createElement("div",{className:d.container},t.createElement("div",{className:d.containerContent},t.createElement("div",{className:d.selectors},!r.activeDatasourceOnly&&t.createElement(Ne.NU,{className:d.multiselect,options:f.map(y=>({value:y.name,label:y.name})),value:g.datasourceFilters,placeholder:(0,S.t)("explore.rich-history-starred-tab.filter-queries-placeholder","Filter queries for data sources(s)"),"aria-label":(0,S.t)("explore.rich-history-starred-tab.filter-queries-aria-label","Filter queries for data sources(s)"),onChange:y=>{o({datasourceFilters:y.map(E=>E.value)})}}),t.createElement("div",{className:d.filterInput},t.createElement(Xn.H,{escapeRegex:!1,placeholder:(0,S.t)("explore.rich-history-starred-tab.search-queries-placeholder","Search queries"),value:g.search,onChange:y=>o({search:y})})),t.createElement("div",{"aria-label":(0,S.t)("explore.rich-history-starred-tab.sort-queries-aria-label","Sort queries"),className:d.sort},t.createElement(Ne.Ph,{value:h.filter(y=>y.value===g.sortOrder),options:h,placeholder:(0,S.t)("explore.rich-history-starred-tab.sort-queries-placeholder","Sort queries by"),onChange:y=>o({sortOrder:y.value})}))),c&&t.createElement("span",null,t.createElement(S.cC,{i18nKey:"explore.rich-history-starred-tab.loading-results"},"Loading results...")),!c&&i.map(y=>t.createElement(eo,{queryHistoryItem:y,key:y.id,exploreId:m})),i.length&&i.length!==l?t.createElement("div",null,t.createElement(S.cC,{i18nKey:"explore.rich-history-starred-tab.showing-queries",defaults:"Showing {{ shown }} of {{ total }} <0>Load more</0>",values:{shown:i.length,total:l},components:[t.createElement(U.zx,{onClick:s,key:"loadMoreButton"},"Load more")]})):null,t.createElement("div",{className:d.footer},q.config.queryHistoryEnabled?"":(0,S.t)("explore.rich-history-starred-tab.local-history-message","The history is local to your browser and is not shared with others."))))}var nn=(e=>(e.RichHistory="Query history",e.Starred="Starred",e.Settings="Settings",e))(nn||{});const no=()=>[{label:(0,S.t)("explore.rich-history.newest-first","Newest first"),value:ce.As.Descending},{label:(0,S.t)("explore.rich-history.oldest-first","Oldest first"),value:ce.As.Ascending},{label:(0,S.t)("explore.rich-history.datasource-a-z","Data source A-Z"),value:ce.As.DatasourceAZ},{label:(0,S.t)("explore.rich-history.datasource-z-a","Data source Z-A"),value:ce.As.DatasourceZA}].filter(e=>(0,Ye.X)().availableFilters.includes(e.value));function ii(e){const{richHistory:o,richHistoryTotal:n,height:s,exploreId:a,deleteRichHistory:r,onClose:i,firstTab:l,activeDatasourceInstance:c}=e,[g,m]=(0,t.useState)(!1),d=w=>{e.updateHistorySettings({...e.richHistorySettings,...w})},f=w=>{const I={...e.richHistorySearchFilters,...w,page:1};e.updateHistorySearchFilters(e.exploreId,I),h()},h=(0,j.debounce)(()=>{e.loadRichHistory(e.exploreId),m(!0)},300),y=w=>{w.value!==void 0&&d({retentionPeriod:w.value})},E=()=>d({starredTabAsFirstTab:!e.richHistorySettings.starredTabAsFirstTab}),b=()=>d({activeDatasourceOnly:!e.richHistorySettings.activeDatasourceOnly});(0,t.useEffect)(()=>{m(!1)},[o]);const v={label:(0,S.t)("explore.rich-history.query-history","Query history"),value:"Query history",content:t.createElement(ti,{queries:o,totalQueries:n||0,loading:g,updateFilters:f,clearRichHistoryResults:()=>e.clearRichHistoryResults(e.exploreId),loadMoreRichHistory:()=>e.loadMoreRichHistory(e.exploreId),activeDatasourceInstance:c,richHistorySettings:e.richHistorySettings,richHistorySearchFilters:e.richHistorySearchFilters,exploreId:a,height:s}),icon:"history"},x={label:(0,S.t)("explore.rich-history.starred","Starred"),value:"Starred",content:t.createElement(ri,{queries:o,totalQueries:n||0,loading:g,activeDatasourceInstance:c,updateFilters:f,clearRichHistoryResults:()=>e.clearRichHistoryResults(e.exploreId),loadMoreRichHistory:()=>e.loadMoreRichHistory(e.exploreId),richHistorySettings:e.richHistorySettings,richHistorySearchFilters:e.richHistorySearchFilters,exploreId:a}),icon:"star"},C={label:(0,S.t)("explore.rich-history.settings","Settings"),value:"Settings",content:t.createElement(si,{retentionPeriod:e.richHistorySettings.retentionPeriod,starredTabAsFirstTab:e.richHistorySettings.starredTabAsFirstTab,activeDatasourceOnly:e.richHistorySettings.activeDatasourceOnly,onChangeRetentionPeriod:y,toggleStarredTabAsFirstTab:E,toggleactiveDatasourceOnly:b,deleteRichHistory:r}),icon:"sliders-v-alt"};let T=[v,x,C];return t.createElement(fn.W,{tabs:T,onClose:i,defaultTab:l,closeIconTooltip:(0,S.t)("explore.rich-history.close-tooltip","Close query history")})}function li(e,{exploreId:o}){const n=e.explore,s=n.panes[o],a=s.richHistorySearchFilters,r=n.richHistorySettings,{datasourceInstance:i}=s,l=r?.starredTabAsFirstTab?nn.Starred:nn.RichHistory,{richHistory:c,richHistoryTotal:g}=s;return{richHistory:c,richHistoryTotal:g,firstTab:l,activeDatasourceInstance:i.name,richHistorySettings:r,richHistorySearchFilters:a}}const ci={initRichHistory:Ce.sO,loadRichHistory:Ce.TV,loadMoreRichHistory:Ce.io,clearRichHistoryResults:Ce.Cs,updateHistorySettings:Ce.ch,updateHistorySearchFilters:Ce.KZ,deleteRichHistory:Ce.ik},ui=(0,ye.connect)(li,ci);function di(e){const o=(0,N.l4)(),[n,s]=(0,t.useState)(o.components.horizontalDrawer.defaultHeight),{richHistory:a,richHistoryTotal:r,width:i,firstTab:l,activeDatasourceInstance:c,exploreId:g,deleteRichHistory:m,initRichHistory:d,loadRichHistory:f,loadMoreRichHistory:h,clearRichHistoryResults:y,richHistorySettings:E,updateHistorySettings:b,richHistorySearchFilters:v,updateHistorySearchFilters:x,onClose:C}=e;return(0,t.useEffect)(()=>{d(),(0,P.ff)("grafana_explore_query_history_opened",{queryHistoryEnabled:q.config.queryHistoryEnabled})},[d]),E?t.createElement(Sn,{width:i,onResize:(T,w,I)=>{s(Number(I.style.height.slice(0,-2)))}},t.createElement(ii,{richHistory:a,richHistoryTotal:r,firstTab:l,activeDatasourceInstance:c,exploreId:g,onClose:C,height:n,deleteRichHistory:m,richHistorySettings:E,richHistorySearchFilters:v,updateHistorySettings:b,updateHistorySearchFilters:x,loadRichHistory:f,loadMoreRichHistory:h,clearRichHistoryResults:y})):t.createElement("span",null,t.createElement(S.cC,{i18nKey:"explore.rich-history-container.loading"},"Loading..."))}const pi=ui(di);var hi=u(25997);const gi=e=>({containerMargin:(0,p.css)`
      display: flex;
      flex-wrap: wrap;
      gap: ${e.spacing(1)};
      margin-top: ${e.spacing(2)};
    `});function mi(e){const o=(0,N.l4)(),n=gi(o);return t.createElement("div",{className:n.containerMargin},!e.addQueryRowButtonHidden&&t.createElement(de.h,{variant:"canvas","aria-label":(0,S.t)("explore.secondary-actions.query-add-button-aria-label","Add query"),onClick:e.onClickAddQueryRowButton,disabled:e.addQueryRowButtonDisabled,icon:"plus"},t.createElement(S.cC,{i18nKey:"explore.secondary-actions.query-add-button"},"Add query")),!e.richHistoryRowButtonHidden&&t.createElement(de.h,{variant:e.richHistoryButtonActive?"active":"canvas","aria-label":(0,S.t)("explore.secondary-actions.query-history-button-aria-label","Query history"),onClick:e.onClickRichHistoryButton,"data-testid":hi.z.QueryTab.queryHistoryButton,icon:"history"},t.createElement(S.cC,{i18nKey:"explore.secondary-actions.query-history-button"},"Query history")),t.createElement(de.h,{variant:e.queryInspectorButtonActive?"active":"canvas","aria-label":(0,S.t)("explore.secondary-actions.query-inspector-button-aria-label","Query inspector"),onClick:e.onClickQueryInspectorButton,icon:"info-circle"},t.createElement(S.cC,{i18nKey:"explore.secondary-actions.query-inspector-button"},"Query inspector")))}var oo=u(24298);function fi(e,{exploreId:o}){const s=e.explore.panes[o],{tableResult:a,range:r}=s,i=(0,W.$9)(o);return{loading:a&&a.length>0?!1:i,tableResult:a,range:r}}const yi=(0,ye.connect)(fi,{});class so extends t.PureComponent{constructor(){super(...arguments),this.hasSubFrames=o=>o.fields.some(n=>n.type===Un.fS.nestedFrames)}getTableHeight(o,n){return o===0?200:Math.min(600,Math.max(o*36,n?300:0)+40+46)}getTableTitle(o,n,s){let a=n.name;return!a&&(o?.length??0)>1&&(a=n.refId||`${s}`),a?(0,S.t)("explore.table.title-with-name","Table - {{name}}",{name:a}):(0,S.t)("explore.table.title","Table")}render(){const{loading:o,onCellFilterAdded:n,tableResult:s,width:a,splitOpenFn:r,range:i,ariaLabel:l,timeZone:c,theme:g}=this.props;let m=(0,oo.yR)(s)?(0,oo.Bc)(s):s;const d=(0,Xe.qQ)(r,i);m?.length&&(m=(0,Ot.SM)({data:m,timeZone:c,theme:en.config.theme2,replaceVariables:(0,Dt.J)().replace.bind((0,Dt.J)()),fieldConfig:{defaults:{},overrides:[]},dataLinkPostProcessor:d}));const f=m?.filter(h=>!!h&&h.length!==0);return t.createElement(t.Fragment,null,f&&f.length===0&&t.createElement(Te.fm,{title:(0,S.t)("explore.table.title","Table"),width:a,height:200},()=>t.createElement(Zt,{metaItems:[{value:(0,S.t)("explore.table.no-data","0 series returned")}]})),f&&f.length>0&&t.createElement("div",{className:(0,p.css)({display:"flex",flexDirection:"column",gap:g.spacing(1)})},f.map((h,y)=>t.createElement(Te.fm,{key:h.refId||`table-${y}`,title:this.getTableTitle(m,h,y),width:a,height:this.getTableHeight(h.length,this.hasSubFrames(h)),loadingState:o?Z.Gu.Loading:void 0},(E,b)=>t.createElement(qt.i,{ariaLabel:l,data:h,width:E,height:b,onCellFilterAdded:n})))))}}const qi=(0,N.HE)(so),vi=(0,N.HE)(yi(so));var Ei=u(61117),bi=u(21477),xi=u(86450);function Si(e){const o=e.dataFrames[0],{dataFrames:n,splitOpenFn:s,exploreId:a,scrollElement:r}=e,i=(0,t.useMemo)(()=>(0,xi.N)(o),[o]),l=(0,O.useSelector)(c=>c.explore.panes[e.exploreId]?.datasourceInstance??void 0);return i?t.createElement(Ei.f,{padding:"none",title:"Trace"},t.createElement(bi.m,{exploreId:a,dataFrames:n,splitOpenFn:s,scrollElement:r,traceProp:i,datasource:l})):null}const Ci=e=>({exploreMain:(0,p.css)({label:"exploreMain",position:"relative",marginTop:"21px",display:"flex",flexDirection:"column",gap:e.spacing(1)}),queryContainer:(0,p.css)({label:"queryContainer",padding:e.spacing(1)}),exploreContainer:(0,p.css)({label:"exploreContainer",display:"flex",flexDirection:"column",paddingRight:e.spacing(2),marginBottom:e.spacing(2)}),left:(0,p.css)({marginBottom:e.spacing(2)}),wrapper:(0,p.css)({position:"absolute",top:0,left:e.spacing(2),right:0,bottom:0,display:"flex"})});var wi=(e=>(e[e.RichHistory=0]="RichHistory",e[e.QueryInspector=1]="QueryInspector",e))(wi||{});class Ri extends t.PureComponent{constructor(o){super(o),this.memoizedGetNodeGraphDataFrames=(0,Ue.Z)(So.Ee),this.onChangeTime=n=>{const{updateTimeRange:s,exploreId:a}=this.props;s({exploreId:a,rawRange:n})},this.onClickExample=n=>{this.props.setQueries(this.props.exploreId,[n])},this.onCellFilterAdded=n=>{const{value:s,key:a,operator:r}=n;r===ut.PT&&this.onClickFilterLabel(a,s),r===ut.tE&&this.onClickFilterOutLabel(a,s)},this.onContentOutlineToogle=()=>{this.setState(n=>((0,P.ff)("explore_toolbar_contentoutline_clicked",{item:"outline",type:n.contentOutlineVisible?"close":"open"}),{contentOutlineVisible:!n.contentOutlineVisible}))},this.isFilterLabelActive=async(n,s,a)=>{const r=this.props.queries.find(l=>l.refId===a);if(!r)return!1;const i=await(0,je.F)().get(r.datasource);return!!((0,G.Vw)(i)&&i.queryHasFilter(r,{key:n,value:s}))},this.onClickFilterLabel=(n,s,a)=>{this.onModifyQueries({type:"ADD_FILTER",options:{key:n,value:s},frame:a},a?.refId)},this.onClickFilterOutLabel=(n,s,a)=>{this.onModifyQueries({type:"ADD_FILTER_OUT",options:{key:n,value:s},frame:a},a?.refId)},this.onClickFilterValue=(n,s)=>{this.onModifyQueries({type:"ADD_STRING_FILTER",options:{value:n}},s)},this.onClickFilterOutValue=(n,s)=>{this.onModifyQueries({type:"ADD_STRING_FILTER_OUT",options:{value:n}},s)},this.onClickAddQueryRowButton=()=>{const{exploreId:n,queryKeys:s}=this.props;this.props.addQueryRow(n,s.length)},this.onModifyQueries=(n,s)=>{const a=async(r,i)=>{if(s&&s!==r.refId)return r;const{datasource:l}=r;if(l==null)return r;const c=await(0,je.F)().get(l),g=["ADD_FILTER","ADD_FILTER_OUT"];return(0,G.Vw)(c)&&g.includes(i.type)?c.toggleQueryFilter(r,{type:i.type==="ADD_FILTER"?"FILTER_FOR":"FILTER_OUT",options:i.options??{},frame:i.frame}):c.modifyQuery?c.modifyQuery(r,i):r};this.props.modifyQueries(this.props.exploreId,n,a)},this.onResize=n=>{this.props.changeSize(this.props.exploreId,n)},this.onStartScanning=()=>{this.props.scanStart(this.props.exploreId)},this.onStopScanning=()=>{this.props.scanStopAction({exploreId:this.props.exploreId})},this.onUpdateTimeRange=n=>{const{exploreId:s,updateTimeRange:a}=this.props;a({exploreId:s,absoluteRange:n})},this.toggleShowRichHistory=()=>{this.setState(n=>({openDrawer:n.openDrawer===0?void 0:0}))},this.toggleShowQueryInspector=()=>{this.setState(n=>({openDrawer:n.openDrawer===1?void 0:1}))},this.onSplitOpen=n=>async s=>{if(this.props.splitOpen(s),s&&this.props.datasourceInstance){const a=(await(0,je.F)().get(s.datasourceUid)).type,r=this.props.datasourceInstance.uid===it.D?(0,j.get)(this.props.queries,"0.datasource.type"):this.props.datasourceInstance.type,i={origin:"panel",panelType:n,source:r,target:a,exploreId:this.props.exploreId};(0,P.ff)("grafana_explore_split_view_opened",i)}},this.state={openDrawer:void 0,contentOutlineVisible:!1},this.graphEventBus=o.eventBus.newScopedBus("graph",{onlyLocal:!1}),this.logsEventBus=o.eventBus.newScopedBus("logs",{onlyLocal:!1})}renderEmptyState(o){return t.createElement("div",{className:(0,p.cx)(o)},t.createElement(yr,null))}renderNoData(){return t.createElement(gr,null)}renderCustom(o){const{timeZone:n,queryResponse:s,absoluteRange:a,eventBus:r}=this.props,i=(0,j.groupBy)(s?.customFrames,"meta.preferredVisualisationPluginId");return Object.entries(i).map(([l,c],g)=>t.createElement(ve,{title:l,icon:"plug",key:g},t.createElement(Vo,{key:g,timeZone:n,pluginId:l,frames:c,state:s.state,absoluteRange:a,height:400,width:o,splitOpenFn:this.onSplitOpen(l),eventBus:r})))}renderGraphPanel(o){const{graphResult:n,absoluteRange:s,timeZone:a,queryResponse:r,showFlameGraph:i}=this.props;return t.createElement(ve,{title:"Graph",icon:"graph-bar"},t.createElement(zs.F,{data:n,height:i?180:400,width:o,absoluteRange:s,timeZone:a,onChangeTime:this.onUpdateTimeRange,annotations:r.annotations,splitOpenFn:this.onSplitOpen("graph"),loadingState:r.state,eventBus:this.graphEventBus}))}renderTablePanel(o){const{exploreId:n,timeZone:s}=this.props;return t.createElement(ve,{title:"Table",icon:"table"},t.createElement(vi,{ariaLabel:lt.wl.pages.Explore.General.table,width:o,exploreId:n,onCellFilterAdded:this.onCellFilterAdded,timeZone:s,splitOpenFn:this.onSplitOpen("table")}))}renderRawPrometheus(o){const{exploreId:n,datasourceInstance:s,timeZone:a}=this.props;return t.createElement(ve,{title:"Raw Prometheus",icon:"gf-prometheus"},t.createElement($r,{showRawPrometheus:!0,ariaLabel:lt.wl.pages.Explore.General.table,width:o,exploreId:n,onCellFilterAdded:s?.modifyQuery?this.onCellFilterAdded:void 0,timeZone:a,splitOpenFn:this.onSplitOpen("table")}))}renderLogsPanel(o){const{exploreId:n,syncedTimes:s,theme:a,queryResponse:r}=this.props,i=parseInt(a.spacing(2).slice(0,-2),10),l=(0,p.css)({display:"flex",flexDirection:"column",gap:a.spacing(1)});return t.createElement(ve,{title:"Logs",icon:"gf-logs",className:l},t.createElement(dr,{exploreId:n,loadingState:r.state,syncedTimes:s,width:o-i,onClickFilterLabel:this.onClickFilterLabel,onClickFilterOutLabel:this.onClickFilterOutLabel,onStartScanning:this.onStartScanning,onStopScanning:this.onStopScanning,eventBus:this.logsEventBus,splitOpenFn:this.onSplitOpen("logs"),scrollElement:this.scrollElement,isFilterLabelActive:this.isFilterLabelActive,onClickFilterValue:this.onClickFilterValue,onClickFilterOutValue:this.onClickFilterOutValue}))}renderLogsSamplePanel(){const{logsSample:o,timeZone:n,setSupplementaryQueryEnabled:s,exploreId:a,datasourceInstance:r,queries:i}=this.props;return t.createElement(ve,{title:"Logs Sample",icon:"gf-logs"},t.createElement(pr,{queryResponse:o.data,timeZone:n,enabled:o.enabled,queries:i,datasourceInstance:r,splitOpen:this.onSplitOpen("logsSample"),setLogsSampleEnabled:l=>s(a,l,G.v8.LogsSample)}))}renderNodeGraphPanel(){const{exploreId:o,showTrace:n,queryResponse:s,datasourceInstance:a}=this.props,r=a?a?.type:"unknown";return t.createElement(ve,{title:"Node Graph",icon:"code-branch"},t.createElement(Cr,{dataFrames:this.memoizedGetNodeGraphDataFrames(s.series),exploreId:o,withTraceView:n,datasourceType:r,splitOpenFn:this.onSplitOpen("nodeGraph")}))}renderFlameGraphPanel(){const{queryResponse:o}=this.props;return t.createElement(ve,{title:"Flame Graph",icon:"fire"},t.createElement(Ds,{dataFrames:o.flameGraphFrames}))}renderTraceViewPanel(){const{queryResponse:o,exploreId:n}=this.props,s=o.series.filter(a=>a.meta?.preferredVisualisationType==="trace");return s.length&&t.createElement(ve,{title:"Traces",icon:"file-alt"},t.createElement(Si,{exploreId:n,dataFrames:s,splitOpenFn:this.onSplitOpen("traceView"),scrollElement:this.scrollElement}))}render(){const{datasourceInstance:o,exploreId:n,graphResult:s,queryResponse:a,isLive:r,theme:i,showMetrics:l,showTable:c,showRawPrometheus:g,showLogs:m,showTrace:d,showCustom:f,showNodeGraph:h,showFlameGraph:y,timeZone:E,showLogsSample:b,correlationEditorDetails:v,correlationEditorHelperData:x}=this.props,{openDrawer:C,contentOutlineVisible:T}=this.state,w=Ci(i),I=a&&a.state!==Z.Gu.NotStarted,H=C===0,M=!(0,Ye.X)().queryHistoryAvailable,A=C===1,$=a.state===Z.Gu.Done&&[a.logsFrames,a.graphFrames,a.nodeGraphFrames,a.flameGraphFrames,a.tableFrames,a.rawPrometheusFrames,a.traceFrames,a.customFrames].every(R=>R.length===0);let F;const D=v?.editorMode;return!!(D||v?.correlationDirty)&&x!==void 0&&(F=t.createElement(Po,{exploreId:n,correlations:x})),t.createElement(Co,null,t.createElement(Is,{exploreId:n,onChangeTime:this.onChangeTime,onContentOutlineToogle:this.onContentOutlineToogle,isContentOutlineOpen:T}),t.createElement("div",{style:{position:"relative",height:"100%",paddingLeft:i.spacing(2)}},t.createElement("div",{className:w.wrapper},T&&t.createElement("div",{className:w.left},t.createElement(Fo,{scroller:this.scrollElement,panelId:`content-outline-container-${n}`})),t.createElement(ct.$,{testId:lt.wl.pages.Explore.General.scrollView,scrollRefCallback:R=>this.scrollElement=R||void 0,hideHorizontalTrack:!0},t.createElement("div",{className:w.exploreContainer},o?t.createElement(t.Fragment,null,t.createElement(ve,{title:"Queries",icon:"arrow"},t.createElement(Pt.l,{className:w.queryContainer},F,t.createElement(Lr,{exploreId:n}),t.createElement(mi,{addQueryRowButtonDisabled:r||D&&o.meta.mixed,addQueryRowButtonHidden:!1,richHistoryRowButtonHidden:M,richHistoryButtonActive:H,queryInspectorButtonActive:A,onClickAddQueryRowButton:this.onClickAddQueryRowButton,onClickRichHistoryButton:this.toggleShowRichHistory,onClickQueryInspectorButton:this.toggleShowQueryInspector}),t.createElement(Wr,{exploreId:n}))),t.createElement(xo.Z,{onResize:this.onResize,disableHeight:!0},({width:R})=>R===0?null:t.createElement("main",{className:(0,p.cx)(w.exploreMain),style:{width:R}},t.createElement(oe.z4,null,I&&t.createElement(t.Fragment,null,l&&s&&t.createElement(oe.z4,null,this.renderGraphPanel(R)),g&&t.createElement(oe.z4,null,this.renderRawPrometheus(R)),c&&t.createElement(oe.z4,null,this.renderTablePanel(R)),m&&t.createElement(oe.z4,null,this.renderLogsPanel(R)),h&&t.createElement(oe.z4,null,this.renderNodeGraphPanel()),y&&t.createElement(oe.z4,null,this.renderFlameGraphPanel()),d&&t.createElement(oe.z4,null,this.renderTraceViewPanel()),b&&t.createElement(oe.z4,null,this.renderLogsSamplePanel()),f&&t.createElement(oe.z4,null,this.renderCustom(R)),$&&t.createElement(oe.z4,null,this.renderNoData())),H&&t.createElement(pi,{width:R,exploreId:n,onClose:this.toggleShowRichHistory}),A&&t.createElement(ls,{exploreId:n,width:R,onClose:this.toggleShowQueryInspector,timeZone:E}))))):this.renderEmptyState(w.exploreContainer))))))}}function Ti(e,{exploreId:o}){const n=e.explore,{syncedTimes:s}=n,a=n.panes[o],r=(0,dt.Z)(e.user),{datasourceInstance:i,queryKeys:l,queries:c,isLive:g,graphResult:m,tableResult:d,logsResult:f,showLogs:h,showMetrics:y,showTable:E,showTrace:b,showCustom:v,absoluteRange:x,queryResponse:C,showNodeGraph:T,showFlameGraph:w,showRawPrometheus:I,supplementaryQueries:H,correlationEditorHelperData:M}=a,A=(0,W.$9)(o)(e),$=H[G.v8.LogsSample],F=!!($.dataProvider!==void 0&&!f&&(m||d));return{datasourceInstance:i,queryKeys:l,queries:c,isLive:g,graphResult:m,logsResult:f??void 0,absoluteRange:x,queryResponse:C,syncedTimes:s,timeZone:r,showLogs:h,showMetrics:y,showTable:E,showTrace:b,showCustom:v,showNodeGraph:T,showRawPrometheus:I,showFlameGraph:w,splitted:(0,te.pd)(e),loading:A,logsSample:$,showLogsSample:F,correlationEditorHelperData:M,correlationEditorDetails:n.correlationEditorDetails}}const Li={changeSize:ue.qN,modifyQueries:W.sK,scanStart:W.EA,scanStopAction:W.P4,setQueries:W.KO,updateTimeRange:me.cD,addQueryRow:W.CS,splitOpen:V.bW,setSupplementaryQueryEnabled:W.z0},Fi=(0,ye.connect)(Ti,Li),Ii=(0,N.HE)(Fi(Ri)),Oi=e=>({explore:(0,p.css)`
      label: explorePaneContainer;
      display: flex;
      flex-direction: column;
      min-width: 600px;
      height: 100%;
    `});function Di({exploreId:e}){Ai(e);const o=(0,N.wW)(Oi),n=(0,t.useRef)(new At.F),s=(0,t.useRef)(null);return(0,t.useEffect)(()=>{const a=n.current;return()=>a.removeAllListeners()},[]),t.createElement(ct.$,{hideVerticalTrack:!0},t.createElement("div",{className:o.explore,ref:s,"data-testid":lt.wl.pages.Explore.General.container},t.createElement(Ii,{exploreId:e,eventBus:n.current})))}function Ni(e,o){return{pane:e.explore.panes[o.exploreId]}}const zi=(0,ye.connect)(Ni)(Di);function Ai(e){const o=(0,t.useMemo)(()=>(0,te.F9)(e),[e]),n=(0,t.useRef)();n.current=(0,O.useSelector)(o),(0,t.useEffect)(()=>()=>{(0,we.RZ)(n.current?.querySubscription)},[])}var ao=u(95454);function Pi(e){const o=(0,t.useRef)();o.current=(0,an.q)("explore");const n=(0,t.useRef)((0,Fe.ak)());(0,t.useEffect)(()=>{if(!e.panes||typeof e.panes!="string")return;let s;try{s=JSON.parse(e.panes)}catch{return}typeof s!="object"||s===null||Promise.allSettled(Object.values(s).map(a=>!a||typeof a!="object"||!ke("datasource",a)||!a.datasource||typeof a.datasource!="string"?Promise.reject():n.current.get(a.datasource))).then(a=>a.filter(Pn).map(r=>r.value)).then(a=>{if(!o.current)return;const r=a.map(i=>i.name);if(r.length===0){u.g.document.title=`${o.current.main.text} - ${ao.c.AppTitle}`;return}u.g.document.title=`${o.current.main.text} - ${r.join(" | ")} - ${ao.c.AppTitle}`})},[e.panes])}function Mi(){const{keybindings:e}=(0,We.p)(),o=(0,O.useDispatch)();(0,t.useEffect)(()=>{e.setupTimeRangeBindings(!1);const n=[];return n.push((0,ot.N$)().subscribe(st.QI,()=>{o((0,me.F9)())})),n.push((0,ot.N$)().subscribe(st.Qt,s=>{o((0,me.a1)(s.payload.direction))})),n.push((0,ot.N$)().subscribe(st.p8,s=>{o((0,me.vG)(s.payload.scale))})),()=>{n.forEach(s=>s.unsubscribe())}},[o,e])}const Hi=e=>{const o=(0,O.useDispatch)(),{width:n}=(0,_t.Z)(),s=(0,O.useSelector)(te.M),a=(0,O.useSelector)(te.pd),[r,i]=(0,t.useState)(.5),l=(0,O.useSelector)(m=>m.explore),c=m=>{const d=n/2,f=(0,j.inRange)(m,d-100,d+100);o(f?(0,V.Sx)({largerExploreId:void 0}):(0,V.Sx)({largerExploreId:m>d?s[1][0]:s[0][0]})),i(m/n)};let g=0;return a&&(!l.evenSplitPanes&&l.maxedExploreId?g=l.maxedExploreId===s[1][0]?n-e:e:l.evenSplitPanes?g=Math.floor(n/2):r!==void 0&&(g=n*r)),{updateSplitSize:c,widthCalc:g}};function $i(){const{location:e}=(0,We.p)();(0,t.useEffect)(()=>{const o=e.getSearchObject();(o.from||o.to)&&e.partial({from:void 0,to:void 0},!0)},[e])}const on=200;function Bi(e){const o=(0,N.wW)(ki),n=(0,N.l4)();$i(),la(e.queryParams),Pi(e.queryParams);const{chrome:s}=(0,We.p)(),a=(0,an.q)("explore"),{updateSplitSize:r,widthCalc:i}=Hi(on),l=(0,O.useSelector)(te.M),c=(0,O.useSelector)(te.pd),g=(0,O.useSelector)(te.z7),m=q.config.featureToggles.correlations&&(g?.editorMode||!1);return(0,t.useEffect)(()=>{s.update({sectionNav:a})},[s,a]),Mi(),t.createElement("div",{className:(0,p.cx)(o.pageScrollbarWrapper,{[o.correlationsEditorIndicator]:m})},t.createElement(bo,null),m&&t.createElement(vo,{panes:l}),t.createElement(De.U,{splitOrientation:"vertical",paneSize:i,minSize:on,maxSize:on*-1,primary:"second",splitVisible:c,parentStyle:m?{height:`calc(100% - ${n.spacing(6)}`}:{},paneStyle:{overflow:"auto",display:"flex",flexDirection:"column"},onDragFinished:d=>d&&r(d)},l.map(([d])=>t.createElement(oe.z4,{key:d,style:"page"},t.createElement(zi,{exploreId:d})))))}const ki=e=>({pageScrollbarWrapper:(0,p.css)({width:"100%",flexGrow:1,minHeight:0,height:"100%",position:"relative"}),correlationsEditorIndicator:(0,p.css)({borderLeft:`4px solid ${e.colors.primary.main}`,borderRight:`4px solid ${e.colors.primary.main}`,borderBottom:`4px solid ${e.colors.primary.main}`,overflow:"scroll"})})},23426:(sn,Ve,u)=>{u.d(Ve,{Z:()=>q});var p=u(85960),t=function(N,oe){var De=(0,p.useRef)(function(){});(0,p.useEffect)(function(){De.current=N}),(0,p.useEffect)(function(){if(oe!==null){var We=setInterval(function(){return De.current()},oe||0);return function(){return clearInterval(We)}}},[oe])};const q=t}}]);

//# sourceMappingURL=explore.62133d5d0f13ef7898a2.js.map