"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8061],{39512:(xe,H,t)=>{t.d(H,{J:()=>X,O:()=>V});var s=t(85960),e=t(8134),n=t(20989),C=t(84954),S=t(66681),z=t(47257),F=t(84933),A=t(27436),W=t(76679);function K(v){return v.name===W.GC?"Grafana":v.name.slice(0,37)}const w=({disabled:v=!1})=>{const I=(0,z.wW)(Y),{selectedAlertmanager:M,availableAlertManagers:U,setSelectedAlertmanager:L}=(0,C.ZA)(),q=(0,s.useMemo)(()=>U.map(y=>({label:K(y),value:y.name,imgUrl:y.imgUrl,meta:y.meta})),[U]);return s.createElement(F._,{className:I.field,label:v?"Alertmanager":"Choose Alertmanager",disabled:v||q.length===1,"data-testid":"alertmanager-picker"},s.createElement(A.Ph,{"aria-label":v?"Alertmanager":"Choose Alertmanager",width:29,className:"ds-picker select-container",backspaceRemovesValue:!1,onChange:y=>{y?.value&&L(y.value)},options:q,maxMenuHeight:500,noOptionsMessage:"No datasources found",value:M,getOptionLabel:y=>y.label}))},Y=v=>({field:(0,S.css)`
    margin: 0;
  `});var k=t(49199);const re=()=>s.createElement(k.b,{title:"No Alertmanager found",severity:"warning"},"We could not find any external Alertmanagers and you may not have access to the built-in Grafana Alertmanager."),oe=()=>s.createElement(k.b,{title:"Selected Alertmanager not found.",severity:"warning"},"The selected Alertmanager no longer exists or you may not have permission to access it. You can select a different Alertmanager from the dropdown."),le=({availableAlertManagers:v})=>{const I=v.length>0;return s.createElement("div",null,I?s.createElement(oe,null):s.createElement(re,null))},X=({children:v,pageId:I,pageNav:M,actions:U,isLoading:L})=>s.createElement(n.T,{pageNav:M,navId:I,actions:U},s.createElement(n.T.Contents,{isLoading:L},v)),V=({children:v,accessType:I,...M})=>{const U=J();return s.createElement(C.h5,{accessType:I},s.createElement(X,{...M,actions:s.createElement(w,{disabled:U})},s.createElement(se,null,v)))};function J(){const v=(0,e.Z)();return["/edit","/new"].some(M=>v?.pathname?.includes(M))}const se=({children:v})=>{const{availableAlertManagers:I,selectedAlertmanager:M}=(0,C.ZA)();return M?s.createElement(s.Fragment,null,v):s.createElement(le,{availableAlertManagers:I})}},8944:(xe,H,t)=>{t.d(H,{w:()=>ze,X:()=>ue});var s=t(66681),e=t(85960),n=t(10476),C=t(47257),S=t(13086),z=t(75064),F=t(20519),A=t(57445),W=t(24956),K=t(40377),w=t(96130),Y=t(5999),k=t(14607),re=t(97666),oe=t(34456),le=t(68700),X=t(92746),V=t(76679),J=t(47689),se=t(44211),v=t(68684),I=t(56375),M=t(47475),U=t(61353),L=t(29165),q=t(27436),y=t(7288),pe=t(60484),fe=t(41879),Ce=t(32737),ie=t(95162),o=t(5970),l=t(38884),u=t(9001),a=t(84237),m=t(9561);const i=()=>{const r=(0,C.wW)(R),d=()=>window.open("https://github.com/grafana/grafana/issues/42947","_blank");return e.createElement(S.K,{gap:.5},e.createElement("div",{className:r.slashNotAllowed},"Folders with '/' character are not allowed."),e.createElement(k.u,{placement:"top",content:"Link to the Github issue",theme:"info"},e.createElement(re.J,{name:"info-circle",size:"xs",className:r.infoIcon,onClick:d})))},c=r=>r.indexOf("/")!==-1;function E(r){const{value:d}=r,p={warningCondition:P=>c(P),warningComponent:i},f={disallowValues:!0,isAllowedValue:P=>!c(P)};return e.createElement(m.Fz,{showRoot:!1,rootName:"",allowEmpty:!0,initialTitle:d?.title,initialFolderUid:d?.uid,searchQueryType:ie.SearchQueryType.AlertFolder,...r,permissionLevel:ie.PermissionLevelString.Edit,customAdd:f,folderWarning:p})}const R=r=>({slashNotAllowed:(0,s.css)`
    color: ${r.colors.warning.main};
    font-size: 12px;
    margin-bottom: 2px;
  `,infoIcon:(0,s.css)`
    color: ${r.colors.warning.main};
    font-size: 12px;
    margin-bottom: 2px;
    cursor: pointer;
  `});var D=t(90943);const h=1e3,T=(r,d)=>{const g=(0,ie.useDispatch)();(0,e.useEffect)(()=>{g((0,o.UR)({rulesSourceName:V.GC}))},[g]);const f=(0,X._)(x=>x.rulerRules)[V.GC];return{groupOptions:((0,le.Zo)(V.GC).find(x=>x.name===r)?.groups??[]).map(x=>{const O=ve(x);return{label:x.name,value:x.name,description:x.interval??l.EB,isDisabled:d?!1:O,isProvisioned:O}}).sort(Ae),loading:f?.loading}},ve=r=>r.rules.some(d=>(0,u.Pc)(d.rulerRule)&&!!d.rulerRule.grafana_alert.provenance),Ae=(r,d)=>r.label?.localeCompare(d.label??"")||0,_=(r,d)=>r.label?.toLowerCase().includes(d.toLowerCase());function B({groupfoldersForGrafana:r,enableProvisionedGroups:d}){const{formState:{errors:g},watch:p,setValue:f,control:P}=(0,n.Gc)(),$=(0,C.wW)(Ie),b=p("folder"),x=p("group"),{groupOptions:O,loading:N}=T(b?.title??"",d),[me,j]=(0,e.useState)(!1),[de,Q]=(0,e.useState)(!1),te=()=>j(!0),ge=()=>Q(!0),$e=Z=>{Ge(),f("folder",Z),j(!1)},Le=(Z,ae)=>{f("group",Z),f("evaluateEvery",ae),Q(!1)},Ge=(0,e.useCallback)(()=>{f("group","")},[f]),Pe=(0,e.useCallback)(async Z=>{const ae=Z?O.filter(Fe=>_(Fe,Z)):O;return(0,I.take)(ae,h)},[O]),Be=(0,e.useMemo)(()=>(0,I.debounce)(Pe,300,{leading:!0}),[Pe]),ne=x?{value:x,label:x}:void 0;return e.createElement("div",{className:$.container},e.createElement(S.K,{alignItems:"center"},e.createElement(F.g,{label:e.createElement(A._,{htmlFor:"folder",description:"Select a folder to store your rule."},"Folder"),className:$.formInput,error:g.folder?.message,invalid:!!g.folder?.message,"data-testid":"folder-picker"},!me&&e.createElement(w.g,{render:({field:{ref:Z,...ae}})=>e.createElement("div",{style:{width:420}},e.createElement(E,{inputId:"folder",...ae,enableReset:!0,onChange:({title:Fe,uid:ye})=>{ae.onChange({title:Fe,uid:ye}),Ge()}})),name:"folder",rules:{required:{value:!0,message:"Select a folder"},validate:{pathSeparator:Z=>(0,D.p0)(Z.title)}}})||e.createElement("div",null,"Creating new folder...")),e.createElement(U.x,{marginTop:2.5,gap:1,display:"flex",alignItems:"center"},e.createElement(K.x,{color:"secondary"},"or"),e.createElement(L.zx,{onClick:te,type:"button",icon:"plus",fill:"outline",variant:"secondary",disabled:!fe.contextSrv.hasPermission(ie.AccessControlAction.FoldersCreate)},"New folder"))),me&&e.createElement(ce,{onCreate:$e,onClose:()=>j(!1)}),e.createElement(S.K,{alignItems:"center"},e.createElement("div",{style:{width:420}},e.createElement(F.g,{label:"Evaluation group","data-testid":"group-picker",description:"Rules within the same group are evaluated concurrently over the same time interval.",className:$.formInput,error:g.group?.message,invalid:!!g.group?.message},e.createElement(w.g,{render:({field:{ref:Z,...ae},fieldState:Fe})=>e.createElement(q.qb,{disabled:!b||N,inputId:"group",key:(0,I.uniqueId)(),...ae,onChange:ye=>{ae.onChange(ye.label??"")},isLoading:N,invalid:!!b&&!x&&!!Fe.error,loadOptions:Be,cacheOptions:!0,loadingMessage:"Loading groups...",defaultValue:ne,defaultOptions:O,getOptionLabel:ye=>e.createElement("div",null,e.createElement("span",null,ye.label),ye.isProvisioned&&e.createElement(e.Fragment,null," ",e.createElement(a.C0,null))),placeholder:"Select an evaluation group..."}),name:"group",control:P,rules:{required:{value:!0,message:"Must enter a group name"},validate:{pathSeparator:Z=>(0,D.p0)(Z)}}}))),e.createElement(U.x,{marginTop:4,gap:1,display:"flex",alignItems:"center"},e.createElement(K.x,{color:"secondary"},"or"),e.createElement(L.zx,{onClick:ge,type:"button",icon:"plus",fill:"outline",variant:"secondary",disabled:!b},"New evaluation group")),de&&e.createElement(Ee,{onCreate:Le,onClose:()=>Q(!1),groupfoldersForGrafana:r})))}function ce({onClose:r,onCreate:d}){const g=(0,C.wW)(Ie),[p,f]=(0,e.useState)(""),P=async()=>{const b=await(0,Ce.L6)({title:p});if(!b.uid){pe.Z.emit(M.SI.alertError,["Folder could not be created"]);return}const x={title:b.title,uid:b.uid};d(x),pe.Z.emit(M.SI.alertSuccess,["Folder Created","OK"])},$=c(p);return e.createElement(y.u,{className:g.modal,isOpen:!0,title:"New folder",onDismiss:r,onClickBackdrop:r},e.createElement("div",{className:g.modalTitle},"Create a new folder to store your rule"),e.createElement("form",{onSubmit:P},e.createElement(F.g,{label:e.createElement(A._,{htmlFor:"folder"},"Folder name"),error:"The folder name can't contain slashes",invalid:$},e.createElement(W.I,{autoFocus:!0,id:"folderName",placeholder:"Enter a name",value:p,onChange:b=>f(b.currentTarget.value),className:g.formInput})),e.createElement(y.u.ButtonRow,null,e.createElement(L.zx,{variant:"secondary",type:"button",onClick:r},"Cancel"),e.createElement(L.zx,{type:"submit",disabled:!p||$},"Create"))))}function Ee({onClose:r,onCreate:d,groupfoldersForGrafana:g}){const p=(0,C.wW)(Ie),f=()=>{d(te("group"),te("evaluateEvery"))},{watch:P}=(0,n.Gc)(),$="eval-every-input",[b,x]=P(["group","folder.title"]),O=(g&&g[x]?.find(ge=>ge.name===b)?.rules)??[],N=()=>{r()},me=(0,n.cI)({defaultValues:{group:"",evaluateEvery:""},mode:"onChange",shouldFocusError:!0}),{register:j,handleSubmit:de,formState:Q,getValues:te}=me;return e.createElement(y.u,{className:p.modal,isOpen:!0,title:"New evaluation group",onDismiss:N,onClickBackdrop:N},e.createElement("div",{className:p.modalTitle},"Create a new evaluation group to use for this alert rule."),e.createElement(n.RV,{...me},e.createElement("form",{onSubmit:de(()=>f())},e.createElement(F.g,{label:e.createElement(A._,{htmlFor:"group"},"Evaluation group name"),error:Q.errors.group?.message,invalid:!!Q.errors.group},e.createElement(W.I,{className:p.formInput,autoFocus:!0,id:"group",placeholder:"Enter a name",...j("group",{required:{value:!0,message:"Required."}})})),e.createElement(F.g,{error:Q.errors.evaluateEvery?.message,invalid:!!Q.errors.evaluateEvery,label:e.createElement(A._,{htmlFor:$,description:"How often is the rule evaluated. Applies to every rule within the group."},"Evaluation interval")},e.createElement(W.I,{className:p.formInput,id:$,placeholder:"e.g. 5m",...j("evaluateEvery",(0,v.MD)(O))})),e.createElement(y.u.ButtonRow,null,e.createElement(L.zx,{variant:"secondary",type:"button",onClick:N},"Cancel"),e.createElement(L.zx,{type:"submit",disabled:!Q.isValid},"Create")))))}const Ie=r=>({container:(0,s.css)`
    display: flex;
    flex-direction: column;
    align-items: baseline;
    max-width: ${r.breakpoints.values.lg}px;
    justify-content: space-between;
  `,formInput:(0,s.css)`
    flex-grow: 1;
  `,modal:(0,s.css)`
    width: ${r.breakpoints.values.sm}px;
  `,modalTitle:(0,s.css)`
    color: ${r.colors.text.secondary};
    margin-bottom: ${r.spacing(2)};
  `});var ee=t(25119);const Ne=[{value:ee.g0.Alerting,label:"Alerting"},{value:ee.g0.NoData,label:"No Data"},{value:ee.g0.OK,label:"OK"},{value:ee.g0.Error,label:"Error"}],he=({includeNoData:r,includeError:d,...g})=>{const p=(0,e.useMemo)(()=>r?d?Ne:Ne.filter(f=>f.value!==ee.g0.Error):Ne.filter(f=>f.value!==ee.g0.NoData),[r,d]);return e.createElement(q.Ph,{options:p,...g})};var be=t(21863),Oe=t(78985);const ue=10,Me=r=>({required:{value:!0,message:"Required."},validate:d=>{if(d==="0")return!0;try{const g=(0,J.nd)(d);if(g===0)return!0;try{const p=(0,J.nd)(r);return g>=p?!0:"For duration must be greater than or equal to the evaluation interval."}catch{return!0}}catch(g){return g instanceof Error?g.message:"Failed to parse duration"}}}),Se=(r,d)=>{const{groupOptions:g}=T(r,!1);return!(0,e.useCallback)(f=>g.some(P=>P.label===f),[g])(d)};function Re({evaluateEvery:r,setEvaluateEvery:d,enableProvisionedGroups:g}){const p=(0,C.wW)(De),{watch:f,setValue:P,getValues:$}=(0,n.Gc)(),[b,x]=(0,e.useState)(!1),[O,N]=f(["group","folder.title"]),j=(0,X._)(ne=>ne.rulerRules)[V.GC],Q=(0,le.Zo)(V.GC).find(ne=>ne.name===N),te=Q?.groups.find(ne=>ne.name===O),ge=Se(N??"",O);(0,e.useEffect)(()=>{!ge&&te?.interval&&d(te.interval)},[d,ge,P,te]);const $e=(ne=!1)=>{ne||(0,oe.PN)(oe.z7.leavingRuleGroupEdit),x(!1)},Le=()=>x(!0),Ge=j?.loading||ge||!N||!O,Pe={name:N,rulesSource:V.GC,groups:[]},Be={name:O,interval:r,rules:[],totals:{}};return e.createElement("div",null,e.createElement(B,{groupfoldersForGrafana:j?.result,enableProvisionedGroups:g}),N&&b&&e.createElement(v.vq,{namespace:Q??Pe,group:te??Be,onClose:()=>$e(),intervalEditOnly:!0,hideFolder:!0}),N&&O&&e.createElement("div",{className:p.evaluationContainer},e.createElement(S.K,{direction:"column",gap:0},e.createElement("div",{className:p.marginTop},e.createElement(S.K,{direction:"column",gap:1},$("group")&&$("evaluateEvery")&&e.createElement("span",null,"All rules in the selected group are evaluated every ",r,"."," ",!ge&&e.createElement(z.h,{name:"pen","aria-label":"Edit",disabled:Ge,onClick:Le})))))))}function Te({evaluateEvery:r}){const d=(0,C.wW)(De),{register:g,formState:{errors:p}}=(0,n.Gc)(),f="eval-for-input";return e.createElement(S.K,{direction:"row","justify-content":"flex-start","align-items":"flex-start"},e.createElement(F.g,{label:e.createElement(A._,{htmlFor:"evaluateFor",description:"Period in which an alert rule can be in breach of the condition until the alert rule fires."},"Pending period"),className:d.inlineField,error:p.evaluateFor?.message,invalid:!!p.evaluateFor?.message,validationMessageHorizontalOverflow:!0},e.createElement(W.I,{id:f,width:8,...g("evaluateFor",Me(r))})))}function G(){const r="https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rules/rule-evaluation/";return e.createElement(S.K,{direction:"row",gap:.5,alignItems:"baseline"},e.createElement(K.x,{variant:"bodySmall",color:"secondary"},"Define how the alert rule is evaluated."),e.createElement(be.h,{contentText:"Evaluation groups are containers for evaluating alert and recording rules. An evaluation group defines an evaluation interval - how often a rule is checked. Alert rules within the same evaluation group are evaluated sequentially",externalLink:r,linkText:"Read about evaluation",title:"Evaluation"}))}function ze({evaluateEvery:r,setEvaluateEvery:d,existing:g,enableProvisionedGroups:p}){const f=(0,C.wW)(De),[P,$]=(0,e.useState)(!1),{watch:b,setValue:x}=(0,n.Gc)(),O=b("isPaused");return e.createElement(Oe.z,{stepNo:3,title:"Set evaluation behavior",description:G()},e.createElement(S.K,{direction:"column","justify-content":"flex-start","align-items":"flex-start"},e.createElement(Re,{setEvaluateEvery:d,evaluateEvery:r,enableProvisionedGroups:p}),e.createElement(Te,{evaluateEvery:r}),g&&e.createElement(F.g,{htmlFor:"pause-alert-switch"},e.createElement(w.g,{render:()=>e.createElement(S.K,{gap:1,direction:"row",alignItems:"center"},e.createElement(Y.r,{id:"pause-alert",onChange:N=>{x("isPaused",N.currentTarget.checked)},value:!!O}),e.createElement("label",{htmlFor:"pause-alert",className:f.switchLabel},"Pause evaluation",e.createElement(k.u,{placement:"top",content:"Turn on to pause evaluation for this alert rule.",theme:"info"},e.createElement(re.J,{tabIndex:0,name:"info-circle",size:"sm",className:f.infoIcon})))),name:"isPaused"}))),e.createElement(se.U,{isCollapsed:!P,onToggle:N=>$(!N),text:"Configure no data and error handling"}),P&&e.createElement(e.Fragment,null,e.createElement(F.g,{htmlFor:"no-data-state-input",label:"Alert state if no data or all values are null"},e.createElement(w.g,{render:({field:{onChange:N,ref:me,...j}})=>e.createElement(he,{...j,inputId:"no-data-state-input",width:42,includeNoData:!0,includeError:!1,onChange:de=>N(de?.value)}),name:"noDataState"})),e.createElement(F.g,{htmlFor:"exec-err-state-input",label:"Alert state if execution error or timeout"},e.createElement(w.g,{render:({field:{onChange:N,ref:me,...j}})=>e.createElement(he,{...j,inputId:"exec-err-state-input",width:42,includeNoData:!1,includeError:!0,onChange:de=>N(de?.value)}),name:"execErrState"}))))}const De=r=>({inlineField:(0,s.css)`
    margin-bottom: 0;
  `,evaluateLabel:(0,s.css)`
    margin-right: ${r.spacing(1)};
  `,evaluationContainer:(0,s.css)`
    color: ${r.colors.text.secondary};
    max-width: ${r.breakpoints.values.sm}px;
    font-size: ${r.typography.size.sm};
  `,intervalChangedLabel:(0,s.css)`
    margin-bottom: ${r.spacing(1)};
  `,warningIcon:(0,s.css)`
    justify-self: center;
    margin-right: ${r.spacing(1)};
    color: ${r.colors.warning.text};
  `,infoIcon:(0,s.css)`
    margin-left: 10px;
  `,warningMessage:(0,s.css)`
    color: ${r.colors.warning.text};
  `,bold:(0,s.css)`
    font-weight: bold;
  `,alignInterval:(0,s.css)`
    margin-top: ${r.spacing(1)};
    margin-left: -${r.spacing(1)};
  `,marginTop:(0,s.css)`
    margin-top: ${r.spacing(1)};
  `,switchLabel:(0,s.css)(`
    color: ${r.colors.text.primary},
    cursor: 'pointer',
    fontSize: ${r.typography.bodySmall.fontSize},
  `)})},90943:(xe,H,t)=>{t.d(H,{p0:()=>M,Ps:()=>U,_m:()=>L,eW:()=>ie,_4:()=>fe,Fu:()=>y,Ry:()=>se,Dr:()=>I,KP:()=>Ce,Yq:()=>q});var s=t(56375),e=t(24677),n=t(37634),C=t(23757),S=t(1713),z=t(67954),F=t(34524),A=t(31476),W=t(36530),K=t(20304),w=t(84513),Y=t(18745);const k=(0,w.Z)(re,(o,l)=>J(o[0])===J(l[0]));function re(o){const l=new Y.kJ,u=o.map(a=>a.refId);return l.createNodes(u),o.forEach(a=>{const m=a.refId;((0,A.j)(a.model)&&a.model.type==="math"?oe(a.model.expression??""):[a.model.expression]).forEach(E=>{m&&E&&!(m===E)&&l.link(E,m)})}),l}function oe(o){const l=new RegExp(/\$\{(?<var>[a-zA-Z0-9_ ]+?)\}/gm),u=new RegExp(/\$(?<var>[a-zA-Z0-9_]+)/gm),a=Array.from(o.matchAll(l)).map(i=>i.groups?.var),m=Array.from(o.matchAll(u)).map(i=>i.groups?.var);return(0,s.compact)((0,s.uniq)([...a,...m]))}const le=(0,s.memoize)(X,(o,l)=>o+V(l));function X(o,l){const u=l.getNode(o);let a=[];function m(i){const c=i.inputEdges;c.length>0?c.forEach(E=>{E.inputNode&&m(E.inputNode)}):a?.push(i)}return m(u),a.map(i=>i.name)}function V(o){return Object.keys(o.nodes).map(l=>{const u=o.nodes[l];let a=u.outputEdges.map(i=>i.outputNode?.name).join(", "),m=u.inputEdges.map(i=>i.inputNode?.name).join(", ");return`${u.name}:${a}:${m}`}).join(" ")}function J(o){return o.map(l=>{const u=(0,A.j)(l.model)?l.model.type:l.queryType;return l.refId+(l.model.expression??"")+u}).join()}function se(o,l,u){return o.map(a=>{if(l===u||!(0,A.j)(a.model))return a;const m=a.model.type==="math",i=a.model.type==="reduce",c=a.model.type==="resample",E=a.model.type==="classic_conditions",R=a.model.type==="threshold";if(m)return{...a,model:{...a.model,expression:v(a.model.expression??"",l,u)}};if(c||i||R){const D=a.model.expression===l;return{...a,model:{...a.model,expression:D?u:a.model.expression}}}if(E){const D=a.model.conditions?.map(h=>({...h,query:{...h.query,params:h.query.params.map(T=>T===l?u:T)}}));return{...a,model:{...a.model,conditions:D}}}return a})}function v(o,l,u){const a=new RegExp("(\\$"+l+"\\b)|(\\${"+l+"})","gm"),m="${"+u+"}";return o.replace(a,m)}function I(o,l){return o.find(u=>u.refId===l)!==void 0}function M(o){return o.includes("/")||o.includes("\\")?'Cannot contain "/" or "\\" characters':!0}function U(o){if(o.series.length===0)return;const l=(0,e.xI)(o.series);let u;return l&&(u=new Error("You cannot use time series data as an alert condition, consider adding a reduce expression.")),u}function L(o){if(o.errors?.length)return new Error(o.errors[0].message)}function q(o){const u=(o[0]?.meta?.notices??[]).find(a=>a.severity==="warning")?.text;return u?new Error(u):void 0}function y(o){const l={},u=[W.Us.threshold,W.Us.classic];for(const i of o){if(!(0,A.j)(i.model)||!u.includes(i.model.type)||!Array.isArray(i.model.conditions))continue;const c=i.model.conditions.some(pe);i.model.conditions.forEach(E=>{const R=E.evaluator.params,D=E.query?.params[0]??i.model.expression;if(!D)return;const h=pe(E);try{const T=k(o),ve=le(D,T);o.filter(_=>ve.includes(_.refId)).forEach(_=>{const B=_.refId,Ee=!!(!(0,A.j)(_?.model)&&B);B&&!l[B]&&(l[B]={config:{mode:n.H.Absolute,steps:[]},mode:S.i3.Line}),B&&Ee&&!h&&!c?a(B,R[0]):B&&Ee&&h&&(m(B,R,E.evaluator.type),l[B].mode=S.i3.LineAndArea)})}catch(T){console.error("Failed to parse thresholds",T);return}})}function a(i,c){l[i].config.steps.push({value:-1/0,color:"transparent"},{value:c,color:z.config.theme2.colors.error.main})}function m(i,c,E){E===F.$.IsWithinRange&&l[i].config.steps.push({value:-1/0,color:"transparent"},{value:c[0],color:z.config.theme2.colors.error.main},{value:c[1],color:z.config.theme2.colors.error.main},{value:c[1],color:"transparent"}),E===F.$.IsOutsideRange&&l[i].config.steps.push({value:-1/0,color:z.config.theme2.colors.error.main},{value:c[0],color:z.config.theme2.colors.error.main},{value:c[0],color:"transparent"},{value:c[1],color:z.config.theme2.colors.error.main}),l[i].config.steps.sort((R,D)=>R.value-D.value),l[i].config.steps=l[i].config.steps.filter(R=>R.value!==void 0)}return l}function pe(o){return o.evaluator.type===F.$.IsWithinRange||o.evaluator.type===F.$.IsOutsideRange}function fe(o){const l="Failed to fetch data";if(o.state!==C.Gu.Error)return;const u=o.errors;return u?.length?u.map(a=>a.message??l).join(", "):o.error?.message??l}function Ce(o=""){return o==="recording"?K.$.cloudRecording:K.$.grafana}function ie(o,l){const u=l.filter(c=>!(0,A.j)(c.model)).map(c=>c.refId),a=o.filter(c=>!(0,A.j)(c.model)).map(c=>c.refId),[m,i]=(0,s.xor)(a,u);return[m,i]}},68684:(xe,H,t)=>{t.d(H,{vq:()=>l,MD:()=>o});var s=t(66681),e=t(56375),n=t(85960),C=t(10476),S=t(67192),z=t(47257),F=t(7288),A=t(13086),W=t(20519),K=t(57445),w=t(24956),Y=t(29165),k=t(93991),re=t(95500),oe=t(95162),le=t(92746),X=t(5970),V=t(39374),J=t(76679),se=t(30422),v=t(9001),I=t(47689),M=t(79253),U=t(90857),L=t(49199);const q=()=>n.createElement(L.b,{severity:"warning",title:"Global evalutation interval limit exceeded"},"A minimum evaluation interval of ",n.createElement("strong",null,U.config.unifiedAlerting.minInterval)," has been configured in Grafana.",n.createElement("br",null),"Please contact the administrator to configure a lower interval.");var y=t(8944);const pe=10;function fe({message:a,error:m}){return m?n.createElement(S.C,{color:"red",icon:"exclamation-circle",text:"Error",tooltip:a}):n.createElement(S.C,{color:"orange",icon:"exclamation-triangle",text:"Unknown",tooltip:a})}const Ce=a=>{try{const m=(0,I.nd)(a);return!(m<y.X*1e3||m%(y.X*1e3)!==0)}catch{return!1}},ie=({rulesWithoutRecordingRules:a})=>{const m=(0,z.wW)(u),{watch:i}=(0,C.Gc)(),c=i("groupInterval"),E=!c,R=a.slice().map((h,T)=>({id:T,data:(0,v.qd)(h,c)})).sort((h,T)=>(0,I.Bg)(h.data.forDuration)-(0,I.Bg)(T.data.forDuration)),D=(0,n.useMemo)(()=>[{id:"alertName",label:"Alert",renderCell:({data:{alertName:h}})=>n.createElement(n.Fragment,null,h),size:"330px"},{id:"for",label:"For",renderCell:({data:{forDuration:h}})=>n.createElement(n.Fragment,null,h),size:.5},{id:"numberEvaluations",label:"#Eval",renderCell:({data:{evaluationsToFire:h}})=>E?n.createElement(fe,{message:"#Evaluations not available."}):Ce(c)?h===0?n.createElement(fe,{message:"Invalid 'For' value: it should be greater or equal to evaluation interval.",error:!0}):n.createElement(n.Fragment,null,h):n.createElement(fe,{message:"Invalid evaluation interval format",error:!0}),size:.4}],[c,E]);return n.createElement("div",{className:m.tableWrapper},n.createElement(M.t,{items:R,cols:D,pagination:{itemsPerPage:pe}}))},o=a=>({required:{value:!0,message:"Required."},validate:m=>{try{const i=(0,I.nd)(m);return i<y.X*1e3?`Cannot be less than ${y.X} seconds.`:i%(y.X*1e3)!==0?`Must be a multiple of ${y.X} seconds.`:(0,X.iH)(a,m).length===0?!0:"Invalid evaluation interval. Evaluation interval should be smaller or equal to 'For' values for existing rules in this group."}catch(i){return i instanceof Error?i.message:"Failed to parse duration"}}});function l(a){const{namespace:m,group:i,onClose:c,intervalEditOnly:E}=a,R=(0,z.wW)(u),D=(0,oe.useDispatch)(),{loading:h,error:T,dispatched:ve}=(0,le._)(G=>G.updateLotexNamespaceAndGroup)??se.oq,Ae=(0,k.iG)(),_=(0,n.useMemo)(()=>({namespaceName:m.name,groupName:i.name,groupInterval:i.interval??""}),[m,i]),B=(0,J.EG)(m.rulesSource),ce=B===J.GC,Ee=ce?"Folder":"Namespace";(0,n.useEffect)(()=>{ve&&!h&&!T&&c(!0)},[ve,h,c,T]),(0,re.x)(G=>G.unifiedAlerting.updateLotexNamespaceAndGroup=se.oq);const Ie=G=>{D((0,X.hv)({rulesSourceName:B,groupName:i.name,newGroupName:G.groupName,namespaceName:m.name,newNamespaceName:G.namespaceName,groupInterval:G.groupInterval||void 0}))},ee=(0,C.cI)({mode:"onBlur",defaultValues:_,shouldFocusError:!0}),{handleSubmit:Ne,register:he,watch:be,formState:{isDirty:Oe,errors:ue}}=ee,Me=()=>{Ae.error("There are errors in the form. Correct the errors and retry.")},Se=(0,e.compact)(i.rules.map(G=>G.rulerRule).filter(G=>!(0,v.yF)(G))),Re=Se.length>0,Te=E||ce?"Edit evaluation group":"Edit namespace or evaluation group";return n.createElement(F.u,{className:R.modal,isOpen:!0,title:Te,onDismiss:c,onClickBackdrop:c},n.createElement(C.RV,{...ee},n.createElement("form",{onSubmit:G=>G.preventDefault(),key:JSON.stringify(_)},n.createElement(n.Fragment,null,!a.hideFolder&&n.createElement(A.K,{gap:1,alignItems:"center"},n.createElement(W.g,{className:R.formInput,label:n.createElement(K._,{htmlFor:"namespaceName",description:!ce&&"Change the current namespace name. Moving groups between namespaces is not supported"},Ee),invalid:!!ue.namespaceName,error:ue.namespaceName?.message},n.createElement(w.I,{id:"namespaceName",readOnly:E||ce,...he("namespaceName",{required:"Namespace name is required."})})),ce&&a.folderUrl&&n.createElement(Y.Qj,{href:a.folderUrl,title:"Go to folder",variant:"secondary",icon:"folder-open",target:"_blank"})),n.createElement(W.g,{label:n.createElement(K._,{htmlFor:"groupName"},"Evaluation group name"),invalid:!!ue.groupName,error:ue.groupName?.message},n.createElement(w.I,{autoFocus:!0,id:"groupName",readOnly:E,...he("groupName",{required:"Evaluation group name is required."})})),n.createElement(W.g,{label:n.createElement(K._,{htmlFor:"groupInterval",description:"How often is the rule evaluated. Applies to every rule within the group."},n.createElement(A.K,{gap:.5},"Evaluation interval")),invalid:!!ue.groupInterval,error:ue.groupInterval?.message},n.createElement(w.I,{id:"groupInterval",placeholder:"1m",...he("groupInterval",o(Se))})),(0,V.f)(be("groupInterval")).exceedsLimit&&n.createElement(q,null),!Re&&n.createElement("div",null,"This group does not contain alert rules."),Re&&n.createElement(n.Fragment,null,n.createElement("div",null,"List of rules that belong to this group"),n.createElement("div",{className:R.evalRequiredLabel},"#Eval column represents the number of evaluations needed before alert starts firing."),n.createElement(ie,{rulesWithoutRecordingRules:Se})),n.createElement("div",{className:R.modalButtons},n.createElement(F.u.ButtonRow,null,n.createElement(Y.zx,{variant:"secondary",type:"button",disabled:h,onClick:()=>c(!1),fill:"outline"},"Cancel"),n.createElement(Y.zx,{type:"button",disabled:!Oe||h,onClick:Ne(G=>Ie(G),Me)},h?"Saving...":"Save")))))))}const u=a=>({modal:(0,s.css)`
    max-width: 560px;
  `,modalButtons:(0,s.css)`
    top: -24px;
    position: relative;
  `,formInput:(0,s.css)`
    flex: 1;
  `,tableWrapper:(0,s.css)`
    margin-top: ${a.spacing(2)};
    margin-bottom: ${a.spacing(2)};
    height: 100%;
  `,evalRequiredLabel:(0,s.css)`
    font-size: ${a.typography.bodySmall.fontSize};
  `})},44097:(xe,H,t)=>{t.d(H,{B:()=>n});var s=t(85960),e=t(5907);function n(){return(0,s.useMemo)(()=>(0,e.Rv)(),[])}},31476:(xe,H,t)=>{t.d(H,{j:()=>n});var s=t(32063),e=t(36530);const n=C=>{if(!C)return!1;if((0,s.Pr)(C.datasource))return!0;const S=C;return typeof S.type!="string"?!1:Object.values(e.Us).includes(S.type)}}}]);

//# sourceMappingURL=8061.b0df30604dc5682d4dad.js.map