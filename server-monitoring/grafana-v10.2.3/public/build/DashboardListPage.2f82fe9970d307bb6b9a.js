"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4074],{68440:(q,N,t)=>{t.d(N,{P:()=>w});var n=t(85960),e=t(81445),b=t(27436),E=t(97666),A=t(19252),v=t(30824);const C=()=>(0,v.getGrafanaSearcher)().getSortOptions();function w({onChange:T,value:B,placeholder:U,filter:F,getSortOptions:y,isClearable:p}){const I=(0,e.Z)(async()=>{const g=await(y??C)();return F?g.filter(z=>F.includes(z.value)):g},[y,F]);if(I.loading)return null;const R=!!(B?.includes("desc")||B?.startsWith("-"));return n.createElement(b.Ph,{key:B,width:28,onChange:T,value:I.value?.find(g=>g.value===B)??null,options:I.value,"aria-label":"Sort",placeholder:U??`Sort (Default ${A.yw.label})`,prefix:n.createElement(E.J,{name:R?"sort-amount-down":"sort-amount-up"}),isClearable:p})}},37260:(q,N,t)=>{t.r(N),t.d(N,{default:()=>Nt});var n=t(66681),e=t(85960),b=t(53565),E=t(43183),A=t(47257),v=t(96535),C=t(20989),w=t(95162),T=t(55539),B=t(56375),U=t(91),F=t(36387),y=t(20994),p=t(19252),I=t(87129),R=t(30824),g=t(98547),z=t(86962);const V={query:"",tag:[],starred:!1,layout:g.A.Folders,sort:void 0,prevSort:void 0,eventTrackingNamespace:"dashboard_search"},x={sort:null,starred:null,query:null,tag:null,layout:null},ee=()=>localStorage.getItem(p.rh)===g.A.List?g.A.List:g.A.Folders;class te extends F.b{constructor(){super(...arguments),this.updateLocation=(0,B.debounce)(a=>U.E1.partial(a,!0),300),this.doSearchWithDebounce=(0,B.debounce)(()=>this.doSearch(),300),this.lastSearchTimestamp=0,this.onCloseSearch=()=>{this.updateLocation({search:null,folder:null,...x})},this.onClearSearchAndFilters=()=>{this.setStateAndDoSearch({query:"",datasource:void 0,tag:[],panel_type:void 0,starred:void 0,sort:void 0})},this.onQueryChange=a=>{this.setStateAndDoSearch({query:a})},this.onRemoveTag=a=>{this.setStateAndDoSearch({tag:this.state.tag.filter(o=>o!==a)})},this.onTagFilterChange=a=>{this.setStateAndDoSearch({tag:a})},this.onAddTag=a=>{this.state.tag&&this.state.tag.includes(a)||this.setStateAndDoSearch({tag:[...this.state.tag,a]})},this.onDatasourceChange=a=>{this.setStateAndDoSearch({datasource:a})},this.onPanelTypeChange=a=>{this.setStateAndDoSearch({panel_type:a})},this.onStarredFilterChange=a=>{const o=a.currentTarget.checked;this.setStateAndDoSearch({starred:o})},this.onClearStarred=()=>{this.setStateAndDoSearch({starred:!1})},this.onSortChange=a=>{a?localStorage.setItem(p.qb,a):localStorage.removeItem(p.qb),this.state.layout===g.A.Folders?this.setStateAndDoSearch({sort:a,layout:g.A.List}):this.setStateAndDoSearch({sort:a})},this.onLayoutChange=a=>{localStorage.setItem(p.rh,a),this.state.sort&&a===g.A.Folders?this.setStateAndDoSearch({layout:a,prevSort:this.state.sort,sort:void 0}):this.setStateAndDoSearch({layout:a,sort:this.state.prevSort})},this.onSetIncludePanels=a=>{this.setStateAndDoSearch({includePanels:a}),y.Z.set(p.to,a)},this.getTagOptions=()=>{const a=this.lastQuery??{kind:["dashboard","folder"],query:"*"};return(0,R.getGrafanaSearcher)().tags(a)},this.onSearchItemClicked=a=>{(0,I.OY)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels})},this.onReportSearchUsage=()=>{(0,I.Qw)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels})}}initStateFromUrl(a,o=!0){const r=(0,z.vj)(U.E1.getSearchObject());(r.query||r.datasource||r.panel_type)&&(r.layout=g.A.List);const l=ee(),i=localStorage.getItem(p.qb)??void 0,c=l===g.A.List?r.sort||i:null;J.setState({...V,...r,layout:l,sort:c??V.sort,prevSort:i,folderUid:a,eventTrackingNamespace:a?"manage_dashboards":"dashboard_search"}),o&&this.hasSearchFilters()&&this.doSearch()}setStateAndDoSearch(a){const o=a.sort||this.state.sort||localStorage.getItem(p.qb)||void 0;this.setState({sort:o,...a}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}hasSearchFilters(){return this.state.query||this.state.tag.length||this.state.starred||this.state.panel_type||this.state.sort||this.state.layout===g.A.List}getSearchQuery(){const a={query:this.state.query,tags:this.state.tag,ds_uid:this.state.datasource,panel_type:this.state.panel_type,location:this.state.folderUid,sort:this.state.sort,explain:this.state.explain,withAllowedActions:this.state.explain,starred:this.state.starred};return a.sort?.length&&!a.sort.includes("name")&&(a.kind=["dashboard","folder"]),a.query?.length||(a.query="*",a.location||(a.kind=["dashboard","folder"])),!this.state.includePanels&&!a.kind&&(a.kind=["dashboard","folder"]),a.panel_type?.length&&(a.kind=["panel"]),a}doSearch(){const a={layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels};(0,I.Jy)(this.state.eventTrackingNamespace,a),this.lastQuery=this.getSearchQuery(),this.setState({loading:!0});const o=(0,R.getGrafanaSearcher)(),r=Date.now();(this.state.starred?o.starred(this.lastQuery):o.search(this.lastQuery)).then(i=>{r>this.lastSearchTimestamp&&(this.setState({result:i,loading:!1}),this.lastSearchTimestamp=r)}).catch(i=>{(0,I.TP)(this.state.eventTrackingNamespace,{...a,error:i?.message}),this.setState({loading:!1})})}}let J;function re(){if(!J){const a=localStorage.getItem(p.rh)??V.layout;let o=y.Z.getBool(p.to,!0);o&&(o=!1),J=new te({...V,layout:a,includePanels:o})}return J}function Y(){const s=re();return[s.useState(),s]}var m=t(95329);function ge(s=!1){return s?(0,m.t)("search.search-input.include-panels-placeholder","Search for dashboards, folders, and panels"):(0,m.t)("search.search-input.placeholder","Search for dashboards and folders")}function le(){return(0,m.t)("search.dashboard-actions.new-dashboard","New dashboard")}function ae(){return(0,m.t)("search.dashboard-actions.new-folder","New folder")}function fe(){return(0,m.t)("search.dashboard-actions.import","Import")}function ie(){return(0,m.t)("search.dashboard-actions.new","New")}var G=t(42321),ce=t(90857),Z=t(29165),Ee=t(14607),de=t(60484),he=t(14914),S=t(65970),ve=t(28864),j=t(26986);function Ce(){const s=(0,A.wW)(ze),a=(0,w.useDispatch)(),o=(0,S.m2)(),[r]=(0,G.zu)(),[l]=(0,G.jL)(),[,i]=Y(),c=(0,e.useMemo)(()=>!ce.config.featureToggles.nestedFolders&&Object.values(o.folder).some(h=>h),[o]),u=i.hasSearchFilters(),f=()=>{a((0,S.u6)({isSelected:!1,folderUID:void 0})),u&&i.doSearchWithDebounce()},P=async()=>{await r({selectedItems:o}),Me("delete",o),f()},d=async h=>{await l({selectedItems:o,destinationUID:h}),Me("move",o),f()},M=()=>{de.Z.publish(new he.Dn({component:j._,props:{selectedItems:o,onConfirm:d}}))},O=()=>{de.Z.publish(new he.Dn({component:ve.p,props:{selectedItems:o,onConfirm:P}}))},L=e.createElement(Z.zx,{onClick:M,variant:"secondary",disabled:c},e.createElement(m.cC,{i18nKey:"browse-dashboards.action.move-button"},"Move"));return e.createElement("div",{className:s.row,"data-testid":"manage-actions"},c?e.createElement(Ee.u,{content:(0,m.t)("browse-dashboards.action.cannot-move-folders","Folders cannot be moved")},L):L,e.createElement(Z.zx,{onClick:O,variant:"destructive"},e.createElement(m.cC,{i18nKey:"browse-dashboards.action.delete-button"},"Delete")))}const ze=s=>({row:(0,n.css)({display:"flex",flexDirection:"row",gap:s.spacing(1),marginBottom:s.spacing(2)})}),Ve={move:"grafana_manage_dashboards_item_moved",delete:"grafana_manage_dashboards_item_deleted"};function Me(s,a){const o=Object.keys(a.dashboard).filter(l=>a.dashboard[l]),r=Object.keys(a.folder).filter(l=>a.folder[l]);(0,E.ff)(Ve[s],{item_counts:{folder:r.length,dashboard:o.length},source:"tree_actions"})}var ye=t(74042),se=t(55973),He=t(5106),$e=t(68440),Qe=t(82894);function Ze(){return[{value:g.A.Folders,icon:"folder",description:(0,m.t)("search.actions.view-as-folders","View by folders")},{value:g.A.List,icon:"list-ul",description:(0,m.t)("search.actions.view-as-list","View as list")}]}function Ge(s){const a=s.layout??g.A.Folders;return a===g.A.Folders&&(s.query||s.sort||s.starred||s.tag.length>0)?g.A.List:a}const Ae=({onLayoutChange:s,onSortChange:a,onStarredFilterChange:o=()=>{},onTagFilterChange:r,getTagOptions:l,getSortOptions:i,sortPlaceholder:c,onDatasourceChange:u,onPanelTypeChange:f,onSetIncludePanels:P,state:d,showStarredFilter:M,hideLayout:O})=>{const L=(0,A.wW)(je),h=Ge(d),D=d.tag.length||d.starred||d.query||d.datasource||d.panel_type?[g.A.Folders]:[];return e.createElement("div",{className:L.actionRow},e.createElement(ye.Lh,{spacing:"md",width:"auto"},e.createElement(Qe.D,{isClearable:!1,tags:d.tag,tagOptions:l,onChange:r}),ce.config.featureToggles.panelTitleSearch&&e.createElement(se.X,{"data-testid":"include-panels",disabled:h===g.A.Folders,value:d.includePanels,onChange:()=>P(!d.includePanels),label:(0,m.t)("search.actions.include-panels","Include panels")}),M&&e.createElement("div",{className:L.checkboxWrapper},e.createElement(se.X,{label:(0,m.t)("search.actions.starred","Starred"),onChange:o,value:d.starred})),d.datasource&&e.createElement(Z.zx,{icon:"times",variant:"secondary",onClick:()=>u(void 0)},e.createElement(m.cC,{i18nKey:"search.actions.remove-datasource-filter"},"Datasource: ",{datasource:d.datasource})),d.panel_type&&e.createElement(Z.zx,{icon:"times",variant:"secondary",onClick:()=>f(void 0)},"Panel: ",d.panel_type)),e.createElement(ye.Lh,{spacing:"md",width:"auto"},!O&&e.createElement(He.S,{options:Ze(),disabledOptions:D,onChange:s,value:h}),e.createElement($e.P,{onChange:H=>a(H?.value),value:d.sort,getSortOptions:i,placeholder:c||(0,m.t)("search.actions.sort-placeholder","Sort"),isClearable:!0})))};Ae.displayName="ActionRow";const je=s=>({actionRow:(0,n.css)`
      display: none;

      ${s.breakpoints.up("md")} {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: ${s.spacing(2)};
        width: 100%;
      }
    `,checkboxWrapper:(0,n.css)`
      label {
        line-height: 1.2;
      }
    `});function Xe(){const[s,a]=Y();return e.createElement("div",null,e.createElement(Ae,{showStarredFilter:!0,state:s,getTagOptions:a.getTagOptions,getSortOptions:(0,R.getGrafanaSearcher)().getSortOptions,sortPlaceholder:(0,R.getGrafanaSearcher)().sortPlaceholder,includePanels:s.includePanels??!1,onLayoutChange:a.onLayoutChange,onStarredFilterChange:a.onStarredFilterChange,onSortChange:a.onSortChange,onTagFilterChange:a.onTagFilterChange,onDatasourceChange:a.onDatasourceChange,onPanelTypeChange:a.onPanelTypeChange,onSetIncludePanels:a.onSetIncludePanels}))}var Je=t(11318),Ye=t(64409),ke=t(76910),W=(s=>(s[s.Unselected=0]="Unselected",s[s.Selected=1]="Selected",s[s.Mixed=2]="Mixed",s))(W||{}),_e=t(36226),qe=t(403),et=t(54563),tt=t(23757),ne=t(92369);function at({row:{original:s},isSelected:a,onItemSelectionChange:o}){const r=(0,A.wW)(st),l=s.item;if(!a)return e.createElement("span",{className:r.checkboxSpacer});if(l.kind==="ui")return l.uiKind==="pagination-placeholder"?e.createElement(se.X,{disabled:!0,value:!1}):e.createElement("span",{className:r.checkboxSpacer});const i=a(l);return e.createElement(se.X,{"data-testid":ne.wl.pages.BrowseDashboards.table.checkbox(l.uid),"aria-label":(0,m.t)("browse-dashboards.dashboards-tree.select-checkbox","Select"),value:i===W.Selected,indeterminate:i===W.Mixed,onChange:c=>o?.(l,c.currentTarget.checked)})}const st=s=>({checkboxSpacer:(0,n.css)({paddingLeft:s.spacing(2)})});function nt({isSelected:s,onAllSelectionChange:a}){const o=s?.("$all")??W.Unselected;return e.createElement(se.X,{value:o===W.Selected,indeterminate:o===W.Mixed,"aria-label":(0,m.t)("browse-dashboards.dashboards-tree.select-all-header-checkbox","Select all"),onChange:r=>{o===W.Mixed?a?.(!1):a?.(r.currentTarget.checked)}})}var ot=t(34785),Te=t(40377),rt=t(75064),lt=t(75682),Ie=t(97666),it=t(59672),Oe=t(53193),ct=t(75169),Le=t(40604);function we(s,a){return s+a.uid}const pe="md",Be="sm";function dt({row:{original:s},onFolderClick:a,treeID:o}){const r=(0,A.wW)(ht),{item:l,level:i,isOpen:c}=s,u=(0,S.$H)(),f=c&&!u[l.uid],P=(0,ct.J6)(s.item.kind,c);return l.kind==="ui"?e.createElement(e.Fragment,null,e.createElement(Le.A,{level:i,spacing:{xs:1,md:3}}),e.createElement("span",{className:r.folderButtonSpacer}),l.uiKind==="empty-folder"?e.createElement("em",{className:r.emptyText},e.createElement(Te.x,{variant:"body",color:"secondary",truncate:!0},"No items")):e.createElement(ot.Z,{width:200})):e.createElement(e.Fragment,null,e.createElement(Le.A,{level:i,spacing:{xs:1,md:3}}),l.kind==="folder"?e.createElement(rt.h,{size:pe,className:r.chevron,onClick:()=>{a(l.uid,!c)},name:c?"angle-down":"angle-right","aria-label":c?(0,m.t)("browse-dashboards.dashboards-tree.collapse-folder-button","Collapse folder {{title}}",{title:l.title}):(0,m.t)("browse-dashboards.dashboards-tree.expand-folder-button","Expand folder {{title}}",{title:l.title})}):e.createElement("span",{className:r.folderButtonSpacer}),e.createElement("div",{className:r.iconNameContainer},f?e.createElement(lt.$,{size:Be}):e.createElement(Ie.J,{size:Be,name:P}),e.createElement(Te.x,{variant:"body",truncate:!0,id:o&&we(o,l)},l.url?e.createElement(it.r,{onClick:()=>{(0,E.ff)("manage_dashboards_result_clicked")},href:l.url,className:r.link},l.title):l.title)))}const ht=s=>({chevron:(0,n.css)({marginRight:s.spacing(1),width:(0,Oe.Bm)(pe)}),emptyText:(0,n.css)({overflow:"hidden"}),folderButtonSpacer:(0,n.css)({paddingLeft:`calc(${(0,Oe.Bm)(pe)}px + ${s.spacing(1)})`}),iconNameContainer:(0,n.css)({alignItems:"center",display:"flex",gap:s.spacing(1),overflow:"hidden"}),link:(0,n.css)({"&:hover":{textDecoration:"underline"}})});var Fe=t(7042);function ut({row:{original:s}}){const a=(0,A.wW)(mt),o=s.item;return o.kind==="ui"?o.uiKind==="pagination-placeholder"?e.createElement(Fe.P.Skeleton,null):null:o.tags?e.createElement(Fe.P,{className:a.tagList,tags:o.tags}):null}function mt(s){return{tagList:(0,n.css)({justifyContent:"flex-start",flexWrap:"nowrap"})}}var gt=t(30672);const Re=36,xe=36;function ft({items:s,width:a,height:o,isSelected:r,onFolderClick:l,onAllSelectionChange:i,onItemSelectionChange:c,isItemLoaded:u,requestLoadMore:f,canSelect:P=!1}){const d=(0,e.useId)(),M=(0,e.useRef)(null),O=(0,A.wW)(We);(0,e.useEffect)(()=>{M.current&&M.current.resetloadMoreItemsCache(!0)},[s]);const L=(0,e.useMemo)(()=>{const $={id:"checkbox",width:0,Header:nt,Cell:at},_={id:"name",width:3,Header:e.createElement("span",{style:{paddingLeft:24}},e.createElement(m.cC,{i18nKey:"browse-dashboards.dashboards-tree.name-column"},"Name")),Cell:Pe=>e.createElement(dt,{...Pe,onFolderClick:l})},oe={id:"tags",width:2,Header:(0,m.t)("browse-dashboards.dashboards-tree.tags-column","Tags"),Cell:ut};return[P&&$,_,oe].filter(tt.fQ)},[l,P]),h=(0,_e.useTable)({columns:L,data:s},gt._),{getTableProps:D,getTableBodyProps:H,headerGroups:X}=h,K=(0,e.useMemo)(()=>({table:h,isSelected:r,onAllSelectionChange:i,onItemSelectionChange:c,treeID:d}),[h,r,i,c,s,d]),Q=(0,e.useCallback)($=>u($),[u]),me=(0,e.useCallback)(($,_)=>{const{parentUID:oe}=s[$];f(oe)},[f,s]);return e.createElement("div",{...D(),role:"table"},X.map($=>{const{key:_,...oe}=$.getHeaderGroupProps({style:{width:a}});return e.createElement("div",{key:_,...oe,className:(0,n.cx)(O.row,O.headerRow)},$.headers.map(Se=>{const{key:Pe,...Ut}=Se.getHeaderProps();return e.createElement("div",{key:Pe,...Ut,role:"columnheader",className:O.cell},Se.render("Header",{isSelected:r,onAllSelectionChange:i}))}))}),e.createElement("div",{...H(),"data-testid":ne.wl.pages.BrowseDashboards.table.body},e.createElement(et.Z,{ref:M,itemCount:s.length,isItemLoaded:Q,loadMoreItems:me},({onItemsRendered:$,ref:_})=>e.createElement(qe.t7,{ref:_,height:o-Re,width:a,itemCount:s.length,itemData:K,itemSize:xe,onItemsRendered:$},Et))))}function Et({index:s,style:a,data:o}){const r=(0,A.wW)(We),{table:l,isSelected:i,onItemSelectionChange:c,treeID:u}=o,{rows:f,prepareRow:P}=l,d=f[s];return P(d),e.createElement("div",{...d.getRowProps({style:a}),className:(0,n.cx)(r.row,r.bodyRow),"aria-labelledby":we(u,d.original.item),"data-testid":ne.wl.pages.BrowseDashboards.table.row("title"in d.original.item?d.original.item.title:d.original.item.uid)},d.cells.map(M=>{const{key:O,...L}=M.getCellProps();return e.createElement("div",{key:O,...L,className:r.cell},M.render("Cell",{isSelected:i,onItemSelectionChange:c,treeID:u}))}))}const We=s=>({row:(0,n.css)({gap:s.spacing(1)}),headerRow:(0,n.css)({backgroundColor:s.colors.background.secondary,height:Re}),bodyRow:(0,n.css)({height:xe,"&:hover":{backgroundColor:s.colors.emphasize(s.colors.background.primary,.03)}}),cell:(0,n.css)({padding:s.spacing(1),overflow:"hidden",display:"flex",alignItems:"center"}),link:(0,n.css)({"&:hover":{textDecoration:"underline"}})});function vt({folderUID:s,width:a,height:o,canSelect:r}){const l=(0,S.zw)(s),i=(0,w.useDispatch)(),c=(0,S.Sk)(s),u=(0,S.aw)(),f=(0,S.$H)(),P=(0,e.useCallback)((h,D)=>{i((0,S.xm)({folderUID:h,isOpen:D})),D&&i((0,S.si)({parentUID:h,pageSize:ke.IV}))},[i]),d=(0,e.useCallback)((h,D)=>{i((0,S.wk)({item:h,isSelected:D}))},[i]),M=(0,e.useCallback)(h=>{if(h==="$all"){if(u.$all)return W.Selected;for(const X of Object.values(u))if(typeof X!="boolean"){for(const K in X)if(X[K])return W.Mixed}return W.Unselected}return u[h.kind][h.uid]?W.Selected:Ke(h,f,u)?W.Mixed:W.Unselected},[u,f]),O=(0,e.useCallback)(h=>{const D=c[h];if(!D)return!1;const H=D.item;return!(H.kind==="ui"&&H.uiKind==="pagination-placeholder")},[c]),L=(0,S.D$)();return l==="fulfilled"&&c.length===0?e.createElement("div",{style:{width:a}},r?e.createElement(Ye.Z,{title:s?"This folder doesn't have any dashboards yet":"No dashboards yet. Create your first!",buttonIcon:"plus",buttonTitle:"Create Dashboard",buttonLink:s?`dashboard/new?folderUid=${s}`:"dashboard/new",proTip:s&&"Add/move dashboards to your folder at ->",proTipLink:s&&"dashboards",proTipLinkTitle:s&&"Browse dashboards",proTipTarget:""}):e.createElement(Je._,{callToActionElement:e.createElement("span",null,"This folder is empty")})):e.createElement(ft,{canSelect:r,items:c,width:a,height:o,isSelected:M,onFolderClick:P,onAllSelectionChange:h=>i((0,S.u6)({isSelected:h,folderUID:s})),onItemSelectionChange:d,isItemLoaded:O,requestLoadMore:L})}function Ke(s,a,o){const r=a[s.uid];return r?r.items.some(l=>{const i=o[l.kind][l.uid];return i||Ke(l,a,o)}):!1}var Ct=t(30694),yt=t(54635),De=t(69707),pt=t(44839),Dt=t(63153),bt=t(66596),St=t(20519),Pt=t(24956),Mt=t(5192);const At={folderName:""};function Tt({onCancel:s,onConfirm:a}){const o=(0,m.t)("browse-dashboards.action.new-folder-name-required-phrase","Folder name is required."),r=async i=>{try{return await Mt.t.validateNewFolderName(i),!0}catch(c){if(c instanceof Error)return c.message;throw c}},l=(0,m.t)("browse-dashboards.new-folder-form.name-label","Folder name");return e.createElement(bt.l,{defaultValues:At,onSubmit:i=>a(i.folderName),"data-testid":ne.wl.pages.BrowseDashboards.NewFolderForm.form},({register:i,errors:c})=>e.createElement(e.Fragment,null,e.createElement(St.g,{label:l,invalid:!!c.folderName,error:c.folderName&&c.folderName.message},e.createElement(Pt.I,{"data-testid":ne.wl.pages.BrowseDashboards.NewFolderForm.nameInput,id:"folder-name-input",...i("folderName",{required:o,validate:async u=>await r(u)})})),e.createElement(ye.Lh,null,e.createElement(Z.zx,{variant:"secondary",fill:"outline",onClick:s},e.createElement(m.cC,{i18nKey:"browse-dashboards.new-folder-form.cancel-label"},"Cancel")),e.createElement(Z.zx,{type:"submit"},e.createElement(m.cC,{i18nKey:"browse-dashboards.new-folder-form.create-label"},"Create")))))}function It({parentFolder:s,canCreateDashboard:a,canCreateFolder:o}){const[r,l]=(0,e.useState)(!1),i=(0,Ct.TH)(),[c]=(0,G.wo)(),[u,f]=(0,e.useState)(!1),P=async M=>{try{await c({title:M,parentUid:s?.uid});const O=s?.parents?s.parents.length+1:0;(0,E.ff)("grafana_manage_dashboards_folder_created",{is_subfolder:!!s?.uid,folder_depth:O})}finally{f(!1)}},d=e.createElement(yt.v,null,a&&e.createElement(De.s,{label:le(),onClick:()=>(0,E.ff)("grafana_menu_item_clicked",{url:ue("/dashboard/new",s?.uid),from:i.pathname}),url:ue("/dashboard/new",s?.uid)}),o&&e.createElement(De.s,{onClick:()=>f(!0),label:ae()}),a&&e.createElement(De.s,{label:fe(),onClick:()=>(0,E.ff)("grafana_menu_item_clicked",{url:ue("/dashboard/import",s?.uid),from:i.pathname}),url:ue("/dashboard/import",s?.uid)}));return e.createElement(e.Fragment,null,e.createElement(pt.L,{overlay:d,onVisibleChange:l},e.createElement(Z.zx,null,ie(),e.createElement(Ie.J,{name:r?"angle-up":"angle-down"}))),u&&e.createElement(Dt.d,{title:ae(),subtitle:s?.title?`Location: ${s.title}`:void 0,onClose:()=>f(!1),size:"sm"},e.createElement(Tt,{onConfirm:P,onCancel:()=>f(!1)})))}function ue(s,a){return a?s+"?folderUid="+a:s}var Ot=t(73575),Lt=t(73891),wt=t(45878),be=t(72435),Bt=t(40865),Ft=t(57544);const k=50,Rt={view:new Lt.U((0,wt.g0)({fields:[{name:"uid",display:!0,values:Array(k).fill(null)},{name:"kind",display:!0,values:Array(k).fill("dashboard")},{name:"name",display:!0,values:Array(k).fill("")},{name:"location",display:!0,values:Array(k).fill("")},{name:"tags",display:!0,values:Array(k).fill([])}],meta:{custom:{locationInfo:[]}}})),loadMoreItems:()=>Promise.resolve(),isItemLoaded:()=>!1,totalRows:k};function xt({width:s,height:a,canSelect:o}){const r=(0,w.useDispatch)(),l=(0,w.useSelector)(h=>h.browseDashboards.selectedItems),i=(0,S.QD)(),{keyboardEvents:c}=(0,Bt.A)(),[u,f]=Y(),P=u.result??Rt,d=(0,e.useCallback)((h,D)=>h?h==="*"&&D==="*"?i:h==="*"?!1:l[Ne(h)][D]??!1:!1,[l,i]),M=(0,e.useCallback)(()=>{r((0,S.u6)({isSelected:!1,folderUID:void 0}))},[r]),O=(0,e.useCallback)((h,D)=>{const H=!d(h,D);r((0,S.wk)({item:{kind:Ne(h),uid:D},isSelected:H}))},[d,r]);if(P.totalRows===0)return e.createElement("div",{style:{width:s}},e.createElement(be.Z,null,e.createElement(be.Z.Heading,null,e.createElement(m.cC,{i18nKey:"browse-dashboards.no-results.text"},"No results found for your query.")),e.createElement(be.Z.Actions,null,e.createElement(Z.zx,{variant:"secondary",onClick:f.onClearSearchAndFilters},e.createElement(m.cC,{i18nKey:"browse-dashboards.no-results.clear"},"Clear search and filters")))));const L={response:P,selection:o?d:void 0,selectionToggle:o?O:void 0,clearSelection:M,width:s,height:a,onTagSelected:f.onAddTag,keyboardEvents:c,onDatasourceChange:u.datasource?f.onDatasourceChange:void 0,onClickItem:f.onSearchItemClicked};return e.createElement(Ft.Q,{...L})}function Ne(s){switch(s){case"folder":return"folder";case"dashboard":return"dashboard";case"panel":return"panel"}throw new Error("Unsupported kind"+s)}var Wt=t(50240);const Ue=(0,e.memo)(({match:s})=>{const{uid:a}=s.params,o=(0,w.useDispatch)(),r=(0,A.wW)(Kt),[l,i]=Y(),c=i.hasSearchFilters();(0,e.useEffect)(()=>{i.initStateFromUrl(a),o((0,S.u6)({isSelected:!1,folderUID:void 0}))},[o,a,i]),(0,e.useEffect)(()=>{!c&&l.result&&i.setState({result:void 0,includePanels:void 0})},[c,l.result,i]);const{data:u}=(0,G.t4)(a??G.CN),[f]=(0,G.vN)(),P=(0,e.useMemo)(()=>{if(!u)return;const K=(0,T.B1)(u),Q=(0,T.Pr)(u.uid),me=K.children?.find($=>$.id===Q);return me&&(me.active=!0),K},[u]),d=(0,S.QD)(),{canEditFolders:M,canEditDashboards:O,canCreateDashboards:L,canCreateFolders:h}=(0,Wt.a)(u),D=M&&a,H=M||O,X=async K=>{if(u){const Q=await f({...u,title:K});if("error"in Q)throw(0,E.ff)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_with_error",error:Q.error}),Q.error;(0,E.ff)("grafana_browse_dashboards_page_edit_folder_name",{status:"success"})}else(0,E.ff)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_no_folderDTO"})};return e.createElement(C.T,{navId:"dashboards/browse",pageNav:P,onEditTitle:D?X:void 0,actions:e.createElement(e.Fragment,null,u&&e.createElement(Ot.A,{folder:u}),(L||h)&&e.createElement(It,{parentFolder:u,canCreateDashboard:L,canCreateFolder:h}))},e.createElement(C.T.Contents,{className:r.pageContents},e.createElement(v.H,{placeholder:ge(l.includePanels),value:l.query,escapeRegex:!1,onChange:K=>i.onQueryChange(K)}),d?e.createElement(Ce,null):e.createElement(Xe,null),e.createElement("div",{className:r.subView},e.createElement(b.Z,null,({width:K,height:Q})=>c?e.createElement(xt,{canSelect:H,width:K,height:Q}):e.createElement(vt,{canSelect:H,width:K,height:Q,folderUID:a})))))}),Kt=s=>({pageContents:(0,n.css)({display:"grid",gridTemplateRows:"auto auto 1fr",height:"100%",rowGap:s.spacing(1)}),subView:(0,n.css)({height:"100%"})});Ue.displayName="BrowseDashboardsPage";const Nt=Ue},28864:(q,N,t)=>{t.d(N,{p:()=>B});var n=t(85960),e=t(98181),b=t(90857),E=t(77980),A=t(40377),v=t(49199),C=t(95329),w=t(42321),T=t(46569);const B=({onConfirm:U,onDismiss:F,selectedItems:y,...p})=>{const{data:I}=(0,w.zs)(y),R=!b.config.featureToggles.nestedFolders&&I&&(I.alertRule||I.libraryPanel),[g,z]=(0,n.useState)(!1),V=async()=>{z(!0);try{await U(),z(!1),F()}catch{z(!1)}};return n.createElement(E.s,{body:n.createElement(n.Fragment,null,n.createElement(A.x,{element:"p"},n.createElement(C.cC,{i18nKey:"browse-dashboards.action.delete-modal-text"},"This action will delete the following content:")),n.createElement(T.X,{selectedItems:y}),n.createElement(e.T,{v:2})),description:n.createElement(n.Fragment,null,R?n.createElement(v.b,{severity:"warning",title:(0,C.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder")},n.createElement(C.cC,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text"},"One or more folders contain library panels or alert rules. Delete these first in order to proceed.")):null),confirmationText:"Delete",confirmText:g?(0,C.t)("browse-dashboards.action.deleting","Deleting..."):(0,C.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:F,onConfirm:V,title:(0,C.t)("browse-dashboards.action.delete-modal-title","Delete"),...p})}},26986:(q,N,t)=>{t.d(N,{_:()=>U});var n=t(85960),e=t(98181),b=t(7288),E=t(49199),A=t(40377),v=t(20519),C=t(29165),w=t(19461),T=t(95329),B=t(46569);const U=({onConfirm:F,onDismiss:y,selectedItems:p,...I})=>{const[R,g]=(0,n.useState)(),[z,V]=(0,n.useState)(!1),x=Object.keys(p.folder).filter(te=>p.folder[te]),ee=async()=>{if(R!==void 0){V(!0);try{await F(R),V(!1),y()}catch{V(!1)}}};return n.createElement(b.u,{title:(0,T.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:y,...I},x.length>0&&n.createElement(E.b,{severity:"info",title:(0,T.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),n.createElement(A.x,{element:"p"},n.createElement(T.cC,{i18nKey:"browse-dashboards.action.move-modal-text"},"This action will move the following content:")),n.createElement(B.X,{selectedItems:p}),n.createElement(e.T,{v:3}),n.createElement(v.g,{label:(0,T.t)("browse-dashboards.action.move-modal-field-label","Folder name")},n.createElement(w.E,{value:R,excludeUIDs:x,onChange:g})),n.createElement(b.u.ButtonRow,null,n.createElement(C.zx,{onClick:y,variant:"secondary",fill:"outline"},n.createElement(T.cC,{i18nKey:"browse-dashboards.action.cancel-button"},"Cancel")),n.createElement(C.zx,{disabled:R===void 0||z,onClick:ee,variant:"primary"},z?(0,T.t)("browse-dashboards.action.moving","Moving..."):(0,T.t)("browse-dashboards.action.move-button","Move"))))}},73575:(q,N,t)=>{t.d(N,{A:()=>V});var n=t(85960),e=t(90857),b=t(43183),E=t(91),A=t(54635),v=t(69707),C=t(44839),w=t(29165),T=t(97666),B=t(63153),U=t(88879),F=t(49683),y=t(95329),p=t(14914),I=t(42321),R=t(50240),g=t(28864),z=t(26986);function V({folder:x}){const[ee,te]=(0,n.useState)(!1),[J,re]=(0,n.useState)(!1),[Y]=(0,I.OH)(),[m]=(0,I.yC)(),{canEditFolders:ge,canDeleteFolders:le,canViewPermissions:ae,canSetPermissions:fe}=(0,R.a)(x),ie=e.config.featureToggles.nestedFolders&&ge,G=async j=>{await Y({folder:x,destinationUID:j}),(0,b.ff)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},ce=async()=>{await m(x),(0,b.ff)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:j}=x,Ce=j&&j.length?j[j.length-1].url:"/dashboards";E.E1.push(Ce)},Z=()=>{F.h$.publish(new p.Dn({component:z._,props:{selectedItems:{folder:{[x.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:G}}))},Ee=()=>{F.h$.publish(new p.Dn({component:g.p,props:{selectedItems:{folder:{[x.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:ce}}))},de=(0,y.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),he=(0,y.t)("browse-dashboards.folder-actions-button.move","Move"),S=(0,y.t)("browse-dashboards.folder-actions-button.delete","Delete"),ve=n.createElement(A.v,null,ae&&n.createElement(v.s,{onClick:()=>re(!0),label:de}),ie&&n.createElement(v.s,{onClick:Z,label:he}),le&&n.createElement(v.s,{destructive:!0,onClick:Ee,label:S}));return!ae&&!ie&&!le?null:n.createElement(n.Fragment,null,n.createElement(C.L,{overlay:ve,onVisibleChange:te},n.createElement(w.zx,{variant:"secondary"},n.createElement(y.cC,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions"},"Folder actions"),n.createElement(T.J,{name:ee?"angle-up":"angle-down"}))),J&&n.createElement(B.d,{title:(0,y.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:x.title,onClose:()=>re(!1),size:"md"},n.createElement(U.P,{resource:"folders",resourceId:x.uid,canSetPermissions:fe})))}},50240:(q,N,t)=>{t.d(N,{a:()=>A});var n=t(90857),e=t(49683),b=t(95162);function E(v,C){return C?e.Vt.hasPermissionInMetadata(v,C):e.Vt.hasPermission(v)}function A(v){const C=E(b.AccessControlAction.DashboardsCreate,v),w=!!((!v||n.config.featureToggles.nestedFolders)&&E(b.AccessControlAction.FoldersCreate)),T=E(b.AccessControlAction.FoldersDelete,v),B=E(b.AccessControlAction.DashboardsWrite,v),U=E(b.AccessControlAction.FoldersWrite,v),F=E(b.AccessControlAction.FoldersPermissionsWrite,v),y=E(b.AccessControlAction.FoldersPermissionsRead,v);return{canCreateDashboards:C,canCreateFolders:w,canDeleteFolders:T,canEditDashboards:B,canEditFolders:U,canSetPermissions:F,canViewPermissions:y}}}}]);

//# sourceMappingURL=DashboardListPage.2f82fe9970d307bb6b9a.js.map