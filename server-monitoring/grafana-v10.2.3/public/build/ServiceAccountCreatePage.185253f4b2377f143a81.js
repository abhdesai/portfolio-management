"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9738],{14598:(K,_,n)=>{n.r(_),n.d(_,{ServiceAccountCreatePage:()=>A,default:()=>T});var t=n(85960),d=n(85445),R=n(91),v=n(66596),C=n(51637),u=n(20519),D=n(24956),I=n(29165),P=n(20989),M=n(84184),g=n(80932),o=n(49683),r=n(95162),p=n(95831);const U=async c=>{const l=await(0,d.i)().post("/api/serviceaccounts/",c);return await o.Vt.fetchUserPermissions(),l},f=async(c,l)=>(0,d.i)().patch(`/api/serviceaccounts/${c}`,l),A=({})=>{const[c,l]=(0,t.useState)([]),[E,h]=(0,t.useState)([]),m=o.Vt.user.orgId,[s,B]=(0,t.useState)({id:0,orgId:o.Vt.user.orgId,role:o.Vt.licensedAccessControlEnabled()?r.OrgRole.None:r.OrgRole.Viewer,tokens:0,name:"",login:"",isDisabled:!1,createdAt:"",teams:[]});(0,t.useEffect)(()=>{async function a(){try{if(o.Vt.hasPermission(r.AccessControlAction.ActionRolesList)){let e=await(0,g.ul)(m);l(e)}}catch(e){console.error("Error loading options",e)}}o.Vt.licensedAccessControlEnabled()&&a()},[m]);const L=(0,t.useCallback)(async a=>{a.role=s.role;const e=await U(a);try{const i={avatarUrl:e.avatarUrl,id:e.id,isDisabled:e.isDisabled,login:e.login,name:e.name,orgId:e.orgId,role:e.role,tokens:e.tokens};await f(e.id,a),o.Vt.licensedAccessControlEnabled()&&o.Vt.hasPermission(r.AccessControlAction.ActionUserRolesAdd)&&o.Vt.hasPermission(r.AccessControlAction.ActionUserRolesRemove)&&await(0,g.hB)(E,i.id,i.orgId)}catch(i){console.error(i)}R.E1.push(`/org/serviceaccounts/${e.id}`)},[s.role,E]),O=a=>{B({...s,role:a})},W=(a,e,i)=>{h(a)};return t.createElement(P.T,{navId:"serviceaccounts",pageNav:{text:"Create service account"}},t.createElement(P.T.Contents,null,t.createElement(v.l,{onSubmit:L,validateOn:"onSubmit"},({register:a,errors:e})=>t.createElement(t.Fragment,null,t.createElement(C.C,null,t.createElement(u.g,{label:"Display name",required:!0,invalid:!!e.name,error:e.name?"Display name is required":void 0},t.createElement(D.I,{id:"display-name-input",...a("name",{required:!0}),autoFocus:!0})),t.createElement(u.g,{label:"Role"},o.Vt.licensedAccessControlEnabled()?t.createElement(M.R,{apply:!0,userId:s.id||0,orgId:s.orgId,basicRole:s.role,onBasicRoleChange:O,roleOptions:c,onApplyRoles:W,pendingRoles:E,maxWidth:"100%"}):t.createElement(p.A,{"aria-label":"Role",value:s.role,onChange:O}))),t.createElement(I.zx,{type:"submit"},"Create")))))},T=A}}]);

//# sourceMappingURL=ServiceAccountCreatePage.185253f4b2377f143a81.js.map