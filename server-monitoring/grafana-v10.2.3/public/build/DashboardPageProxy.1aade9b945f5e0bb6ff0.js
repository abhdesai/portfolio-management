"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8443],{2315:(Ce,V,o)=>{o.d(V,{E:()=>U,z:()=>e});const e=()=>({type:"query",query:{params:["A","5m","now"]},reducer:{type:"avg",params:[]},evaluator:{type:"gt",params:[null]},operator:{type:"and"}}),U=async(b,F,K,S)=>{if(F.length===0)return"Could not find any metric queries";if(b&&b.length)return"Transformations are not supported in alert queries";let m=0,R=0;for(const M of F){const k=M.datasource||S,h=await K.get(k);h.meta.alerting?h.targetContainsTemplate&&h.targetContainsTemplate(M)&&R++:m++}return m===F.length?"The datasource does not support alerting queries":R===F.length?"Template variables are not supported in alert queries":""}},5429:(Ce,V,o)=>{o.r(V),o.d(V,{DashboardScenePage:()=>m,default:()=>R});var e=o(85960),U=o(5836),b=o(20989),F=o(55415),K=o(95162),S=o(51012);function m({match:M,route:k}){const h=(0,S.wc)(),{dashboard:y,isLoading:C,loadError:$}=h.useState();return(0,e.useEffect)(()=>(k.routeName===K.DashboardRoutes.Home?h.loadDashboard(k.routeName):h.loadDashboard(M.params.uid),()=>{h.clearState()}),[h,M.params.uid,k.routeName]),y?e.createElement(y.Component,{model:y}):e.createElement(b.T,{layout:U.Q.Canvas,"data-testid":"dashboard-scene-page"},C&&e.createElement(F.Z,null),$&&e.createElement("h2",null,$))}const R=m},34601:(Ce,V,o)=>{o.r(V),o.d(V,{default:()=>bo});var e=o(85960),U=o(81445),b=o(90857),F=o(5429),K=o(51012),S=o(95162),m=o(66681),R=o(36752),M=o(5836),k=o(12693),h=o(92369),y=o(91),C=o(47257),$=o(88492),W=o(20989),j=o(1225),En=o(6005),ot=o(93991);function yn(t){switch(t.kiosk){case"tv":return S.KioskMode.TV;case"1":case!0:return S.KioskMode.Full;default:return null}}var it=o(87947),lt=o(60829),re=o(43183),q=o(49199),ct=o(52248);const bn="grafana.angularDeprecation.dashboardNotice.isDismissed";function Cn(t){return bn+"."+t}function Pn({dashboardUid:t}){return e.createElement(ct.G,{storageKey:Cn(t),defaultValue:!1},(n,a)=>n?null:e.createElement("div",null,e.createElement(q.b,{severity:"warning",title:"This dashboard depends on Angular, which is deprecated and will stop working in future releases of Grafana.",onRemove:()=>{(0,re.ff)("angular_deprecation_notice_dismissed"),a(!0)}},e.createElement("div",{className:"markdown-html"},e.createElement("ul",null,e.createElement("li",null,e.createElement("a",{href:"https://grafana.com/docs/grafana/latest/developers/angular_deprecation/",className:"external-link",target:"_blank",rel:"noreferrer"},"Read our deprecation notice and migration advice.")))))))}var Co=o(55635);function Po(t){const n=t.match.params.slug??"",a=useAsync(()=>getGrafanaStorage().list("content/"+n),[n]),s=n.length>0?`g/${n}/`:"g/",r=dt(n),i=()=>a.value?a.value.fields[0].values.map(d=>{let u=d;const p=u.indexOf(".")<0,g=!p&&u.endsWith(".json"),f=`${s}${u}`;return React.createElement(Card,{key:u,href:p||g?f:void 0},React.createElement(Card.Heading,null,u),React.createElement(Card.Figure,null,React.createElement(Icon,{name:p?"folder":g?"gf-grid":"file-alt",size:"sm"})))}):a.loading?React.createElement(Spinner,null):React.createElement("div",null,"?"),c=ut();return React.createElement(Page,{navModel:c,pageNav:r},i())}function dt(t){const n=t.split("/");let a=[],s="g",r;for(let i=0;i<n.length;i++)s+=`/${n[i]}`,a.push({text:n[i],url:s,parentItem:r}),r=a[a.length-1];return r}function ut(){return{main:{text:"C:"},node:{text:"Content",url:"/g"}}}const To=null;var Z=o(14914),pt=o(99165),Tn=o(10805),Y=o(7288),se=o(24956),X=o(97666),oe=o(50263),Pe=o(64524),Sn=o(88566),mt=o(99602);const xn=()=>{const t=(0,C.wW)(Dn),[n,a]=(0,e.useState)(""),s=(0,S.useSelector)(l=>l.dashboard.getModel()),r=(0,e.useMemo)(()=>(0,mt.Ry)(),[]),i=(0,e.useMemo)(()=>(0,mt.rw)(r,n),[r,n]),c=()=>{y.E1.partial({addWidget:null})};return e.createElement(Y.u,{title:"Select widget type",closeOnEscape:!0,closeOnBackdropClick:!0,isOpen:!0,className:t.modal,onClickBackdrop:c,onDismiss:c},e.createElement(se.I,{type:"search",autoFocus:!0,className:t.searchInput,value:n,prefix:e.createElement(X.J,{name:"search"}),placeholder:"Search widget",onChange:l=>{a(l.currentTarget.value)}}),e.createElement(oe.$,null,e.createElement("div",{className:t.grid},i.map((l,d)=>e.createElement(Sn.u,{disabled:!1,key:l.id,isCurrent:!1,plugin:l,onClick:u=>{const p=(0,Pe.AI)(s,l.id);y.E1.partial({editPanel:p,addWidget:null})}})))))},Dn=t=>({modal:(0,m.css)`
    width: 65%;
    max-width: 960px;

    ${t.breakpoints.down("md")} {
      width: 100%;
    }
  `,searchInput:(0,m.css)`
    margin-bottom: ${t.spacing(2)};
  `,grid:(0,m.css)`
    display: grid;
    grid-gap: ${t.spacing(1)};
  `});var wn=o(52171),In=o(18888),Nn=o(87860),_=o(56375),Fe=o(30694),gt=o(93349),On=o(60484),Te=o(41879),Rn=o(27160),w=o(29165),An=o(1706),Mn=o(37565),$n=o(90499);const ht=({panel:t,folderUid:n,isUnsavedPrompt:a,onDismiss:s,onConfirm:r,onDiscard:i})=>{const[c,l]=(0,e.useState)(""),d=(0,U.Z)(async()=>{const T=await(0,An.E8)(t.libraryPanel.uid);return T.length>0?T.map(I=>I.title):[]},[t.libraryPanel.uid]),[u,p]=(0,e.useState)([]);(0,Rn.Z)(()=>d.value?p(d.value.filter(T=>T.toLowerCase().includes(c.toLowerCase()))):p([]),300,[d.value,c]);const{saveLibraryPanel:g}=(0,$n.E)(),f=(0,C.wW)(Mn.J),v=(0,e.useCallback)(()=>{i()},[i]),E=a?"Unsaved library panel changes":"Save library panel";return e.createElement(Y.u,{title:E,icon:"save",onDismiss:s,isOpen:!0},e.createElement("div",null,e.createElement("p",{className:f.textInfo},"This update will affect ",e.createElement("strong",null,t.libraryPanel.meta?.connectedDashboards," ",t.libraryPanel.meta?.connectedDashboards===1?"dashboard":"dashboards","."),"The following dashboards using the panel will be affected:"),e.createElement(se.I,{className:f.dashboardSearch,prefix:e.createElement(X.J,{name:"search"}),placeholder:"Search affected dashboards",value:c,onChange:T=>l(T.currentTarget.value)}),d.loading?e.createElement("p",null,"Loading connected dashboards..."):e.createElement("table",{className:f.myTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Dashboard name"))),e.createElement("tbody",null,u.map((T,I)=>e.createElement("tr",{key:`dashrow-${I}`},e.createElement("td",null,T))))),e.createElement(Y.u.ButtonRow,null,e.createElement(w.zx,{variant:"secondary",onClick:s,fill:"outline"},"Cancel"),a&&e.createElement(w.zx,{variant:"destructive",onClick:v},"Discard"),e.createElement(w.zx,{onClick:()=>{g(t,n).then(()=>{r()})}},"Update all"))))};var Ln=o(98898),We=o(20994),Ue=o(8808),Se=o(29100),ft=o(79248),J=o(53301);function Fn(t,n){return async a=>{const s=n.initEditPanel(t);a((0,J.Hl)({panel:s,sourcePanel:t}))}}function vt(){return async(t,n)=>{const{getPanel:a}=n().panelEditor;a().configRev=0,t((0,J.yi)(!0))}}function Wn(t,n){return a=>{if(t.libraryPanel?.uid===void 0||!n)return;const s=t.getSaveModel();for(const r of n.panels){if(Un(t,r))continue;r.restoreModel({...s,...(0,_.pick)(r,"gridPos","id")});const i=r.plugin?.meta.id!==t.plugin?.meta.id;r.plugin=t.plugin,r.configRev++,i&&(r.generateNewKey(),a((0,ft.bc)({key:r.key,plugin:r.plugin}))),setTimeout(()=>{r.getQueryRunner().useLastResultFrom(t.getQueryRunner())},20)}t.repeat&&setTimeout(()=>n.processRepeats(),20)}}function Un(t,n){return!!(n.libraryPanel?.uid!==t.libraryPanel.uid||n.id&&n.id===t.id||n.repeatPanelId)}function zn(){return async(t,n)=>{const a=n().dashboard.getModel(),{getPanel:s,getSourcePanel:r,shouldDiscardChanges:i}=n().panelEditor,c=s();a&&a.exitPanelEditor();const l=r();if(Bn(c)&&!i){const d=c.getSaveModel(),u=l.type!==c.type;t(Wn(c,a)),l.restoreModel(d),l.configRev++,u&&(l.plugin=c.plugin,l.generateNewKey(),await t((0,ft.bc)({key:l.key,plugin:c.plugin}))),setTimeout(()=>{l.getQueryRunner().useLastResultFrom(c.getQueryRunner()),l.render(),c.hasSavedPanelEditChange&&!c.hasChanged&&(l.configRev=0)},20)}l.isNew&&(i?a&&(0,Ue.WJ)(a,l,!0):delete l.isNew),t((0,Se.qj)(c.key)),t((0,J.my)())}}function Bn(t){return t.hasChanged||t.hasSavedPanelEditChange||t.isAngularPlugin()}function ze(t){return(n,a)=>{const s={...a().panelEditor.ui,...t};n((0,J.K9)(s));try{We.Z.setObject(J.jy,s)}catch(r){console.error(r)}}}var Vn=o(82179);const kn=({dashboard:t,onSaveSuccess:n,onDiscard:a,onDismiss:s})=>e.createElement(Y.u,{isOpen:!0,title:"Unsaved changes",onDismiss:s,icon:"exclamation-triangle",className:(0,m.css)`
        width: 500px;
      `},e.createElement("h5",null,"Do you want to save your changes?"),e.createElement(Y.u.ButtonRow,null,e.createElement(w.zx,{variant:"secondary",onClick:s,fill:"outline"},"Cancel"),e.createElement(w.zx,{variant:"destructive",onClick:a},"Discard"),e.createElement(Vn.i,{dashboard:t,onSaveSuccess:n}))),Et=e.memo(({dashboard:t})=>{const[n,a]=(0,e.useState)({original:null}),s=(0,S.useDispatch)(),{original:r,originalPath:i}=n,{showModal:c,hideModal:l}=(0,e.useContext)(gt.kr);(0,e.useEffect)(()=>{const u=setTimeout(()=>{const g=y.E1.getLocation().pathname,f=t.getSaveModelCloneOld();a({originalPath:g,original:f})},1e3),p=On.h.subscribe(Z.Jd,()=>{const g=t.getSaveModelCloneOld();a({originalPath:i,original:g})});return()=>{clearTimeout(u),p.unsubscribe()}},[t,i]),(0,e.useEffect)(()=>{const u=p=>{yt(t,r)||Ct(t,r)&&(p.preventDefault(),p.returnValue="")};return window.addEventListener("beforeunload",u),()=>window.removeEventListener("beforeunload",u)},[t,r]);const d=u=>{const p=t.panelInEdit,g=new URLSearchParams(u.search);return p&&p.libraryPanel&&p.hasChanged&&!g.has("editPanel")?(c(ht,{isUnsavedPrompt:!0,panel:t.panelInEdit,folderUid:t.meta.folderUid??"",onConfirm:()=>{l(),xe(u)},onDiscard:()=>{s(vt()),xe(u),l()},onDismiss:l}),!1):i===u.pathname||!r?(p&&!g.has("editPanel")&&s(zn()),!0):yt(t,r)||!Ct(t,r)?!0:(c(kn,{dashboard:t,onSaveSuccess:()=>{l(),xe(u)},onDiscard:()=>{a({...n,original:null}),l(),xe(u)},onDismiss:l}),!1)};return e.createElement(Fe.NL,{when:!0,message:d})});Et.displayName="DashboardPrompt";function xe(t){t&&setTimeout(()=>y.E1.push(t),10)}function yt(t,n){if(!n||n.version===0||!Te.contextSrv.isSignedIn||!t)return!0;const{canSave:a,fromScript:s,fromFile:r}=t.meta;return!Te.contextSrv.isEditor&&!a?!0:!a||s||r}function bt(t){const n=new Ln.f(t);n.expandRows();const a=n.getSaveModelClone();if(delete a.time,a.refresh="",a.schemaVersion=0,delete a.timezone,a.panels=[],a.templating?.list)for(const s of a.templating.list)delete s.current,delete s.options,delete s.filters;return a}function Ct(t,n){if(t.hasUnsavedChanges())return!0;const a=bt(t.getSaveModelCloneOld()),s=bt(n),r=(0,_.find)(a.nav,{type:"timepicker"}),i=(0,_.find)(s.nav,{type:"timepicker"});r&&i&&(r.now=i.now);const c=JSON.stringify(a,null),l=JSON.stringify(s,null);return c!==l}var Hn=o(68114),z=o(48116),De=o(6537),we=o(53565),Pt=o(81223),Ie=o(63153),de=o(13086),Gn=o(34364),Be=o(70523),ue=o(94439),Kn=o(75682),ie=o(20519),Tt=o(27436),Ve=o(55855),jn=o(62577),L=o(74042),ee=o(5999),Zn=o(78344),Jn=o.n(Zn),Qn=o(12537),Ne=o(1930),Yn=o(36387),Xn=o(47390),le=o(45864),qn=o(27008),St=o(24024),xt=o(71851),pe=(t=>(t[t.Support=0]="Support",t[t.Data=1]="Data",t))(pe||{}),Oe=(t=>(t[t.PanelSnapshot=0]="PanelSnapshot",t[t.GithubComment=1]="GithubComment",t))(Oe||{});class _n extends Yn.b{constructor(n){super({panel:n,panelTitle:n.replaceVariables(n.title,void 0,"text")||"Panel",currentTab:0,showMessage:1,snapshotText:"",markdownText:"",randomize:{},snapshotUpdate:0,options:[{label:"GitHub comment",description:"Copy and paste this message into a GitHub issue or comment",value:1},{label:"Panel support snapshot",description:"Dashboard JSON used to help troubleshoot visualization issues",value:0}]}),this.onCurrentTabChange=a=>{this.setState({currentTab:a})},this.onShowMessageChange=a=>{this.setState({showMessage:a.value})},this.onGetMarkdownForClipboard=()=>{const{markdownText:a}=this.state,s=Math.pow(1024,2)*1.5;return a.length>s?(this.setState({error:{title:"Copy to clipboard failed",message:"Snapshot is too large, consider download and attaching a file instead"}}),""):a},this.onDownloadDashboard=()=>{const{snapshotText:a,panelTitle:s}=this.state,r=new Blob([a],{type:"text/plain"}),i=`debug-${s}-${(0,Qn.dq)(new Date)}.json.txt`;Jn()(r,i)},this.onSetSnapshotText=a=>{this.setState({snapshotText:a})},this.onToggleRandomize=a=>{const{randomize:s}=this.state;this.setState({randomize:{...s,[a]:!s[a]}})},this.onPreviewDashboard=()=>{const{snapshot:a}=this.state;a&&((0,St.$M)({meta:{},dashboard:a}),o.g.open(b.config.appUrl+"dashboard/new","_blank"))}}async buildDebugDashboard(){const{panel:n,randomize:a,snapshotUpdate:s}=this.state,r=await(0,xt.$R)(n,a,(0,le.$t)().timeRange()),i=JSON.stringify(r,null,2),c=(0,xt.S$)(n,i),l=(0,Ne.zc)((0,Ne.Cf)("bytes")(i?.length??0));let d;if(!n.isAngularPlugin())try{const u=new qn.f(r);d=(0,Xn.Yz)(u).state.body}catch(u){console.log("Error creating scene:",u)}this.setState({snapshot:r,snapshotText:i,markdownText:c,snapshotSize:l,snapshotUpdate:s+1,scene:d})}}function ea({panel:t,plugin:n,onClose:a}){const s=(0,C.wW)(ta),r=(0,e.useMemo)(()=>new _n(t),[t]),{currentTab:i,loading:c,error:l,options:d,showMessage:u,snapshotSize:p,markdownText:g,snapshotText:f,randomize:v,panelTitle:E,scene:T}=r.useState();if((0,e.useEffect)(()=>{r.buildDebugDashboard()},[r,n,v]),!n)return null;const I=[{label:"Snapshot",value:pe.Support},{label:"Data",value:pe.Data}],N=b.config.supportBundlesEnabled&&Te.contextSrv.hasPermission(S.AccessControlAction.ActionSupportBundlesCreate);return e.createElement(Ie.d,{title:"Get help with this panel",size:"lg",onClose:a,subtitle:e.createElement(de.K,{direction:"column",gap:1},e.createElement(de.K,{direction:"row",gap:1},e.createElement(Gn.a,{featureState:Pt.CQ.beta}),e.createElement("a",{href:"https://grafana.com/docs/grafana/latest/troubleshooting/",target:"blank",className:"external-link",rel:"noopener noreferrer"},"Troubleshooting docs ",e.createElement(X.J,{name:"external-link-alt"}))),e.createElement("span",{className:"muted"},"To request troubleshooting help, send a snapshot of this panel to Grafana Labs Technical Support. The snapshot contains query response data and panel settings."),N&&e.createElement("span",{className:"muted"},"You can also retrieve a support bundle containing information concerning your Grafana instance and configured datasources in the ",e.createElement("a",{href:"/support-bundles"},"support bundles section"),".")),tabs:e.createElement(Be.J,null,I.map((P,ae)=>e.createElement(ue.O,{key:`${P.value}-${ae}`,label:P.label,active:P.value===i,onChangeTab:()=>r.onCurrentTabChange(P.value)})))},c&&e.createElement(Kn.$,null),l&&e.createElement(q.b,{title:l.title},l.message),i===pe.Data&&e.createElement("div",{className:s.code},e.createElement("div",{className:s.opts},e.createElement(ie.g,{label:"Template",className:s.field},e.createElement(Tt.Ph,{options:d,value:u,onChange:r.onShowMessageChange})),u===Oe.GithubComment?e.createElement(Ve.m,{icon:"copy",getText:r.onGetMarkdownForClipboard},"Copy to clipboard"):e.createElement(w.zx,{icon:"download-alt",onClick:r.onDownloadDashboard},"Download (",p,")")),e.createElement(we.Z,{disableWidth:!0},({height:P})=>e.createElement(jn.p,{width:"100%",height:P,language:u===Oe.GithubComment?"markdown":"json",showLineNumbers:!0,showMiniMap:!0,value:u===Oe.GithubComment?g:f,readOnly:!1,onBlur:r.onSetSnapshotText}))),i===pe.Support&&e.createElement(e.Fragment,null,e.createElement(ie.g,{label:"Randomize data",description:"Modify the original data to hide sensitve information.  Note the lengths will stay the same, and duplicate values will be equal."},e.createElement(L.Lh,null,e.createElement(ee.x,{label:"Labels",id:"randomize-labels",showLabel:!0,value:!!v.labels,onChange:()=>r.onToggleRandomize("labels")}),e.createElement(ee.x,{label:"Field names",id:"randomize-field-names",showLabel:!0,value:!!v.names,onChange:()=>r.onToggleRandomize("names")}),e.createElement(ee.x,{label:"String values",id:"randomize-string-values",showLabel:!0,value:!!v.values,onChange:()=>r.onToggleRandomize("values")}))),e.createElement(ie.g,{label:"Support snapshot",description:`Panel: ${E}`},e.createElement(de.K,null,e.createElement(w.zx,{icon:"download-alt",onClick:r.onDownloadDashboard},"Dashboard (",p,")"),e.createElement(Ve.m,{icon:"github",getText:r.onGetMarkdownForClipboard,title:"Copy a complete GitHub comment to the clipboard"},"Copy to clipboard"),e.createElement(w.zx,{onClick:r.onPreviewDashboard,variant:"secondary",title:"Open support snapshot dashboard in a new tab"},"Preview"))),e.createElement(we.Z,{disableWidth:!0},({height:P})=>e.createElement("div",{style:{height:P,overflow:"auto"}},T&&e.createElement(T.Component,{model:T})))))}const ta=t=>({code:(0,m.css)`
    flex-grow: 1;
    height: 100%;
    overflow: scroll;
  `,field:(0,m.css)`
    width: 100%;
  `,opts:(0,m.css)`
    display: flex;
    display: flex;
    width: 100%;
    flex-grow: 0;
    align-items: center;
    justify-content: flex-end;

    button {
      margin-left: 8px;
    }
  `});var ke=o(23757);const He=(t,n,a)=>{const s=(0,e.useRef)(),[r,i]=(0,e.useState)();return(0,e.useEffect)(()=>{let c=-1,l=0;return s.current=t.getQueryRunner().getData({withTransforms:n.withTransforms,withFieldConfig:!1}).subscribe({next:d=>{if(a){if(c===d.structureRev){const u=Date.now();if(u-l<1e4)return;l=u}c=d.structureRev??-1}i(d)}}),()=>{s.current&&s.current.unsubscribe()}},[t,n.withTransforms]),{data:r,isLoading:r?.state===ke.Gu.Loading,hasSeries:r?!!r.series:!1,hasError:!!(r&&(r.error||r?.errors?.length||r.state===ke.Gu.Error))}};var Ge=o(12399),me=o(95329),na=o(16826),aa=o(46715),ra=o(3902);const sa=({data:t,metadataDatasource:n})=>!n||!n.components?.MetadataInspector?e.createElement(me.cC,{i18nKey:"dashboard.inspect-meta.no-inspector"},"No Metadata Inspector"):e.createElement(n.components.MetadataInspector,{datasource:n,data:t.series});var oa=o(73536),ia=o(97577);const la=({panel:t,plugin:n,dashboard:a,tabs:s,data:r,isDataLoading:i,dataOptions:c,metadataDatasource:l,defaultTab:d,onDataOptionsChange:u,onClose:p})=>{const[g,f]=(0,e.useState)(d??z.q.Data);if(!n)return null;let v=ca(r),E=g;s.find(N=>N.value===g)||(E=z.q.JSON);const T=(0,Ge.J)().replace(t.title,t.scopedVars,"text")||"Panel",I=(0,me.t)("dashboard.inspect.title","Inspect: {{panelTitle}}",{panelTitle:T});return e.createElement(Ie.d,{title:I,subtitle:r&&da(r),onClose:p,tabs:e.createElement(Be.J,null,s.map((N,P)=>e.createElement(ue.O,{key:`${N.value}-${P}`,label:N.label,active:N.value===E,onChangeTab:()=>f(N.value||z.q.Data)})))},E===z.q.Data&&e.createElement(na.E,{dataName:t.getDisplayTitle(),panelPluginId:t.type,fieldConfig:t.fieldConfig,hasTransformations:!!t.transformations?.length,data:r&&r.series,isLoading:i,options:c,onOptionsChange:u,timeZone:a.timezone,app:Pt.zj.Dashboard}),r&&E===z.q.Meta&&e.createElement(sa,{data:r,metadataDatasource:l}),E===z.q.JSON&&e.createElement(ra.W,{panel:t,dashboard:a,data:r,onClose:p}),E===z.q.Error&&e.createElement(aa.l,{errors:v}),r&&E===z.q.Stats&&e.createElement(oa.f,{data:r,timeZone:a.getTimezone()}),r&&E===z.q.Query&&e.createElement(ia.D,{data:r,onRefreshQuery:()=>t.refresh()}))};function ca(t){let n=t?.errors??[];return t?.error&&!n.includes(t.error)&&(n=[t.error,...n]),!n.length&&t?.state===ke.Gu.Error?[{message:"Error loading data"}]:n}function da(t){const{request:n}=t;if(!n||(0,_.isEmpty)(n))return"";const a=n.targets.length,s=n.endTime?n.endTime-n.startTime:0,r=(0,Ne.zc)((0,Ne.Cf)("ms")(s));return e.createElement(me.cC,{i18nKey:"dashboard.inspect.subtitle"},{queryCount:a}," queries with total query time of ",{formatted:r})}var Dt=o(10798);const ua=({panel:t,dashboard:n,plugin:a})=>{const s=(0,Fe.TH)(),r=new URLSearchParams(s.search).get("inspectTab"),[i,c]=(0,e.useState)({withTransforms:r===z.q.Error,withFieldConfig:!0}),{data:l,isLoading:d,hasError:u}=He(t,i,!1),p=(0,Dt.pV)(l),g=(0,Dt.WM)(t,n,a,u,p),f=()=>{y.E1.partial({inspect:null,inspectTab:null})};return a?r===z.q.Help?e.createElement(ea,{panel:t,plugin:a,onClose:f}):e.createElement(la,{dashboard:n,panel:t,plugin:a,defaultTab:r,tabs:g,data:l,isDataLoading:d,dataOptions:i,onDataOptionsChange:c,metadataDatasource:p,onClose:f}):null},pa=(t,n)=>{const a=(0,De.i)(t,n.panel);return a?{plugin:a.plugin}:{plugin:null}},ma=(0,R.connect)(pa)(ua);var wt=o(34269),Re=o(5106),Ke=o(40235),ga=o(19424),It=o(33808),ha=o(37870),Nt=o(93160),fa=o(49683),je=o(50595),ge=o(14607),va=o(25648),Ea=o(74539);const ya=t=>{const n=(0,e.useMemo)(()=>va.z.get(t.variable.type).picker,[t.variable]);return t.variable?e.createElement("div",{className:"gf-form"},e.createElement(ba,{variable:t.variable}),t.variable.hide!==je.bU.hideVariable&&n&&e.createElement(n,{variable:t.variable,readOnly:t.readOnly??!1})):e.createElement("div",null,"Couldn't load variable")};function ba({variable:t}){const n=(0,e.useMemo)(()=>t.label||t.name,[t]);if(t.hide!==je.bU.dontHide)return null;const a=Ea.IG+t.id;return t.description?e.createElement(ge.u,{content:t.description,placement:"bottom"},e.createElement("label",{className:"gf-form-label gf-form-label--variable","data-testid":h.wl.pages.Dashboard.SubMenu.submenuItemLabels(n),htmlFor:a},n)):e.createElement("label",{className:"gf-form-label gf-form-label--variable","data-testid":h.wl.pages.Dashboard.SubMenu.submenuItemLabels(n),htmlFor:a},n)}const Ot=({variables:t,readOnly:n})=>{const[a,s]=(0,e.useState)([]);return(0,e.useEffect)(()=>{s(t.filter(r=>r.hide!==je.bU.hideVariable))},[t]),a.length===0?null:e.createElement(e.Fragment,null,a.map(r=>e.createElement("div",{key:r.id,className:"submenu-item gf-form-inline","data-testid":h.wl.pages.Dashboard.SubMenu.submenuItem},e.createElement(ya,{variable:r,readOnly:n}))))};var Ca=o(21644),Pa=o(53685),he=o(12404),Ze=o(59084),Ta=o(33964),Sa=o(7628),xa=o(58434),Rt=o(96535),Da=o(91032),At=o(92289);function wa(t,n){We.Z.set(`panel-edit-section-${t}`,n?"true":"false")}function Ia(t,n){return We.Z.getBool(`panel-edit-section-${t}`,n)}const Mt=(t,n)=>({angularPanelComponent:(0,De.i)(t,n.panel)?.angularComponent}),$t={changePanelPlugin:Se.Kc},So=(0,R.connect)(Mt,$t);class Na extends e.PureComponent{constructor(n){super(n)}componentDidMount(){this.loadAngularOptions()}componentDidUpdate(n){(this.props.plugin!==n.plugin||this.props.angularPanelComponent!==n.angularPanelComponent)&&this.cleanUpAngularOptions(),this.loadAngularOptions()}componentWillUnmount(){this.cleanUpAngularOptions()}cleanUpAngularOptions(){this.angularOptions&&(this.angularOptions.destroy(),this.angularOptions=null)}loadAngularOptions(){const{panel:n,angularPanelComponent:a,changePanelPlugin:s}=this.props;if(!this.element||!a||this.angularOptions)return;const r=a.getScope();if(!r.$$childHead){setTimeout(()=>{this.forceUpdate()});return}const i=r.$$childHead.ctrl;i.initEditMode(),i.onPluginTypeChange=u=>{s({panel:n,pluginId:u.id})};let c="";for(let u=0;u<i.editorTabs.length;u++){const p=i.editorTabs[u];p.isOpen=Ia(p.title,u===0),c+=`
      <div class="panel-options-group" ng-cloak>
        <div class="panel-options-group__header" ng-click="toggleOptionGroup(${u})" aria-label="${p.title} section">
          <div class="panel-options-group__icon">
            <icon name="ctrl.editorTabs[${u}].isOpen ? 'angle-down' : 'angle-right'"></icon>
          </div>
          <div class="panel-options-group__title">${p.title}</div>
        </div>
        <div class="panel-options-group__body" ng-if="ctrl.editorTabs[${u}].isOpen">
          <panel-editor-tab editor-tab="ctrl.editorTabs[${u}]" ctrl="ctrl"></panel-editor-tab>
        </div>
      </div>
      `}const l=(0,At.w)(),d={ctrl:i,toggleOptionGroup:u=>{const p=i.editorTabs[u];p.isOpen=!p.isOpen,wa(p.title,!!p.isOpen)}};this.angularOptions=l.load(this.element,d,c),this.angularOptions.digest()}render(){return e.createElement("div",{ref:n=>this.element=n})}}const Oa=(0,R.connect)(Mt,$t)(Na);var Je=o(91480),Lt=o(34103),Ae=o(37496),Ft=o(83741),Wt=o(66008),Qe=o(43282),Ra=o(83795),Aa=o.n(Ra),Ma=o(57445),$a=o(66600),fe=o(75064);const La=({property:t,context:n,registry:a,onChange:s,onRemove:r,isSystemOverride:i,searchQuery:c})=>{const l=(0,C.wW)(Fa),d=a?.getIfExists(t.id),u=(0,e.useId)();if(!d)return null;const p=Array.isArray(t.value)||t.id===Ae.qb.Thresholds||t.id===Ae.qb.Links||t.id===Ae.qb.Mappings,g=d.category?.filter(E=>E!==d.name);let f;const v=(E=!0,T=!1)=>(I=!1)=>e.createElement(L.Lh,{justify:"space-between"},e.createElement(Ma._,{category:g,description:E?d.description:void 0,htmlFor:u},e.createElement(Aa(),{textToHighlight:d.name,searchWords:[c],highlightClassName:"search-fragment-highlight"}),!I&&T&&d.getItemsCount&&e.createElement($a.A,{value:d.getItemsCount(t.value)})),!i&&e.createElement("div",null,e.createElement(fe.h,{name:"times",onClick:r,tooltip:"Remove label"})));return p?f=e.createElement(Je.u,{id:d.name,renderTitle:v(!1,!0),className:(0,m.css)`
          padding-left: 0;
          padding-right: 0;
        `,isNested:!0,isOpenDefault:t.value!==void 0},e.createElement(d.override,{value:t.value,onChange:E=>{s(E)},item:d,context:n})):f=e.createElement("div",null,e.createElement(ie.g,{label:v()(),description:d.description},e.createElement(d.override,{value:t.value,onChange:E=>{s(E)},item:d,context:n,id:u}))),e.createElement("div",{className:(0,m.cx)(p&&l.collapsibleOverrideEditor,!p&&"dynamicConfigValueEditor--nonCollapsible")},f)},Fa=t=>({collapsibleOverrideEditor:(0,m.css)`
      label: collapsibleOverrideEditor;
      & + .dynamicConfigValueEditor--nonCollapsible {
        margin-top: ${t.spacing(1)};
      }
    `});var te=o(44690),B=o(59386);const Ut=({isExpanded:t,registry:n,matcherUi:a,overrideName:s,override:r,onOverrideRemove:i})=>{const c=(0,C.wW)(Wa),d=r.properties.map(p=>n.getIfExists(p.id)).filter(p=>!!p).map(p=>p?.name).join(", "),u=a.optionsToLabel(r.matcher.options);return e.createElement("div",null,e.createElement(L.Lh,{justify:"space-between"},e.createElement("div",null,s),e.createElement(fe.h,{name:"trash-alt",onClick:i,tooltip:"Remove override"})),!t&&e.createElement("div",{className:c.overrideDetails},e.createElement("div",{className:c.options,title:u},u," ",e.createElement(X.J,{name:"angle-right"})," ",d)))};Ut.displayName="OverrideTitle";const Wa=t=>({matcherUi:(0,m.css)`
      padding: ${t.spacing(1)};
    `,propertyPickerWrapper:(0,m.css)`
      margin-top: ${t.spacing(2)};
    `,overrideDetails:(0,m.css)`
      font-size: ${t.typography.bodySmall.fontSize};
      color: ${t.colors.text.secondary};
      font-weight: ${t.typography.fontWeightRegular};
    `,options:(0,m.css)`
      overflow: hidden;
      padding-right: ${t.spacing(4)};
    `,unknownLabel:(0,m.css)`
      margin-bottom: 0;
    `});function Ua(t,n){const a=[],s=t.panel.fieldConfig,r=t.plugin.fieldConfigRegistry,i=t.data?.series??[];if(r.isEmpty())return[];const c=(p,g)=>{let f=(0,_.cloneDeep)(s.overrides);f[p]=g,t.onFieldConfigsChange({...s,overrides:f})},l=p=>{let g=(0,_.cloneDeep)(s.overrides);g.splice(p,1),t.onFieldConfigsChange({...s,overrides:g})},d=p=>{const g=Lt.Ls.get(p.value);g&&t.onFieldConfigsChange({...s,overrides:[...s.overrides,{matcher:{id:g.id,options:g.defaultOptions},properties:[]}]})},u={data:i,getSuggestions:p=>(0,Qe.PW)(i,p),isOverride:!0};for(let p=0;p<s.overrides.length;p++){const g=s.overrides[p],f=`Override ${p+1}`,v=Ft.i.get(g.matcher.id),E=za(r),T=(0,Ae.v3)(g),I=g.properties.length===0?1:0,N=new te.j({title:f,id:f,forceOpen:I,renderTitle:function(D){return e.createElement(Ut,{override:g,isExpanded:D,registry:r,overrideName:f,matcherUi:v,onOverrideRemove:()=>l(p)})}}),P=x=>{g.matcher.options=x,c(p,g)},ae=(x,D)=>{const Q=r.get(D.value),ce={id:Q.id,value:Q.defaultValue};g.properties?x.properties.push(ce):x.properties=[ce],c(p,x)};N.addItem(new B.a({title:v.name,render:function(){return e.createElement(v.component,{id:`${v.matcher.id}-${p}`,matcher:v.matcher,data:t.data?.series??[],options:g.matcher.options,onChange:P})}}));for(let x=0;x<g.properties.length;x++){const D=g.properties[x],Q=r.getIfExists(D.id);if(!Q)continue;const ce=vn=>{g.properties[x].value=vn,c(p,g)},be=()=>{g.properties.splice(x,1),c(p,g)};N.addItem(new B.a({title:Q.name,skipField:!0,render:function(){return e.createElement(La,{key:`${D.id}/${x}`,isSystemOverride:T,onChange:ce,onRemove:be,property:D,registry:r,context:u,searchQuery:n})}}))}!T&&g.matcher.options&&N.addItem(new B.a({title:"----------",skipField:!0,render:function(){return e.createElement(Wt.b,{key:"Add override property",label:"Add override property",variant:"secondary",isFullWidth:!0,icon:"plus",menuPlacement:"auto",options:E,onChange:D=>ae(g,D)})}})),a.push(N)}return a.push(new te.j({title:"add button",id:"add button",customRender:function(){return e.createElement(Ba,{key:"Add override"},e.createElement(Wt.b,{icon:"plus",label:"Add field override",variant:"secondary",menuPlacement:"auto",isFullWidth:!0,size:"md",options:Ft.i.list().filter(g=>!g.excludeFromPicker).map(g=>({label:g.name,value:g.id,description:g.description})),onChange:g=>d(g)}))}})),a}function za(t){return t.list().filter(n=>!n.hideFromOverrides).map(n=>{let a=n.name;return n.category&&(a=[...n.category,n.name].join(" > ")),{label:a,value:n.id,description:n.description}})}function Ba({children:t}){const n=(0,C.wW)(Va);return e.createElement("div",{className:n},t)}function Va(t){return(0,m.css)({borderTop:`1px solid ${t.colors.border.weak}`,padding:`${t.spacing(2)}`,display:"flex"})}const ka=({panel:t,formatDate:n})=>{const a=(0,C.wW)(Ha),s=t.libraryPanel?.meta;return s?e.createElement("div",{className:a.info},e.createElement("div",{className:a.libraryPanelInfo},`Used on ${s.connectedDashboards} `,s.connectedDashboards===1?"dashboard":"dashboards"),e.createElement("div",{className:a.libraryPanelInfo},"Last edited on ",n?.(s.updated,"L")??s.updated," by",s.updatedBy.avatarUrl&&e.createElement("img",{width:"22",height:"22",className:a.userAvatar,src:s.updatedBy.avatarUrl,alt:`Avatar for ${s.updatedBy.name}`}),s.updatedBy.name)):null},Ha=t=>({info:(0,m.css)`
      line-height: 1;
    `,libraryPanelInfo:(0,m.css)`
      color: ${t.colors.text.secondary};
      font-size: ${t.typography.bodySmall.fontSize};
    `,userAvatar:(0,m.css)`
      border-radius: ${t.shape.radius.circle};
      box-sizing: content-box;
      width: 22px;
      height: 22px;
      padding-left: ${t.spacing(1)};
      padding-right: ${t.spacing(1)};
    `});function Ga(t){const{panel:n,onPanelConfigChange:a,dashboard:s}=t,r=new te.j({title:"Library panel options",id:"Library panel options",isOpenDefault:!0});return(0,he.V)(n)&&r.addItem(new B.a({title:"Name",value:n.libraryPanel.name,popularRank:1,render:function(){return e.createElement(se.I,{id:"LibraryPanelFrameName",defaultValue:n.libraryPanel.name,onBlur:c=>a("libraryPanel",{...n.libraryPanel,name:c.currentTarget.value})})}})).addItem(new B.a({title:"Information",render:function(){return e.createElement(ka,{panel:n,formatDate:s.formatDate})}})),r}var Ka=o(7073),ja=o(96394),ve=o(93657),zt=o(28879),Bt=o(33941),H=o(34802);const Za=`You are an expert in creating Grafana Panels.
You will be given the title and description of the dashboard the panel is in as well as the JSON for the panel.
Your goal is to write a descriptive and concise panel description.
The panel description is meant to explain the purpose of the panel, not just its attributes.
Do not refer to the panel; simply describe its purpose.
There should be no numbers in the description except for thresholds.
The description should be, at most, 200 characters.`,Ja=({onGenerate:t,panel:n})=>{const a=e.useMemo(()=>Qa(n),[n]);return e.createElement(zt.v,{messages:a,onGenerate:t,eventTrackingSrc:Bt.dG.panelDescription,toggleTipTitle:"Improve your panel description"})};function Qa(t){const n=(0,ve.h4)().getCurrent(),a=(0,H.wH)(t);return[{content:Za,role:H.uU.system},{content:`The panel is part of a dashboard with the title: ${n.title}`,role:H.uU.system},{content:`The panel is part of a dashboard with the description: ${n.description}`,role:H.uU.system},{content:`This is the JSON which defines the panel: ${a}`,role:H.uU.user}]}const Ya="You are an expert in creating Grafana Panels.Your goal is to write short, descriptive, and concise panel title.The title should be shorter than 50 characters.",Xa=({onGenerate:t,panel:n})=>{const a=e.useMemo(()=>qa(n),[n]);return e.createElement(zt.v,{messages:a,onGenerate:t,eventTrackingSrc:Bt.dG.panelTitle,toggleTipTitle:"Improve your panel title"})};function qa(t){const n=(0,ve.h4)().getCurrent(),a=(0,H.wH)(t);return[{content:Ya,role:H.uU.system},{content:`The panel is part of a dashboard with the title: ${n.title}`,role:H.uU.system},{content:`The panel is part of a dashboard with the description: ${n.description}`,role:H.uU.system},{content:`Use this JSON object which defines the panel: ${a}`,role:H.uU.system}]}var _a=o(85381);function er(t){const{panel:n,onPanelConfigChange:a}=t,s=new te.j({title:"Panel options",id:"Panel options",isOpenDefault:!0}),r=c=>{const l=document.getElementById("PanelFrameTitle");l instanceof HTMLInputElement&&(l.value=c,a("title",c))},i=c=>{const l=document.getElementById("description-text-area");l instanceof HTMLTextAreaElement&&(l.value=c,a("description",c))};return s.addItem(new B.a({title:"Title",value:n.title,popularRank:1,render:function(){return e.createElement(se.I,{id:"PanelFrameTitle",defaultValue:n.title,onBlur:l=>a("title",l.currentTarget.value)})},addon:b.config.featureToggles.dashgpt&&e.createElement(Xa,{onGenerate:r,panel:n})})).addItem(new B.a({title:"Description",description:n.description,value:n.description,render:function(){return e.createElement(Ka.K,{id:"description-text-area",defaultValue:n.description,onBlur:l=>a("description",l.currentTarget.value)})},addon:b.config.featureToggles.dashgpt&&e.createElement(Ja,{onGenerate:i,panel:n})})).addItem(new B.a({title:"Transparent background",render:function(){return e.createElement(ee.r,{value:n.transparent,id:"transparent-background",onChange:l=>a("transparent",l.currentTarget.checked)})}})).addCategory(new te.j({title:"Panel links",id:"Panel links",isOpenDefault:!1,itemsCount:n.links?.length}).addItem(new B.a({title:"Panel links",render:function(){return e.createElement(ja.d,{links:n.links,onChange:l=>a("links",l),getSuggestions:Qe.PR,data:[]})}}))).addCategory(new te.j({title:"Repeat options",id:"Repeat options",isOpenDefault:!1}).addItem(new B.a({title:"Repeat by variable",description:"Repeat this panel for each value in the selected variable. This is not visible while in edit mode. You need to go back to dashboard and then update the variable or reload the dashboard.",render:function(){return e.createElement(_a.X,{id:"repeat-by-variable-select",repeat:n.repeat,onChange:l=>{a("repeat",l)}})}})).addItem(new B.a({title:"Repeat direction",showIf:()=>!!n.repeat,render:function(){const l=[{label:"Horizontal",value:"h"},{label:"Vertical",value:"v"}];return e.createElement(Re.S,{options:l,value:n.repeatDirection||"h",onChange:d=>a("repeatDirection",d)})}})).addItem(new B.a({title:"Max per row",showIf:()=>!!(n.repeat&&n.repeatDirection==="h"),render:function(){const l=[2,3,4,6,8,12].map(d=>({label:d.toString(),value:d}));return e.createElement(Tt.Ph,{options:l,value:n.maxPerRow,onChange:d=>a("maxPerRow",d.value)})}})))}var tr=o(73393);class nr{constructor(n,a){this.categories=n,this.overrides=a}search(n){const a=new RegExp(n,"i"),r=this.collectHits(this.categories,a,[]).sort(Vt).map(l=>l.item),c=this.collectHits(this.overrides,a,[]).sort(Vt).map(l=>l.item);return{optionHits:r,overrideHits:this.buildOverrideHitCategories(c),totalCount:this.getAllOptionsCount(this.categories)}}collectHits(n,a,s){for(const r of n){const i=a.test(r.props.title);for(const c of r.items){if(a.test(c.props.title)){s.push({item:c,rank:1});continue}if(c.props.description&&a.test(c.props.description)){s.push({item:c,rank:2});continue}i&&s.push({item:c,rank:3})}r.categories.length>0&&this.collectHits(r.categories,a,s)}return s}getAllOptionsCount(n){let a=0;for(const s of n)a+=s.items.length,s.categories.length>0&&(a+=this.getAllOptionsCount(s.categories));return a}buildOverrideHitCategories(n){const a={};for(const s of n){let r=a[s.parent.props.title];r||(r=a[s.parent.props.title]=new te.j(s.parent.props),r.addItem(s.parent.items[0])),r.items[0].props.title!==s.props.title&&r.addItem(s)}return Object.values(a)}}function Vt(t,n){return t.rank-n.rank}function ar(t){const n=[];for(const a of t)for(const s of a.items)s.props.title==="Unit"&&(s.props.popularRank=2),s.props.title==="Min"&&(s.props.popularRank=3),s.props.title==="Max"&&(s.props.popularRank=4),s.props.title==="Display name"&&(s.props.popularRank=5),s.props.popularRank&&n.push(s);return n.sort((a,s)=>a.props.popularRank-s.props.popularRank)}const rr=t=>{const{plugin:n,dashboard:a,panel:s}=t,[r,i]=(0,e.useState)(""),[c,l]=(0,e.useState)("All"),d=(0,C.wW)(lr),[u,p,g]=(0,e.useMemo)(()=>[er(t),(0,tr.AL)(t),Ga(t)],[s.configRev,t.data,t.instanceState,r]),f=(0,e.useMemo)(()=>Ua(t,r),[s.configRev,t.data,t.instanceState,r]),v=[],E=r.length>0,T=(0,e.useMemo)(sr,[]),I=(0,he.V)(s)?[g,u,...p]:[u,...p];if(E)v.push(ir(I,f,r)),t.plugin.angularPanelCtrl&&v.push(e.createElement("div",{className:d.searchNotice,key:"Search notice"},"This is an old visualization type that does not support searching all options."));else switch(c){case"All":(0,he.V)(s)&&v.push(g.render()),v.push(u.render()),t.plugin.angularPanelCtrl&&v.push(e.createElement(Oa,{plugin:n,dashboard:a,panel:s,key:"AngularOptions"}));for(const P of p)v.push(P.render());for(const P of f)v.push(P.render());break;case"Overrides":for(const P of f)v.push(P.render());break;case"Recent":v.push(e.createElement(Je.u,{id:"Recent options",title:"Recent options",key:"Recent options",forceOpen:1},ar(I).map(P=>P.render())));break}const N=!E&&!n.fieldConfigRegistry.isEmpty();return e.createElement("div",{className:d.wrapper},e.createElement("div",{className:d.formBox},s.isAngularPlugin()&&!n.meta.angular?.hideDeprecation&&e.createElement(Da.Y,{className:d.angularDeprecationWrapper,showPluginDetailsLink:!0,pluginId:n.meta.id,pluginType:n.meta.type,angularSupportEnabled:b.config?.angularSupportEnabled,interactionElementId:"panel-options"}),e.createElement("div",{className:d.formRow},e.createElement(Rt.H,{width:0,value:r,onChange:i,placeholder:"Search options"})),N&&e.createElement("div",{className:d.formRow},e.createElement(Re.S,{options:T,value:c,fullWidth:!0,onChange:l}))),e.createElement("div",{className:d.scrollWrapper},e.createElement(oe.$,{autoHeightMin:"100%"},e.createElement("div",{className:d.mainBox},v))))};function sr(){return[{label:"All",value:"All"},{label:"Overrides",value:"Overrides"}]}var or=(t=>(t.All="All",t.Overrides="Overrides",t.Recent="Recent",t))(or||{});function ir(t,n,a){const s=new nr(t,n),{optionHits:r,totalCount:i,overrideHits:c}=s.search(a);return e.createElement("div",{key:"search results"},e.createElement(Je.u,{id:"Found options",title:`Matched ${r.length}/${i} options`,key:"Normal options",forceOpen:1},r.map(l=>l.render(a))),c.map(l=>l.render(a)))}const lr=t=>({wrapper:(0,m.css)`
    height: 100%;
    display: flex;
    flex-direction: column;
    flex: 1 1 0;

    .search-fragment-highlight {
      color: ${t.colors.warning.text};
      background: transparent;
    }
  `,searchBox:(0,m.css)`
    display: flex;
    flex-direction: column;
    min-height: 0;
  `,formRow:(0,m.css)`
    margin-bottom: ${t.spacing(1)};
  `,formBox:(0,m.css)`
    padding: ${t.spacing(1)};
    background: ${t.colors.background.primary};
    border: 1px solid ${t.components.panel.borderColor};
    border-top-left-radius: ${t.shape.borderRadius(1.5)};
    border-bottom: none;
  `,closeButton:(0,m.css)`
    margin-left: ${t.spacing(1)};
  `,searchHits:(0,m.css)`
    padding: ${t.spacing(1,1,0,1)};
  `,scrollWrapper:(0,m.css)`
    flex-grow: 1;
    min-height: 0;
  `,searchNotice:(0,m.css)`
    font-size: ${t.typography.size.sm};
    color: ${t.colors.text.secondary};
    padding: ${t.spacing(1)};
    text-align: center;
  `,mainBox:(0,m.css)`
    background: ${t.colors.background.primary};
    border: 1px solid ${t.components.panel.borderColor};
    border-top: none;
    flex-grow: 1;
  `,angularDeprecationWrapper:(0,m.css)`
    padding: ${t.spacing(1)};
  `});var kt=o(82541),cr=o(25802);const Ht=t=>n=>n.plugins.panels[t]||(0,cr.X)(`Panel plugin not found (${t})`,!0),Ye=({panel:t})=>{const n=(0,S.useDispatch)(),a=(0,S.useSelector)(Ht(t.type)),s=(0,S.useSelector)(l=>l.panelEditor.ui.isPanelOptionsVisible),r=(0,S.useSelector)(l=>l.panelEditor.isVizPickerOpen),i=()=>{n((0,J.g_)(!r))},c=()=>{n(ze({isPanelOptionsVisible:!s}))};return a?e.createElement("div",{className:Gt.wrapper},e.createElement(kt.h,null,e.createElement(Ke.h,{className:Gt.vizButton,tooltip:"Click to change visualization",imgSrc:a.meta.info.logos.small,isOpen:r,onClick:i,"data-testid":h.wl.components.PanelEditor.toggleVizPicker,"aria-label":"Change Visualization",variant:"canvas",fullWidth:!0},a.meta.name),e.createElement(Ke.h,{tooltip:s?"Close options pane":"Show options pane",icon:s?"angle-right":"angle-left",onClick:c,variant:"canvas","data-testid":h.wl.components.PanelEditor.toggleVizOptions,"aria-label":s?"Close options pane":"Show options pane"}))):null};Ye.displayName="VisualizationTab";const Gt={wrapper:(0,m.css)`
    display: flex;
    flex-direction: column;
  `,vizButton:(0,m.css)`
    text-align: left;
  `};var dr=o(6753),Kt=o(89248),ur=o(32327),pr=o(17027),Me=o(77980);const mr=({onConfirm:t,onDismiss:n,panel:a})=>{const s=(0,he.V)(a),r=`${s?"Changing":"Replace with"} library panel`,i=`${s?"Changing":"Replacing with a"} library panel will remove any changes since last save.`;return e.createElement(Me.s,{onConfirm:t,onDismiss:n,confirmText:s?"Change":"Replace",title:r,body:i,dismissText:"Cancel",isOpen:!0})};var gr=o(71496);const hr=({panel:t,searchQuery:n,isWidget:a=!1})=>{const[s,r]=(0,e.useState)(!1),[i,c]=(0,e.useState)(void 0),[l,d]=(0,e.useState)([]),u=(0,e.useCallback)(T=>{d(T.map(I=>I.id))},[d]),p=(0,ve.h4)().getCurrent(),g=(0,S.useDispatch)(),f=async()=>{i&&(c(void 0),g((0,Se.ih)(t,i)))},v=()=>r(!0),E=()=>c(void 0);return e.createElement(L.wc,{spacing:"md"},!t.libraryPanel&&e.createElement(L.wc,{align:"center"},e.createElement(w.zx,{icon:"plus",onClick:v,variant:"secondary",fullWidth:!0},"Create new library panel")),e.createElement(ur.j,{onChange:u,isWidget:a}),e.createElement("div",{className:fr.libraryPanelsView},e.createElement(gr.u,{currentPanelId:t.libraryPanel?.uid,searchString:n,panelFilter:l,onClickCard:c,showSecondaryActions:!0,isWidget:a})),s&&e.createElement(pr.c,{panel:t,onDismiss:()=>r(!1),initialFolderUid:p?.meta.folderUid,isOpen:s}),i&&e.createElement(mr,{panel:t,onDismiss:E,onConfirm:f}))},fr={libraryPanelsView:(0,m.css)`
    width: 100%;
  `};var Xe=o(11795),vr=o(20229);const Er=["timeseries","barchart","gauge","stat","piechart","bargauge","table","state-timeline","status-history","logs","candlestick","flamegraph"];async function yr(t,n){const a=new Xe.mi(t,n);for(const r of Er){const c=(await(0,vr.Ub)(r)).getSuggestionsSupplier();c&&c.getSuggestionsForData(a)}const s=a.getList();if(!b.config.featureToggles.vizAndWidgetSplit&&a.dataSummary.fieldCount===0)for(const r of Object.values(b.config.panels))!r.skipDataQuery||r.hideFromList||s.push({name:r.name,pluginId:r.id,description:r.info.description,cardOptions:{imgSrc:r.info.logos.small}});return s.sort((r,i)=>{if(a.dataSummary.preferredVisualisationType){if(r.pluginId===a.dataSummary.preferredVisualisationType)return-1;if(i.pluginId===a.dataSummary.preferredVisualisationType)return 1}return(i.score??Xe._.OK)-(r.score??Xe._.OK)})}var jt=o(33088);function br({data:t,suggestion:n,onChange:a,width:s}){const r=(0,C.wW)(Cr),{innerStyles:i,outerStyles:c,renderWidth:l,renderHeight:d}=Pr(s),u=n.cardOptions??{},p={"aria-label":n.name,className:r.vizBox,"data-testid":h.wl.components.VisualizationPreview.card(n.name),style:c,onClick:()=>{a({pluginId:n.pluginId,options:n.options,fieldConfig:n.fieldConfig})}};if(u.imgSrc)return e.createElement(ge.u,{content:n.description??n.name},e.createElement("button",{...p,className:(0,m.cx)(r.vizBox,r.imgBox)},e.createElement("div",{className:r.name},n.name),e.createElement("img",{className:r.img,src:u.imgSrc,alt:n.name})));let g=n;return n.cardOptions?.previewModifier&&(g=(0,_.cloneDeep)(n),n.cardOptions.previewModifier(g)),e.createElement("button",{...p},e.createElement(ge.u,{content:n.name},e.createElement("div",{style:i,className:r.renderContainer},e.createElement(jt.$,{title:"",data:t,pluginId:n.pluginId,width:l,height:d,options:g.options,fieldConfig:g.fieldConfig}),e.createElement("div",{className:r.hoverPane}))))}const Cr=t=>({hoverPane:(0,m.css)({position:"absolute",top:0,right:0,left:0,borderRadius:t.spacing(2),bottom:0}),vizBox:(0,m.css)`
      position: relative;
      background: none;
      border-radius: ${t.shape.radius.default};
      cursor: pointer;
      border: 1px solid ${t.colors.border.medium};

      transition: ${t.transitions.create(["background"],{duration:t.transitions.duration.short})};

      &:hover {
        background: ${t.colors.background.secondary};
      }
    `,imgBox:(0,m.css)`
      display: flex;
      flex-direction: column;
      height: 100%;

      justify-self: center;
      color: ${t.colors.text.primary};
      width: 100%;
      display: flex;

      justify-content: center;
      align-items: center;
      text-align: center;
    `,name:(0,m.css)`
      padding-bottom: ${t.spacing(.5)};
      margin-top: ${t.spacing(-1)};
      font-size: ${t.typography.bodySmall.fontSize};
      white-space: nowrap;
      overflow: hidden;
      color: ${t.colors.text.secondary};
      font-weight: ${t.typography.fontWeightMedium};
      text-overflow: ellipsis;
    `,img:(0,m.css)`
      max-width: ${t.spacing(8)};
      max-height: ${t.spacing(8)};
    `,renderContainer:(0,m.css)`
      position: absolute;
      transform-origin: left top;
      top: 6px;
      left: 6px;
    `});function Pr(t){const a=t,s=t*(1/1.6),r=350,i=r*(1/1.6),c=6,l=(a-c*2)/r,d=(s-c*2)/i;return{renderHeight:i,renderWidth:r,outerStyles:{width:a,height:s},innerStyles:{width:r,height:i,transform:`scale(${l}, ${d})`}}}function Tr({searchQuery:t,onChange:n,data:a,panel:s}){const r=(0,C.wW)(xr),{value:i}=(0,U.Z)(()=>yr(a,s),[a,s]),c=Sr(t,i);return e.createElement(we.Z,{disableHeight:!0,style:{width:"100%",height:"100%"}},({width:l})=>{if(!l)return null;const d=Math.floor(l/170),u=8*(d-1),p=(l-u)/d;return e.createElement("div",null,e.createElement("div",{className:r.filterRow},e.createElement("div",{className:r.infoText},"Based on current data")),e.createElement("div",{className:r.grid,style:{gridTemplateColumns:`repeat(auto-fill, ${p-1}px)`}},c.map((g,f)=>e.createElement(br,{key:f,data:a,suggestion:g,onChange:n,width:p})),t&&c.length===0&&e.createElement("div",{className:r.infoText},"No results matched your query")))})}function Sr(t,n){if(!t||!n)return n||[];const a=new RegExp(t,"i");return n.filter(s=>a.test(s.name)||a.test(s.pluginId))}const xr=t=>({heading:(0,m.css)({...t.typography.h5,margin:t.spacing(0,.5,1)}),filterRow:(0,m.css)({display:"flex",flexDirection:"row",justifyContent:"space-around",alignItems:"center",paddingBottom:"8px"}),infoText:(0,m.css)({fontSize:t.typography.bodySmall.fontSize,color:t.colors.text.secondary,fontStyle:"italic"}),grid:(0,m.css)({display:"grid",gridGap:t.spacing(1),gridTemplateColumns:"repeat(auto-fill, 144px)",marginBottom:t.spacing(1),justifyContent:"space-evenly"})});var Zt=o(66372),O=o(12702);const Jt=({panel:t,data:n})=>{const a=(0,S.useSelector)(Ht(t.type)),[s,r]=(0,e.useState)(""),i=!!a.meta.skipDataQuery,c=!!(i&&b.config.featureToggles.vizAndWidgetSplit),l=c?Kt.Hk:Kt.FL,d=c?O.Ok.Widgets:O.Ok.Visualizations,[u,p]=(0,dr.Z)(l,d),g=(0,S.useDispatch)(),f=(0,C.wW)(Dr),v=(0,e.useRef)(null),E=(0,e.useCallback)(P=>{g((0,Se.Kc)({panel:t,...P})),P.withModKey||g((0,J.g_)(!1))},[g,t]),T=()=>{g((0,J.g_)(!1))};if(!a)return null;const I=[{label:"Visualizations",value:O.Ok.Visualizations},{label:"Suggestions",value:O.Ok.Suggestions},{label:"Library panels",value:O.Ok.LibraryPanels,description:"Reusable panels you can share between multiple dashboards."}],N=[{label:"Widgets",value:O.Ok.Widgets},{label:"Library panels",value:O.Ok.LibraryPanels,description:"Reusable panels you can share between multiple dashboards."}];return e.createElement("div",{className:f.openWrapper},e.createElement("div",{className:f.formBox},e.createElement("div",{className:f.searchRow},e.createElement(Rt.H,{value:s,onChange:r,ref:v,autoFocus:!0,placeholder:"Search for..."}),e.createElement(w.zx,{title:"Close",variant:"secondary",icon:"angle-up",className:f.closeButton,"aria-label":h.wl.components.PanelEditor.toggleVizPicker,onClick:T})),e.createElement(ie.g,{className:f.customFieldMargin},e.createElement(Re.S,{options:c?N:I,value:u,onChange:p,fullWidth:!0}))),e.createElement("div",{className:f.scrollWrapper},e.createElement(oe.$,{autoHeightMin:"100%"},e.createElement("div",{className:f.scrollContent},u===O.Ok.Visualizations&&e.createElement(Zt.G,{pluginId:a.meta.id,onChange:E,searchQuery:s}),u===O.Ok.Widgets&&e.createElement(Zt.G,{pluginId:a.meta.id,onChange:E,searchQuery:s,isWidget:!0}),u===O.Ok.Suggestions&&e.createElement(Tr,{onChange:E,searchQuery:s,panel:t,data:n}),u===O.Ok.LibraryPanels&&e.createElement(hr,{searchQuery:s,panel:t,key:"Panel Library",isWidget:i})))))};Jt.displayName="VisualizationSelectPane";const Dr=t=>({icon:(0,m.css)`
      color: ${t.v1.palette.gray33};
    `,wrapper:(0,m.css)`
      display: flex;
      flex-direction: column;
      flex: 1 1 0;
      height: 100%;
    `,vizButton:(0,m.css)`
      text-align: left;
    `,scrollWrapper:(0,m.css)`
      flex-grow: 1;
      min-height: 0;
    `,scrollContent:(0,m.css)`
      padding: ${t.spacing(1)};
    `,openWrapper:(0,m.css)`
      display: flex;
      flex-direction: column;
      flex: 1 1 100%;
      height: 100%;
      background: ${t.colors.background.primary};
      border: 1px solid ${t.colors.border.weak};
    `,searchRow:(0,m.css)`
      display: flex;
      margin-bottom: ${t.spacing(1)};
    `,closeButton:(0,m.css)`
      margin-left: ${t.spacing(1)};
    `,customFieldMargin:(0,m.css)`
      margin-bottom: ${t.spacing(1)};
    `,formBox:(0,m.css)`
      padding: ${t.spacing(1)};
      padding-bottom: 0;
    `}),wr=({plugin:t,panel:n,onFieldConfigsChange:a,onPanelOptionsChanged:s,onPanelConfigChange:r,dashboard:i,instanceState:c})=>{const l=(0,C.wW)(Ir),d=(0,S.useSelector)(p=>p.panelEditor.isVizPickerOpen),{data:u}=He(n,{withTransforms:!0,withFieldConfig:!1},!0);return e.createElement("div",{className:l.wrapper,"aria-label":h.wl.components.PanelEditor.OptionsPane.content},!d&&e.createElement(e.Fragment,null,e.createElement("div",{className:l.vizButtonWrapper},e.createElement(Ye,{panel:n})),e.createElement("div",{className:l.optionsWrapper},e.createElement(rr,{panel:n,dashboard:i,plugin:t,instanceState:c,data:u,onFieldConfigsChange:a,onPanelOptionsChanged:s,onPanelConfigChange:r}))),d&&e.createElement(Jt,{panel:n,data:u}))},Ir=t=>({wrapper:(0,m.css)`
      height: 100%;
      width: 100%;
      display: flex;
      flex: 1 1 0;
      flex-direction: column;
      padding: 0;
    `,optionsWrapper:(0,m.css)`
      flex-grow: 1;
      min-height: 0;
    `,vizButtonWrapper:(0,m.css)`
      padding: 0 ${t.spacing(2,2)} 0;
    `,legacyOptions:(0,m.css)`
      label: legacy-options;
      .panel-options-grid {
        display: flex;
        flex-direction: column;
      }
      .panel-options-group {
        margin-bottom: 0;
      }
      .panel-options-group__body {
        padding: ${t.spacing(2)} 0;
      }

      .section {
        display: block;
        margin: ${t.spacing(2)} 0;

        &:first-child {
          margin-top: 0;
        }
      }
    `});var Qt=o(2384),Nr=o(58861),Or=o(55583),Rr=(t=>(t.Error="Error",t.Info="Info",t.Links="Links",t))(Rr||{});class Ar extends e.Component{constructor(){super(...arguments),this.timeSrv=(0,le.$t)(),this.getInfoMode=()=>{const{panel:n,error:a}=this.props;if(a)return"Error";if(n.description)return"Info";if(n.links&&n.links.length)return"Links"},this.getInfoContent=()=>{const{panel:n}=this.props,a=n.description||"",s=(0,Ge.J)().replace(a,n.scopedVars),r=(0,Or.a)(s),i=this.props.links&&this.props.links.getLinks(n.replaceVariables);return e.createElement("div",{className:"panel-info-content markdown-html"},e.createElement("div",{dangerouslySetInnerHTML:{__html:r}}),i&&i.length>0&&e.createElement("ul",{className:"panel-info-corner-links"},i.map((c,l)=>e.createElement("li",{key:l},e.createElement("a",{className:"panel-info-corner-links__item",href:c.href,target:c.target},c.title)))))},this.onClickError=()=>{y.E1.partial({inspect:this.props.panel.id,inspectTab:z.q.Error})}}renderCornerType(n,a,s){const r=n==="Error"?"error":"info",i=`panel-info-corner panel-info-corner--${n.toLowerCase()}`,c=h.wl.components.Panels.Panel.headerCornerInfo(n.toLowerCase());return e.createElement(ge.u,{content:a,placement:"top-start",theme:r,interactive:!0},e.createElement("button",{type:"button",className:i,onClick:s,"aria-label":c},e.createElement("i",{"aria-hidden":!0,className:"fa"}),e.createElement("span",{className:"panel-info-corner-inner"})))}render(){const{error:n}=this.props,a=this.getInfoMode();return a?a==="Error"&&n?this.renderCornerType(a,n,this.onClickError):a==="Info"||a==="Links"?this.renderCornerType(a,this.getInfoContent):null:null}}const Mr=Ar;function $r({width:t,height:n,panel:a,dashboard:s}){const{data:r}=He(a,{withTransforms:!0,withFieldConfig:!1},!1),[i,c]=(0,e.useState)({frameIndex:0,showHeader:!0,showTypeIcons:!0});if((0,e.useEffect)(()=>{const d=(0,le.$t)(),u=a.events.subscribe(Qt.U5,()=>{const p=(0,Ue.W1)(a,d.timeRange());a.runAllPanelQueries({dashboardUID:s.uid,dashboardTimezone:s.getTimezone(),timeData:p,width:t})});return()=>{u.unsubscribe()}},[a,s,t]),!r)return null;const l=r?.errors?r.errors.length>1?"Multiple errors found. Click for more details":r.errors[0].message:r?.error?.message;return e.createElement(Nr.fm,{width:t,height:n,padding:"none"},(d,u)=>e.createElement(e.Fragment,null,e.createElement(Mr,{panel:a,error:l}),e.createElement(jt.$,{title:"Raw data",pluginId:"table",width:d,height:u,data:r,options:i,onOptionsChange:c})))}var Yt=o(87173),qe=o(42202),Lr=o(10305),Fr=o(16293),Wr=o(81502),Ur=o(64409);function Xt({message:t}){const n=(0,e.useCallback)(()=>{y.E1.partial({tab:O.Ip.Query})},[]);return e.createElement(L.Ar,{justify:"center",style:{marginTop:"100px"}},e.createElement(L.wc,{spacing:"md"},e.createElement("h2",null,t),e.createElement("div",null,e.createElement(w.zx,{size:"md",variant:"secondary",icon:"arrow-left",onClick:n},"Go back to Queries"))))}var _e=o(85445),zr=o(16783),qt=o(34524);class Br extends e.PureComponent{constructor(){super(...arguments),this.state={stateHistoryItems:[]},this.clearHistory=async()=>{const{dashboard:n,panelId:a,onRefresh:s}=this.props;await(0,_e.i)().post("/api/annotations/mass-delete",{dashboardId:n.id,panelId:a}),this.setState({stateHistoryItems:[]}),s()}}componentDidMount(){const{dashboard:n,panelId:a}=this.props;(0,_e.i)().get(`/api/annotations?dashboardId=${n.id}&panelId=${a}&limit=50&type=alert`,{},`state-history-${n.id}-${a}`).then(s=>{const r=s.map(i=>({stateModel:qt.Z.getStateDisplayModel(i.newState),time:n.formatDate(i.time,"MMM D, YYYY HH:mm:ss"),info:qt.Z.getAlertAnnotationInfo(i)}));this.setState({stateHistoryItems:r})})}render(){const{stateHistoryItems:n}=this.state;return e.createElement("div",null,n.length>0&&e.createElement("div",{className:"p-b-1"},e.createElement("span",{className:"muted"},"Last 50 state changes"),e.createElement(zr.p,{onConfirm:this.clearHistory,confirmVariant:"destructive",confirmText:"Clear"},e.createElement(w.zx,{className:(0,m.css)`
                  direction: ltr;
                `,variant:"destructive",icon:"trash-alt"},"Clear history"))),e.createElement("ol",{className:"alert-rule-list"},n.length>0?n.map((a,s)=>e.createElement("li",{className:"alert-rule-item",key:`${a.time}-${s}`},e.createElement("div",{className:`alert-rule-item__icon ${a.stateModel.stateClass}`},e.createElement(X.J,{name:a.stateModel.iconClass,size:"xl"})),e.createElement("div",{className:"alert-rule-item__body"},e.createElement("div",{className:"alert-rule-item__header"},e.createElement("p",{className:"alert-rule-item__name"},a.alertName),e.createElement("div",{className:"alert-rule-item__text"},e.createElement("span",{className:`${a.stateModel.stateClass}`},a.stateModel.text))),a.info),e.createElement("div",{className:"alert-rule-item__time"},a.time))):e.createElement("i",null,"No state changes recorded")))}}const Vr=Br;var _t=o(79468),et=o(92904);class kr extends e.PureComponent{constructor(){super(...arguments),this.state={isLoading:!1,allNodesExpanded:null,testRuleResponse:{}},this.setFormattedJson=n=>{this.formattedJson=n},this.getTextForClipboard=()=>JSON.stringify(this.formattedJson,null,2),this.onToggleExpand=()=>{this.setState(n=>({...n,allNodesExpanded:!this.state.allNodesExpanded}))},this.getNrOfOpenNodes=()=>this.state.allNodesExpanded===null?3:this.state.allNodesExpanded?20:1,this.renderExpandCollapse=()=>{const{allNodesExpanded:n}=this.state,a=e.createElement(e.Fragment,null,e.createElement(X.J,{name:"minus-circle"})," Collapse All"),s=e.createElement(e.Fragment,null,e.createElement(X.J,{name:"plus-circle"})," Expand All");return n?a:s}}componentDidMount(){this.testRule()}async testRule(){const{dashboard:n,panel:a}=this.props,s=n.getSaveModelCloneOld();s.panels=s.panels.map(c=>c.id===a.id?a.getSaveModel():c);const r={dashboard:s,panelId:a.id};this.setState({isLoading:!0});const i=await(0,_e.i)().post("/api/alerts/test",r);this.setState({isLoading:!1,testRuleResponse:i})}render(){const{testRuleResponse:n,isLoading:a}=this.state,s=(0,w.gN)(this.props.theme);if(a===!0)return e.createElement(_t.u,{text:"Evaluating rule"});const r=this.getNrOfOpenNodes();return e.createElement(e.Fragment,null,e.createElement("div",{className:"pull-right"},e.createElement(L.Lh,{spacing:"md"},e.createElement("button",{type:"button",className:s,onClick:this.onToggleExpand},this.renderExpandCollapse()),e.createElement(Ve.m,{getText:this.getTextForClipboard,icon:"copy"},"Copy to Clipboard"))),e.createElement(et.g,{json:n,open:r,onDidRender:this.setFormattedJson}))}}const Hr=(0,C.HE)(kr);var Gr=o(2315);class Kr extends e.PureComponent{constructor(){super(...arguments),this.state={validationMessage:"",showStateHistory:!1,showDeleteConfirmation:!1,showTestRule:!1},this.onAngularPanelUpdated=()=>{this.forceUpdate()},this.onAddAlert=()=>{this.panelCtrl?._enableAlert(),this.component?.digest(),this.forceUpdate()},this.onToggleModal=n=>{const a=this.state[n];this.setState({...this.state,[n]:!a})},this.renderTestRule=()=>{if(!this.state.showTestRule)return null;const{panel:n,dashboard:a}=this.props,s=()=>this.onToggleModal("showTestRule");return e.createElement(Y.u,{isOpen:!0,icon:"bug",title:"Testing rule",onDismiss:s,onClickBackdrop:s},e.createElement(Hr,{panel:n,dashboard:a}))},this.renderDeleteConfirmation=()=>{if(!this.state.showDeleteConfirmation)return null;const{panel:n}=this.props,a=()=>this.onToggleModal("showDeleteConfirmation");return e.createElement(Me.s,{isOpen:!0,icon:"trash-alt",title:"Delete",body:e.createElement("div",null,"Are you sure you want to delete this alert rule?",e.createElement("br",null),e.createElement("small",null,"You need to save dashboard for the delete to take effect.")),confirmText:"Delete alert",onDismiss:a,onConfirm:()=>{delete n.alert,n.thresholds=[],this.panelCtrl&&(this.panelCtrl.alertState=null,this.panelCtrl.render()),this.component?.digest(),a()}})},this.renderStateHistory=()=>{if(!this.state.showStateHistory)return null;const{panel:n,dashboard:a}=this.props,s=()=>this.onToggleModal("showStateHistory");return e.createElement(Y.u,{isOpen:!0,icon:"history",title:"State history",onDismiss:s,onClickBackdrop:s},e.createElement(Vr,{dashboard:a,panelId:n.id,onRefresh:()=>this.panelCtrl?.refresh()}))}}async componentDidMount(){b.config.angularSupportEnabled?(await Promise.all([o.e(6783),o.e(5718)]).then(o.bind(o,7485)),this.loadAlertTab()):alert("Angular support disabled, legacy alerting cannot function without angular support")}componentDidUpdate(n){this.loadAlertTab()}componentWillUnmount(){this.component&&this.component.destroy()}async loadAlertTab(){const{panel:n,angularPanelComponent:a}=this.props;if(!this.element||this.component)return;if(a){const l=a.getScope();if(!l.$$childHead){setTimeout(()=>{this.forceUpdate()});return}this.panelCtrl=l.$$childHead.ctrl}else this.panelCtrl=this.getReactAlertPanelCtrl();const s=(0,At.w)(),r="<alert-tab />",i={ctrl:this.panelCtrl};this.component=s.load(this.element,i,r);const c=await(0,Gr.E)(n.transformations,n.targets,(0,Wr.F)(),n.datasource);c&&this.setState({validationMessage:c})}getReactAlertPanelCtrl(){return{panel:this.props.panel,events:new Fr.F,render:()=>{this.props.panel.render()}}}render(){const{alert:n,transformations:a}=this.props.panel,{validationMessage:s}=this.state,r=a&&a.length>0;if(!n&&s)return e.createElement(Xt,{message:s});const i={title:"Panel has no alert rule defined",buttonIcon:"bell",onClick:this.onAddAlert,buttonTitle:"Create Alert"};return e.createElement(e.Fragment,null,e.createElement(oe.$,{autoHeightMin:"100%"},e.createElement(L.W2,{padding:"md"},e.createElement("div",{"data-testid":h.wl.components.AlertTab.content},n&&r&&e.createElement(q.b,{severity:S.AppNotificationSeverity.Error,title:"Transformations are not supported in alert queries"}),e.createElement("div",{ref:c=>this.element=c}),n&&e.createElement(L.Lh,null,e.createElement(w.zx,{onClick:()=>this.onToggleModal("showStateHistory"),variant:"secondary"},"State history"),e.createElement(w.zx,{onClick:()=>this.onToggleModal("showTestRule"),variant:"secondary"},"Test rule"),e.createElement(w.zx,{onClick:()=>this.onToggleModal("showDeleteConfirmation"),variant:"destructive"},"Delete")),!n&&!s&&e.createElement(Ur.Z,{...i})))),this.renderTestRule(),this.renderDeleteConfirmation(),this.renderStateHistory())}}const jr=(t,n)=>({angularPanelComponent:(0,De.i)(t,n.panel)?.angularComponent}),Zr={},Jr=(0,R.connect)(jr,Zr)(Kr);var Qr=o(173),en=o(34456),Yr=o(38884);const tn=({dashboard:t,panel:n,className:a})=>{const s=(0,S.useSelector)(d=>d.templating),r=(0,Fe.TH)(),{loading:i,value:c}=(0,U.Z)(()=>(0,Yr.aR)(n,t),[n,t,s]);if(i)return e.createElement(w.zx,{disabled:!0},"New alert rule");if(!c)return e.createElement(q.b,{severity:"info",title:"No alerting capable query found"},"Cannot create alerts from this panel because no query to an alerting capable datasource is found.");const l=Qr.Cj.renderUrl("alerting/new",{defaults:JSON.stringify(c),returnTo:r.pathname+r.search});return e.createElement(w.Qj,{icon:"bell",onClick:()=>(0,en.PN)(en.z7.alertRuleFromPanel),href:l,className:a,"data-testid":"create-alert-rule-button"},"New alert rule")};var Xr=o(50657),nn=o(5970),tt=o(46002),Ee=o(76679),an=o(30422),qr=o(68700),rn=o(92746);function sn({dashboard:t,panel:n,poll:a=!1}){const s=(0,S.useDispatch)(),r=(0,rn._)(p=>p.promRules[Ee.GC])??an.oq,i=(0,rn._)(p=>p.rulerRules[Ee.GC])??an.oq;(0,e.useEffect)(()=>{const p=()=>{s((0,nn.y6)({rulesSourceName:Ee.GC,filter:{dashboardUID:t.uid,panelId:n.id}})),s((0,nn.UR)({rulesSourceName:Ee.GC,filter:{dashboardUID:t.uid,panelId:n.id}}))};if(p(),a){const g=setInterval(p,tt.p4);return()=>{clearInterval(g)}}return()=>{}},[s,a,n.id,t.uid]);const c=r.loading||i.loading,l=[r.error,i.error].filter(p=>!!p),d=(0,qr.Zo)(Ee.GC);return{rules:(0,e.useMemo)(()=>d.flatMap(p=>p.groups).flatMap(p=>p.rules).filter(p=>p.annotations[tt.q6.dashboardUID]===t.uid&&p.annotations[tt.q6.panelID]===String(n.id)),[d,t,n]),errors:l,loading:c}}var _r=o(5907);const es=({dashboard:t,panel:n})=>{const a=(0,C.wW)(ts),{errors:s,loading:r,rules:i}=sn({dashboard:t,panel:n,poll:!0}),c=(0,_r.Bz)("grafana"),l=Te.contextSrv.hasPermission(c.create),d=s.length?e.createElement(q.b,{title:"Errors loading rules",severity:"error"},s.map((u,p)=>e.createElement("div",{key:p},"Failed to load Grafana rules state: ",u.message||"Unknown error."))):null;return r&&!i.length?e.createElement("div",{className:a.innerWrapper},d,e.createElement(_t.u,{text:"Loading rules..."})):i.length?e.createElement(oe.$,{autoHeightMin:"100%"},e.createElement("div",{className:a.innerWrapper},d,e.createElement(Xr.i,{rules:i}),!!t.meta.canSave&&l&&e.createElement(tn,{className:a.newButton,panel:n,dashboard:t}))):e.createElement("div",{"data-testid":h.wl.components.PanelAlertTabContent.content,className:a.noRulesWrapper},d,!!t.uid&&e.createElement(e.Fragment,null,e.createElement("p",null,"There are no alert rules linked to this panel."),!!t.meta.canSave&&l&&e.createElement(tn,{panel:n,dashboard:t})),!t.uid&&!!t.meta.canSave&&e.createElement(q.b,{severity:"info",title:"Dashboard not saved"},"Dashboard must be saved before alerts can be added."))},ts=t=>({newButton:(0,m.css)`
    margin-top: ${t.spacing(3)};
  `,innerWrapper:(0,m.css)`
    padding: ${t.spacing(2)};
  `,noRulesWrapper:(0,m.css)`
    margin: ${t.spacing(2)};
    background-color: ${t.colors.background.secondary};
    padding: ${t.spacing(3)};
  `}),ns=b.config.unifiedAlertingEnabled?es:Jr,as=({panel:t,dashboard:n,...a})=>{const{rules:s,loading:r}=sn({panel:t,dashboard:n});return e.createElement(ue.O,{...a,counter:r?null:s.length})};var on=o(31173),$e=o(31674),rs=o(61353),ln=o(40377),G=o(67954),nt=o(45220),ss=o(70274),ye=o(8907),os=o(61387),at=o(35029),is=o(25066),rt=o(6011);const ls=({debugMode:t,index:n,data:a,uiConfig:s,configs:r,onChange:i,toggleShowDebug:c})=>{const l=(0,C.wW)(cs),[d,u]=(0,e.useState)([]),[p,g]=(0,e.useState)([]),f=(0,e.useMemo)(()=>r[n],[r,n]);(0,e.useEffect)(()=>{const E=r[n].transformation,T=E.filter?.options?(0,Lt.b9)(E.filter):void 0,I=r.slice(0,n).map(D=>D.transformation),N=r.slice(n,n+1).map(D=>D.transformation),P={interpolate:D=>(0,Ge.J)().replace(D)},ae=(0,rt.H)(I,a,P).subscribe(D=>{T&&(D=a.filter(Q=>T(Q))),u(D)}),x=(0,rt.H)(I,a,P).pipe((0,is.z)(D=>(0,rt.H)(N,D,P))).subscribe(g);return function(){ae.unsubscribe(),x.unsubscribe()}},[n,a,r]);const v=(0,e.useMemo)(()=>e.createElement(s.editor,{options:{...s.transformation.defaultOptions,...f.transformation.options},input:d,onChange:E=>{i(n,{...f.transformation,options:E})}}),[s.editor,s.transformation.defaultOptions,f.transformation,d,i,n]);return e.createElement("div",{className:l.editor,"data-testid":h.wl.components.TransformTab.transformationEditor(s.name)},v,t&&e.createElement(Ie.d,{title:"Debug transformation",subtitle:s.name,onClose:c},e.createElement("div",{className:l.debugWrapper,"data-testid":h.wl.components.TransformTab.transformationEditorDebugger(s.name)},e.createElement("div",{className:l.debug},e.createElement("div",{className:l.debugTitle},"Input data"),e.createElement("div",{className:l.debugJson},e.createElement(et.g,{json:d}))),e.createElement("div",{className:l.debugSeparator},e.createElement(X.J,{name:"arrow-right"})),e.createElement("div",{className:l.debug},e.createElement("div",{className:l.debugTitle},"Output data"),e.createElement("div",{className:l.debugJson},p&&e.createElement(et.g,{json:p}))))))},cs=t=>({title:(0,m.css)`
      display: flex;
      padding: 4px 8px 4px 8px;
      position: relative;
      height: 35px;
      border-radius: 4px 4px 0 0;
      flex-wrap: nowrap;
      justify-content: space-between;
      align-items: center;
    `,name:(0,m.css)`
      font-weight: ${t.typography.fontWeightMedium};
      color: ${t.colors.primary.text};
    `,iconRow:(0,m.css)`
      display: flex;
    `,icon:(0,m.css)`
      background: transparent;
      border: none;
      box-shadow: none;
      cursor: pointer;
      color: ${t.colors.text.secondary};
      margin-left: ${t.spacing(1)};
      &:hover {
        color: ${t.colors.text};
      }
    `,editor:(0,m.css)``,debugWrapper:(0,m.css)`
      display: flex;
      flex-direction: row;
    `,debugSeparator:(0,m.css)`
      width: 48px;
      min-height: 300px;
      display: flex;
      align-items: center;
      align-self: stretch;
      justify-content: center;
      margin: 0 ${t.spacing(.5)};
      color: ${t.colors.primary.text};
    `,debugTitle:(0,m.css)`
      padding: ${t.spacing(1)} ${t.spacing(.25)};
      font-family: ${t.typography.fontFamilyMonospace};
      font-size: ${t.typography.bodySmall.fontSize};
      color: ${t.colors.text};
      border-bottom: 1px solid ${t.colors.border.weak};
      flex-grow: 0;
      flex-shrink: 1;
    `,debug:(0,m.css)`
      margin-top: ${t.spacing(1)};
      padding: 0 ${t.spacing(1,1,1)};
      border: 1px solid ${t.colors.border.weak};
      background: ${t.isLight?t.v1.palette.white:t.v1.palette.gray05};
      border-radius: ${t.shape.radius.default};
      width: 100%;
      min-height: 300px;
      display: flex;
      flex-direction: column;
      align-self: stretch;
    `,debugJson:(0,m.css)`
      flex-grow: 1;
      height: 100%;
      overflow: hidden;
      padding: ${t.spacing(.5)};
    `});var ds=o(67983),us=o(70727);const ps=({isOpen:t,onCloseClick:n,transformer:a})=>{const{transformation:{name:s},help:r}=a,i=r||(0,us.X)(),c=`Transformation help - ${s}`;return e.createElement(Y.u,{title:c,isOpen:t,onClickBackdrop:()=>n(!1),onDismiss:()=>n(!1)},e.createElement(ds.h,{markdown:i,styleOverrides:{borderTop:"2px solid"}}))};var ms=o(50660);const gs=({index:t,data:n,config:a,onChange:s})=>{const r=(0,C.wW)(hs),i=(0,e.useMemo)(()=>({data:n}),[n]);return e.createElement("div",{className:r.wrapper},e.createElement(ie.g,{label:"Apply transformation to"},e.createElement(ms.M,{value:a.filter,context:i,item:{},onChange:c=>s(t,{...a,filter:c})})))},hs=t=>{const n=t.shape.radius.default;return{wrapper:(0,m.css)`
      padding: ${t.spacing(2)};
      border: 2px solid ${t.colors.background.secondary};
      border-top: none;
      border-radius: 0 0 ${n} ${n};
      position: relative;
      top: -4px;
    `}},fs=({onRemove:t,index:n,id:a,data:s,configs:r,uiConfig:i,onChange:c})=>{const[l,d]=(0,nt.Z)(!1),[u,p]=(0,nt.Z)(!1),[g,f]=(0,nt.Z)(!1),v=!!r[n].transformation.disabled,E=r[n].transformation.filter!=null,T=E||s.length>1,I=(0,e.useCallback)(x=>{const D=r[x].transformation;c(x,{...D,disabled:D.disabled?void 0:!0})},[c,r]),N=(0,e.useCallback)(()=>{let x={...r[n].transformation};x.filter?delete x.filter:x.filter={id:ss.E4.byRefId,options:""},c(n,x)},[c,n,r]),P=(0,e.useCallback)((x,D,Q)=>ce=>{let be="panel_editor_tabs_transformations_toggle";G.default.featureToggles.transformationsRedesign&&(be="transformations_redesign_"+be),(0,re.ff)(be,{action:Q?"off":"on",toggleId:D,transformationId:r[n].transformation.id}),x(ce)},[r,n]),ae=()=>e.createElement(e.Fragment,null,i.state&&e.createElement(at.u,{state:i.state}),e.createElement(ye.V,{title:"Show transform help",icon:"info-circle",onClick:P(f,"help",g),active:g}),T&&e.createElement(ye.V,{title:"Filter",icon:"filter",onClick:P(N,"filter",E),active:E}),e.createElement(ye.V,{title:"Debug",icon:"bug",onClick:P(p,"debug",u),active:u}),e.createElement(ye.V,{title:"Disable transformation",icon:v?"eye-slash":"eye",onClick:P(()=>I(n),"disabled",v),active:v}),e.createElement(ye.y,{title:"Remove",icon:"trash-alt",onClick:()=>G.default.featureToggles.transformationsRedesign?d(!0):t(n)}),G.default.featureToggles.transformationsRedesign&&e.createElement(Me.s,{isOpen:l,title:`Delete ${i.name}?`,body:"Note that removing one transformation may break others. If there is only a single transformation, you will go back to the main selection screen.",confirmText:"Delete",onConfirm:()=>{d(!1),t(n)},onDismiss:()=>d(!1)}));return e.createElement(e.Fragment,null,e.createElement(os.t,{id:a,index:n,title:`${n+1} - ${i.name}`,draggable:!0,actions:ae,disabled:v,expanderMessages:{close:"Collapse transformation row",open:"Expand transformation row"}},E&&e.createElement(gs,{index:n,config:r[n].transformation,data:s,onChange:c}),e.createElement(ls,{debugMode:u,index:n,data:s,configs:r,uiConfig:i,onChange:c,toggleShowDebug:p})),e.createElement(ps,{transformer:i,isOpen:g,onCloseClick:f}))},vs=({data:t,onChange:n,onRemove:a,configs:s})=>e.createElement(e.Fragment,null,s.map((r,i)=>{const c=$e.Z.getIfExists(r.transformation.id);return c?e.createElement(fs,{index:i,id:`${r.id}`,key:`${r.id}`,data:t,configs:s,uiConfig:c,onRemove:a,onChange:n}):null}));var Le=o(94203),ne=o(72435);const Es={[Le.x.Transformations]:"https://grafana.com/docs/grafana/latest/panels/transformations",[Le.x.FieldConfig]:"https://grafana.com/docs/grafana/latest/panels/field-configuration-options/",[Le.x.FieldConfigOverrides]:"https://grafana.com/docs/grafana/latest/panels/field-configuration-options/#override-a-field"},ys=t=>Es[t],bs="dashboard.components.TransformationEditor.featureInfoBox.isDismissed";function Cs(t){const{noTransforms:n,search:a,xforms:s,onSearchChange:r,onSearchKeyDown:i,onTransformationAdd:c,suffix:l}=t;return e.createElement(L.wc,null,n&&e.createElement(L.W2,{grow:1},e.createElement(ct.G,{storageKey:bs,defaultValue:!1},(d,u)=>d?null:e.createElement(q.b,{title:"Transformations",severity:"info",onRemove:()=>{u(!0)}},e.createElement("p",null,"Transformations allow you to join, calculate, re-order, hide, and rename your query results before they are visualized. ",e.createElement("br",null),"Many transforms are not suitable if you're using the Graph visualization, as it currently only supports time series data. ",e.createElement("br",null),"It can help to switch to the Table visualization to understand what a transformation is doing."," "),e.createElement("a",{href:ys(Le.x.Transformations),className:"external-link",target:"_blank",rel:"noreferrer"},"Read more")))),e.createElement(se.I,{"data-testid":h.wl.components.Transforms.searchInput,value:a??"",autoFocus:!n,placeholder:"Search for transformation",onChange:r,onKeyDown:i,suffix:l}),s.map(d=>e.createElement(Ps,{key:d.name,transform:d,onClick:()=>{c({value:d.id})}})))}function Ps({transform:t,onClick:n}){const a=(0,C.wW)(Ts);return e.createElement(ne.Z,{className:a.card,"data-testid":h.wl.components.TransformTab.newTransform(t.name),onClick:n},e.createElement(ne.Z.Heading,null,t.name),e.createElement(ne.Z.Description,null,t.description),t.state&&e.createElement(ne.Z.Tags,null,e.createElement(at.u,{state:t.state})))}function Ts(t){return{card:(0,m.css)({margin:"0",padding:`${t.spacing(1)}`})}}var Ss=o(92344),A=o(61751),xs=o(45564),Ds=o(37600);const ws=[["viewAll","View all"],...Object.entries(Ds.Vx)];function Is(t){const n=(0,C.wW)(Ns),{noTransforms:a,suffix:s,setState:r,xforms:i,search:c,onSearchChange:l,onSearchKeyDown:d,showIllustrations:u,onTransformationAdd:p,selectedFilter:g,data:f}=t;return e.createElement(Ie.d,{size:"md",onClose:()=>r({showPicker:!1}),title:"Add another transformation"},e.createElement("div",{className:n.searchWrapper},e.createElement(se.I,{"data-testid":h.wl.components.Transforms.searchInput,className:n.searchInput,value:c??"",autoFocus:!a,placeholder:"Search for transformation",onChange:l,onKeyDown:d,suffix:s}),e.createElement("div",{className:n.showImages},e.createElement("span",{className:n.illustationSwitchLabel},"Show images")," ",e.createElement(ee.r,{value:u,onChange:()=>r({showIllustrations:!u})}))),e.createElement("div",{className:n.filterWrapper},ws.map(([v,E])=>e.createElement(xs.B,{key:v,onClick:()=>r({selectedFilter:v}),label:E,selected:g===v}))),e.createElement(Os,{showIllustrations:u,transformations:i,data:f,onClick:v=>{p({value:v})}}))}function Ns(t){return{showImages:(0,m.css)({flexBasis:"0",display:"flex",gap:"8px",alignItems:"center"}),pickerInformationLine:(0,m.css)({fontSize:"16px",marginBottom:`${t.spacing(2)}`}),pickerInformationLineHighlight:(0,m.css)({verticalAlign:"middle"}),searchWrapper:(0,m.css)({display:"flex",flexWrap:"wrap",columnGap:"27px",rowGap:"16px",width:"100%"}),searchInput:(0,m.css)({flexGrow:"1",width:"initial"}),illustationSwitchLabel:(0,m.css)({whiteSpace:"nowrap"}),filterWrapper:(0,m.css)({padding:`${t.spacing(1)} 0`,display:"flex",flexWrap:"wrap",rowGap:`${t.spacing(1)}`,columnGap:`${t.spacing(.5)}`})}}function Os({showIllustrations:t,transformations:n,onClick:a,data:s}){const r=(0,C.wW)(Rs);return e.createElement("div",{className:r.grid},n.map(i=>{let c=Ss.s.Applicable;i.transformation.isApplicable!==void 0&&(c=i.transformation.isApplicable(s));const l=c>0;let d=null;i.transformation.isApplicableDescription!==void 0&&(typeof i.transformation.isApplicableDescription=="function"?d=i.transformation.isApplicableDescription(s):d=i.transformation.isApplicableDescription);let u=r.newCard;return l||(u=(0,m.cx)(r.newCard,r.cardDisabled)),e.createElement(ne.Z,{className:u,"data-testid":h.wl.components.TransformTab.newTransform(i.name),onClick:()=>a(i.id),key:i.id},e.createElement(ne.Z.Heading,{className:r.heading},e.createElement("span",null,i.name),e.createElement("span",{className:r.pluginStateInfoWrapper},e.createElement(at.u,{state:i.state}))),e.createElement(ne.Z.Description,{className:r.description},e.createElement("span",null,$s(i.id)),t&&e.createElement("span",null,e.createElement("img",{className:r.image,src:As(i.id,!l),alt:i.name})),!l&&d!==null&&e.createElement(fe.h,{className:r.cardApplicableInfo,name:"info-circle",tooltip:d})))}))}function Rs(t){return{heading:(0,m.css)`
            font-weight: 400,
            > button: {
                width: '100%',
                display: 'flex',
                justify-content: 'space-between',
                align-items: 'center',
                flex-wrap: 'no-wrap',
        },`,description:(0,m.css)({fontSize:"12px",display:"flex",flexDirection:"column",justifyContent:"space-between"}),image:(0,m.css)({display:"block",maxEidth:"100%`",marginTop:`${t.spacing(2)}`}),grid:(0,m.css)({display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gridAutoRows:"1fr",gap:`${t.spacing(2)} ${t.spacing(1)}`,width:"100%"}),cardDisabled:(0,m.css)({backgroundColor:"rgb(204, 204, 220, 0.045)",color:`${t.colors.text.disabled} !important`}),cardApplicableInfo:(0,m.css)({position:"absolute",bottom:`${t.spacing(1)}`,right:`${t.spacing(1)}`}),newCard:(0,m.css)({gridTemplateRows:"min-content 0 1fr 0"}),pluginStateInfoWrapper:(0,m.css)({marginLeft:"5px"})}}const As=(t,n)=>{let a=null;return n?a="disabled":a=G.default.theme2.isDark?"dark":"light",`public/img/transformations/${a}/${t}.svg`},Ms={[A.W.concatenate]:"Combine all fields into a single frame.",[A.W.configFromData]:"Set unit, min, max and more.",[A.W.fieldLookup]:"Use a field value to lookup countries, states, or airports.",[A.W.filterFieldsByName]:"Remove parts of the query results using a regex pattern.",[A.W.filterByRefId]:"Remove rows from the data based on origin query",[A.W.filterByValue]:"Remove rows from the query results using user-defined filters.",[A.W.groupBy]:"Group data by a field value and create aggregate data.",[A.W.groupingToMatrix]:"Summarize and reorganize data based on three fields.",[A.W.joinByField]:"Combine rows from 2+ tables, based on a related field.",[A.W.labelsToFields]:"Group series by time and return labels or tags as fields.",[A.W.merge]:"Merge multiple series. Values will be combined into one row.",[A.W.organize]:"Re-order, hide, or rename fields.",[A.W.partitionByValues]:"Split a one-frame dataset into multiple series.",[A.W.prepareTimeSeries]:"Stretch data frames from the wide format into the long format.",[A.W.reduce]:"Reduce all rows or data points to a single value (ex. max, mean).",[A.W.renameByRegex]:"Rename parts of the query results using a regular expression and replacement pattern.",[A.W.seriesToRows]:"Merge multiple series. Return time, metric and values as a row."},$s=t=>Ms[t]||$e.Z.getIfExists(t)?.description||"",cn="viewAll";class Ls extends e.PureComponent{constructor(n){super(n),this.onSearchChange=r=>{this.setState({search:r.target.value})},this.onSearchKeyDown=r=>{if(r.key==="Enter"){const{search:i}=this.state;if(i){const c=i.toLowerCase(),l=$e.Z.list().filter(d=>(d.name+d.description).toLowerCase().indexOf(c)>=0);l.length>0&&this.onTransformationAdd({value:l[0].id})}}else r.keyCode===27&&(this.setState({search:"",showPicker:!1}),r.stopPropagation())},this.getTransformationNextId=r=>{const{transformations:i}=this.state;let c=0;const l=i.filter(d=>d.id.startsWith(r)).map(d=>d.id);return l.length!==0&&(c=Math.max(...l.map(d=>parseInt(d.match(/\d+/)[0],10)))+1),`${r}-${c}`},this.onTransformationAdd=r=>{let i="panel_editor_tabs_transformations_management";G.default.featureToggles.transformationsRedesign&&(i="transformations_redesign_"+i),(0,re.ff)(i,{action:"add",transformationId:r.value});const{transformations:c}=this.state,l=this.getTransformationNextId(r.value);this.setState({search:"",showPicker:!1}),this.onChange([...c,{id:l,transformation:{id:r.value,options:{}}}])},this.onTransformationChange=(r,i)=>{const{transformations:c}=this.state,l=Array.from(c);let d="panel_editor_tabs_transformations_management";G.default.featureToggles.transformationsRedesign&&(d="transformations_redesign_"+d),(0,re.ff)(d,{action:"change",transformationId:l[r].transformation.id}),l[r].transformation=i,this.onChange(l)},this.onTransformationRemove=r=>{const{transformations:i}=this.state,c=Array.from(i);let l="panel_editor_tabs_transformations_management";G.default.featureToggles.transformationsRedesign&&(l="transformations_redesign_"+l),(0,re.ff)(l,{action:"remove",transformationId:c[r].transformation.id}),c.splice(r,1),this.onChange(c)},this.onTransformationRemoveAll=()=>{this.onChange([]),this.setState({showRemoveAllModal:!1})},this.onDragEnd=r=>{const{transformations:i}=this.state;if(!r||!r.destination)return;const c=r.source.index,l=r.destination.index;if(c===l)return;const d=Array.from(i),[u]=d.splice(c,1);d.splice(l,0,u),this.onChange(d)},this.renderEmptyMessage=()=>e.createElement(rs.x,{alignItems:"center",padding:4},e.createElement(de.K,{direction:"column",alignItems:"center",gap:2},e.createElement(ln.x,{element:"h3",textAlignment:"center"},e.createElement(me.cC,{key:"transformations.empty.add-transformation-header"},"Start transforming data")),e.createElement(ln.x,{element:"p",textAlignment:"center","data-testid":h.wl.components.Transforms.noTransformationsMessage},e.createElement(me.cC,{key:"transformations.empty.add-transformation-body"},"Transformations allow data to be changed in various ways before your visualization is shown.",e.createElement("br",null),"This includes joining data together, renaming fields, making calculations, formatting data for display, and more.")),e.createElement(w.zx,{icon:"plus",variant:"primary",size:"md",onClick:()=>{this.setState({showPicker:!0})},"data-testid":h.wl.components.Transforms.addTransformationButton},"Add transformation"))),this.renderTransformationEditors=()=>{const{data:r,transformations:i}=this.state;return e.createElement(on.Z5,{onDragEnd:this.onDragEnd},e.createElement(on.bK,{droppableId:"transformations-list",direction:"vertical"},c=>e.createElement("div",{ref:c.innerRef,...c.droppableProps},e.createElement(vs,{configs:i,data:r,onRemove:this.onTransformationRemove,onChange:this.onTransformationChange}),c.placeholder)))};const a=n.panel.transformations||[],s=this.buildTransformationIds(a);this.state={transformations:a.map((r,i)=>({transformation:r,id:s[i]})),data:[],search:"",selectedFilter:cn,showIllustrations:!0}}buildTransformationIds(n){const a={},s=[];for(let r=0;r<n.length;r++){const i=n[r];a[i.id]===void 0?a[i.id]=0:a[i.id]+=1,s.push(`${n[r].id}-${a[n[r].id]}`)}return s}componentDidMount(){this.subscription=this.props.panel.getQueryRunner().getData({withTransforms:!1,withFieldConfig:!1}).subscribe({next:n=>this.setState({data:n.series})})}componentWillUnmount(){this.subscription&&this.subscription.unsubscribe()}componentDidUpdate(n,a){if(G.default.featureToggles.transformationsRedesign){const r=!(a.transformations.length>0)||a.showPicker,c=!(this.state.transformations.length>0)||this.state.showPicker;if(r!==c){const l=Math.random()/2;this.setState({scrollTop:c?l:Number.MAX_SAFE_INTEGER})}}}onChange(n){this.setState({transformations:n}),this.props.panel.setTransformations(n.map(a=>a.transformation))}renderTransformsPicker(){let{showPicker:n}=this.state;const{transformations:a,search:s}=this.state,{transformationsRedesign:r}=G.default.featureToggles,i=!a?.length,c=a.length>0;let l=null,d=$e.Z.list().sort((f,v)=>f.name>v.name?1:v.name>f.name?-1:0);if(!r&&i&&(n=!0),this.state.selectedFilter!==cn&&(d=d.filter(f=>f.categories&&this.state.selectedFilter&&f.categories.has(this.state.selectedFilter))),s){const f=s.toLowerCase(),v=d.filter(E=>(E.name+E.description).toLowerCase().indexOf(f)>=0);l=e.createElement(e.Fragment,null,v.length," / ",d.length," \xA0\xA0",e.createElement(fe.h,{name:"times",onClick:()=>{this.setState({search:""})},tooltip:"Clear search"})),d=v}!l&&n&&!i&&(l=e.createElement(fe.h,{name:"times",onClick:()=>{this.setState({showPicker:!1})},tooltip:"Close picker"}));let u=null,p=null;r?(u=e.createElement(Is,{noTransforms:i,search:s,suffix:l,xforms:d,setState:this.setState.bind(this),onSearchChange:this.onSearchChange,onSearchKeyDown:this.onSearchKeyDown,onTransformationAdd:this.onTransformationAdd,data:this.state.data,selectedFilter:this.state.selectedFilter,showIllustrations:this.state.showIllustrations}),p=e.createElement(e.Fragment,null,e.createElement(w.zx,{icon:"times",variant:"secondary",onClick:()=>this.setState({showRemoveAllModal:!0}),style:{marginLeft:this.props.theme.spacing.md}},"Delete all transformations"),e.createElement(Me.s,{isOpen:!!this.state.showRemoveAllModal,title:"Delete all transformations?",body:"By deleting all transformations, you will go back to the main selection screen.",confirmText:"Delete all",onConfirm:()=>this.onTransformationRemoveAll(),onDismiss:()=>this.setState({showRemoveAllModal:!1})}))):u=e.createElement(Cs,{noTransforms:i,search:s,suffix:l,xforms:d,onSearchChange:this.onSearchChange,onSearchKeyDown:this.onSearchKeyDown,onTransformationAdd:this.onTransformationAdd});const g=e.createElement(kt.h,null,e.createElement(w.zx,{icon:"plus",variant:"secondary",onClick:()=>{this.setState({showPicker:!0})},"data-testid":h.wl.components.Transforms.addTransformationButton},"Add another transformation"),p);return e.createElement(e.Fragment,null,n&&u,r&&c&&g||!r&&!n&&c&&g)}render(){const{panel:{alert:n}}=this.props,{transformations:a}=this.state,s=a.length>0;if(n){const r=s?"Transformations can't be used on a panel with alerts":"Transformations can't be used on a panel with existing alerts";return e.createElement(Xt,{message:r})}return e.createElement(oe.$,{scrollTop:this.state.scrollTop,autoHeightMin:"100%"},e.createElement(L.W2,{padding:"lg"},e.createElement("div",{"data-testid":h.wl.components.TransformTab.content},!s&&G.default.featureToggles.transformationsRedesign&&this.renderEmptyMessage(),s&&this.renderTransformationEditors(),this.renderTransformsPicker())))}}const Fs=(0,C.Zz)(Ls);var Ws=o(52219),st=o(65512),Us=o(87181),zs=o(63459);class Bs extends e.PureComponent{constructor(n){super(n),this.updateLastUsedDatasource=a=>{if(!a.uid)return;const s=(0,ve.h4)().getCurrent()?.uid??"";if(a.uid===zs.D)return(0,Pe.$0)(s);(0,Pe.yQ)(s,a.uid)},this.onRunQueries=()=>{this.props.panel.refresh()},this.onOpenQueryInspector=()=>{y.E1.partial({inspect:this.props.panel.id,inspectTab:"query"})},this.onOptionsChange=a=>{const{panel:s}=this.props;s.updateQueries(a),a.dataSource.uid!==s.datasource?.uid&&setTimeout(this.onRunQueries,10),this.forceUpdate()}}buildQueryOptions(n){const a=n.datasource??{default:!0},s=(0,st.ak)().getInstanceSettings(a);return this.updateLastUsedDatasource(a),{cacheTimeout:s?.meta.queryOptions?.cacheTimeout?n.cacheTimeout:void 0,dataSource:{default:s?.isDefault,type:s?.type,uid:s?.uid},queryCachingTTL:s?.cachingConfig?.enabled?n.queryCachingTTL:void 0,queries:n.targets,maxDataPoints:n.maxDataPoints,minInterval:n.interval,timeRange:{from:n.timeFrom,shift:n.timeShift,hide:n.hideTimeOverride}}}async componentDidMount(){const{panel:n}=this.props;if(!n.datasource){let a;const s=(0,ve.h4)().getCurrent()?.uid??"",r=(0,Pe.$N)(s);r?.datasourceUid!==null&&(a=(0,st.ak)().getInstanceSettings(r?.datasourceUid)),a||(a=(0,st.ak)().getInstanceSettings(null)),n.datasource=(0,Ws.iU)(a),this.forceUpdate()}}render(){const{panel:n}=this.props;if(!n.datasource)return null;const a=this.buildQueryOptions(n);return e.createElement(Us.D,{options:a,queryRunner:n.getQueryRunner(),onRunQueries:this.onRunQueries,onOpenQueryInspector:this.onOpenQueryInspector,onOptionsChange:this.onOptionsChange})}}const dn=e.memo(({panel:t,dashboard:n,tabs:a,onChangeTab:s})=>{const r=(0,Yt.N)(),i=(0,C.wW)(ks),c=(0,e.useCallback)(d=>{let u="panel_editor_tabs_changed";b.config.featureToggles.transformationsRedesign&&(u="transformations_redesign_"+u),d.active||(0,re.ff)(u,{tab_id:d.id}),s(d)},[s]);(0,e.useEffect)(()=>{const d=new wt.w0;return d.add(t.events.subscribe(Z.pO,r)),d.add(t.events.subscribe(Z.Xw,r)),()=>d.unsubscribe()},[t,n,r]);const l=a.find(d=>d.active);return a.length===0?null:e.createElement("div",{className:i.wrapper},e.createElement(Be.J,{className:i.tabBar,hideBorder:!0},a.map(d=>d.id===O.Ip.Alert?Vs(d,t,n,c):e.createElement(ue.O,{key:d.id,label:d.text,active:d.active,onChangeTab:()=>c(d),icon:(0,qe.toIconName)(d.icon),counter:un(t,d)}))),e.createElement(Lr.I,{className:i.tabContent},l.id===O.Ip.Query&&e.createElement(Bs,{panel:t,queries:t.targets}),l.id===O.Ip.Alert&&e.createElement(ns,{panel:t,dashboard:n}),l.id===O.Ip.Transform&&e.createElement(Fs,{panel:t})))});dn.displayName="PanelEditorTabs";function un(t,n){switch(n.id){case O.Ip.Query:return t.targets.length;case O.Ip.Alert:return t.alert?1:0;case O.Ip.Transform:return(t.getTransformations()??[]).length}return null}function Vs(t,n,a,s){return!b.config.alertingEnabled&&!b.config.unifiedAlertingEnabled?null:b.config.unifiedAlertingEnabled?e.createElement(as,{key:t.id,label:t.text,active:t.active,onChangeTab:()=>s(t),icon:(0,qe.toIconName)(t.icon),panel:n,dashboard:a}):b.config.alertingEnabled?e.createElement(ue.O,{key:t.id,label:t.text,active:t.active,onChangeTab:()=>s(t),icon:(0,qe.toIconName)(t.icon),counter:un(n,t)}):null}const ks=t=>({wrapper:(0,m.css)`
      display: flex;
      flex-direction: column;
      height: 100%;
    `,tabBar:(0,m.css)`
      padding-left: ${t.spacing(2)};
    `,tabContent:(0,m.css)`
      padding: 0;
      display: flex;
      flex-direction: column;
      flex: 1;
      min-height: 0;
      background: ${t.colors.background.primary};
      border: 1px solid ${t.components.panel.borderColor};
      border-left: none;
      border-bottom: none;
      border-top-right-radius: ${t.shape.borderRadius(1.5)};
    `});var Hs=o(98746),Gs=o(38685);const Ks=(t,n)=>{const a=t.panelEditor.getPanel(),s=(0,De.i)(t,a);return{panel:a,plugin:s?.plugin,instanceState:s?.instanceState,initDone:t.panelEditor.initDone,uiState:t.panelEditor.ui,tableViewEnabled:t.panelEditor.tableViewEnabled,variables:(0,Ze.gt)(n.dashboard.uid,t)}},js={initPanelEditor:Fn,discardPanelChanges:vt,updatePanelEditorUIState:ze,updateTimeZoneForSession:Ca.YT,toggleTableView:J.OT,notifyApp:$.$l},Zs=(0,R.connect)(Ks,js);class Js extends e.PureComponent{constructor(){super(...arguments),this.state={showSaveLibraryPanelModal:!1},this.triggerForceUpdate=()=>{this.forceUpdate()},this.onBack=()=>{y.E1.partial({editPanel:null,tab:null,showCategory:null})},this.onDiscard=()=>{this.props.discardPanelChanges(),this.onBack()},this.onSaveDashboard=()=>{fa.h$.publish(new Z.Dn({component:xa.d,props:{dashboard:this.props.dashboard}}))},this.onSaveLibraryPanel=async()=>{(0,he.V)(this.props.panel)&&this.setState({showSaveLibraryPanelModal:!0})},this.onChangeTab=n=>{y.E1.partial({tab:n.id})},this.onFieldConfigChange=n=>{this.props.panel.updateFieldConfig({...n})},this.onPanelOptionsChanged=n=>{this.props.panel.updateOptions(n)},this.onPanelConfigChanged=(n,a)=>{this.props.panel.setProperty(n,a),this.props.panel.render(),this.forceUpdate()},this.onDisplayModeChange=n=>{const{updatePanelEditorUIState:a}=this.props;this.props.tableViewEnabled&&this.props.toggleTableView(),a({mode:n})},this.onToggleTableView=()=>{this.props.toggleTableView()},this.onGoBackToDashboard=()=>{y.E1.partial({editPanel:null,tab:null,showCategory:null})},this.onConfirmAndDismissLibarayPanelModel=()=>{this.setState({showSaveLibraryPanelModal:!1})}}componentDidMount(){this.props.initPanelEditor(this.props.sourcePanel,this.props.dashboard)}componentDidUpdate(){const{panel:n,initDone:a}=this.props;a&&!this.eventSubs&&(this.eventSubs=new wt.w0,this.eventSubs.add(n.events.subscribe(Z.Wj,this.triggerForceUpdate)))}componentWillUnmount(){this.eventSubs?.unsubscribe()}renderPanel(n,a){const{dashboard:s,panel:r,uiState:i,tableViewEnabled:c,theme:l}=this.props;return e.createElement("div",{className:n.mainPaneWrapper,key:"panel"},this.renderPanelToolbar(n),e.createElement("div",{className:n.panelWrapper},e.createElement(we.Z,null,({width:d,height:u})=>{if(d<3||u<3)return null;if(a&&(u-=l.spacing.gridSize*2),c)return e.createElement($r,{width:d,height:u,panel:r,dashboard:s});const p=(0,Gs.jF)(i.mode,d,u,r);return e.createElement("div",{className:n.centeringContainer,style:{width:d,height:u}},e.createElement("div",{style:p,"data-panelid":r.id},e.createElement(Ta.l,{key:r.key,stateKey:r.key,dashboard:s,panel:r,isEditing:!0,isViewing:!1,lazy:!1,width:p.width,height:p.height})))})))}renderPanelAndEditor(n,a){const{panel:s,dashboard:r,plugin:i,tab:c}=this.props,l=(0,Hs.b)(c,i),d=l.length===0,u=this.renderPanel(a,d);return l.length===0?e.createElement("div",{className:a.onlyPanel},u):e.createElement(Nt.U,{splitOrientation:"horizontal",maxSize:-200,paneSize:n.topPaneSize,primary:"first",secondaryPaneStyle:{minHeight:0},onDragFinished:p=>{p&&ze({topPaneSize:p/window.innerHeight})}},u,e.createElement("div",{className:a.tabsWrapper,"aria-label":h.wl.components.PanelEditor.DataPane.content,key:"panel-editor-tabs"},e.createElement(dn,{key:s.key,panel:s,dashboard:r,tabs:l,onChangeTab:this.onChangeTab})))}renderTemplateVariables(n){const{variables:a}=this.props;return a.length?e.createElement("div",{className:n.variablesWrapper},e.createElement(Ot,{variables:a})):null}renderPanelToolbar(n){const{dashboard:a,uiState:s,variables:r,updateTimeZoneForSession:i,panel:c,tableViewEnabled:l}=this.props;return e.createElement("div",{className:n.panelToolbar},e.createElement(L.Lh,{justify:r.length>0?"space-between":"flex-end",align:"flex-start"},this.renderTemplateVariables(n),e.createElement(de.K,{gap:1},e.createElement(ee.x,{label:"Table view",showLabel:!0,id:"table-view",value:l,onClick:this.onToggleTableView,"aria-label":h.wl.components.PanelEditor.toggleTableView}),e.createElement(Re.S,{value:s.mode,options:O.d7,onChange:this.onDisplayModeChange}),e.createElement(Sa.C,{dashboard:a,onChangeTimeZone:i,isOnCanvas:!0}),!s.isPanelOptionsVisible&&e.createElement(Ye,{panel:c}))))}renderEditorActions(){const n="sm";let a=[e.createElement(w.zx,{onClick:this.onDiscard,title:"Undo all changes",key:"discard",size:n,variant:"destructive",fill:"outline"},"Discard"),this.props.panel.libraryPanel?e.createElement(w.zx,{onClick:this.onSaveLibraryPanel,variant:"primary",size:n,title:"Apply changes and save library panel",key:"save-panel"},"Save library panel"):e.createElement(w.zx,{onClick:this.onSaveDashboard,title:"Apply changes and save dashboard",key:"save",size:n,variant:"secondary"},"Save"),e.createElement(w.zx,{onClick:this.onBack,variant:"primary",title:"Apply changes and go back to dashboard","data-testid":h.wl.components.PanelEditor.applyButton,key:"apply",size:n},"Apply")];return this.props.panel.libraryPanel&&(a.splice(1,0,e.createElement(gt.JY,{key:"unlink-controller"},({showModal:s,hideModal:r})=>e.createElement(Ke.h,{onClick:()=>{s(Pa.i,{onConfirm:()=>{this.props.panel.unlinkLibraryPanel(),this.forceUpdate()},onDismiss:r,isOpen:!0})},title:"Disconnects this panel from the library panel so that you can edit it regularly.",key:"unlink"},"Unlink"))),a.pop()),a}renderOptionsPane(){const{plugin:n,dashboard:a,panel:s,instanceState:r}=this.props;return n?e.createElement(wr,{plugin:n,dashboard:a,panel:s,instanceState:r,onFieldConfigsChange:this.onFieldConfigChange,onPanelOptionsChanged:this.onPanelOptionsChanged,onPanelConfigChange:this.onPanelConfigChanged}):e.createElement("div",null)}render(){const{initDone:n,uiState:a,theme:s,sectionNav:r,pageNav:i,className:c,updatePanelEditorUIState:l}=this.props,d=Ys(s,this.props);return n?e.createElement(W.T,{navModel:r,pageNav:i,"aria-label":h.wl.components.PanelEditor.General.content,layout:M.Q.Custom,className:c},e.createElement(ha.A,{actions:e.createElement(ga.R,{alignment:"right"},this.renderEditorActions())}),e.createElement("div",{className:d.wrapper},e.createElement("div",{className:d.verticalSplitPanesWrapper},a.isPanelOptionsVisible?e.createElement(Nt.U,{splitOrientation:"vertical",maxSize:-300,paneSize:a.rightPaneSize,primary:"second",onDragFinished:u=>{u&&l({rightPaneSize:u/window.innerWidth})}},this.renderPanelAndEditor(a,d),this.renderOptionsPane()):this.renderPanelAndEditor(a,d)),this.state.showSaveLibraryPanelModal&&e.createElement(ht,{panel:this.props.panel,folderUid:this.props.dashboard.meta.folderUid??"",onConfirm:this.onConfirmAndDismissLibarayPanelModel,onDiscard:this.onDiscard,onDismiss:this.onConfirmAndDismissLibarayPanelModel}))):null}}const Qs=(0,C.HE)(Zs(Js)),Ys=(0,It.B)((t,n)=>{const{uiState:a}=n,s=t.spacing(2);return{wrapper:(0,m.css)({width:"100%",flexGrow:1,minHeight:0,display:"flex",paddingTop:t.spacing(2)}),verticalSplitPanesWrapper:(0,m.css)`
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      position: relative;
    `,mainPaneWrapper:(0,m.css)`
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      padding-right: ${a.isPanelOptionsVisible?0:s};
    `,variablesWrapper:(0,m.css)`
      label: variablesWrapper;
      display: flex;
      flex-grow: 1;
      flex-wrap: wrap;
      gap: ${t.spacing(1,2)};
    `,panelWrapper:(0,m.css)`
      flex: 1 1 0;
      min-height: 0;
      width: 100%;
      padding-left: ${s};
    `,tabsWrapper:(0,m.css)`
      height: 100%;
      width: 100%;
    `,panelToolbar:(0,m.css)`
      display: flex;
      padding: 0 0 ${s} ${s};
      justify-content: space-between;
      flex-wrap: wrap;
    `,angularWarning:(0,m.css)`
      display: flex;
      height: theme.spacing(4);
      align-items: center;
    `,toolbarLeft:(0,m.css)`
      padding-left: ${t.spacing(1)};
    `,centeringContainer:(0,m.css)`
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      flex-direction: column;
    `,onlyPanel:(0,m.css)`
      height: 100%;
      position: absolute;
      overflow: hidden;
      width: 100%;
    `}});var Xs=o(81368),qs=o(84933),_s=o(3446),eo=o(9739);const to=({annotation:t,events:n,onEnabledChanged:a})=>{const[s,r]=(0,e.useState)(!1),i=(0,C.wW)(no),c=()=>(0,eo.kt)().cancel(t);return(0,e.useEffect)(()=>{const l=n.getStream(Z.z).subscribe({next:u=>{u.payload===t&&r(!0)}}),d=n.getStream(Z.RB).subscribe({next:u=>{u.payload===t&&r(!1)}});return()=>{l.unsubscribe(),d.unsubscribe()}}),e.createElement("div",{key:t.name,className:i.annotation},e.createElement(Xs.Z,null,e.createElement(qs._,{label:t.name,disabled:s,"data-testid":h.wl.pages.Dashboard.SubMenu.Annotations.annotationLabel(t.name)},e.createElement(ee.x,{label:t.name,value:t.enable,onChange:()=>a(t),disabled:s,"data-testid":h.wl.pages.Dashboard.SubMenu.Annotations.annotationToggle(t.name)})),e.createElement("div",{className:i.indicator},e.createElement(_s.T,{loading:s,onCancel:c}))))};function no(t){return{annotation:(0,m.css)`
      display: inline-block;
      margin-right: ${t.spacing(1)};

      .fa-caret-down {
        font-size: 75%;
        padding-left: ${t.spacing(1)};
      }

      .gf-form-inline .gf-form {
        margin-bottom: 0;
      }
    `,indicator:(0,m.css)`
      align-self: center;
      padding: 0 ${t.spacing(.5)};
    `}}const ao=({annotations:t,onAnnotationChanged:n,events:a})=>{const[s,r]=(0,e.useState)([]);return(0,e.useEffect)(()=>{r(t.filter(i=>i.hide!==!0))},[t]),s.length===0?null:e.createElement("div",{"data-testid":h.wl.pages.Dashboard.SubMenu.Annotations.annotationsWrapper},s.map(i=>e.createElement(to,{events:a,annotation:i,onEnabledChanged:n,key:i.name})))};var ro=o(33067),so=o(12331),oo=o(47020),pn=o(53568);const io=({dashboard:t,links:n})=>{const a=(0,Yt.N)();return(0,ro.Z)(()=>{const s=t.events.subscribe(Qt.md,a);return()=>s.unsubscribe()}),n.length?e.createElement(e.Fragment,null,n.map((s,r)=>{const i=(0,Qe.Bq)().getAnchorInfo(s),c=`${s.title}-$${r}`;if(s.type==="dashboards")return e.createElement(pn.Ul,{key:c,link:s,linkInfo:i,dashboardUID:t.uid});const l=oo.xy[s.icon],d=e.createElement(pn.MM,{href:(0,so.Nm)(i.href),target:s.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":h.wl.components.DashboardLinks.link,icon:l},i.title);return e.createElement("div",{key:c,className:"gf-form","data-testid":h.wl.components.DashboardLinks.container},s.tooltip?e.createElement(ge.u,{content:i.tooltip},d):d)})):null};class lo extends e.PureComponent{constructor(){super(...arguments),this.onAnnotationStateChanged=n=>{for(let a=0;a<this.props.dashboard.annotations.list.length;a++){const s=this.props.dashboard.annotations.list[a];if(s.name===n.name){s.enable=!s.enable;break}}this.props.dashboard.startRefresh(),this.forceUpdate()},this.disableSubmitOnEnter=n=>{n.preventDefault()}}render(){const{dashboard:n,variables:a,links:s,annotations:r,theme:i}=this.props,c=uo(i);if(!n.isSubMenuVisible())return null;const l=n.meta.isSnapshot??!1;return e.createElement("div",{className:c.submenu},e.createElement("form",{"aria-label":"Template variables",className:c.formStyles,onSubmit:this.disableSubmitOnEnter},e.createElement(Ot,{variables:a,readOnly:l})),e.createElement(ao,{annotations:r,onAnnotationChanged:this.onAnnotationStateChanged,events:n.events}),e.createElement("div",{className:c.spacer}),n&&e.createElement(io,{dashboard:n,links:s}))}}const co=(t,n)=>{const{uid:a}=n.dashboard,s=(0,Ze.AE)(a,t);return{variables:(0,Ze.IV)(a,s.variables)}},uo=(0,It.B)(t=>({formStyles:(0,m.css)`
      display: flex;
      flex-wrap: wrap;
      display: contents;
    `,submenu:(0,m.css)`
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      align-content: flex-start;
      align-items: flex-start;
      gap: ${t.spacing(1)} ${t.spacing(2)};
      padding: 0 0 ${t.spacing(1)} 0;
    `,spacer:(0,m.css)({flexGrow:1})})),mn=(0,C.HE)((0,R.connect)(co)(lo));mn.displayName="SubMenu";var po=o(17691),mo=o(26515),go=o(63319);const ho=t=>({initPhase:t.dashboard.initPhase,initError:t.dashboard.initError,dashboard:t.dashboard.getModel(),navIndex:t.navIndex}),fo={initDashboard:St.mV,cleanUpDashboardAndVariables:go.lw,notifyApp:$.$l,cancelVariables:pt.wX,templateVarsChangedInUrl:pt.xs},vo=(0,R.connect)(ho,fo);class gn extends e.PureComponent{constructor(){super(...arguments),this.forceRouteReloadCounter=0,this.state=this.getCleanState(),this.updateLiveTimer=()=>{let n;this.props.dashboard?.liveNow&&(n=(0,le.$t)().timeRange()),mo.A.setLiveTimeRange(n)},this.onAddPanel=()=>{const{dashboard:n}=this.props;n&&(n.panels.length>0&&n.panels[0].type==="add-panel"||(n.addPanel({type:"add-panel",gridPos:(0,Ue.lg)(n),title:"Panel Title"}),this.setState({updateScrollTop:0})))},this.setScrollRef=n=>{this.setState({scrollElement:n})}}getCleanState(){return{editPanel:null,viewPanel:null,showLoadingState:!1,panelNotFound:!1,editPanelAccessDenied:!1}}componentDidMount(){this.initDashboard(),this.forceRouteReloadCounter=this.props.history.location.state?.routeReloadCounter||0}componentWillUnmount(){this.closeDashboard()}closeDashboard(){this.props.cleanUpDashboardAndVariables(),this.setState(this.getCleanState())}initDashboard(){const{dashboard:n,match:a,queryParams:s}=this.props;n&&this.closeDashboard(),this.props.initDashboard({urlSlug:a.params.slug,urlUid:a.params.uid,urlType:a.params.type,urlFolderUid:s.folderUid,panelType:s.panelType,routeName:this.props.route.routeName,fixUrl:!0,accessToken:a.params.accessToken,keybindingSrv:this.context.keybindings}),setTimeout(this.updateLiveTimer,250)}componentDidUpdate(n,a){const{dashboard:s,match:r,templateVarsChangedInUrl:i}=this.props,c=this.props.history.location.state?.routeReloadCounter;if(s){if(n.match.params.uid!==r.params.uid||c!==void 0&&this.forceRouteReloadCounter!==c){this.initDashboard(),this.forceRouteReloadCounter=c;return}if(n.location.search!==this.props.location.search){const l=n.queryParams,d=this.props.queryParams;(d?.from!==l?.from||d?.to!==l?.to)&&((0,le.$t)().updateTimeRangeFromUrl(),this.updateLiveTimer()),!l?.refresh&&d?.refresh&&(0,le.$t)().setAutoRefresh(d.refresh);const u=(0,Tn.xT)(this.props.queryParams,n.queryParams);u&&i(s.uid,u)}this.state.editPanel&&!a.editPanel&&(lt.H.setEditingState(!0),this.props.dashboard?.events.publish(new Z.xF(this.state.editPanel.id))),!this.state.editPanel&&a.editPanel&&(lt.H.setEditingState(!1),this.props.dashboard?.events.publish(new Z.Yr(a.editPanel.id))),this.state.editPanelAccessDenied&&(this.props.notifyApp((0,ot.t_)("Permission to edit panel denied")),y.E1.partial({editPanel:null})),this.state.panelNotFound&&(this.props.notifyApp((0,ot.t_)("Panel not found")),y.E1.partial({editPanel:null,viewPanel:null}))}}static getDerivedStateFromProps(n,a){const{dashboard:s,queryParams:r}=n,i=r.editPanel,c=r.viewPanel;if(!s)return a;const l={...a};if(!a.editPanel&&i){const d=s.getPanelByUrlId(i);d?s.canEditPanel(d)?(l.editPanel=d,l.rememberScrollTop=a.scrollElement?.scrollTop):l.editPanelAccessDenied=!0:l.panelNotFound=!0}else a.editPanel&&!i&&(l.editPanel=null,l.updateScrollTop=a.rememberScrollTop);if(!a.viewPanel&&c){const d=s.getPanelByUrlId(c);d?(s.initViewPanel(d),l.viewPanel=d,l.rememberScrollTop=a.scrollElement?.scrollTop,l.updateScrollTop=0):l.panelNotFound=!0}else a.viewPanel&&!c&&(s.exitViewPanel(a.viewPanel),l.viewPanel=null,l.updateScrollTop=a.rememberScrollTop);return(a.panelNotFound||a.editPanelAccessDenied&&!i)&&(l.panelNotFound=!1,l.editPanelAccessDenied=!1),Eo(n,l)}getInspectPanel(){const{dashboard:n,queryParams:a}=this.props,s=a.inspect;if(!n||!s)return null;const r=n.getPanelById(parseInt(s,10));return r||null}render(){const{dashboard:n,initError:a,queryParams:s}=this.props,{editPanel:r,viewPanel:i,updateScrollTop:c,pageNav:l,sectionNav:d}=this.state,u=yn(this.props.queryParams);if(!n||!l||!d)return e.createElement(Nn.B,{initPhase:this.props.initPhase});const p=this.getInspectPanel(),g=!r&&!u&&!this.props.queryParams.editview,f=u!==S.KioskMode.Full&&!s.editview,v=(0,m.cx)({"panel-in-fullscreen":!!i,"page-hidden":!!(s.editview||r)});return n.meta.dashboardNotFound?e.createElement(W.T,{navId:"dashboards/browse",layout:M.Q.Canvas,pageNav:{text:"Not found"}},e.createElement(j.j,{entity:"Dashboard"})):e.createElement(e.Fragment,null,e.createElement(W.T,{navModel:d,pageNav:l,layout:M.Q.Canvas,className:v,scrollRef:this.setScrollRef,scrollTop:c},f&&e.createElement("header",{"data-testid":h.wl.pages.Dashboard.DashNav.navV2},e.createElement(wn.t,{dashboard:n,title:n.title,folderTitle:n.meta.folderTitle,isFullscreen:!!i,onAddPanel:this.onAddPanel,kioskMode:u,hideTimePicker:n.timepicker.hidden})),e.createElement(Et,{dashboard:n}),a&&e.createElement(In.u,null),g&&e.createElement("section",{"aria-label":h.wl.pages.Dashboard.SubMenu.submenu},e.createElement(mn,{dashboard:n,annotations:n.annotations.list,links:n.links})),b.config.featureToggles.angularDeprecationUI&&n.hasAngularPlugins()&&n.uid!==null&&e.createElement(Pn,{dashboardUid:n.uid}),e.createElement(po.Z,{dashboard:n,isEditable:!!n.meta.canEdit,viewPanel:i,editPanel:r}),p&&e.createElement(ma,{dashboard:n,panel:p})),r&&e.createElement(Qs,{dashboard:n,sourcePanel:r,tab:this.props.queryParams.tab,sectionNav:d,pageNav:l}),s.editview&&e.createElement(Hn.D,{dashboard:n,editview:s.editview,pageNav:l,sectionNav:d}),s.addWidget&&b.config.featureToggles.vizAndWidgetSplit&&e.createElement(xn,null))}}gn.contextType=En.h;function Eo(t,n){const{dashboard:a,navIndex:s}=t;if(!a)return n;let r=n.pageNav,i=n.sectionNav;(!r||a.title!==r.text||a.meta.folderUrl!==r.parentItem?.url)&&(r={text:a.title,url:k.u.getUrlForPartial(t.history.location,{editview:null,editPanel:null,viewPanel:null})});const{folderUid:c}=a.meta;if(c&&r){const l=(0,it.ht)(s,`folder-dashboards-${c}`).main;l.id!=="not-found"&&(r={...r,parentItem:l})}if(t.route.routeName===S.DashboardRoutes.Path){i=ut();const l=dt(t.match.params.slug);l?.parentItem&&(l.parentItem=l.parentItem)}else i=(0,it.ht)(t.navIndex,"dashboards/browse");return(n.editPanel||n.viewPanel)&&(r={...r,text:`${n.editPanel?"Edit":"View"} panel`,parentItem:r,url:void 0}),n.pageNav===r&&n.sectionNav===i?n:{...n,pageNav:r,sectionNav:i}}const hn=(0,C.HE)(gn);hn.displayName="DashboardPage";const fn=vo(hn);function yo(t){if(b.config.featureToggles.dashboardScene)return e.createElement(F.default,{...t});const n=(0,K.wc)(),a=!!(t.route.routeName===S.DashboardRoutes.Home||t.route.routeName===S.DashboardRoutes.Normal&&t.match.params.uid),s=(0,U.Z)(async()=>{const r=t.route.routeName===S.DashboardRoutes.Home?t.route.routeName:t.match.params.uid;return r?n.fetchDashboard(r):null},[t.match.params.uid,t.route.routeName]);return b.config.featureToggles.dashboardSceneForViewers?s.loading?null:s.value&&!s.value.meta.canEdit&&a?e.createElement(F.default,{...t}):e.createElement(fn,{...t}):e.createElement(fn,{...t})}const bo=yo},55635:(Ce,V,o)=>{o.d(V,{$:()=>M,J:()=>m});var e=o(79739),U=o(64282),b=o(85445),F=o(90857),K=o(46783);class S{constructor(){}async get(h){const y=`api/storage/read/${h}`.replace("//","/");return(0,b.i)().get(y)}async list(h){let y="api/storage/list/";h&&(y+=h+"/");const C=await(0,b.i)().get(y);if(C?.data){const $=(0,e.vP)(C);for(const W of $.fields)W.display=(0,U.U)({field:W,theme:F.config.theme2});return $}}async createFolder(h){const y=await(0,b.i)().post("/api/storage/createFolder",JSON.stringify({path:h}));return y.success?{}:{error:y.message??"unknown error"}}async deleteFolder(h){const y=await(0,b.i)().post("/api/storage/deleteFolder",JSON.stringify(h));return y.success?{}:{error:y.message??"unknown error"}}async deleteFile(h){const y=await(0,b.i)().post(`/api/storage/delete/${h.path}`);return y.success?{}:{error:y.message??"unknown error"}}async delete(h){return h.isFolder?this.deleteFolder({path:h.path,force:!0}):this.deleteFile({path:h.path})}async upload(h,y,C){const $=new FormData;$.append("folder",h),$.append("file",y),$.append("overwriteExistingFile",String(C));const W=await fetch("/api/storage/upload",{method:"POST",body:$});let j=await W.json();return j||(j={}),j.status=W.status,j.statusText=W.statusText,W.status!==200&&!j.err&&(j.err=!0),j}async write(h,y){return K.ae.post(`/api/storage/write/${h}`,y)}async getConfig(){return(0,b.i)().get("/api/storage/config")}async getOptions(h){return(0,b.i)().get(`/api/storage/options/${h}`)}}function m(k,h){const C=k.toLowerCase().trim();return h.map(W=>W.trim().toLowerCase()).includes(C)}let R;function M(){return R||(R=new S),R}},50660:(Ce,V,o)=>{o.d(V,{M:()=>F});var e=o(85960),U=o(70274),b=o(63964);const F=({value:K,context:S,onChange:m})=>{const R=(0,e.useCallback)(M=>{m(M?.length?{id:U.E4.byRefId,options:M}:void 0)},[m]);return e.createElement(b.O,{value:K?.options,onChange:R,data:S.data,placeholder:"Change filter"})}}}]);

//# sourceMappingURL=DashboardPageProxy.1aade9b945f5e0bb6ff0.js.map