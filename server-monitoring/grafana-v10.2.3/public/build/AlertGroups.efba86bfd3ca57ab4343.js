"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2415],{49653:(F,h,e)=>{e.r(h),e.d(h,{default:()=>ee});var a=e(66681),t=e(85960),o=e(47257),E=e(79468),v=e(49199),y=e(763),O=e(95162),G=e(16901),f=e(81828),x=e(39512),c=e(19311),i=e(29165),A=e(77294),S=e(57445),V=e(5106);const j=({onStateFilterChange:r,stateFilter:g})=>{const D=(0,o.wW)(Z),p=Object.entries(G.Z9).sort(([s],[l])=>s<l?-1:1).map(([s,l])=>({label:s,value:l}));return t.createElement("div",{className:D.wrapper},t.createElement(S._,null,"State"),t.createElement(V.S,{options:p,value:g,onChange:r}))},Z=r=>({wrapper:(0,a.css)`
    margin-left: ${r.spacing(1)};
  `});var z=e(56375),Y=e(27436),Q=e(97666);const d=({className:r,groups:g,groupBy:D,onGroupingChange:p})=>{const s=(0,z.uniq)(g.flatMap(l=>l.alerts).flatMap(({labels:l})=>Object.keys(l))).filter(l=>!(l.startsWith("__")&&l.endsWith("__"))).map(l=>({label:l,value:l}));return t.createElement("div",{"data-testid":"group-by-container",className:r},t.createElement(S._,null,"Custom group by"),t.createElement(Y.NU,{"aria-label":"group by label keys",value:D,placeholder:"Group by",prefix:t.createElement(Q.J,{name:"tag-alt"}),onChange:l=>{p(l.map(({value:m})=>m))},options:s}))};var C=e(69737);const N=({groups:r})=>{const[g,D]=(0,t.useState)(Math.floor(Math.random()*100)),[p,s]=(0,y.K)(),{groupBy:l=[],queryString:m,alertState:b}=(0,A.lC)(p),I=`matcher-${g}`,W=(0,o.wW)(U),$=()=>{s({groupBy:null,queryString:null,alertState:null}),setTimeout(()=>D(g+1),100)},k=!!(l.length>0||m||b);return t.createElement("div",{className:W.wrapper},t.createElement("div",{className:W.filterSection},t.createElement(C.F,{className:W.filterInput,key:I,defaultQueryString:m,onFilterChange:B=>s({queryString:B||null})}),t.createElement(d,{className:W.filterInput,groups:r,groupBy:l,onGroupingChange:B=>s({groupBy:B.length?B.join(","):null})}),t.createElement(j,{stateFilter:b,onStateFilterChange:B=>s({alertState:B||null})}),k&&t.createElement(i.zx,{className:W.clearButton,variant:"secondary",icon:"times",onClick:$},"Clear filters")))},U=r=>({wrapper:(0,a.css)`
    border-bottom: 1px solid ${r.colors.border.medium};
    margin-bottom: ${r.spacing(3)};
  `,filterSection:(0,a.css)`
    display: flex;
    flex-direction: row;
    margin-bottom: ${r.spacing(3)};
  `,filterInput:(0,a.css)`
    width: 340px;
    & + & {
      margin-left: ${r.spacing(1)};
    }
  `,clearButton:(0,a.css)`
    margin-left: ${r.spacing(1)};
    margin-top: 19px;
  `});var K=e(98724);const H=r=>{const[g]=(0,y.K)(),D=(0,A.lC)(g),p=(0,K.Zh)(D.queryString||"");return(0,t.useMemo)(()=>r.reduce((s,l)=>{const m=l.alerts.filter(({labels:b,status:I})=>{const W=(0,K.eD)(b,p),$=D.alertState?I.state===D.alertState:!0;return W&&$});return m.length>0&&(Object.keys(l.labels).length===0?s.unshift({...l,alerts:m}):s.push({...l,alerts:m})),s},[]),[r,D,p])},T=(r,g)=>(0,t.useMemo)(()=>g.length===0?r.filter(s=>Object.keys(s.labels).length===0).length>1?r.reduce((s,l)=>{if(Object.keys(l.labels).length===0){const m=s.find(({labels:b})=>Object.keys(b));m?m.alerts=(0,z.uniqBy)([...m.alerts,...l.alerts],"labels"):s.push({alerts:l.alerts,labels:{},receiver:{name:"NONE"}})}else s.push(l);return s},[]):r:r.flatMap(({alerts:p})=>p).reduce((p,s)=>{if(g.every(m=>Object.keys(s.labels).includes(m))){const m=p.find(b=>g.every(I=>b.labels[I]===s.labels[I]));if(m)m.alerts.push(s);else{const b=g.reduce((I,W)=>(I={...I,[W]:s.labels[W]},I),{});p.push({alerts:[s],labels:b,receiver:{name:"NONE"}})}}else{const m=p.find(b=>Object.keys(b.labels).length===0);m?m.alerts.push(s):p.push({alerts:[s],labels:{},receiver:{name:"NONE"}})}return p},[]),[r,g]);var n=e(92746),P=e(84954),M=e(5970),J=e(46002),L=e(76679),u=e(30422);const w=()=>{const{useGetAlertmanagerChoiceStatusQuery:r}=f.alertmanagerApi,{selectedAlertmanager:g}=(0,P.ZA)(),D=(0,O.useDispatch)(),[p]=(0,y.K)(),{groupBy:s=[]}=(0,A.lC)(p),l=(0,o.wW)(_),{currentData:m}=r(),b=(0,n._)(R=>R.amAlertGroups),{loading:I,error:W,result:$=[]}=b[g||""]??u.oq,k=T($,s),B=H(k),te=g===L.GC&&m?.alertmanagersChoice===G.TE.External;return(0,t.useEffect)(()=>{function R(){g&&D((0,M.mS)(g))}R();const X=setInterval(R,J.iF);return()=>{clearInterval(X)}},[D,g]),t.createElement(t.Fragment,null,t.createElement(N,{groups:$}),I&&t.createElement(E.u,{text:"Loading notifications"}),W&&!I&&t.createElement(v.b,{title:"Error loading notifications",severity:"error"},W.message||"Unknown error"),te&&t.createElement(v.b,{title:"Grafana alerts are not delivered to Grafana Alertmanager"},"Grafana is configured to send alerts to external alertmanagers only. No alerts are expected to be available here for the selected Alertmanager."),$&&B.map((R,X)=>t.createElement(t.Fragment,{key:`${JSON.stringify(R.labels)}-group-${X}`},(X===1&&Object.keys(B[0].labels).length===0||X===0&&Object.keys(R.labels).length>0)&&t.createElement("p",{className:l.groupingBanner},"Grouped by: ",Object.keys(R.labels).join(", ")),t.createElement(c.y,{alertManagerSourceName:g||"",group:R}))),$&&!B.length&&t.createElement("p",null,"No results."))},q=()=>t.createElement(x.O,{pageId:"groups",accessType:"instance"},t.createElement(w,null)),_=r=>({groupingBanner:(0,a.css)`
    margin: ${r.spacing(2,0)};
  `}),ee=q},39512:(F,h,e)=>{e.d(h,{J:()=>Z,O:()=>z});var a=e(85960),t=e(8134),o=e(20989),E=e(84954),v=e(66681),y=e(47257),O=e(84933),G=e(27436),f=e(76679);function x(d){return d.name===f.GC?"Grafana":d.name.slice(0,37)}const c=({disabled:d=!1})=>{const C=(0,y.wW)(i),{selectedAlertmanager:N,availableAlertManagers:U,setSelectedAlertmanager:K}=(0,E.ZA)(),H=(0,a.useMemo)(()=>U.map(T=>({label:x(T),value:T.name,imgUrl:T.imgUrl,meta:T.meta})),[U]);return a.createElement(O._,{className:C.field,label:d?"Alertmanager":"Choose Alertmanager",disabled:d||H.length===1,"data-testid":"alertmanager-picker"},a.createElement(G.Ph,{"aria-label":d?"Alertmanager":"Choose Alertmanager",width:29,className:"ds-picker select-container",backspaceRemovesValue:!1,onChange:T=>{T?.value&&K(T.value)},options:H,maxMenuHeight:500,noOptionsMessage:"No datasources found",value:N,getOptionLabel:T=>T.label}))},i=d=>({field:(0,v.css)`
    margin: 0;
  `});var A=e(49199);const S=()=>a.createElement(A.b,{title:"No Alertmanager found",severity:"warning"},"We could not find any external Alertmanagers and you may not have access to the built-in Grafana Alertmanager."),V=()=>a.createElement(A.b,{title:"Selected Alertmanager not found.",severity:"warning"},"The selected Alertmanager no longer exists or you may not have permission to access it. You can select a different Alertmanager from the dropdown."),j=({availableAlertManagers:d})=>{const C=d.length>0;return a.createElement("div",null,C?a.createElement(V,null):a.createElement(S,null))},Z=({children:d,pageId:C,pageNav:N,actions:U,isLoading:K})=>a.createElement(o.T,{pageNav:N,navId:C,actions:U},a.createElement(o.T.Contents,{isLoading:K},d)),z=({children:d,accessType:C,...N})=>{const U=Y();return a.createElement(E.h5,{accessType:C},a.createElement(Z,{...N,actions:a.createElement(c,{disabled:U})},a.createElement(Q,null,d)))};function Y(){const d=(0,t.Z)();return["/edit","/new"].some(N=>d?.pathname?.includes(N))}const Q=({children:d})=>{const{availableAlertManagers:C,selectedAlertmanager:N}=(0,E.ZA)();return N?a.createElement(a.Fragment,null,d):a.createElement(j,{availableAlertManagers:C})}},53914:(F,h,e)=>{e.d(h,{q:()=>v});var a=e(56375),t=e.n(a),o=e(85960),E=e(57297);const v=({actions:c,children:i})=>{const A=(0,a.filter)(c,f),S=(0,a.filter)(c,x);return A.length?o.createElement(y,{actions:A},i):S.length?o.createElement(O,{actions:S},i):null},y=({actions:c,children:i})=>{const A=(0,E.Mz)();return G(A,c)?o.createElement(o.Fragment,null,i):null},O=({actions:c,children:i})=>{const A=(0,E.K_)();return G(A,c)?o.createElement(o.Fragment,null,i):null};function G(c,i){return(0,a.chain)(c).pick(i).values().value().some(([A,S])=>S===!0)}function f(c){return Object.values(E.oI).includes(c)}function x(c){return Object.values(E.jU).includes(c)}},25661:(F,h,e)=>{e.d(h,{F:()=>v});var a=e(66681),t=e(85960),o=e(47257),E=e(79253);const v=({renderExpandedContent:O,...G})=>{const f=(0,o.wW)(y);return t.createElement(E.t,{renderExpandedContent:O?(x,c,i)=>t.createElement(t.Fragment,null,c!==i.length-1&&t.createElement("div",{className:(0,a.cx)(f.contentGuideline,f.guideline)}),O(x,c,i)):void 0,renderPrefixHeader:()=>t.createElement("div",{className:f.relative},t.createElement("div",{className:(0,a.cx)(f.headerGuideline,f.guideline)})),renderPrefixCell:(x,c,i)=>t.createElement("div",{className:f.relative},t.createElement("div",{className:(0,a.cx)(f.topGuideline,f.guideline)}),c!==i.length-1&&t.createElement("div",{className:(0,a.cx)(f.bottomGuideline,f.guideline)})),...G})},y=O=>({relative:(0,a.css)`
    position: relative;
    height: 100%;
  `,guideline:(0,a.css)`
    left: -19px;
    border-left: 1px solid ${O.colors.border.weak};
    position: absolute;

    ${O.breakpoints.down("md")} {
      display: none;
    }
  `,topGuideline:(0,a.css)`
    width: 18px;
    border-bottom: 1px solid ${O.colors.border.medium};
    top: 0;
    bottom: 50%;
  `,bottomGuideline:(0,a.css)`
    top: 50%;
    bottom: 0;
  `,contentGuideline:(0,a.css)`
    top: 0;
    bottom: 0;
    left: -49px !important;
  `,headerGuideline:(0,a.css)`
    top: -17px;
    bottom: 0;
  `})},46911:(F,h,e)=>{e.d(h,{g:()=>O});var a=e(66681),t=e(85960),o=e(47257),E=e(40377),v=e(13086),y=e(97666);const O=({children:f,icon:x,color:c="secondary",...i})=>{const A=(0,o.wW)(G),S=typeof i.onClick=="function";return t.createElement("div",{className:(0,a.cx)({[A.interactive]:S}),...i},t.createElement(E.x,{variant:"bodySmall",color:c},t.createElement(v.K,{direction:"row",alignItems:"center",gap:.5,wrap:"wrap"},x&&t.createElement(y.J,{size:"sm",name:x}),f)))},G=()=>({interactive:(0,a.css)`
    cursor: pointer;
  `})},35855:(F,h,e)=>{e.d(h,{c:()=>o});var a=e(85960),t=e(47257);const o=({children:E})=>{const v=(0,t.l4)();return a.createElement("strong",{style:{color:v.colors.text.primary}},E)}},19311:(F,h,e)=>{e.d(h,{y:()=>H});var a=e(66681),t=e(85960),o=e(47257),E=e(13086),v=e(16901),y=e(2698),O=e(44211),G=e(46911),f=e(35855),x=e(18678),c=e(25661),i=e(30209),A=e(29165),S=e(41879),V=e(95162),j=e(57297),Z=e(76679),z=e(77294),Y=e(87921),Q=e(53914);const d=({alert:n,alertManagerSourceName:P})=>{const M=(0,o.wW)(C),L=(0,Z.HY)(P)?S.contextSrv.hasPermission(V.AccessControlAction.AlertingRuleRead):!0;return t.createElement(t.Fragment,null,t.createElement("div",{className:M.actionsRow},n.status.state===v.Z9.Suppressed&&t.createElement(Q.q,{actions:[j.oI.CreateSilence,j.oI.UpdateSilence]},t.createElement(A.Qj,{href:`${(0,z.eQ)("/alerting/silences",P)}&silenceIds=${n.status.silencedBy.join(",")}`,className:M.button,icon:"bell",size:"sm"},"Manage silences")),n.status.state===v.Z9.Active&&t.createElement(Q.q,{actions:[j.oI.CreateSilence]},t.createElement(A.Qj,{href:(0,z.VN)(P,n.labels),className:M.button,icon:"bell-slash",size:"sm"},"Silence")),L&&n.generatorURL&&t.createElement(A.Qj,{className:M.button,href:n.generatorURL,icon:"chart-line",size:"sm"},"See source")),Object.entries(n.annotations).map(([u,w])=>t.createElement(Y.a,{key:u,annotationKey:u,value:w})),t.createElement("div",{className:M.receivers},"Receivers:"," ",n.receivers.map(({name:u})=>u).filter(u=>!!u).join(", ")))},C=n=>({button:(0,a.css)`
    & + & {
      margin-left: ${n.spacing(1)};
    }
  `,actionsRow:(0,a.css)`
    padding: ${n.spacing(2,0)} !important;
    border-bottom: 1px solid ${n.colors.border.medium};
  `,receivers:(0,a.css)`
    padding: ${n.spacing(1,0)};
  `}),N=({alerts:n,alertManagerSourceName:P})=>{const M=(0,o.wW)(U),J=(0,t.useMemo)(()=>[{id:"state",label:"State",renderCell:({data:u})=>t.createElement(t.Fragment,null,t.createElement(i.G,{state:u.status.state}),t.createElement("span",{className:M.duration},"for"," ",(0,x.vT)({start:new Date(u.startsAt),end:new Date(u.endsAt)}))),size:"220px"},{id:"labels",label:"Labels",renderCell:({data:{labels:u}})=>t.createElement(y.s,{labels:u,size:"sm"}),size:1}],[M]),L=(0,t.useMemo)(()=>n.map(u=>({id:u.fingerprint,data:u})),[n]);return t.createElement("div",{className:M.tableWrapper,"data-testid":"alert-group-table"},t.createElement(c.F,{cols:J,items:L,isExpandable:!0,renderExpandedContent:({data:u})=>t.createElement(d,{alert:u,alertManagerSourceName:P})}))},U=n=>({tableWrapper:(0,a.css)`
    margin-top: ${n.spacing(3)};
    ${n.breakpoints.up("md")} {
      margin-left: ${n.spacing(4.5)};
    }
  `,duration:(0,a.css)`
    margin-left: ${n.spacing(1)};
    font-size: ${n.typography.bodySmall.fontSize};
  `});var K=e(44412);const H=({alertManagerSourceName:n,group:P})=>{const[M,J]=(0,t.useState)(!0),L=(0,o.wW)(T),u=P.receiver.name!=="NONE";return t.createElement("div",{className:L.wrapper},t.createElement("div",{className:L.header},t.createElement("div",{className:L.group,"data-testid":"alert-group"},t.createElement(O.U,{size:"sm",isCollapsed:M,onToggle:()=>J(!M),"data-testid":"alert-group-collapse-toggle"}),Object.keys(P.labels).length?t.createElement(E.K,{direction:"row",alignItems:"center"},t.createElement(y.s,{labels:P.labels,size:"sm"}),u&&t.createElement(G.g,{icon:"at"},"Delivered to ",t.createElement(f.c,null,P.receiver.name))):t.createElement("span",null,"No grouping")),t.createElement(K.Z,{group:P})),!M&&t.createElement(N,{alertManagerSourceName:n,alerts:P.alerts}))},T=n=>({wrapper:(0,a.css)({"& + &":{marginTop:n.spacing(2)}}),header:(0,a.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",padding:`${n.spacing(1)} ${n.spacing(1)} ${n.spacing(1)} 0`,backgroundColor:n.colors.background.secondary,width:"100%"}),group:(0,a.css)({display:"flex",flexDirection:"row",alignItems:"center"}),summary:(0,a.css)({}),[v.Z9.Active]:(0,a.css)({color:n.colors.error.main}),[v.Z9.Suppressed]:(0,a.css)({color:n.colors.primary.main}),[v.Z9.Unprocessed]:(0,a.css)({color:n.colors.secondary.main})})},30209:(F,h,e)=>{e.d(h,{G:()=>v});var a=e(85960),t=e(16901),o=e(65825);const E={[t.Z9.Active]:"bad",[t.Z9.Unprocessed]:"neutral",[t.Z9.Suppressed]:"info"},v=({state:y})=>a.createElement(o.i,{state:E[y]},y)}}]);

//# sourceMappingURL=AlertGroups.efba86bfd3ca57ab4343.js.map