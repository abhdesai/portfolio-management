"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9113],{86755:(z,h,a)=>{a.d(h,{K:()=>O});var n=a(66681),t=a(85960),v=a(47257);const O=({children:E})=>{const m=(0,v.wW)(M);return t.createElement("div",{className:m.root},E)},M=E=>({root:(0,n.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:E.spacing(3),minHeight:E.spacing(4)})})},53628:(z,h,a)=>{a.d(h,{B:()=>t});var n=a(85960);const t=({grow:v,shrink:O})=>n.createElement("div",{style:{display:"block",flexGrow:v,flexShrink:O}})},59694:(z,h,a)=>{a.d(h,{P:()=>pe});var n=a(66681),t=a(85960),v=a(31173),O=a(79088),M=a(69690),E=a(47257),m=a(13086),L=a(30379),p=a(29165),u=a(14607),_=a(97666),I=a(84933),R=a(20785),b=a(14061),o=a(53628),U=a(27436),N=a(30142),x=a(55583),w=a(25142);const H=t.memo(({def:e,operation:r})=>{const s=(0,E.wW)(S),[l,c]=(0,t.useState)(!1),{getTooltipProps:P,setTooltipRef:C,setTriggerRef:W,visible:d}=(0,N.O)({placement:"top",visible:l,offset:[0,16],onVisibleChange:c,interactive:!0,trigger:["click"]});return t.createElement(t.Fragment,null,t.createElement(p.zx,{title:"Click to show description",ref:W,icon:"info-circle",size:"sm",variant:"secondary",fill:"text"}),d&&t.createElement(w.h_,null,t.createElement("div",{ref:C,...P(),className:s.docBox},t.createElement("div",{className:s.docBoxHeader},t.createElement("span",null,e.renderer(r,e,"<expr>")),t.createElement(o.B,{grow:1}),t.createElement(p.zx,{icon:"times",onClick:()=>c(!1),fill:"text",variant:"secondary",title:"Remove operation"})),t.createElement("div",{className:s.docBoxBody,dangerouslySetInnerHTML:{__html:j(e,r)}}))))});H.displayName="OperationDocs";const S=e=>({docBox:(0,n.css)({overflow:"hidden",background:e.colors.background.primary,border:`1px solid ${e.colors.border.strong}`,boxShadow:e.shadows.z3,maxWidth:"600px",padding:e.spacing(1),borderRadius:e.shape.radius.default,zIndex:e.zIndex.tooltip}),docBoxHeader:(0,n.css)({fontSize:e.typography.h5.fontSize,fontFamily:e.typography.fontFamilyMonospace,paddingBottom:e.spacing(1),display:"flex",alignItems:"center"}),docBoxBody:(0,n.css)({marginBottom:e.spacing(-1),color:e.colors.text.secondary}),signature:(0,n.css)({fontSize:e.typography.bodySmall.fontSize,fontFamily:e.typography.fontFamilyMonospace}),dropdown:(0,n.css)({opacity:0,color:e.colors.text.secondary})});function j(e,r){return(0,x.a)(e.explainHandler?e.explainHandler(r,e):e.documentation??"no docs")}const Z=t.memo(({operation:e,def:r,index:s,onChange:l,onRemove:c,queryModeller:P,dragHandleProps:C})=>{const W=(0,E.wW)(q),[d,F]=(0,t.useState)({}),V=()=>{if(d.isOpen)F({...d,isOpen:!1});else{const f=P.getAlternativeOperations(r.alternativesKey).map(K=>({label:K.name,value:K}));F({isOpen:!0,alternatives:f})}};return t.createElement("div",{className:W.header},!d.isOpen&&t.createElement(t.Fragment,null,t.createElement("div",{...C},r.name??r.id),t.createElement(o.B,{grow:1}),t.createElement("div",{className:`${W.operationHeaderButtons} operation-header-show-on-hover`},t.createElement(p.zx,{icon:"angle-down",size:"sm",onClick:V,fill:"text",variant:"secondary",title:"Click to view alternative operations"}),t.createElement(H,{def:r,operation:e}),t.createElement(p.zx,{icon:"times",size:"sm",onClick:()=>c(s),fill:"text",variant:"secondary",title:"Remove operation"}))),d.isOpen&&t.createElement("div",{className:W.selectWrapper},t.createElement(U.Ph,{autoFocus:!0,openMenuOnFocus:!0,placeholder:"Replace with",options:d.alternatives,isOpen:!0,onCloseMenu:V,onChange:f=>{if(f.value){const K=P.getOperationDef(f.value.id),Q=[...K.defaultParams];for(let A=0;A<Math.min(e.params.length,Q.length);A++)K.params[A].type===r.params[A].type&&(Q[A]=e.params[A]);const $={...e,params:Q,id:f.value.id};l(s,r.changeTypeHandler?r.changeTypeHandler($,K):$)}}})))});Z.displayName="OperationHeader";const q=e=>({header:(0,n.css)({borderBottom:`1px solid ${e.colors.border.medium}`,padding:e.spacing(.5,.5,.5,1),display:"flex",alignItems:"center"}),operationHeaderButtons:(0,n.css)({opacity:1}),selectWrapper:(0,n.css)({paddingRight:e.spacing(2)})});var ee=a(11248),te=a(15910),ae=a(55973),G=a(80988);function ne(e){if(e.editor)return e.editor;if(e.options)return oe;switch(e.type){case"boolean":return se;case"number":case"string":default:return re}}function re(e){return t.createElement(te.H,{id:(0,G.i1)(e.operationId,e.index),defaultValue:e.value?.toString(),minWidth:e.paramDef.minWidth,placeholder:e.paramDef.placeholder,title:e.paramDef.description,maxWidth:(e.paramDef.minWidth||20)*3,onCommitChange:r=>{e.onChange(e.index,r.currentTarget.value),e.paramDef.runQueryOnEnter&&r.type==="keydown"&&e.onRunQuery()}})}function se(e){return t.createElement(ae.X,{id:(0,G.i1)(e.operationId,e.index),value:!!e.value,onChange:r=>e.onChange(e.index,r.currentTarget.checked)})}function oe({paramDef:e,value:r,index:s,operationId:l,onChange:c}){const P=(0,E.wW)(le);let C=e.options;C[0]?.label||(C=e.options.map(d=>({label:d.toString(),value:d})));let W=C.find(d=>d.value===r)??(0,ee.E)(r);return!r&&e.optional?t.createElement("div",{className:P.optionalParam},t.createElement(p.zx,{size:"sm",variant:"secondary",title:`Add ${e.name}`,icon:"plus",onClick:()=>c(s,C[0].value)},e.name)):t.createElement(m.K,{gap:.5,direction:"row",alignItems:"center"},t.createElement(U.Ph,{id:(0,G.i1)(l,s),value:W,options:C,placeholder:e.placeholder,allowCustomValue:!0,onChange:d=>c(s,d.value),width:e.minWidth||"auto"}),e.optional&&t.createElement(p.zx,{"data-testid":`operations.${s}.remove-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${e.name}`,onClick:()=>c(s,"")}))}const le=e=>({optionalParam:(0,n.css)({marginTop:e.spacing(1)})});function ie({operation:e,index:r,onRemove:s,onChange:l,onRunQuery:c,queryModeller:P,query:C,datasource:W,flash:d,highlight:F,timeRange:V}){const f=P.getOperationDef(e.id),K=ce(d),Q=(0,t.useId)(),$=e.id===b.B5.LabelFilter&&(0,R.ZO)(e,C.operations),A=(0,E.l4)(),D=me(A,$);if(!f)return t.createElement("span",null,"Operation ",e.id," not found");const Y=(i,B)=>{const J={...e,params:[...e.params]};J.params[i]=B,X(f,J,r,i,l)},y=()=>{const i={...e,params:[...e.params,""]};X(f,i,r,e.params.length,l)},g=i=>{const B={...e,params:[...e.params.slice(0,i),...e.params.slice(i+1)]};X(f,B,r,i,l)},T=[];for(let i=0;i<e.params.length;i++){const B=f.params[Math.min(f.params.length-1,i)],J=ne(B);T.push(t.createElement("div",{className:D.paramRow,key:`${i}-1`},!B.hideName&&t.createElement("div",{className:D.paramName},t.createElement("label",{htmlFor:(0,G.i1)(Q,i)},B.name),B.description&&t.createElement(u.u,{placement:"top",content:B.description,theme:"info"},t.createElement(_.J,{name:"info-circle",size:"sm",className:D.infoIcon}))),t.createElement("div",{className:D.paramValue},t.createElement(m.K,{gap:.5,direction:"row",alignItems:"center"},t.createElement(J,{index:i,paramDef:B,value:e.params[i],operation:e,operationId:Q,onChange:Y,onRunQuery:c,query:C,datasource:W,timeRange:V}),B.restParam&&(e.params.length>f.params.length||B.optional)&&t.createElement(p.zx,{"data-testid":`operations.${r}.remove-rest-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${B.name}`,onClick:()=>g(i)})))))}let k;if(f.params.length>0){const i=f.params[f.params.length-1];i.restParam&&(k=de(i,y,r,e.params.length,D))}const fe=i=>{if(!i)return $?!0:void 0};return t.createElement(v._l,{draggableId:`operation-${r}`,index:r},(i,B)=>t.createElement(I._,{error:"You have conflicting label filters",invalid:fe(B.isDragging),className:(0,n.cx)(D.error,D.cardWrapper)},t.createElement("div",{className:(0,n.cx)(D.card,(K||F)&&D.cardHighlight,$&&D.cardError),ref:i.innerRef,...i.draggableProps,"data-testid":`operations.${r}.wrapper`},t.createElement(Z,{operation:e,dragHandleProps:i.dragHandleProps,def:f,index:r,onChange:l,onRemove:s,queryModeller:P}),t.createElement("div",{className:D.body},T),k,r<C.operations.length-1&&t.createElement("div",{className:D.arrow},t.createElement("div",{className:D.arrowLine}),t.createElement("div",{className:D.arrowArrow})))))}function ce(e){const[r,s]=(0,t.useState)(!0);return(0,t.useEffect)(()=>{let l;return e?l=setTimeout(()=>{s(!1)},1e3):s(!0),()=>clearTimeout(l)},[e]),r&&e}function de(e,r,s,l,c){return t.createElement("div",{className:c.restParam,key:`${l}-2`},t.createElement(p.zx,{size:"sm",icon:"plus",title:`Add ${e.name}`.trimEnd(),variant:"secondary",onClick:r,"data-testid":`operations.${s}.add-rest-param`},e.name))}function X(e,r,s,l,c){e.paramChangedHandler?c(s,e.paramChangedHandler(l,r,e)):c(s,r)}const me=(e,r)=>({cardWrapper:(0,n.css)({alignItems:"stretch"}),error:(0,n.css)({marginBottom:e.spacing(1)}),card:(0,n.css)({background:e.colors.background.primary,border:`1px solid ${e.colors.border.medium}`,cursor:"grab",borderRadius:e.shape.radius.default,position:"relative",transition:"all 0.5s ease-in 0s",height:r?"auto":"100%"}),cardError:(0,n.css)({boxShadow:`0px 0px 4px 0px ${e.colors.warning.main}`,border:`1px solid ${e.colors.warning.main}`}),cardHighlight:(0,n.css)({boxShadow:`0px 0px 4px 0px ${e.colors.primary.border}`,border:`1px solid ${e.colors.primary.border}`}),infoIcon:(0,n.css)({marginLeft:e.spacing(.5),color:e.colors.text.secondary,":hover":{color:e.colors.text.primary}}),body:(0,n.css)({margin:e.spacing(1,1,.5,1),display:"table"}),paramRow:(0,n.css)({label:"paramRow",display:"table-row",verticalAlign:"middle"}),paramName:(0,n.css)({display:"table-cell",padding:e.spacing(0,1,0,0),fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,verticalAlign:"middle",height:"32px"}),paramValue:(0,n.css)({label:"paramValue",display:"table-cell",verticalAlign:"middle"}),restParam:(0,n.css)({padding:e.spacing(0,1,1,1)}),arrow:(0,n.css)({position:"absolute",top:"0",right:"-18px",display:"flex"}),arrowLine:(0,n.css)({height:"2px",width:"8px",backgroundColor:e.colors.border.strong,position:"relative",top:"14px"}),arrowArrow:(0,n.css)({width:0,height:0,borderTop:"5px solid transparent",borderBottom:"5px solid transparent",borderLeft:`7px solid ${e.colors.border.strong}`,position:"relative",top:"10px"})});function pe({query:e,datasource:r,queryModeller:s,onChange:l,onRunQuery:c,highlightedOp:P,timeRange:C}){const W=(0,E.wW)(Ee),{operations:d}=e,F=ue(d),[V,f]=(0,t.useState)(!1),K=(y,g)=>{const T=[...d];T.splice(y,1,g),l({...e,operations:T})},Q=y=>{const g=[...d.slice(0,y),...d.slice(y+1)];l({...e,operations:g})},$=s.getCategories().map(y=>({value:y,label:y,items:s.getOperationsForCategory(y).map(g=>({value:g.id,label:g.name,isLeaf:!0}))})),A=y=>{const g=s.getOperationDef(y);g&&(l(g.addOperationHandler(g,e,s)),f(!1))},D=y=>{if(!y.destination)return;const g=[...d],T=g[y.source.index];g.splice(y.source.index,1),g.splice(y.destination.index,0,T),l({...e,operations:g})},Y=()=>{f(!1)};return t.createElement(m.K,{gap:1,direction:"column"},t.createElement(m.K,{gap:1},d.length>0&&t.createElement(v.Z5,{onDragEnd:D},t.createElement(v.bK,{droppableId:"sortable-field-mappings",direction:"horizontal"},y=>t.createElement("div",{className:W.operationList,ref:y.innerRef,...y.droppableProps},d.map((g,T)=>t.createElement(ie,{key:g.id+JSON.stringify(g.params)+T,queryModeller:s,index:T,operation:g,query:e,datasource:r,onChange:K,onRemove:Q,onRunQuery:c,flash:F[T],highlight:P===g,timeRange:C})),y.placeholder))),t.createElement("div",{className:W.addButton},V?t.createElement(L.v,{options:$,onSelect:A,onBlur:Y,autoFocus:!0,alwaysOpen:!0,hideActiveLevelLabel:!0,placeholder:"Search"}):t.createElement(p.zx,{icon:"plus",variant:"secondary",onClick:()=>f(!0),title:"Add operation"},"Operations"))))}function ue(e){const r=(0,O.Z)(),s=(0,M.Z)(e);if(!r())return e.map(()=>!1);if(!s)return e.map(()=>!0);let l=[];if(s.length-1===e.length&&e.every(c=>s.includes(c)))return e.map(()=>!1);if(s.length+1===e.length&&s.every(c=>e.includes(c))){const c=e.find(P=>!s.includes(P));l=e.map(P=>P===c)}else l=e.map((c,P)=>!ge(c.id,s[P]?.id));return l}function ge(e,r){return e===r||`__${e}_by`===r||e===`__${r}_by`}const Ee=e=>({heading:(0,n.css)({label:"heading",fontSize:12,fontWeight:e.typography.fontWeightMedium,marginBottom:0}),operationList:(0,n.css)({label:"operationList",display:"flex",flexWrap:"wrap",gap:e.spacing(2)}),addButton:(0,n.css)({label:"addButton",width:126,paddingBottom:e.spacing(1)})})},36796:(z,h,a)=>{a.d(h,{B:()=>M});var n=a(66681),t=a(85960),v=a(47257),O=a(13086);function M({children:m}){const L=(0,v.wW)(E);return t.createElement("div",{className:L.root},t.createElement(O.K,{gap:1},m))}const E=m=>({root:(0,n.css)({padding:m.spacing(1,1,0,1),backgroundColor:m.colors.background.secondary,borderRadius:m.shape.radius.default})})},42763:(z,h,a)=>{a.d(h,{L:()=>m});var n=a(66681),t=a(85960),v=a(43183),O=a(47257),M=a(14607),E=a(29165);const m=({datasource:p,query:u,onChange:_,data:I,queryModeller:R,buildVisualQueryFromString:b})=>{const[o,U]=(0,t.useState)([]),N=(0,O.wW)(L);return(0,t.useEffect)(()=>{const x={expr:R.renderQuery(u),refId:""},w=p.getQueryHints(x,I?.series||[]).filter(H=>H.fix?.action);U(w)},[p,u,I,R]),t.createElement(t.Fragment,null,o.length>0&&t.createElement("div",{className:N.container},o.map(x=>t.createElement(M.u,{content:`${x.label} ${x.fix?.label}`,key:x.type},t.createElement(E.zx,{onClick:()=>{if((0,v.ff)("grafana_query_builder_hints_clicked",{hint:x.type,datasourceType:p.type}),x?.fix?.action){const w={expr:R.renderQuery(u),refId:""},H=p.modifyQuery(w,x.fix.action),S=b(H.expr);return _(S.query)}},fill:"outline",size:"sm",className:N.hint},"hint: ",x.fix?.title||x.fix?.action?.type.toLowerCase().replace("_"," "))))))};m.displayName="QueryBuilderHints";const L=p=>({container:(0,n.css)`
      display: flex;
      align-items: start;
    `,hint:(0,n.css)`
      margin-right: ${p.spacing(1)};
    `})},65607:(z,h,a)=>{a.d(h,{k:()=>M});var n=a(85960),t=a(5106),v=a(33485);const O=[{label:"Builder",value:v.c.Builder},{label:"Code",value:v.c.Code}];function M({mode:E,onChange:m}){return n.createElement("div",{"data-testid":"QueryEditorModeToggle"},n.createElement(t.S,{options:O,size:"sm",value:E,onChange:m}))}},69217:(z,h,a)=>{a.d(h,{n:()=>L});var n=a(66681),t=a(56375),v=a.n(t),O=a(85960),M=a(47257),E=a(13086),m=a(5999);function L({label:u,..._}){const I=u.replace(" ","-"),R=(0,O.useRef)((0,t.uniqueId)(`switch-${I}`)),b=(0,M.wW)(p);return O.createElement(E.K,{gap:1},O.createElement("label",{htmlFor:R.current,className:b.switchLabel},u),O.createElement(m.r,{..._,id:R.current}))}const p=u=>({switchLabel:(0,n.css)({color:u.colors.text.secondary,cursor:"pointer",fontSize:u.typography.bodySmall.fontSize,"&:hover":{color:u.colors.text.primary}})})},15880:(z,h,a)=>{a.d(h,{d:()=>_});var n=a(66681),t=a(85960),v=a(45220),O=a(1930),M=a(90857),E=a(47257),m=a(8655),L=a(13086),p=a(14607),u=a(97666);function _({title:o,children:U,collapsedInfo:N,queryStats:x}){const[w,H]=(0,v.Z)(!1),S=(0,E.wW)(I);return t.createElement("div",{className:S.wrapper},t.createElement(m.U,{className:S.collapse,collapsible:!0,isOpen:w,onToggle:H,label:t.createElement(L.K,{gap:0},t.createElement("h6",{className:S.title},o),!w&&t.createElement("div",{className:S.description},N.map((j,Z)=>t.createElement("span",{key:Z},j))))},t.createElement("div",{className:S.body},U)),x&&M.config.featureToggles.lokiQuerySplitting&&t.createElement(p.u,{content:"Note: the query will be split into multiple parts and executed in sequence. Query limits will only apply each individual part."},t.createElement(u.J,{tabIndex:0,name:"info-circle",className:S.tooltip,size:"sm"})),x&&t.createElement("p",{className:S.stats},R(x)))}const I=o=>({collapse:(0,n.css)({backgroundColor:"unset",border:"unset",marginBottom:0,["> button"]:{padding:o.spacing(0,1)}}),wrapper:(0,n.css)({width:"100%",display:"flex",justifyContent:"space-between",alignItems:"baseline"}),title:(0,n.css)({flexGrow:1,overflow:"hidden",fontSize:o.typography.bodySmall.fontSize,fontWeight:o.typography.fontWeightMedium,margin:0}),description:(0,n.css)({color:o.colors.text.secondary,fontSize:o.typography.bodySmall.fontSize,fontWeight:o.typography.bodySmall.fontWeight,paddingLeft:o.spacing(2),gap:o.spacing(2),display:"flex"}),body:(0,n.css)({display:"flex",gap:o.spacing(2),flexWrap:"wrap"}),stats:(0,n.css)({margin:"0px",color:o.colors.text.secondary,fontSize:o.typography.bodySmall.fontSize}),tooltip:(0,n.css)({marginRight:o.spacing(.25)})}),R=o=>o.message?o.message:`This query will process approximately ${b(o)}.`,b=o=>{const{text:U,suffix:N}=(0,O.Cf)("bytes")(o.bytes,1);return U+N}},36867:(z,h,a)=>{a.d(h,{P5:()=>p,ar:()=>v,iS:()=>M});var n=a(85960),t=a(20994);const v="PrometheusQueryEditorExplainDefault",O="PrometheusQueryEditorRawQueryDefault",M="LokiQueryEditorExplainDefault",E="LokiQueryEditorRawQueryDefault";function m(u,_=!1){const I=t.Z.get(u);return I===void 0?_:!!parseInt(I,10)}function L(u,_){t.Z.set(u,_?"1":"0")}function p(u,_=!1){const[I,R]=(0,n.useState)(m(u,_)),b=(0,n.useCallback)(o=>{L(u,o),R(o)},[u]);return{flag:I,setFlag:b}}}}]);

//# sourceMappingURL=9113.1c52d92ab51a3635f261.js.map