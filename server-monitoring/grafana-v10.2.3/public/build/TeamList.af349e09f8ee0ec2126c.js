"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9671],{28393:(Z,C,e)=>{e.d(C,{f:()=>g});var A=e(85960),t=e(85954),r=e(49683),T=e(95162),O=e(477),f=e(80932);const g=({teamId:M,roleOptions:m,disabled:s,roles:c,onApplyRoles:d,pendingRoles:_,apply:L=!1,maxWidth:y,width:K,isLoading:p})=>{const[{loading:$,value:P=c||[]},E]=(0,t.Z)(async()=>{try{if(c)return c;if(L&&_?.length)return _;if(r.Vt.hasPermission(T.AccessControlAction.ActionTeamsRolesList))return await(0,f._C)(M)}catch(R){console.error("Error loading options",R)}return[]},[M,_,c]);(0,A.useEffect)(()=>{E()},[E]);const I=async R=>{L?d&&d(R):(await(0,f.u7)(R,M),await E())},v=r.Vt.hasPermission(T.AccessControlAction.ActionTeamsRolesAdd)&&r.Vt.hasPermission(T.AccessControlAction.ActionTeamsRolesRemove);return A.createElement(O.I,{apply:L,onRolesChange:I,roleOptions:m,appliedRoles:P,isLoading:$||p,disabled:s,basicRoleDisabled:!0,canUpdateRoles:v,maxWidth:y,width:K})}},56011:(Z,C,e)=>{e.r(C),e.d(C,{TeamList:()=>j,default:()=>B});var A=e(66681),t=e(85960),r=e(34785),T=e(36752),O=e(47257),f=e(71679),g=e(13086),M=e(14607),m=e(97666),s=e(81573),c=e(29165),d=e(84933),_=e(96535),L=e(23940),y=e(44574),K=e(64409),p=e(20989),$=e(80932),P=e(41879),E=e(95162),I=e(28393),v=e(13739);const R=new Array(3).fill(null).map((u,h)=>({id:h,memberCount:0,name:"",orgId:0,permission:0})),j=({teams:u,query:h,noTeams:N,hasFetched:D,loadTeams:W,deleteTeam:U,changeQuery:X,totalPages:z,page:Y,rolesLoading:G,changePage:w,changeSort:F})=>{const[V,k]=(0,t.useState)([]),S=(0,O.wW)(b);(0,t.useEffect)(()=>{W(!0)},[W]),(0,t.useEffect)(()=>{P.contextSrv.licensedAccessControlEnabled()&&P.contextSrv.hasPermission(E.AccessControlAction.ActionRolesList)&&(0,$.ul)().then(i=>k(i))},[]);const Q=P.contextSrv.hasPermission(E.AccessControlAction.ActionTeamsCreate),H=a(),q=(0,t.useMemo)(()=>[{id:"avatarUrl",header:"",disableGrow:!0,cell:({cell:{value:i}})=>D?i&&t.createElement(f.q,{src:i,alt:"User avatar"}):t.createElement(r.Z,{containerClassName:S.blockSkeleton,width:24,height:24,circle:!0})},{id:"name",header:"Name",cell:({cell:{value:i}})=>D?i:t.createElement(r.Z,{width:100}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:i}})=>D?i:t.createElement(r.Z,{width:60}),sortType:"string"},{id:"memberCount",header:"Members",disableGrow:!0,cell:({cell:{value:i}})=>D?i:t.createElement(r.Z,{width:40}),sortType:"number"},...H?[{id:"role",header:"Role",cell:({cell:{value:i},row:{original:x}})=>D?P.contextSrv.hasPermissionInMetadata(E.AccessControlAction.ActionTeamsRolesList,x)&&t.createElement(I.f,{teamId:x.id,roles:x.roles||[],isLoading:G,roleOptions:V,width:40}):t.createElement(r.Z,{width:320,height:32,containerClassName:S.blockSkeleton})}]:[],{id:"actions",header:"",disableGrow:!0,cell:({row:{original:i}})=>{if(!D)return t.createElement(g.K,{direction:"row",justifyContent:"flex-end",alignItems:"center"},t.createElement(r.Z,{containerClassName:S.blockSkeleton,width:16,height:16}),t.createElement(r.Z,{containerClassName:S.blockSkeleton,width:22,height:24}));const x=P.contextSrv.hasPermissionInMetadata(E.AccessControlAction.ActionTeamsRead,i),J=P.contextSrv.hasPermissionInMetadata(E.AccessControlAction.ActionTeamsDelete,i);return t.createElement(g.K,{direction:"row",justifyContent:"flex-end"},x&&t.createElement(M.u,{content:"Edit team"},t.createElement("a",{href:`org/teams/edit/${i.id}`,"aria-label":`Edit team ${i.name}`},t.createElement(m.J,{name:"pen"}))),t.createElement(s.m,{"aria-label":`Delete team ${i.name}`,size:"sm",disabled:!J,onConfirm:()=>U(i.id)}))}}],[H,D,G,V,U,S]);return t.createElement(p.T,{navId:"teams",actions:t.createElement(c.Qj,{href:Q?"org/teams/new":"#",disabled:!Q},"New Team")},t.createElement(p.T.Contents,null,N?t.createElement(K.Z,{title:"You haven't created any teams yet.",buttonIcon:"users-alt",buttonLink:"org/teams/new",buttonTitle:" New team",buttonDisabled:!P.contextSrv.hasPermission(E.AccessControlAction.ActionTeamsCreate),proTip:"Assign folder and dashboard permissions to teams instead of users to ease administration.",proTipLink:"",proTipLinkTitle:"",proTipTarget:"_blank"}):t.createElement(t.Fragment,null,t.createElement("div",{className:"page-action-bar"},t.createElement(d._,{grow:!0},t.createElement(_.H,{placeholder:"Search teams",value:h,onChange:X}))),t.createElement(g.K,{direction:"column",gap:2},t.createElement(L.e,{columns:q,data:D?u:R,getRowId:i=>String(i.id),fetchData:F}),t.createElement(g.K,{justifyContent:"flex-end"},t.createElement(y.t,{hideWhenSinglePage:!0,currentPage:Y,numberOfPages:z,onNavigate:w}))))))};function a(){return P.contextSrv.licensedAccessControlEnabled()&&P.contextSrv.hasPermission(E.AccessControlAction.ActionTeamsRolesList)&&P.contextSrv.hasPermission(E.AccessControlAction.ActionRolesList)}function n(u){return{teams:u.teams.teams,query:u.teams.query,perPage:u.teams.perPage,page:u.teams.page,noTeams:u.teams.noTeams,totalPages:u.teams.totalPages,hasFetched:u.teams.hasFetched,rolesLoading:u.teams.rolesLoading}}const o={loadTeams:v.jI,deleteTeam:v.fC,changePage:v.oO,changeQuery:v.R5,changeSort:v.nt},B=(0,T.connect)(n,o)(j),b=u=>({blockSkeleton:(0,A.css)({lineHeight:1,display:"flex"})})},13739:(Z,C,e)=>{e.d(C,{A_:()=>v,P5:()=>R,QX:()=>d,R5:()=>L,fC:()=>_,fs:()=>E,jI:()=>s,j_:()=>I,nt:()=>K,oO:()=>y});var A=e(56375),t=e.n(A),r=e(85445),T=e(88492),O=e(49683),f=e(78105),g=e(95162),M=e(50212),m=e(98619);function s(a=!1){return async(n,o)=>{const{query:l,page:B,perPage:b,sort:u}=o().teams;if(!O.Vt.hasPermission(g.AccessControlAction.ActionTeamsRead)){n((0,m.PL)({teams:[],totalCount:0,page:1,perPage:b,noTeams:!0}));return}const h=await(0,r.i)().get("/api/teams/search",(0,f.y)({query:l,page:B,perpage:b,sort:u}));let N=!1;if(a&&(N=h.teams.length===0),O.Vt.licensedAccessControlEnabled()){n((0,m.Fy)());const D=h?.teams.map(U=>U.id),W=await(0,r.i)().post("/api/access-control/teams/roles/search",{teamIds:D});h.teams.forEach(U=>{U.roles=W?W[U.id]||[]:[]}),n((0,m.BR)())}n((0,m.PL)({noTeams:N,...h}))}}const c=(0,A.debounce)(a=>a(s()),500);function d(a){return async n=>{const o=await(0,r.i)().get(`/api/teams/${a}`,(0,f.y)());n((0,m.y$)(o)),n((0,T.RL)((0,M.B)(o)))}}function _(a){return async n=>{await(0,r.i)().delete(`/api/teams/${a}`),await O.Vt.fetchUserPermissions(),n(s())}}function L(a){return async n=>{n((0,m.aj)(a)),c(n)}}function y(a){return async n=>{n((0,m.PJ)(a)),n(s())}}function K({sortBy:a}){const n=a.length?`${a[0].id}-${a[0].desc?"desc":"asc"}`:void 0;return async o=>{o((0,m.UL)(n)),o(s())}}function p(){return async(a,n)=>{const o=n().team.team,l=await getBackendSrv().get(`/api/teams/${o.id}/members`);a(teamMembersLoaded(l))}}function $(a){return async(n,o)=>{const l=o().team.team;await getBackendSrv().post(`/api/teams/${l.id}/members`,{userId:a}),n(p())}}function P(a){return async(n,o)=>{const l=o().team.team;await getBackendSrv().delete(`/api/teams/${l.id}/members/${a}`),n(p())}}function E(a,n){return async(o,l)=>{const B=l().team.team;await(0,r.i)().put(`/api/teams/${B.id}`,{name:a,email:n}),o(d(B.id))}}function I(){return async(a,n)=>{const o=n().team.team,l=await(0,r.i)().get(`/api/teams/${o.id}/groups`);a((0,m.iI)(l))}}function v(a){return async(n,o)=>{const l=o().team.team;await(0,r.i)().post(`/api/teams/${l.id}/groups`,{groupId:a}),n(I())}}function R(a){return async(n,o)=>{const l=o().team.team;await(0,r.i)().delete(`/api/teams/${l.id}/groups?groupId=${encodeURIComponent(a)}`),n(I())}}function j(a){return async n=>{await getBackendSrv().put(`/api/teams/${a.teamId}/members/${a.userId}`,{permission:a.permission}),n(p())}}},50212:(Z,C,e)=>{e.d(C,{B:()=>M,o:()=>m});var A=e(11855),t=e(64582),r=e(67954),T=e(41879),O=e(3016),f=e(95162);const g={avatarUrl:"public/img/user_profile.png",id:1,name:"Loading",email:"loading",memberCount:0,permission:f.TeamPermissionLevel.Member,accessControl:{isEditor:!1},orgId:0,updated:""};function M(s){const c={img:s.avatarUrl,id:"team-"+s.id,subTitle:"Manage members and settings",url:"",text:s.name,children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${s.id}`,text:"Settings",url:`org/teams/edit/${s.id}/settings`}]};(s===g||T.contextSrv.hasPermissionInMetadata(f.AccessControlAction.ActionTeamsPermissionsRead,s))&&c.children.unshift({active:!1,icon:"users-alt",id:`team-members-${s.id}`,text:"Members",url:`org/teams/edit/${s.id}/members`});const d={active:!1,icon:"sync",id:`team-groupsync-${s.id}`,text:"External group sync",url:`org/teams/edit/${s.id}/groupsync`},_=s===g;return(0,O.d5)()&&(d.tabSuffix=()=>(0,t.Z)({experimentId:_?"":"feature-highlights-team-sync-badge",eventVariant:"trial"})),(0,A.v)("teamsync")?(_||T.contextSrv.hasPermissionInMetadata(f.AccessControlAction.ActionTeamsPermissionsRead,s))&&c.children.push(d):r.default.featureToggles.featureHighlights&&c.children.push({...d,tabSuffix:()=>(0,t.Z)({experimentId:_?"":"feature-highlights-team-sync-badge"})}),c}function m(s){const c=M(g);let d;for(const _ of c.children)if(_.id.indexOf(s)>0){_.active=!0,d=_;break}return{main:c,node:d}}}}]);

//# sourceMappingURL=TeamList.af349e09f8ee0ec2126c.js.map