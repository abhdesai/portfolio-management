"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2323],{42323:(H,D,t)=>{t.r(D),t.d(D,{ContactPoint:()=>he,ContactPointReceiverSummary:()=>Ce,default:()=>lt});var g=t(66681),x=t(51670),y=t(56375),S=t(53136),F=t.n(S),e=t(85960),U=t(16088),K=t(45220),$=t(85745),L=t(49199),C=t(13086),O=t(70523),B=t(94439),Q=t(10305),R=t(79468),a=t(29165),s=t(40377),f=t(44574),o=t(47257),d=t(54635),i=t(14607),A=t(44839),b=t(97666),T=t(26321);const W={pagerduty:"PagerDuty",pushover:"Pushover",slack:"Slack",opsgenie:"OpsGenie",webhook:"Webhook",victorops:"VictorOps",wechat:"WeChat",discord:"Discord",webex:"Cisco Webex Teams",sns:"Amazon SNS",telegram:"Telegram",msteams:"Microsoft Teams"};var P=t(57297),j=t(37310),J=t(75636),G=t(84954),w=t(5493),ee=t(76679),re=t(87873),ye=t(28157),k=t(46911);const Se=(0,e.forwardRef)(function(l,r){return e.createElement(a.zx,{variant:"secondary",size:"sm",type:"button","aria-label":"more-actions","data-testid":"more-actions",ref:r,...l},e.createElement(C.K,{direction:"row",alignItems:"center",gap:0},"More ",e.createElement(b.J,{name:"angle-down"})))});var de=t(84237),ie=t(99586),te=t(35855),me=t(14411),ue=t(27908),ge=t(29657),pe=t(23694);const Re=({receiverName:n,decrypt:l,exportFormat:r,onClose:c})=>{const{currentData:m="",isFetching:u}=me.alertRuleApi.useExportReceiverQuery({receiverName:n,decrypt:l,format:r}),v=`cp-${n}-${new Date().getTime()}`;return u?e.createElement(R.u,{text:"Loading...."}):e.createElement(ue.u,{format:r,textDefinition:m,downloadFileName:v,onClose:c})},Pe=({onClose:n,receiverName:l,decrypt:r})=>{const[c,m]=(0,e.useState)("yaml");return e.createElement(ge.i,{activeTab:c,onTabChange:m,onClose:n,formatProviders:Object.values(pe.uN)},e.createElement(Re,{receiverName:l,decrypt:r,exportFormat:c,onClose:n}))},Te=({decrypt:n,exportFormat:l,onClose:r})=>{const{currentData:c="",isFetching:m}=me.alertRuleApi.useExportReceiversQuery({decrypt:n,format:l}),u=`contact-points-${new Date().getTime()}`;return m?e.createElement(R.u,{text:"Loading...."}):e.createElement(ue.u,{format:l,textDefinition:c,downloadFileName:u,onClose:r})},De=({onClose:n,decrypt:l})=>{const[r,c]=(0,e.useState)("yaml");return e.createElement(ge.i,{activeTab:r,onTabChange:c,onClose:n,formatProviders:Object.values(pe.uN)},e.createElement(Te,{decrypt:l,exportFormat:r,onClose:n}))},xe=({metadata:{icon:n,title:l,externalUrl:r,warning:c}})=>{const m=(0,o.wW)(Le);return e.createElement(C.K,{alignItems:"center",gap:.5},e.createElement(C.K,{direction:"row",alignItems:"center",gap:.5},c?e.createElement(i.u,{content:c,theme:"error"},e.createElement(b.J,{name:"exclamation-triangle",className:m.warnIcon})):e.createElement("img",{src:n,alt:l,height:"16px"}),e.createElement("span",null,l)),r&&e.createElement(a.Qj,{icon:"external-link-alt",href:r,target:"_blank",variant:"secondary",size:"sm"}))},Le=n=>({warnIcon:(0,g.css)({fill:n.colors.warning.text})});var Ie=t(70335),Me=t(77980),Oe=t(95162),q=t(53914),Ne=t(5970),Fe=t(14806),ne=t(77294),Ke=t(44211),Be=t(48633),ae=t(90504),We=t(80316);const Ue=({config:n,alertManagerName:l})=>{const r=(0,Oe.useDispatch)(),[c,m]=(0,e.useState)({}),u=(0,o.wW)(Fe.D),v=(0,e.useMemo)(()=>Object.entries(n.template_files).map(([N,M])=>({name:N,template:M,provenance:(n.template_file_provenances??{})[N]})),[n]),[p,E]=(0,e.useState)(),I=()=>{p&&r((0,Ne.S6)(p,l)),E(void 0)};return e.createElement(e.Fragment,null,e.createElement("table",{className:u.table,"data-testid":"templates-table"},e.createElement("colgroup",null,e.createElement("col",{className:u.colExpand}),e.createElement("col",null),e.createElement("col",null)),e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,"Template"),e.createElement(q.q,{actions:[P.oI.CreateNotificationTemplate,P.oI.UpdateNotificationTemplate,P.oI.DeleteNotificationTemplate]},e.createElement("th",null,"Actions")))),e.createElement("tbody",null,!v.length&&e.createElement("tr",{className:u.evenRow},e.createElement("td",{colSpan:3},"No templates defined.")),v.map(({name:h,template:N,provenance:M},z)=>{const V=!!c[h];return e.createElement(e.Fragment,{key:h},e.createElement("tr",{key:h,className:z%2===0?u.evenRow:void 0},e.createElement("td",null,e.createElement(Ke.U,{isCollapsed:!c[h],onToggle:()=>m({...c,[h]:!V})})),e.createElement("td",null,h," ",M&&e.createElement(de.C0,null)),e.createElement("td",{className:u.actionsCell},M&&e.createElement(ae.A,{to:(0,ne.eQ)(`/alerting/notifications/templates/${encodeURIComponent(h)}/edit`,l),tooltip:"view template",icon:"file-alt"}),!M&&e.createElement(q.q,{actions:[P.oI.UpdateNotificationTemplate]},e.createElement(ae.A,{to:(0,ne.eQ)(`/alerting/notifications/templates/${encodeURIComponent(h)}/edit`,l),tooltip:"edit template",icon:"pen"})),e.createElement(q.q,{actions:[P.oI.CreateContactPoint]},e.createElement(ae.A,{to:(0,ne.eQ)(`/alerting/notifications/templates/${encodeURIComponent(h)}/duplicate`,l),tooltip:"Copy template",icon:"copy"})),!M&&e.createElement(q.q,{actions:[P.oI.DeleteNotificationTemplate]},e.createElement(ae.A,{onClick:()=>E(h),tooltip:"delete template",icon:"trash-alt"})))),V&&e.createElement("tr",{className:z%2===0?u.evenRow:void 0},e.createElement("td",null),e.createElement("td",{colSpan:2},e.createElement(Be.C,{label:"Description",horizontal:!0},e.createElement(We.u,{width:"auto",height:"auto",autoHeight:!0,value:N,showLineNumbers:!1,monacoOptions:{readOnly:!0,scrollBeyondLastLine:!1}})))))}))),!!p&&e.createElement(Me.s,{isOpen:!0,title:"Delete template",body:`Are you sure you want to delete template "${p}"?`,confirmText:"Yes, delete",onConfirm:I,onDismiss:()=>E(void 0)}))},we=()=>{const{selectedAlertmanager:n}=(0,G.ZA)(),{data:l,error:r}=(0,Ie.W)(n);return r?e.createElement(L.b,{title:"Failed to fetch notification templates"},String(r)):l?e.createElement(Ue,{config:l,alertManagerName:n}):null};var $e=t(27160),Ge=t(7442),ze=t(20519),Ve=t(24956);const Qe=()=>{const n=(0,o.wW)(je),[l,r]=(0,J.j)(),c=l.get("search")??"",[m,u]=(0,e.useState)(c),[v,p]=(0,$e.Z)(()=>{r({search:m},!0)},300,[r,m]),E=(0,e.useCallback)(()=>{p(),u(""),r({search:""},!0)},[p,r]),I=!!c;return e.createElement(Ge.K,{direction:"row",alignItems:"end",gap:.5},e.createElement(ze.g,{className:n.noBottom,label:"Search by name or type"},e.createElement(Ve.I,{"aria-label":"search contact points",placeholder:"Search",width:46,prefix:e.createElement(b.J,{name:"search"}),onChange:h=>{u(h.currentTarget.value)},value:m})),e.createElement(a.zx,{variant:"secondary",icon:"times",onClick:()=>E(),disabled:!I,"aria-label":"clear"},"Clear"))},je=()=>({noBottom:(0,g.css)({marginBottom:0})}),He=({alertManagerName:n})=>{const l=(0,ee.RY)(n);return e.createElement(q.q,{actions:[P.oI.UpdateExternalConfiguration]},e.createElement(L.b,{severity:"info",title:"Global config for contact points"},e.createElement("p",null,"For each external Alertmanager you can define global settings, like server addresses, usernames and password, for all the supported contact points."),e.createElement(a.Qj,{href:(0,ne.eQ)("alerting/notifications/global-config",n),variant:"secondary"},l?"View global config":"Edit global config")))};var se=t(7288);const Ye=(n,l)=>{const[r,c]=(0,e.useState)(!1),[m,u]=(0,e.useState)(),[v,p]=(0,e.useState)(),E=(0,e.useCallback)(()=>{l||(u(void 0),c(!1),p(void 0))},[l]),I=(0,e.useCallback)(M=>{u(M),c(!0),p(void 0)},[]),h=(0,e.useCallback)(()=>{m&&n(m).then(()=>c(!1)).catch(p)},[n,m]);return[(0,e.useMemo)(()=>v?e.createElement(Ze,{isOpen:r,onDismiss:E,error:v}):e.createElement(se.u,{isOpen:r,onDismiss:E,closeOnBackdropClick:!l,closeOnEscape:!l,title:"Delete contact point"},e.createElement("p",null,"Deleting this contact point will permanently remove it."),e.createElement("p",null,"Are you sure you want to delete this contact point?"),e.createElement(se.u.ButtonRow,null,e.createElement(a.zx,{type:"button",variant:"destructive",onClick:h,disabled:l},l?"Deleting...":"Yes, delete contact point"),e.createElement(a.zx,{type:"button",variant:"secondary",onClick:E,disabled:l},"Cancel"))),[v,E,h,l,r]),I,E]},Ze=({isOpen:n,onDismiss:l,error:r})=>e.createElement(se.u,{isOpen:n,onDismiss:l,closeOnBackdropClick:!0,closeOnEscape:!0,title:"Something went wrong"},e.createElement("p",null,"Failed to update your configuration:"),e.createElement("p",null,e.createElement("code",null,String(r))));var Je=t(67192);const ke=()=>e.createElement(Je.C,{text:"Unused","aria-label":"unused",color:"orange",icon:"exclamation-triangle",tooltip:"This contact point is not used in any notification policy and it will not receive any alerts"});var Y=t(7038),Ee=t(16859),Xe=(n=>(n[n.ContactPoints=0]="ContactPoints",n[n.NotificationTemplates=1]="NotificationTemplates",n))(Xe||{});const fe=10,qe=()=>{const{selectedAlertmanager:n}=(0,G.ZA)(),[l,r]=(0,e.useState)(0);let{isLoading:c,error:m,contactPoints:u}=(0,Y.ce)();const{deleteTrigger:v,updateAlertmanagerState:p}=(0,Y.kC)(n),[E,I]=(0,P.RA)(P.oI.CreateContactPoint),[h,N]=(0,P.RA)(P.oI.ExportContactPoint),[M,z]=Ye(v,p.isLoading),[V,_]=be(),[X]=(0,J.j)(),{search:ce}=ot(X),Z=l===0,le=l===1;if(m)return e.createElement(L.b,{title:"Failed to fetch contact points"},m.message);const rt=n===ee.GC;return e.createElement(e.Fragment,null,e.createElement(ye.u,{currentAlertmanager:n}),e.createElement(C.K,{direction:"column"},e.createElement(O.J,null,e.createElement(B.O,{label:"Contact Points",active:Z,counter:u.length,onChangeTab:()=>r(0)}),e.createElement(B.O,{label:"Notification Templates",active:le,onChangeTab:()=>r(1)})),e.createElement(Q.I,null,e.createElement(C.K,{direction:"column"},e.createElement(e.Fragment,null,c&&e.createElement(R.u,{text:"Loading..."}),Z&&e.createElement(e.Fragment,null,m?e.createElement(L.b,{title:"Failed to fetch contact points"},String(m)):e.createElement(e.Fragment,null,e.createElement(C.K,{direction:"row",alignItems:"end"},e.createElement(Qe,null),e.createElement(ie.L,null),e.createElement(C.K,{direction:"row",gap:1},E&&e.createElement(a.Qj,{icon:"plus","aria-label":"add contact point",variant:"primary",href:"/alerting/notifications/receivers/new",disabled:!I},"Add contact point"),h&&e.createElement(a.zx,{icon:"download-alt",variant:"secondary","aria-label":"export all",disabled:!N,onClick:()=>_(Ae)},"Export all"))),e.createElement(_e,{contactPoints:u,search:ce,pageSize:fe,onDelete:it=>z(it),disabled:p.isLoading}),!rt&&e.createElement(He,{alertManagerName:n}))),le&&e.createElement(e.Fragment,null,e.createElement(C.K,{direction:"row",alignItems:"center"},e.createElement(s.x,{variant:"body",color:"secondary"},"Create notification templates to customize your notifications."),e.createElement(ie.L,null),e.createElement(a.Qj,{icon:"plus",variant:"primary",href:"/alerting/notifications/templates/new"},"Add notification template")),e.createElement(we,null)))))),M,V)},_e=({contactPoints:n,disabled:l=!1,search:r,pageSize:c=fe,onDelete:m})=>{const u=et(n,r),{page:v,pageItems:p,numberOfPages:E,onPageChange:I}=(0,j.h)(u,1,c);return e.createElement(e.Fragment,null,p.map((h,N)=>{const M=(0,Ee.yL)(h),z=h.numberOfPolicies,V=`${h.name}-${N}`;return e.createElement(he,{key:V,name:h.name,disabled:l,onDelete:m,receivers:h.grafana_managed_receiver_configs,provisioned:M,policies:z})}),e.createElement(f.t,{currentPage:v,numberOfPages:E,onNavigate:I,hideWhenSinglePage:!0}))},ve=new x.Z({intraMode:1,intraIns:1,intraSub:1,intraDel:1,intraTrn:1});function et(n,l){const r=(0,e.useMemo)(()=>n.map(p=>p.name),[n]),c=(0,e.useMemo)(()=>n.map(p=>p.grafana_managed_receiver_configs.map(E=>E[Y.qs].name).join(" ")),[n]);if(!l)return n;const m=ve.filter(r,l)??[],u=ve.filter(c,l)??[],v=[...m,...u];return(0,y.uniq)(v).map(p=>n[p])??[]}const he=({name:n,disabled:l=!1,provisioned:r=!1,receivers:c,policies:m=0,onDelete:u})=>{const v=(0,o.wW)(oe),p=c.some(E=>!!E[Y.zR]);return e.createElement("div",{className:v.contactPointWrapper,"data-testid":"contact-point"},e.createElement(C.K,{direction:"column",gap:0},e.createElement(tt,{name:n,policies:m,provisioned:r,disabled:l,onDelete:u}),p?e.createElement("div",null,c.map((E,I)=>{const h=E[Y.zR],N=E[Y.qs],M=!E.disableResolveMessage,z=E[Y.pY],V=N.name+I;return e.createElement(nt,{key:V,name:N.name,type:E.type,description:(0,Ee.tS)(E),diagnostics:h,pluginMetadata:z,sendingResolved:M})})):e.createElement("div",{className:v.integrationWrapper},e.createElement(Ce,{receivers:c}))))},tt=n=>{const{name:l,disabled:r=!1,provisioned:c=!1,policies:m=0,onDelete:u}=n,v=(0,o.wW)(oe),[p,E]=(0,P.RA)(P.oI.ExportContactPoint),[I,h]=(0,P.RA)(P.oI.UpdateContactPoint),[N,M]=(0,P.RA)(P.oI.UpdateContactPoint),[z,V]=be(),_=m>0,X=I&&h&&!c,ce=N&&M&&!c&&m===0,Z=[];return p&&Z.push(e.createElement(e.Fragment,{key:"export-contact-point"},e.createElement(d.v.Item,{icon:"download-alt",label:"Export",ariaLabel:"export",disabled:!E,"data-testid":"export",onClick:()=>V(l)}),e.createElement(d.v.Divider,null))),N&&Z.push(e.createElement(T.Z,{key:"delete-contact-point",shouldWrap:_,wrap:le=>e.createElement(i.u,{content:"Contact point is currently in use by one or more notification policies",placement:"top"},e.createElement("span",null,le))},e.createElement(d.v.Item,{label:"Delete",ariaLabel:"delete",icon:"trash-alt",destructive:!0,disabled:r||!ce,onClick:()=>u(l)}))),e.createElement("div",{className:v.headerWrapper},e.createElement(C.K,{direction:"row",alignItems:"center",gap:1},e.createElement(C.K,{alignItems:"center",gap:1},e.createElement(s.x,{variant:"body",weight:"medium"},l)),_&&e.createElement(k.g,null,e.createElement(U.Link,{to:(0,re.u)("/alerting/routes",{contactPoint:l})},"is used by ",e.createElement(te.c,null,m)," ",F()("notification policy",m))),c&&e.createElement(de.C0,null),!_&&e.createElement(ke,null),e.createElement(ie.L,null),e.createElement(a.Qj,{tooltipPlacement:"top",tooltip:c?"Provisioned contact points cannot be edited in the UI":void 0,variant:"secondary",size:"sm",icon:X?"pen":"eye",type:"button",disabled:r,"aria-label":`${X?"edit":"view"}-action`,"data-testid":`${X?"edit":"view"}-action`,href:`/alerting/notifications/receivers/${encodeURIComponent(l)}/edit`},X?"Edit":"View"),Z.length>0&&e.createElement(A.L,{overlay:e.createElement(d.v,null,Z)},e.createElement(Se,null))),z)},nt=n=>{const{name:l,type:r,description:c,diagnostics:m,pluginMetadata:u,sendingResolved:v=!0}=n,p=(0,o.wW)(oe),E=w.y[r],I=m!==void 0;return e.createElement("div",{className:p.integrationWrapper},e.createElement(C.K,{direction:"column",gap:.5},e.createElement(C.K,{direction:"row",alignItems:"center",gap:1},e.createElement(C.K,{direction:"row",alignItems:"center",gap:.5},E&&e.createElement(b.J,{name:E}),u?e.createElement(xe,{metadata:u}):e.createElement(s.x,{variant:"body",color:"primary"},l)),c&&e.createElement(s.x,{variant:"bodySmall",color:"secondary"},c)),I&&e.createElement(at,{diagnostics:m,sendingResolved:v})))},Ce=({receivers:n})=>{const l=(0,y.groupBy)(n,r=>r.type);return e.createElement(C.K,{direction:"column",gap:0},e.createElement(C.K,{direction:"row",alignItems:"center",gap:1},Object.entries(l).map(([r,c],m)=>{const u=w.y[r],v=W[r]??(0,y.upperFirst)(r),p=(0,y.size)(l)-1===m;return e.createElement(e.Fragment,{key:r},e.createElement(C.K,{direction:"row",alignItems:"center",gap:.5},u&&e.createElement(b.J,{name:u}),e.createElement(s.x,{variant:"body"},v,c.length>1&&e.createElement(e.Fragment,null," (",c.length,")"))),!p&&"\u22C5")})))},at=({diagnostics:n,sendingResolved:l})=>{const r=(0,o.wW)(oe),c=!!n.lastNotifyAttemptError,m=(0,$.CQ)(n.lastNotifyAttempt),u=n.lastNotifyAttemptDuration,v=m.isValid();return e.createElement("div",{className:r.metadataRow},e.createElement(C.K,{direction:"row",gap:1},c?e.createElement(e.Fragment,null,e.createElement(k.g,{color:"error",icon:"exclamation-circle"},e.createElement(i.u,{content:n.lastNotifyAttemptError},e.createElement("span",null,"Last delivery attempt failed")))):e.createElement(e.Fragment,null,v&&e.createElement(e.Fragment,null,e.createElement(k.g,{icon:"clock-nine"},"Last delivery attempt"," ",e.createElement(i.u,{content:m.toLocaleString()},e.createElement("span",null,e.createElement(te.c,null,m.locale("en").fromNow())))),e.createElement(k.g,{icon:"stopwatch"},"took ",e.createElement(te.c,null,u))),!v&&e.createElement(k.g,{icon:"clock-nine"},"No delivery attempts"),!l&&e.createElement(k.g,{icon:"info-circle"},"Delivering ",e.createElement(te.c,null,"only firing")," notifications"))))},Ae=Symbol("all contact points"),be=()=>{const[n,l]=(0,e.useState)(null),[r,c]=(0,K.Z)(!1),[m,u]=(0,P.RA)(P.oI.DecryptSecrets),v=m&&u,p=(0,e.useCallback)(()=>{l(null),c(!1)},[c]),E=h=>{l(h),c(!0)};return[(0,e.useMemo)(()=>!n||!r?null:n===Ae?e.createElement(De,{decrypt:v,onClose:p}):e.createElement(Pe,{receiverName:n,decrypt:v,onClose:p}),[v,r,p,n]),E]},ot=n=>({search:n.get("search")??void 0}),oe=n=>({contactPointWrapper:(0,g.css)({borderRadius:`${n.shape.radius.default}`,border:`solid 1px ${n.colors.border.weak}`,borderBottom:"none"}),integrationWrapper:(0,g.css)({position:"relative",background:`${n.colors.background.primary}`,padding:`${n.spacing(1)} ${n.spacing(1.5)}`,borderBottom:`solid 1px ${n.colors.border.weak}`}),headerWrapper:(0,g.css)({background:`${n.colors.background.secondary}`,padding:`${n.spacing(1)} ${n.spacing(1.5)}`,borderBottom:`solid 1px ${n.colors.border.weak}`,borderTopLeftRadius:`${n.shape.radius.default}`,borderTopRightRadius:`${n.shape.radius.default}`}),metadataRow:(0,g.css)({borderBottomLeftRadius:`${n.shape.radius.default}`,borderBottomRightRadius:`${n.shape.radius.default}`})}),lt=qe},7038:(H,D,t)=>{t.d(D,{ce:()=>Q,kC:()=>R,pY:()=>O,qs:()=>C,zR:()=>L});var g=t(93638),x=t(56375),y=t.n(x),S=t(81828),F=t(4609),e=t(84639),U=t(84954),K=t(58533),$=t(16859);const L=Symbol("receiver_status"),C=Symbol("receiver_metadata"),O=Symbol("receiver_plugin_metadata"),B=10*1e3;function Q(){const{selectedAlertmanager:a,isGrafanaAlertmanager:s}=(0,U.ZA)(),{installed:f,loading:o}=(0,e.n)(K.W.OnCall),d=S.alertmanagerApi.endpoints.getContactPointsStatus.useQuery(void 0,{refetchOnFocus:!0,refetchOnReconnect:!0,pollingInterval:B,skip:!s}),i=S.alertmanagerApi.endpoints.grafanaNotifiers.useQuery(void 0,{skip:!s}),{data:A,isLoading:b}=F.onCallApi.endpoints.grafanaOnCallIntegrations.useQuery(void 0,{skip:!f||!s});let T;f?T=A??[]:f===!1&&(T=null);const W=S.alertmanagerApi.endpoints.getAlertmanagerConfiguration.useQuery(a,{refetchOnFocus:!0,refetchOnReconnect:!0,selectFromResult:G=>({...G,contactPoints:G.data?(0,$.Ml)(G.data,d.data,i.data,T):[]})}),P=W.error??d.error,j=W.isLoading||d.isLoading||o||b,J=W.contactPoints.sort((G,w)=>G.name.localeCompare(w.name));return{error:P,isLoading:j,contactPoints:J}}function R(a){const[s]=S.alertmanagerApi.endpoints.getAlertmanagerConfiguration.useLazyQuery(),[f,o]=S.alertmanagerApi.endpoints.updateAlertmanagerConfiguration.useMutation();return{deleteTrigger:i=>s(a).then(({data:A})=>{if(!A)return;const b=(0,g.Uy)(A,T=>((0,x.remove)(T?.alertmanager_config?.receivers??[],W=>W.name===i),T));return f({selectedAlertmanager:a,config:b}).unwrap()}),updateAlertmanagerState:o}}},16859:(H,D,t)=>{t.d(D,{Ml:()=>a,tS:()=>Q,yL:()=>B});var g=t(56375),x=t(59439);function y(o){return"grafana_managed_receiver_configs"in o?o.grafana_managed_receiver_configs??[]:Object.entries(o).filter(([i])=>i!=="grafana_managed_receiver_configs"&&i.endsWith("_configs")).filter(([i,A])=>Array.isArray(A)&&!(0,g.isEmpty)(A)).reduce((i,[A,b])=>{const T=A.replace("_configs",""),W=(0,g.times)(b.length,()=>({name:o.name,type:T,settings:[],disableResolveMessage:!1}));return i.concat(W)},[])}var S=t(66564),F=t(58533),e=t(32722),U=t(29137);const L={title:"Grafana OnCall",icon:U.g[F.W.OnCall]};function C(o,d){if(o===void 0)return L;if(o==null)return{...L,warning:"Grafana OnCall is not installed or is disabled"};const i=o.find(A=>A.integration_url===d.settings.url);return{...L,description:i?.display_name,externalUrl:i?(0,e.d)(F.W.OnCall,`/integrations/${i.value}`):void 0,warning:i?void 0:"OnCall Integration no longer exists"}}var O=t(7038);function B(o){return!!o.grafana_managed_receiver_configs?.find(i=>i.provenance)?.provenance}function Q(o){switch(o.type){case"email":return"addresses"in o.settings?R(o.settings.addresses):void 0;case"slack":{const d=o.settings.recipient;return d?`#${d}`:void 0}case"kafka":return o.settings.kafkaTopic;case"webhook":return o.settings.url;case S.hM.OnCall:return o[O.pY]?.description;default:return o[O.qs]?.description}}function R(o){const i=/,|;|\n+/g,b=o.trim().split(i).map(g.trim).length-3,T=(0,g.split)(o,i,3);return b>0&&T.push(`+${b} more`),T.join(", ")}function a(o,d=[],i=[],A){const b=o.alertmanager_config.receivers??[],T=(0,x.tK)(o?.alertmanager_config?.route??{}),W=s(T),P=(0,g.countBy)(W);return b.map(j=>{const J=y(j),G=d.find(w=>w.name===j.name);return{...j,numberOfPolicies:P[j.name]??0,grafana_managed_receiver_configs:J.map((w,ee)=>{const re=w.type===S.hM.OnCall;return{...w,[O.zR]:G?.integrations[ee],[O.qs]:f(i,w),[O.pY]:re?C(A,w):void 0}})}})}function s(o){const d=o.routes?.flatMap(i=>s(i))??[];return o.receiver?[o.receiver,...d]:d}function f(o,d){const i=o.find(A=>A.type===d.type);return{name:i?.name??(0,g.upperFirst)(d.type),description:i?.description}}},80316:(H,D,t)=>{t.d(D,{u:()=>R});var g=t(85960),x=t(62577),y=t(56375),S=t(19050);function F(a){const s=a.languages.CompletionItemKind.Function;return[{label:S.AlertmanagerTemplateFunction.toUpper,detail:"function(s string)",kind:s},{label:S.AlertmanagerTemplateFunction.toLower,detail:"function(s string)",kind:s},{label:S.AlertmanagerTemplateFunction.title,documentation:"Capitalizes the first letter of each word",detail:"function(s string)",kind:s},{label:S.AlertmanagerTemplateFunction.join,documentation:{value:"Joins an array of strings using the separator provided."},detail:"function(separator string, s []string)",kind:s},{label:S.AlertmanagerTemplateFunction.match,detail:"function",kind:s},{label:S.AlertmanagerTemplateFunction.safeHtml,detail:"function(pattern, repl, text)",kind:s},{label:S.AlertmanagerTemplateFunction.reReplaceAll,detail:"function(pattern, repl, text)",kind:s},{label:S.AlertmanagerTemplateFunction.stringSlice,detail:"function(s ...string)",kind:s}]}var e=t(9049);function U(a){const s={triggerCharacters:["."],provideCompletionItems(f,o,d){const i=f.getWordUntilPosition(o),A={startLineNumber:o.lineNumber,endLineNumber:o.lineNumber,startColumn:i.startColumn,endColumn:i.endColumn},b=new $(a,A);if(!K(f,o))return b.getSnippetsSuggestions();if(d.triggerKind===a.languages.CompletionTriggerKind.Invoke&&!d.triggerCharacter)return b.getFunctionsSuggestions();const W=f.getWordUntilPosition({lineNumber:o.lineNumber,column:o.column-1});return b.getTemplateDataSuggestions(W.word)}};return a.languages.registerCompletionItemProvider("go-template",s)}function K(a,s){const f={startLineNumber:s.lineNumber,endLineNumber:s.lineNumber,startColumn:a.getLineMinColumn(s.lineNumber),endColumn:a.getLineMaxColumn(s.lineNumber)},o='\\{\\{[a-zA-Z0-9._() "]+\\}\\}';return a.findMatches(o,f,!0,!1,null,!0).some(i=>i.range.containsPosition(s))}class ${constructor(s,f){this.monaco=s,this.range=f,this.getSnippetsSuggestions=()=>this.getCompletionsFromDefinitions((0,e.Zn)(this.monaco)),this.getFunctionsSuggestions=()=>this.getCompletionsFromDefinitions(F(this.monaco)),this.getTemplateDataSuggestions=o=>{switch(o){case"":return this.getCompletionsFromDefinitions((0,e.y5)(this.monaco),(0,e.J_)(this.monaco));case"Alerts":return this.getCompletionsFromDefinitions((0,e.WA)(this.monaco));case"GroupLabels":case"CommonLabels":case"CommonAnnotations":case"Labels":case"Annotations":return this.getCompletionsFromDefinitions((0,e.wY)(this.monaco));default:return{suggestions:[]}}},this.getCompletionsFromDefinitions=(...o)=>({suggestions:(0,y.concat)(...o).map(i=>L(i,this.range))})}}function L({label:a,detail:s,documentation:f,kind:o,insertText:d},i){const A=typeof a=="string"?a:a.label,b=typeof a=="string"?{label:a,description:s}:{...a};return b.description??=s,{label:b,kind:o,insertText:d??A,range:i,documentation:f,detail:s}}const C="go-template",B={id:C,extensions:[],aliases:[],mimetypes:[],loader:()=>Promise.resolve().then(t.bind(t,19050))},Q=(a,s)=>{const{id:f,loader:o}=s;a.languages.getLanguages().find(i=>i.id===f)||(a.languages.register({id:f}),o().then(i=>{a.languages.setMonarchTokensProvider(f,i.language),a.languages.setLanguageConfiguration(f,i.conf)}))},R=a=>{const s=!!a.autoHeight,f=(0,g.useRef)(null),o=d=>{if(s){const i=d.getContentHeight();try{d.layout({height:i,width:NaN})}catch{}}};return(0,g.useEffect)(()=>()=>{f.current?.dispose()},[]),g.createElement(x.p,{showLineNumbers:!0,showMiniMap:!1,...a,onEditorDidMount:o,onBeforeEditorMount:d=>{Q(d,B),f.current=U(d)},language:C})}},9049:(H,D,t)=>{t.d(D,{J_:()=>L,WA:()=>C,y5:()=>$,wY:()=>O,Zn:()=>Q,hn:()=>B});const g=`
{{ range .Alerts }}
  Status: {{ .Status }}
  Starts at: {{ .StartsAt }}
{{ end }}
`,x=`
[{{.Status}}] {{ .Labels.alertname }}

Labels:
{{ range .Labels.SortedPairs }}
  {{ .Name }}: {{ .Value }}
{{ end }}

{{ if gt (len .Annotations) 0 }}
Annotations:
{{ range .Annotations.SortedPairs }}
  {{ .Name }}: {{ .Value }}
{{ end }}
{{ end }}

{{ if gt (len .SilenceURL ) 0 }}
  Silence alert: {{ .SilenceURL }}
{{ end }}
{{ if gt (len .DashboardURL ) 0 }}
  Go to dashboard: {{ .DashboardURL }}
{{ end }}
`,y=K("GroupLabels.SortedPairs"),S=K("CommonLabels.SortedPairs"),F=K("CommonAnnotations.SortedPairs"),e=K("Labels.SortedPairs"),U=K("Annotations.SortedPairs");function K(R){return`
{{ range .${R} }}
  {{ .Name }} = {{ .Value }}
{{ end }}`}function $(R){const a=R.languages.CompletionItemKind.Field;return[{label:"Alerts",kind:a,detail:"Alert[]",documentation:{value:"An Array containing all alerts"}},{label:"Receiver",kind:a,detail:"string"},{label:"Status",kind:a,detail:"string"},{label:"GroupLabels",kind:a,detail:"[]KeyValue"},{label:"CommonLabels",kind:a,detail:"[]KeyValue"},{label:"CommonAnnotations",kind:a,detail:"[]KeyValue"},{label:"ExternalURL",kind:a,detail:"string"}]}function L(R){const a=R.languages.CompletionItemKind.Field;return[{label:{label:"Status",detail:"(Alert)",description:"string"},kind:a,detail:"string",documentation:{value:"Status of the alert. It can be `firing` or `resolved`"}},{label:{label:"Labels",detail:"(Alert)"},kind:a,detail:"[]KeyValue",documentation:{value:"A set of labels attached to the alert."}},{label:{label:"Annotations",detail:"(Alert)"},kind:a,detail:"[]KeyValue",documentation:"A set of annotations attached to the alert."},{label:{label:"StartsAt",detail:"(Alert)"},kind:a,detail:"time.Time",documentation:"Time the alert started firing."},{label:{label:"EndsAt",detail:"(Alert)"},kind:a,detail:"time.Time",documentation:"Only set if the end time of an alert is known. Otherwise set to a configurable timeout period from the time since the last alert was received."},{label:{label:"GeneratorURL",detail:"(Alert)"},kind:a,detail:"string",documentation:"Back link to Grafana or external Alertmanager."},{label:{label:"SilenceURL",detail:"(Alert)"},kind:a,detail:"string",documentation:"Link to Grafana silence for with labels for this alert pre-filled. Only for Grafana managed alerts."},{label:{label:"DashboardURL",detail:"(Alert)"},kind:a,detail:"string",documentation:"Link to Grafana dashboard, if alert rule belongs to one. Only for Grafana managed alerts."},{label:{label:"PanelURL",detail:"(Alert)"},kind:a,detail:"string",documentation:"Link to Grafana dashboard panel, if alert rule belongs to one. Only for Grafana managed alerts."},{label:{label:"Fingerprint",detail:"(Alert)"},kind:a,detail:"string",documentation:"Fingerprint that can be used to identify the alert."},{label:{label:"ValueString",detail:"(Alert)"},kind:a,detail:"string",documentation:"String that contains labels and values of each reduced expression in the alert."}]}function C(R){const a=R.languages.CompletionItemKind.Field;return[{label:"Firing",kind:a,detail:"Alert[]"},{label:"Resolved",kind:a,detail:"Alert[]"}]}function O(R){const a=R.languages.CompletionItemKind.Field;return[{label:"SortedPairs",kind:a,detail:"[]KeyValue"},{label:"Names",kind:a,detail:"[]string"},{label:"Values",kind:a,detail:"[]string"},{label:"Remove",detail:"KeyValue[] function(keys []string)",kind:R.languages.CompletionItemKind.Method}]}const B={alerts:{label:"alertsloop",description:"Renders a loop through alerts",snippet:g},alertDetails:{label:"alertdetails",description:"Renders all information available about the alert",snippet:x},groupLabels:{label:"grouplabelsloop",description:"Renders a loop through group labels",snippet:y},commonLabels:{label:"commonlabelsloop",description:"Renders a loop through common labels",snippet:S},commonAnnotations:{label:"commonannotationsloop",description:"Renders a loop through common annotations",snippet:F},labels:{label:"labelsloop",description:"Renders a loop through labels",snippet:e},annotations:{label:"annotationsloop",description:"Renders a loop through annotations",snippet:U}};function Q(R){const a=R.languages.CompletionItemKind.Snippet,s=R.languages.CompletionItemInsertTextRule.InsertAsSnippet,{alerts:f,alertDetails:o,groupLabels:d,commonLabels:i,commonAnnotations:A,labels:b,annotations:T}=B;return[{label:f.label,documentation:f.description,kind:a,insertText:f.snippet,insertTextRules:s},{label:{label:o.label,detail:"(Alert)"},documentation:o.description,kind:a,insertText:o.snippet,insertTextRules:s},{label:d.label,documentation:d.description,kind:a,insertText:d.snippet,insertTextRules:s},{label:i.label,documentation:i.description,kind:a,insertText:i.snippet,insertTextRules:s},{label:A.label,documentation:A.description,kind:a,insertText:A.snippet,insertTextRules:s},{label:{label:b.label,detail:"(Alert)"},documentation:b.description,kind:a,insertText:b.snippet,insertTextRules:s},{label:{label:T.label,detail:"(Alert)"},documentation:T.description,kind:a,insertText:T.snippet,insertTextRules:s}]}},29137:(H,D,t)=>{t.d(D,{g:()=>x});var g=t(58533);const x={[g.W.OnCall]:"public/img/alerting/oncall_logo.svg",[g.W.Incident]:"",[g.W.MachineLearning]:""}},90504:(H,D,t)=>{t.d(D,{A:()=>S});var g=t(85960),x=t(14607),y=t(29165);const S=({tooltip:F,icon:e,to:U,target:K,onClick:$,className:L,tooltipPlacement:C="top",...O})=>{const B=typeof F=="string"?F:void 0;return g.createElement(x.u,{content:F,placement:C},U?g.createElement(y.Qj,{variant:"secondary",fill:"text",icon:e,href:U,size:"sm",target:K,...O,"aria-label":B}):g.createElement(y.zx,{className:L,variant:"secondary",fill:"text",size:"sm",icon:e,type:"button",onClick:$,...O,"aria-label":B}))}},14806:(H,D,t)=>{t.d(D,{D:()=>x});var g=t(66681);const x=y=>({table:(0,g.css)`
    width: 100%;
    border-radius: ${y.shape.radius.default};
    border: solid 1px ${y.colors.border.weak};
    background-color: ${y.colors.background.secondary};

    th {
      padding: ${y.spacing(1)};
    }

    td {
      padding: 0 ${y.spacing(1)};
    }

    tr {
      height: 38px;
    }
  `,evenRow:(0,g.css)`
    background-color: ${y.colors.background.primary};
  `,colExpand:(0,g.css)`
    width: 36px;
  `,nameCell:(0,g.css)`
    gap: ${y.spacing(1)};
  `,actionsCell:(0,g.css)`
    text-align: right;
    width: 1%;
    white-space: nowrap;

    & > * + * {
      margin-left: ${y.spacing(.5)};
    }
  `})}}]);

//# sourceMappingURL=2323.b4041e0a993c3aca309a.js.map