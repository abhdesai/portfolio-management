"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7323],{82719:(k,O,t)=>{t.d(O,{Z:()=>_,v:()=>V});var e=t(66681),a=t(85960),S=t(83105),L=t(81223),p=t(92369),W=t(43183),x=t(90857),N=t(66596),F=t(51637),y=t(20519),f=t(27436),o=t(57445),w=t(76310),l=t(38797),T=t(34364),D=t(29165),Z=t(33808),H=t(66399),c=t(95329),Q=t(9675),I=t(76831),n=t(25199);function r(){const M=Q.a2.map(s=>({value:s.code,label:s.name}));return[{value:"",label:(0,c.t)("common.locale.default","Default")},...M]}class V extends a.PureComponent{constructor(u){super(u),this.onSubmitForm=async()=>{if(this.props.onConfirm?await this.props.onConfirm():!0){const{homeDashboardUID:$,theme:j,timezone:G,weekStart:J,language:B,queryHistory:X}=this.state;await this.service.update({homeDashboardUID:$,theme:j,timezone:G,weekStart:J,language:B,queryHistory:X}),window.location.reload()}},this.onThemeChanged=s=>{this.setState({theme:s.value}),s.value&&(0,n.L)(s.value,!0)},this.onTimeZoneChanged=s=>{typeof s=="string"&&this.setState({timezone:s})},this.onWeekStartChanged=s=>{this.setState({weekStart:s})},this.onHomeDashboardChanged=s=>{this.setState({homeDashboardUID:s})},this.onLanguageChanged=s=>{this.setState({language:s}),(0,W.ff)("grafana_preferences_language_changed",{toLanguage:s,preferenceType:this.props.preferenceType})},this.service=new I.y(u.resourceUri),this.state={theme:"",timezone:"",weekStart:"",language:"",queryHistory:{homeTab:""}},this.themeOptions=(0,S.d)(x.config.featureToggles.extraThemes).map(s=>({value:s.id,label:te(s)})),this.themeOptions.unshift({value:"",label:(0,c.t)("shared-preferences.theme.default-label","Default")})}async componentDidMount(){const u=await this.service.load();this.setState({homeDashboardUID:u.homeDashboardUID,theme:u.theme,timezone:u.timezone,weekStart:u.weekStart,language:u.language,queryHistory:u.queryHistory})}render(){const{theme:u,timezone:s,weekStart:$,homeDashboardUID:j,language:G}=this.state,{disabled:J}=this.props,B=Y(),X=r(),z=this.themeOptions.find(U=>U.value===u)??this.themeOptions[0];return a.createElement(N.l,{onSubmit:this.onSubmitForm},()=>a.createElement(a.Fragment,null,a.createElement(F.C,{label:a.createElement(c.cC,{i18nKey:"shared-preferences.title"},"Preferences"),disabled:J},a.createElement(y.g,{label:(0,c.t)("shared-preferences.fields.theme-label","Interface theme")},a.createElement(f.Ph,{options:this.themeOptions,value:z,onChange:this.onThemeChanged,inputId:"shared-preferences-theme-select"})),a.createElement(y.g,{label:a.createElement(o._,{htmlFor:"home-dashboard-select"},a.createElement("span",{className:B.labelText},a.createElement(c.cC,{i18nKey:"shared-preferences.fields.home-dashboard-label"},"Home Dashboard"))),"data-testid":"User preferences home dashboard drop down"},a.createElement(H.o,{value:j,onChange:U=>this.onHomeDashboardChanged(U?.uid??""),defaultOptions:!0,isClearable:!0,placeholder:(0,c.t)("shared-preferences.fields.home-dashboard-placeholder","Default dashboard"),inputId:"home-dashboard-select"})),a.createElement(y.g,{label:(0,c.t)("shared-dashboard.fields.timezone-label","Timezone"),"data-testid":p.wl.components.TimeZonePicker.containerV2},a.createElement(w.O,{includeInternal:!0,value:s,onChange:this.onTimeZoneChanged,inputId:"shared-preferences-timezone-picker"})),a.createElement(y.g,{label:(0,c.t)("shared-preferences.fields.week-start-label","Week start"),"data-testid":p.wl.components.WeekStartPicker.containerV2},a.createElement(l.z,{value:$||"",onChange:this.onWeekStartChanged,inputId:"shared-preferences-week-start-picker"})),a.createElement(y.g,{label:a.createElement(o._,{htmlFor:"locale-select"},a.createElement("span",{className:B.labelText},a.createElement(c.cC,{i18nKey:"shared-preferences.fields.locale-label"},"Language")),a.createElement(T.a,{featureState:L.CQ.beta})),"data-testid":"User preferences language drop down"},a.createElement(f.Ph,{value:X.find(U=>U.value===G),onChange:U=>this.onLanguageChanged(U.value??""),options:X,placeholder:(0,c.t)("shared-preferences.fields.locale-placeholder","Choose language"),inputId:"locale-select"}))),a.createElement(D.zx,{type:"submit",variant:"primary","data-testid":p.wl.components.UserProfile.preferencesSaveButton},a.createElement(c.cC,{i18nKey:"common.save"},"Save"))))}}const _=V,Y=(0,Z.B)(()=>({labelText:(0,e.css)`
      margin-right: 6px;
    `}));function te(M){switch(M.id){case"dark":return(0,c.t)("shared.preferences.theme.dark-label","Dark");case"light":return(0,c.t)("shared.preferences.theme.light-label","Light");case"system":return(0,c.t)("shared.preferences.theme.system-label","System preference");default:return M.name}}},16246:(k,O,t)=>{t.r(O),t.d(O,{UserProfileEditPage:()=>ae,default:()=>ue});var e=t(85960),a=t(36752),S=t(16857),L=t(73999),p=t(92369),W=t(26141),x=t(74042),N=t(70523),F=t(94439),y=t(10305),f=t(20989),o=t(82719),w=t(763),l=t(95329),T=t(79468),D=t(29165);class Z extends e.PureComponent{render(){const{isLoading:v,orgs:g,user:h}=this.props;return v?e.createElement(T.u,{text:"Loading organizations..."}):g.length===0?null:e.createElement("div",null,e.createElement("h3",{className:"page-sub-heading"},e.createElement(l.cC,{i18nKey:"user-orgs.title"},"Organizations")),e.createElement("div",{className:"gf-form-group"},e.createElement("table",{className:"filter-table form-inline","data-testid":p.wl.components.UserProfile.orgsTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,e.createElement(l.cC,{i18nKey:"user-orgs.name-column"},"Name")),e.createElement("th",null,e.createElement(l.cC,{i18nKey:"user-orgs.role-column"},"Role")),e.createElement("th",null))),e.createElement("tbody",null,g.map((d,m)=>e.createElement("tr",{key:m},e.createElement("td",null,d.name),e.createElement("td",null,d.role),e.createElement("td",{className:"text-right"},d.orgId===h?.orgId?e.createElement(D.zx,{variant:"secondary",size:"sm",disabled:!0},e.createElement(l.cC,{i18nKey:"user-orgs.current-org-button"},"Current")):e.createElement(D.zx,{variant:"secondary",size:"sm",onClick:()=>{this.props.setUserOrg(d)}},e.createElement(l.cC,{i18nKey:"user-orgs.select-org-button"},"Select organisation")))))))))}}const H=Z;var c=t(66596),Q=t(51637),I=t(20519),n=t(24956),r=t(14607),V=t(97666),_=t(67954);const{disableLoginForm:Y}=_.default,M=({user:E,isSavingUser:v,updateProfile:g})=>{const h=P=>{g(P)},d=(E&&E.isExternal)??!1,m=d&&E&&E.authLabels?E.authLabels[0]:"",C=m?` (Synced via ${m})`:"",b=Y||d;return e.createElement(c.l,{onSubmit:h,validateOn:"onBlur"},({register:P,errors:R})=>e.createElement(e.Fragment,null,e.createElement(Q.C,null,e.createElement(I.g,{label:(0,l.t)("user-profile.fields.name-label","Name")+C,invalid:!!R.name,error:e.createElement(l.cC,{i18nKey:"user-profile.fields.name-error"},"Name is required"),disabled:b},e.createElement(n.I,{...P("name",{required:!0}),id:"edit-user-profile-name",placeholder:(0,l.t)("user-profile.fields.name-label","Name"),defaultValue:E?.name??"",suffix:e.createElement(u,null)})),e.createElement(I.g,{label:(0,l.t)("user-profile.fields.email-label","Email")+C,invalid:!!R.email,error:e.createElement(l.cC,{i18nKey:"user-profile.fields.email-error"},"Email is required"),disabled:b},e.createElement(n.I,{...P("email",{required:!0}),id:"edit-user-profile-email",placeholder:(0,l.t)("user-profile.fields.email-label","Email"),defaultValue:E?.email??"",suffix:e.createElement(u,null)})),e.createElement(I.g,{label:(0,l.t)("user-profile.fields.username-label","Username")+C,disabled:b},e.createElement(n.I,{...P("login"),id:"edit-user-profile-username",defaultValue:E?.login??"",placeholder:(0,l.t)("user-profile.fields.username-label","Username")+C,suffix:e.createElement(u,null)}))),e.createElement(D.zx,{variant:"primary",disabled:v||b,"data-testid":p.wl.components.UserProfile.profileSaveButton,type:"submit"},e.createElement(l.cC,{i18nKey:"common.save"},"Save"))))},u=()=>Y?e.createElement(r.u,{content:"Login details locked because they are managed in another system."},e.createElement(V.J,{name:"lock"})):null;var s=t(66681),$=t(18863);class j extends e.PureComponent{render(){const{isLoading:v,sessions:g,revokeUserSession:h}=this.props,d=G();return v?e.createElement(T.u,{text:e.createElement(l.cC,{i18nKey:"user-sessions.loading"},"Loading sessions...")}):e.createElement("div",{className:d.wrapper},g.length>0&&e.createElement(e.Fragment,null,e.createElement("h3",{className:"page-sub-heading"},"Sessions"),e.createElement("div",{className:(0,s.cx)("gf-form-group",d.table)},e.createElement("table",{className:"filter-table form-inline","data-testid":p.wl.components.UserProfile.sessionsTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,e.createElement(l.cC,{i18nKey:"user-session.seen-at-column"},"Last seen")),e.createElement("th",null,e.createElement(l.cC,{i18nKey:"user-session.created-at-column"},"Logged on")),e.createElement("th",null,e.createElement(l.cC,{i18nKey:"user-session.ip-column"},"IP address")),e.createElement("th",null,e.createElement(l.cC,{i18nKey:"user-session.browser-column"},"Browser & OS")),e.createElement("th",null))),e.createElement("tbody",null,g.map((m,C)=>e.createElement("tr",{key:C},m.isActive?e.createElement("td",null,"Now"):e.createElement("td",null,m.seenAt),e.createElement("td",null,(0,l.$q)(m.createdAt,{dateStyle:"long"})),e.createElement("td",null,m.clientIp),e.createElement("td",null,m.browser," on ",m.os," ",m.osVersion),e.createElement("td",null,e.createElement(D.zx,{size:"sm",variant:"destructive",onClick:()=>h(m.id),"aria-label":(0,$.t)("user-session.revoke","Revoke user session")},e.createElement(V.J,{name:"power"}))))))))))}}const G=()=>({wrapper:(0,s.css)({maxWidth:"100%"}),table:(0,s.css)({overflow:"auto"})}),J=j;class B extends e.PureComponent{render(){const{isLoading:v,teams:g}=this.props;return v?e.createElement(T.u,{text:"Loading teams..."}):g.length===0?null:e.createElement("div",null,e.createElement("h3",{className:"page-sub-heading"},"Teams"),e.createElement("div",{className:"gf-form-group"},e.createElement("table",{className:"filter-table form-inline","aria-label":"User teams table"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,"Name"),e.createElement("th",null,"Email"),e.createElement("th",null,"Members"))),e.createElement("tbody",null,g.map((h,d)=>e.createElement("tr",{key:d},e.createElement("td",{className:"width-4 text-center"},e.createElement("img",{className:"filter-table__avatar",src:h.avatarUrl,alt:""})),e.createElement("td",null,h.name),e.createElement("td",null,h.email),e.createElement("td",null,h.memberCount)))))))}}const X=null;var z=t(1545);const U="tab",q="general";function ie(E){const v=E.user,{user:g,teams:h,orgs:d,sessions:m,teamsAreLoading:C,orgsAreLoading:b,sessionsAreLoading:P,isUpdating:R}=v;return{orgsAreLoading:b,sessionsAreLoading:P,teamsAreLoading:C,orgs:d,sessions:m,teams:h,isUpdating:R,user:g}}const ce={initUserProfilePage:z.PA,revokeUserSession:z.cc,changeUserOrg:z.hz,updateUserProfile:z.Lj},me=(0,a.connect)(ie,ce);function ae({orgsAreLoading:E,sessionsAreLoading:v,teamsAreLoading:g,initUserProfilePage:h,orgs:d,sessions:m,teams:C,isUpdating:b,user:P,revokeUserSession:R,changeUserOrg:de,updateUserProfile:Ee}){const[fe,ge]=(0,w.K)(),ne=fe[U],[ee,he]=(0,e.useState)(typeof ne=="string"?ne:q);(0,S.Z)(()=>h());const re=(0,e.useMemo)(()=>{const{extensions:i}=(0,W.QK)({extensionPointId:L.y.UserProfileTab,context:{}});return i},[]),se=re.reduce((i,K)=>{const{title:A}=K;return i[A]?i[A].push(K):i[A]=[K],i},{}),le=i=>i.toLowerCase(),pe=re.length>0,ve=[{id:q,title:(0,l.t)("user-profile.tabs.general","General")},...Object.keys(se).map(i=>({id:le(i),title:i}))],oe=()=>e.createElement(x.wc,{spacing:"md"},e.createElement(M,{updateProfile:Ee,isSavingUser:b,user:P}),e.createElement(o.Z,{resourceUri:"user",preferenceType:"user"}),e.createElement(B,{isLoading:g,teams:C}),e.createElement(H,{isLoading:E,setUserOrg:de,orgs:d,user:P}),e.createElement(J,{isLoading:v,revokeUserSession:R,sessions:m})),Pe=()=>e.createElement("div",{"data-testid":p.wl.components.UserProfile.extensionPointTabs},e.createElement(x.wc,{spacing:"md"},e.createElement(N.J,null,ve.map(({id:i,title:K})=>e.createElement(F.O,{key:i,label:K,active:ee===i,onChangeTab:()=>{he(i),ge({[U]:i})},"data-testid":p.wl.components.UserProfile.extensionPointTab(i)}))),e.createElement(y.I,null,ee===q&&e.createElement(oe,null),Object.entries(se).map(([i,K])=>{const A=le(i);return ee===A?e.createElement(e.Fragment,{key:A},K.map(({component:Ue},Ce)=>e.createElement(Ue,{key:`${A}-${Ce}`}))):null}))));return e.createElement(f.T,{navId:"profile/settings"},e.createElement(f.T.Contents,{isLoading:!P},pe?e.createElement(Pe,null):e.createElement(oe,null)))}const ue=me(ae)},1545:(k,O,t)=>{t.d(O,{Cp:()=>w,hz:()=>Q,PA:()=>l,II:()=>T,cc:()=>c,Lj:()=>I});var e=t(90857),a=t(85445);async function S(n){try{await(0,a.i)().put("/api/user/password",n)}catch(r){console.error(r)}}function L(){return(0,a.i)().get("/api/user")}function p(){return(0,a.i)().get("/api/user/teams")}function W(){return(0,a.i)().get("/api/user/orgs")}function x(){return(0,a.i)().get("/api/user/auth-tokens")}async function N(n){await(0,a.i)().post("/api/user/revoke-auth-token",{authTokenId:n})}async function F(n){await(0,a.i)().post("/api/user/using/"+n.orgId,{})}async function y(n){try{await(0,a.i)().put("/api/user",n)}catch(r){console.error(r)}}const f={changePassword:S,revokeUserSession:N,loadUser:L,loadSessions:x,loadOrgs:W,loadTeams:p,setUserOrg:F,updateUserProfile:y};var o=t(21644);function w(n){return async function(r){r((0,o.zc)({updating:!0})),await f.changePassword(n),r((0,o.zc)({updating:!1}))}}function l(){return async function(n){await n(T()),n(D()),n(Z()),n(H())}}function T(){return async function(n){const r=await f.loadUser();n((0,o.aw)({user:r}))}}function D(){return async function(n){n((0,o.qD)());const r=await f.loadTeams();n((0,o.PL)({teams:r}))}}function Z(){return async function(n){n((0,o.$S)());const r=await f.loadOrgs();n((0,o.Ns)({orgs:r}))}}function H(){return async function(n){n((0,o.Uk)());const r=await f.loadSessions();n((0,o.z0)({sessions:r}))}}function c(n){return async function(r){r((0,o.zc)({updating:!0})),await f.revokeUserSession(n),r((0,o.p$)({tokenId:n}))}}function Q(n){return async function(r){r((0,o.zc)({updating:!0})),await f.setUserOrg(n),window.location.href=e.config.appSubUrl+"/profile"}}function I(n){return async function(r){r((0,o.zc)({updating:!0})),await f.updateUserProfile(n),await r(T()),r((0,o.zc)({updating:!1}))}}},16857:(k,O,t)=>{t.d(O,{Z:()=>S});var e=t(33067),a=function(L){(0,e.Z)(function(){L()})};const S=a}}]);

//# sourceMappingURL=UserProfileEditPage.71d375eaf89d5f7b72ae.js.map