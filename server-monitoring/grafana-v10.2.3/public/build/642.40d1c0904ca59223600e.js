"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[642],{86755:(it,ge,v)=>{v.d(ge,{K:()=>o});var Y=v(66681),q=v(85960),ue=v(47257);const o=({children:ae})=>{const he=(0,ue.wW)(Se);return q.createElement("div",{className:he.root},ae)},Se=ae=>({root:(0,Y.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:ae.spacing(3),minHeight:ae.spacing(4)})})},27786:(it,ge,v)=>{v.d(ge,{X:()=>Ee});var Y=v(66681),q=v(85960),ue=v(47257),o=v(27436),Se=v(39445),ae=Object.defineProperty,he=Object.defineProperties,re=Object.getOwnPropertyDescriptors,ie=Object.getOwnPropertySymbols,U=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable,J=(T,C,R)=>C in T?ae(T,C,{enumerable:!0,configurable:!0,writable:!0,value:R}):T[C]=R,Fe=(T,C)=>{for(var R in C||(C={}))U.call(C,R)&&J(T,R,C[R]);if(ie)for(var R of ie(C))ze.call(C,R)&&J(T,R,C[R]);return T},z=(T,C)=>he(T,re(C)),be=(T,C)=>{var R={};for(var F in T)U.call(T,F)&&C.indexOf(F)<0&&(R[F]=T[F]);if(T!=null&&ie)for(var F of ie(T))C.indexOf(F)<0&&ze.call(T,F)&&(R[F]=T[F]);return R};function Ee(T){var C=T,{label:R}=C,F=be(C,["label"]);const me=(0,ue.wW)(Ae),[je]=(0,q.useState)(()=>Math.random().toString(16).slice(2)),nt={SelectContainer:W,ValueContainer:Q,SingleValue:Q};return q.createElement("div",{className:me.root},R&&q.createElement("label",{className:me.label,htmlFor:je},R,":","\xA0"),q.createElement(o.Ph,z(Fe({openMenuOnFocus:!0,inputId:je},F),{components:nt})))}const W=T=>{const{children:C}=T,R=(0,ue.wW)(Ae);return q.createElement(Se.e,z(Fe({},T),{className:(0,Y.cx)(T.className,R.container)}),C)},Q=T=>{const{className:C,children:R}=T,F=(0,ue.wW)(Ae);return q.createElement("div",{className:(0,Y.cx)(C,F.valueContainer)},R)},Ae=T=>({root:(0,Y.css)({display:"flex",fontSize:12,alignItems:"center"}),label:(0,Y.css)({color:T.colors.text.secondary,whiteSpace:"nowrap"}),container:(0,Y.css)({background:"none",borderColor:"transparent"}),valueContainer:(0,Y.css)({display:"flex",alignItems:"center",flex:"initial",color:T.colors.text.secondary,fontSize:12})})},80642:(it,ge,v)=>{v.r(ge),v.d(ge,{plugin:()=>Go});var Y=v(41466),q=v(43471),ue=v(2384),o=v(85960),Se=v(52219),ae=v(83743),he=v(57773),re=v(12399),ie=v(85445),U=v(90857),ze=v(45635),J=v(49199),Fe=v(9011),z=v(56375),be=v.n(z),Ee=v(71244);class W{static createISO8601Duration(e,s){const r=["hour","minute","h","m"];return(0,z.includes)(r,s)?`PT${e}${s[0].toUpperCase()}`:`P${e}${s[0].toUpperCase()}`}static createISO8601DurationFromInterval(e){const s=+e.slice(0,e.length-1),r=e[e.length-1];if(e.indexOf("ms")>-1)return W.createISO8601Duration(1,"m");if(e[e.length-1]==="s"){let a=s*60%60;return a<1&&(a=1),W.createISO8601Duration(a,"m")}return W.createISO8601Duration(s,r)}static findClosestTimeGrain(e,s){const r=(0,z.filter)(s,c=>c!=="auto");let a=r[0];const i=Ee.intervalToMs(e);for(let c=0;c<r.length;c++)i>Ee.intervalToMs(r[c])&&(c+1<r.length?a=r[c+1]:a=r[c]);return a}static createTimeGrainFromISO8601Duration(e){let s=1;e.substring(0,2)==="PT"&&(s=2);const r=e.substring(s,e.length-1),a=e.substring(e.length-1);return r+" "+W.timeUnitToText(+r,a)}static timeUnitToText(e,s){let r="";return s==="S"&&(r="second"),s==="M"&&(r="minute"),s==="H"&&(r="hour"),s==="D"&&(r="day"),e>1?r+"s":r}static createKbnUnitFromISO8601Duration(e){if(e==="auto")return"auto";let s=1;e.substring(0,2)==="PT"&&(s=2);const r=e.substring(s,e.length-1),a=e.substring(e.length-1);return r+W.timeUnitToKbn(+r,a)}static timeUnitToKbn(e,s){return s==="S"?"s":s==="M"?"m":s==="H"?"h":s==="D"?"d":""}}class Q{static parseResponseValues(e,s,r){const a=[];if(!e)return a;for(let i=0;i<e.value.length;i++)if(!(0,z.find)(a,["value",(0,z.get)(e.value[i],r)])){const c=(0,z.get)(e.value[i],r),n=(0,z.get)(e.value[i],s,c);a.push({text:n,value:c})}return a}static parseResourceNames(e,s){const r=[];if(!e)return r;for(let a=0;a<e.value.length;a++)typeof e.value[a].type=="string"&&(!s||e.value[a].type.toLocaleLowerCase()===s.toLocaleLowerCase())&&r.push({text:e.value[a].name,value:e.value[a].name});return r}static parseMetadata(e,s){const r=["None","Average","Minimum","Maximum","Total","Count"],a=e?.value.find(i=>i.name.value===s);return a?{primaryAggType:a.primaryAggregationType,supportedAggTypes:a.supportedAggregationTypes||r,supportedTimeGrains:[{label:"Auto",value:"auto"},...Q.parseTimeGrains(a.metricAvailabilities??[])],dimensions:Q.parseDimensions(a.dimensions??[])}:{primaryAggType:"",supportedAggTypes:r,supportedTimeGrains:[],dimensions:[]}}static parseTimeGrains(e){const s=[];return e&&e.forEach(r=>{r.timeGrain&&s.push({label:W.createTimeGrainFromISO8601Duration(r.timeGrain),value:r.timeGrain})}),s}static parseDimensions(e){return e.map(s=>({label:s.localizedValue||s.value,value:s.value}))}static parseSubscriptions(e){const s=[];if(!e)return s;const r="subscriptionId",a="displayName";for(let i=0;i<e.value.length;i++)(0,z.find)(s,["value",(0,z.get)(e.value[i],r)])||s.push({text:`${(0,z.get)(e.value[i],a)}`,value:(0,z.get)(e.value[i],r)});return s}static parseSubscriptionsForSelect(e){const s=[];if(!e)return s;const r="subscriptionId",a="displayName";for(let i=0;i<e.data.value.length;i++)(0,z.find)(s,["value",(0,z.get)(e.data.value[i],r)])||s.push({label:`${(0,z.get)(e.data.value[i],a)} - ${(0,z.get)(e.data.value[i],r)}`,value:(0,z.get)(e.data.value[i],r)});return s}static parseLocations(e){const s=[];if(!e)return s;for(const r of e.value)s.push({name:r.name,displayName:r.displayName,supportsLogs:void 0});return s}}const Ae=(t,e)=>t.some(s=>s.options?Ae(s.options,e):s.value===e),T=(t,e=[])=>{if(e.length===0)return[];const s=e.reduce((r,a)=>(r.add(a),r),new Set);return t.filter(r=>s.has(r.value))},C=t=>({value:t.value,label:t.text}),R=(t,e,s)=>{const r=[...t,e],a=t.map(i=>i.value.toLowerCase()).concat(e.options.map(i=>i.value));return s&&!a.includes(s.toLowerCase())&&r.push({label:s,value:s}),r},F={azureMonitor:"azuremonitor",logAnalytics:"loganalytics",appInsights:"appinsights",resourceGraph:"resourcegraph"};function me(t,e){return typeof t=="string"?e.multi||e.includeAll&&!e.allValue?"'"+t+"'":t:typeof t=="number"?t:(0,z.map)(t,r=>typeof t=="number"?t:"'"+r+"'").join(",")}var je=v(72555);const nt={subscriptions:[]};var m=(t=>(t.AzureMonitor="Azure Monitor",t.AzureResourceGraph="Azure Resource Graph",t.AzureTraces="Azure Traces",t.GrafanaTemplateVariableFn="Grafana Template Variable Function",t.LocationsQuery="Azure Regions",t.LogAnalytics="Azure Log Analytics",t.MetricNamesQuery="Azure Metric Names",t.NamespacesQuery="Azure Namespaces",t.ResourceGroupsQuery="Azure Resource Groups",t.ResourceNamesQuery="Azure Resource Names",t.SubscriptionsQuery="Azure Subscriptions",t.WorkspacesQuery="Azure Workspaces",t))(m||{});const Wo={allowedTimeGrainsMs:[],dimensionFilters:[],resources:[]},Uo={resources:[]},jo={filters:[],resources:[],traceTypes:[]},Xo={filters:[]};var Z=(t=>(t.Logs="logs",t.Table="table",t.TimeSeries="time_series",t.Trace="trace",t))(Z||{});const Bo={filters:[]};var Te=(t=>(t.Public="AzureCloud",t.China="AzureChinaCloud",t.USGovernment="AzureUSGovernment",t.None="",t))(Te||{});const jt=Symbol("Concealed client secret");function Ge(t){return t.jsonData.azureAuthType?t.jsonData.azureAuthType:t.jsonData.tenantId&&t.jsonData.clientId?"clientsecret":U.config.azure.managedIdentityEnabled?"msi":"clientsecret"}function Ne(){switch(U.config.azure.cloud){case Te.Public:case Te.None:case void 0:return"azuremonitor";case Te.China:return"chinaazuremonitor";case Te.USGovernment:return"govazuremonitor";default:throw new Error(`The cloud '${U.config.azure.cloud}' not supported.`)}}function ct(t){switch(t){case"azuremonitor":return"https://portal.azure.com";case"chinaazuremonitor":return"https://portal.azure.cn";case"govazuremonitor":return"https://portal.azure.us";default:throw new Error("The cloud not supported.")}}function lt(t){switch(Ge(t)){case"msi":case"workloadidentity":return Ne();case"clientsecret":return t.jsonData.cloudName||Ne()}}function Xt(t){if(t.secureJsonFields.clientSecret)return jt;{const e=t.secureJsonData?.clientSecret;return typeof e=="string"&&e.length>0?e:void 0}}function Bt(t){switch(t.authType){case"msi":case"workloadidentity":return!0;case"clientsecret":return!!(t.azureCloud&&t.tenantId&&t.clientId&&t.clientSecret)}}function Ht(t){const e=Ge(t);switch(e){case"msi":case"workloadidentity":return e==="msi"&&U.config.azure.managedIdentityEnabled||e==="workloadidentity"&&U.config.azure.workloadIdentityEnabled?{authType:e}:{authType:"clientsecret",azureCloud:Ne()};case"clientsecret":return{authType:"clientsecret",azureCloud:t.jsonData.cloudName||Ne(),tenantId:t.jsonData.tenantId,clientId:t.jsonData.clientId,clientSecret:Xt(t)}}}function Kt(t,e){switch(e.authType){case"msi":case"workloadidentity":if(e.authType==="msi"&&!U.config.azure.managedIdentityEnabled)throw new Error("Managed Identity authentication is not enabled in Grafana config.");if(e.authType==="workloadidentity"&&!U.config.azure.workloadIdentityEnabled)throw new Error("Workload Identity authentication is not enabled in Grafana config.");return t={...t,jsonData:{...t.jsonData,azureAuthType:e.authType}},t;case"clientsecret":return t={...t,jsonData:{...t.jsonData,azureAuthType:"clientsecret",cloudName:e.azureCloud||Ne(),tenantId:e.tenantId,clientId:e.clientId},secureJsonData:{...t.secureJsonData,clientSecret:typeof e.clientSecret=="string"?e.clientSecret:void 0},secureJsonFields:{...t.secureJsonFields,clientSecret:typeof e.clientSecret=="symbol"}},t}}var O=v(20519),D=v(27436),x=v(24956),_=v(29165);const N={components:{configEditor:{authType:{select:"data-testid auth-type"},azureCloud:{input:"data-testid azure-cloud"},tenantID:{input:"data-testid tenant-id"},clientID:{input:"data-testid client-id"},clientSecret:{input:"data-testid client-secret"},loadSubscriptions:{button:"data-testid load-subscriptions"},defaultSubscription:{input:"data-testid default-subscription"}},queryEditor:{header:{select:"data-testid azure-monitor-experimental-header"},resourcePicker:{select:{button:"data-testid resource-picker-select"},search:{input:"data-testid resource-picker-search"},apply:{button:"data-testid resource-picker-apply"},cancel:{button:"data-testid resource-picker-cancel"},advanced:{collapse:"data-testid resource-picker-advanced",subscription:{input:"data-testid resource-picker-subscription"},resourceGroup:{input:"data-testid resource-picker-resource-group"},namespace:{input:"data-testid resource-picker-namespace"},region:{input:"data-testid resource-picker-region"},resource:{input:"data-testid resource-picker-resource"}}},metricsQueryEditor:{container:{input:"data-testid azure-monitor-metrics-query-editor-with-experimental-ui"},metricName:{input:"data-testid metric-name"}},logsQueryEditor:{container:{input:"data-testid azure-monitor-logs-query-editor-with-experimental-ui"},formatSelection:{input:"data-testid format-selection"}},argsQueryEditor:{container:{input:"data-testid azure-monitor-arg-query-editor"},subscriptions:{input:"data-testid azure-monitor-args-subscription"}},tracesQueryEditor:{container:{input:"data-testid azure-monitor-traces-query-editor-with-experimental-ui"},traceTypes:{select:"data-testid azure-monitor-traces-query-editor-trace-types"}}},variableEditor:{queryType:{input:"data-testid query-type"},subscription:{input:"data-testid subscription"},resourceGroup:{input:"data-testid resource-group"},namespace:{input:"data-testid namespace"},resource:{input:"data-testid resource"},region:{input:"data-testid region"}}}},Jt=t=>{const{credentials:e,azureCloudOptions:s,onCredentialsChange:r,disabled:a,managedIdentityEnabled:i,workloadIdentityEnabled:c}=t,n=(0,o.useMemo)(()=>{let f=[{value:"clientsecret",label:"App Registration"}];return i&&f.push({value:"msi",label:"Managed Identity"}),c&&f.push({value:"workloadidentity",label:"Workload Identity"}),f},[i,c]),l=f=>{const p=i?"msi":c?"workloadidentity":"clientsecret",b={...e,authType:f.value||p};r(b)},u=f=>{if(e.authType==="clientsecret"){const p={...e,azureCloud:f.value};r(p)}},d=f=>{if(e.authType==="clientsecret"){const p={...e,tenantId:f.target.value};r(p)}},g=f=>{if(e.authType==="clientsecret"){const p={...e,clientId:f.target.value};r(p)}},w=f=>{if(e.authType==="clientsecret"){const p={...e,clientSecret:f.target.value};r(p)}},h=()=>{if(e.authType==="clientsecret"){const f={...e,clientSecret:""};r(f)}};return o.createElement(he.K,{title:"Authentication"},n.length>1&&o.createElement(O.g,{label:"Authentication",description:"Choose the type of authentication to Azure services","data-testid":N.components.configEditor.authType.select,htmlFor:"authentication-type"},o.createElement(D.Ph,{className:"width-15",value:n.find(f=>f.value===e.authType),options:n,onChange:l,disabled:a})),e.authType==="clientsecret"&&o.createElement(o.Fragment,null,s&&o.createElement(O.g,{label:"Azure Cloud","data-testid":N.components.configEditor.azureCloud.input,htmlFor:"azure-cloud-type",disabled:a},o.createElement(D.Ph,{inputId:"azure-cloud-type","aria-label":"Azure Cloud",className:"width-15",value:s.find(f=>f.value===e.azureCloud),options:s,onChange:u})),o.createElement(O.g,{label:"Directory (tenant) ID",required:!0,"data-testid":N.components.configEditor.tenantID.input,htmlFor:"tenant-id",invalid:!e.tenantId,error:"Tenant ID is required"},o.createElement(x.I,{"aria-label":"Tenant ID",className:"width-30",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:e.tenantId||"",onChange:d,disabled:a})),o.createElement(O.g,{label:"Application (client) ID",required:!0,"data-testid":N.components.configEditor.clientID.input,htmlFor:"client-id",invalid:!e.clientId,error:"Client ID is required"},o.createElement(x.I,{className:"width-30","aria-label":"Client ID",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:e.clientId||"",onChange:g,disabled:a})),!a&&(typeof e.clientSecret=="symbol"?o.createElement(O.g,{label:"Client Secret",htmlFor:"client-secret",required:!0},o.createElement("div",{className:"width-30",style:{display:"flex",gap:"4px"}},o.createElement(x.I,{"aria-label":"Client Secret",placeholder:"configured",disabled:!0,"data-testid":"client-secret"}),o.createElement(_.zx,{variant:"secondary",type:"button",onClick:h,disabled:a},"Reset"))):o.createElement(O.g,{label:"Client Secret","data-testid":N.components.configEditor.clientSecret.input,required:!0,htmlFor:"client-secret",invalid:!e.clientSecret,error:"Client secret is required"},o.createElement(x.I,{className:"width-30","aria-label":"Client Secret",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:e.clientSecret||"",onChange:w,id:"client-secret",disabled:a})))),t.children)},Ko=null,Zt=t=>{const{credentials:e,disabled:s,options:r,subscriptions:a,getSubscriptions:i,onSubscriptionChange:c,onSubscriptionsChange:n}=t,l=Bt(e),[u,d]=(0,o.useReducer)(h=>h+1,0);(0,o.useEffect)(()=>{if(!i||!l){g([]);return}let h=!1;return i().then(f=>{h||g(f,u)}),()=>{h=!0}},[u]);const g=(h,f=!1)=>{n(h),i&&(f&&!r.subscriptionId&&h.length>0?w(h[0]):r.subscriptionId&&(h.find(b=>b.value===r.subscriptionId)||w(void 0)))},w=h=>c(h?.value);return o.createElement(o.Fragment,null,o.createElement(O.g,{label:"Default Subscription","data-testid":N.components.configEditor.defaultSubscription.input,htmlFor:"default-subscription"},o.createElement("div",{className:"width-30",style:{display:"flex",gap:"4px"}},o.createElement(D.Ph,{inputId:"default-subscription","aria-label":"Default Subscription",value:r.subscriptionId?a.find(h=>h.value===r.subscriptionId):void 0,options:a,onChange:w,disabled:s}),o.createElement(_.zx,{variant:"secondary",type:"button",onClick:d,disabled:!l||s,"data-testid":N.components.configEditor.loadSubscriptions.button},"Load Subscriptions"))))},Yt=[{value:"azuremonitor",label:"Azure"},{value:"govazuremonitor",label:"Azure US Government"},{value:"chinaazuremonitor",label:"Azure China"}],qt=t=>{const{updateOptions:e,getSubscriptions:s,options:r}=t,[a,i]=(0,o.useState)([]),c=(0,o.useMemo)(()=>Ht(t.options),[t.options]),n=(d,g)=>{g||i([]),e(w=>Kt({...w,jsonData:{...w.jsonData,subscriptionId:g}},d))},l=d=>i(d),u=d=>e(g=>({...g,jsonData:{...g.jsonData,subscriptionId:d}}));return o.createElement(o.Fragment,null,o.createElement(Jt,{managedIdentityEnabled:U.config.azure.managedIdentityEnabled,workloadIdentityEnabled:U.config.azure.workloadIdentityEnabled,credentials:c,azureCloudOptions:Yt,onCredentialsChange:n,disabled:t.options.readOnly},o.createElement(Zt,{subscriptions:a,credentials:c,getSubscriptions:s,disabled:t.options.readOnly,onSubscriptionsChange:l,onSubscriptionChange:u,options:r.jsonData})))},Jo=null;class _t extends o.PureComponent{constructor(e){super(e),this.templateSrv=(0,re.J)(),this.updateOptions=s=>{const r=s(this.props.options);this.props.onOptionsChange(r),this.setState({unsaved:!0})},this.saveOptions=async()=>{this.state.unsaved&&(await(0,ie.i)().put(`/api/datasources/${this.props.options.id}`,this.props.options).then(s=>{(0,Se.fd)(this.props,"version",s.datasource.version)}),this.setState({unsaved:!1}))},this.getSubscriptions=async()=>{await this.saveOptions();const s="?api-version=2019-03-01";try{const r=await(0,ie.i)().fetch({url:this.baseURL+s,method:"GET"}).toPromise();return this.setState({error:void 0}),Q.parseSubscriptionsForSelect(r)}catch(r){return(0,ie.kW)(r)&&this.setState({error:{title:"Error requesting subscriptions",description:"Could not request subscriptions from Azure. Check your credentials and try again.",details:r?.data?.message}}),Promise.resolve([])}},this.state={unsaved:!1},this.baseURL=`/api/datasources/${this.props.options.id}/resources/${F.azureMonitor}/subscriptions`}render(){const{options:e,onOptionsChange:s}=this.props,{error:r}=this.state;return o.createElement(o.Fragment,null,o.createElement(ae.j,{dataSourceName:"Azure Monitor",docsLink:"https://grafana.com/docs/grafana/latest/datasources/azure-monitor/",hasRequiredFields:!0}),o.createElement(ze.i,null),o.createElement(qt,{options:e,updateOptions:this.updateOptions,getSubscriptions:this.getSubscriptions}),r&&o.createElement(J.b,{severity:"error",title:r.title},o.createElement("p",null,r.description),r.details&&o.createElement("details",{style:{whiteSpace:"pre-wrap"}},r.details)),U.config.secureSocksDSProxyEnabled&&o.createElement(o.Fragment,null,o.createElement(ze.i,null),o.createElement(he.K,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source. This includes Secure Socks Proxy.",isCollapsible:!0,isInitiallyOpen:e.jsonData.enableSecureSocksProxy!==void 0},o.createElement(Fe.i,{options:e,onOptionsChange:s}))))}}const Zo=null;var S=v(66681),Pe=v(43183),Xe=v(62577);function es(t){return(0,o.isValidElement)(t)?t:ve(t)}function ve(t){if(!t||typeof t!="object")return;if(typeof t.message=="string")return t.message;if(typeof t.data?.error?.message=="string")return t.data.error.message;const e=t.error?.data?.error?.innererror?.innererror?.message||t.error?.data?.error?.innererror?.message||t.error?.data?.error?.message||t.error?.data?.message||t.data?.message||t;if(typeof e=="string")return e;if(e&&e.toString)return e.toString()}function ut(){const[t,e]=(0,o.useState)([]),s=(0,o.useCallback)((a,i)=>{e(c=>{const n=[...c],l=c.findIndex(([u])=>u===a);return l>-1&&n.splice(l,1),i&&n.unshift([a,i]),n})},[]);return[(0,o.useMemo)(()=>{const a=t[0];return a&&es(a[1])},[t]),s]}var Qe=v(23270),ee=v(82564),te=v(33614);const ts=({query:t,onQueryChange:e})=>{const s=(0,o.useCallback)(r=>{e({...t,azureResourceGraph:{...t.azureResourceGraph,query:r}})},[e,t]);return o.createElement(Xe.p,{value:t.azureResourceGraph?.query??"",language:"kusto",height:200,width:"100%",showMiniMap:!1,onBlur:s,onSave:s})};var ss=v(74321),rs=v(73688),oe=v(84933);const mt=18,X=t=>{const{labelWidth:e,inlineField:s,...r}=t;return s?o.createElement(oe._,{labelWidth:e||mt,...r}):o.createElement(rs.S,{width:e||mt,...r})},os=({query:t,subscriptions:e,variableOptionGroup:s,onQueryChange:r})=>{const[a,i]=(0,o.useState)(!1),[c,n]=(0,o.useState)([]),l=(0,o.useMemo)(()=>[...e,s],[e,s]);(0,o.useEffect)(()=>{t.subscriptions&&t.subscriptions.length>0?(n(T([...e,...s.options],t.subscriptions)),i(!1)):i(!0)},[t.subscriptions,e,s.options]);const u=d=>{if(!d||d.length===0)n([]),r({...t,subscriptions:[]}),i(!0);else{const g=d.map(w=>w.value??"");r({...t,subscriptions:g}),n(T([...e,...s.options],g)),i(!1)}};return o.createElement(X,{label:"Subscriptions","data-testid":N.components.queryEditor.argsQueryEditor.subscriptions.input},o.createElement(o.Fragment,null,o.createElement(D.NU,{isClearable:!0,value:c,inputId:"azure-monitor-subscriptions-field",onChange:u,options:l,width:38}),a?o.createElement(ss.S,null,"At least one subscription must be chosen."):null))},pt="arg-subscriptions";function as(t,e,s){let r=e||[];r.length===0&&s&&(r=[s]),r.length===0&&t.length&&(r=[t[0]]);const a=r.filter(c=>c.includes("$")),i=(0,z.intersection)(r,t).concat(a);return t.length&&r.length>i.length&&(r=i.length>0?i:[t[0]]),r}const dt=({query:t,datasource:e,subscriptionId:s,variableOptionGroup:r,onChange:a,setError:i})=>{const[c,n]=(0,o.useState)([]);return(0,o.useMemo)(()=>{e.getSubscriptions().then(l=>{const u=l.map(d=>({label:d.text,value:d.value,description:d.value}));n(u),i(pt,void 0),a({...t,subscriptions:as(u.map(d=>d.value),t.subscriptions,t.subscription)})}).catch(l=>i(pt,l))},[e]),o.createElement("span",{"data-testid":N.components.queryEditor.argsQueryEditor.container.input},o.createElement(Qe._,null,o.createElement(ee.p,null,o.createElement(te.s,null,o.createElement(os,{subscriptions:c,query:t,datasource:e,subscriptionId:s,variableOptionGroup:r,onQueryChange:a,setError:i})))),o.createElement(ts,{query:t,datasource:e,subscriptionId:s,variableOptionGroup:r,onQueryChange:a,setError:i}))};var Be=v(33067);const ft=({query:t,variableOptionGroup:e,onQueryChange:s,inputId:r,options:a,defaultValue:i,setFormatAs:c,resultFormat:n})=>{const l=(0,o.useMemo)(()=>[...a,e],[e,a]),u=(0,o.useCallback)(d=>{const{value:g}=d;if(!g)return;const w=c(t,g);s(w)},[s,t,c]);return(0,Be.Z)(()=>{n?a.find(d=>d.value===n)||u({value:i}):u({value:i})}),o.createElement(X,{label:"Format as","data-testid":N.components.queryEditor.logsQueryEditor.formatSelection.input},o.createElement(D.Ph,{inputId:`${r}-format-as-field`,value:n??i,onChange:u,options:l,width:38}))};var B=v(47257),He=v(7288),ne=v(97666),Ke=v(79468);const H=t=>{const e=(0,B.wW)(is,t);return o.createElement("span",{className:(0,S.cx)(e.wrapper)})};H.defaultProps={v:0,h:0,layout:"block"};const is=(t,e)=>({wrapper:(0,S.css)([{paddingRight:t.spacing(e.h??0),paddingBottom:t.spacing(e.v??0)},e.layout==="inline"&&{display:"inline-block"},e.layout==="block"&&{display:"block"}])});var gt=v(8655);const ns=({resources:t,onChange:e,renderAdvanced:s})=>{const[r,a]=(0,o.useState)(!!t.length&&JSON.stringify(t).includes("$"));return o.createElement("div",{"data-testid":N.components.queryEditor.resourcePicker.advanced.collapse},o.createElement(gt.U,{collapsible:!0,label:"Advanced",isOpen:r,onToggle:()=>a(!r)},s(t,e),o.createElement(H,{v:2})))};var cs=v(73215),ls=v(75064),ht=v(55973),I=(t=>(t.Subscription="Subscription",t.ResourceGroup="ResourceGroup",t.Resource="Resource",t.VariableGroup="TemplateVariableGroup",t.Variable="TemplateVariable",t))(I||{});const us=({isOpen:t,entry:{type:e}})=>{switch(e){case I.Subscription:return o.createElement(ne.J,{name:"layer-group"});case I.ResourceGroup:return o.createElement(ne.J,{name:t?"folder-open":"folder"});case I.Resource:return o.createElement(ne.J,{name:"cube"});case I.VariableGroup:return o.createElement(ne.J,{name:"x"});case I.Variable:return o.createElement(ne.J,{name:"x"});default:return null}},Me=t=>({table:(0,S.css)({width:"100%",tableLayout:"fixed",overflow:"scroll"}),scrollableTable:(0,S.css)({overflow:"auto"}),tableScroller:(0,S.css)({maxHeight:"16vh"}),selectedTableScroller:(0,S.css)({maxHeight:"13vh"}),header:(0,S.css)({background:t.colors.background.secondary}),row:(0,S.css)({borderBottom:`1px solid ${t.colors.border.weak}`,"&:last-of-type":{borderBottomColor:t.colors.border.medium}}),disabledRow:(0,S.css)({opacity:.5}),cell:(0,S.css)({padding:t.spacing(1,1,1,0),width:"25%",overflow:"hidden",textOverflow:"ellipsis","&:first-of-type":{width:"50%",padding:t.spacing(1,1,1,2)}}),collapseButton:(0,S.css)({margin:0}),loadingCell:(0,S.css)({textAlign:"center"}),spinner:(0,S.css)({marginBottom:0}),nestedEntry:(0,S.css)({display:"flex",alignItems:"center"}),entryContentItem:(0,S.css)({margin:t.spacing(0,1,0,0)}),truncated:(0,S.css)({minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),resourceField:(0,S.css)({maxWidth:t.spacing(36),overflow:"hidden"}),resourceFieldButton:(0,S.css)({padding:"7px",textAlign:"left"}),nestedRowCheckbox:(0,S.css)({zIndex:0}),selectionFooter:(0,S.css)({background:t.colors.background.primary,paddingTop:t.spacing(2)}),loadingWrapper:(0,S.css)({textAlign:"center",paddingTop:t.spacing(2),paddingBottom:t.spacing(2),color:t.colors.text.secondary}),resultLimit:(0,S.css)({margin:"4px 0",fontStyle:"italic"}),modal:(0,S.css)({width:t.breakpoints.values.lg})}),ms=({entry:t,isSelected:e,isDisabled:s,isOpen:r,isSelectable:a,level:i,scrollIntoView:c,onToggleCollapse:n,onSelectedChange:l})=>{const u=(0,B.l4)(),d=(0,B.wW)(Me),g=!!t.children,w=(0,o.useCallback)(()=>{n(t)},[n,t]),h=(0,o.useCallback)(p=>{const b=p.target.checked;l(t,b)},[t,l]),f=`${c?"table":"summary"}_checkbox_${t.uri}`;return(0,o.useEffect)(()=>{e&&c&&document.getElementById(f)?.scrollIntoView({behavior:"smooth",block:"center"})},[]),o.createElement("div",{className:d.nestedEntry,style:{marginLeft:i*(3*u.spacing.gridSize)}},g?o.createElement(ls.h,{className:d.collapseButton,name:r?"angle-down":"angle-right","aria-label":r?`Collapse ${t.name}`:`Expand ${t.name}`,onClick:w,id:t.id}):o.createElement(H,{layout:"inline",h:2}),o.createElement(H,{layout:"inline",h:2}),a&&o.createElement(o.Fragment,null,o.createElement(ht.X,{id:f,onChange:h,disabled:s,value:e,className:d.nestedRowCheckbox}),o.createElement(H,{layout:"inline",h:2})),o.createElement(us,{entry:t,isOpen:r}),o.createElement(H,{layout:"inline",h:1}),o.createElement("label",{htmlFor:f,className:(0,S.cx)(d.entryContentItem,d.truncated)},t.name))};var ps=v(93638);class pe{static buildResourceUri(e,s,r){const a=[],{subscription:i,resourceGroup:c,metricNamespace:n,resourceName:l}=s;if(i&&(a.push("/subscriptions",i),c&&!r&&(a.push("resourceGroups",c),n&&l))){const u=e.replace(n),d=n.split("/"),g=e.replace(l),w=l.split("/"),h=d.shift();if(h&&a.push("providers",h),u.toLowerCase().startsWith("microsoft.storage/storageaccounts/")&&!g.endsWith("default")&&w.push("default"),w.length>d.length){const f=w.shift();f&&a.push(f)}for(const f in d)a.push(d[f]),a.push(w[f])}return a.join("/")}static buildAzureMonitorGetMetricNamespacesUrl(e,s,r,a,i){let c;if("resourceUri"in r)c=r.resourceUri;else{const{subscription:n,resourceGroup:l,metricNamespace:u,resourceName:d}=r;c=pe.buildResourceUri(i,{subscription:n,resourceGroup:l,metricNamespace:u,resourceName:d})}return`${e}${c}/providers/microsoft.insights/metricNamespaces?api-version=${s}${a?"&region=global":""}`}static buildAzureMonitorGetMetricNamesUrl(e,s,r,a,i,c){let n;const{customNamespace:l,metricNamespace:u}=r;if("resourceUri"in r)n=r.resourceUri;else{const{subscription:g,resourceGroup:w,metricNamespace:h,resourceName:f}=r;n=pe.buildResourceUri(a,{subscription:g,resourceGroup:w,metricNamespace:h,resourceName:f},i)}let d=`${e}${n}/providers/microsoft.insights/metricdefinitions?api-version=${s}`;return l&&(d+=`&metricnamespace=${encodeURIComponent(l)}`),i&&!l&&u&&(d+=`&metricnamespace=${encodeURIComponent(u)}`,c&&(d+=`&region=${c}`)),d}}const ds=/\/subscriptions\/(?<subscription>[^/]+)(?:\/resourceGroups\/(?<resourceGroup>[^/]+)(?:\/providers\/(?<metricNamespaceAndResource>.+))?)?/;function fs(t){if(!t)return{};const e=t.split("/"),s=e.splice(0,2),r=e.splice(0,1);for(;e.length;){const a=e.shift();e.length%2===0?r.push(a):s.push(a)}return{metricNamespace:s.join("/"),resourceName:r.join("/")}}function xe(t){const s=ds.exec(t)?.groups??{},{subscription:r,resourceGroup:a,metricNamespaceAndResource:i}=s,{metricNamespace:c,resourceName:n}=fs(i);return{subscription:r,resourceGroup:a,metricNamespace:c,resourceName:n}}function de(t,e){return t.map(s=>j(s,e))}function j(t,e){if(typeof t=="string"){const s=xe(t);return e&&(s.region=e),s}return t}function Je(t){return t.map(e=>Ve(e))}function Ve(t){return t?typeof t=="string"?t:pe.buildResourceUri((0,re.J)(),t):""}function bt(t){return!!t.match(/^[A-Z0-9]+/i)}function gs(t,e,s,r){return s?.startsWith("microsoft.storage/storageaccounts")&&(s="microsoft.storage/storageaccounts",r?.endsWith("/default")&&(r=r.slice(0,-8))),t===s&&e===r}function vt(t,e){const s=j(e),r=j(t);return r?.subscription===s?.subscription&&r?.resourceGroup?.toLowerCase()===s?.resourceGroup?.toLowerCase()&&gs(r?.metricNamespace?.toLowerCase(),r?.resourceName,s?.metricNamespace?.toLowerCase(),s?.resourceName)}function hs(t,e){const s=[];return e.forEach(r=>{const a=ye(t,r);a&&s.push(a)}),s}function ye(t,e){for(const s of t){if(vt(s.uri,e))return s;if(s.children){const r=ye(s.children,e);if(r)return r}}}function Ze(t,e,s){return(0,ps.Uy)(t,r=>{const a=ye(r,e);a&&(a.children=s)})}function bs(t,e,s){if(e==="logs")return{...t,azureLogAnalytics:{...t.azureLogAnalytics,resources:Je(s).filter(a=>a!=="")}};if(e==="traces")return{...t,azureTraces:{...t.azureTraces,resources:Je(s).filter(a=>a!=="")}};const r=s.length?j(s[0]):{};return{...t,subscription:r.subscription,azureMonitor:{...t.azureMonitor,metricNamespace:r.metricNamespace?.toLocaleLowerCase(),region:r.region,resources:de(s).filter(a=>a.resourceName!==""&&a.metricNamespace!==""&&a.subscription!==""&&a.resourceGroup!==""),metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]}}}const yt=({row:t,selectedRows:e,level:s,requestNestedRows:r,onRowSelectedChange:a,selectableEntryTypes:i,scrollIntoView:c,disableRow:n})=>{const l=(0,B.wW)(Me),[u,d]=(0,o.useState)("closed"),g=!!e.find(p=>p.uri.toLowerCase()===t.uri.toLowerCase()),w=!g&&n(t,e),h=u==="open",f=async()=>{if(u==="open"){d("closed");return}d("loading"),r(t).then(()=>d("open")).catch(()=>d("closed"))};return(0,o.useEffect)(()=>{const p=e[0];p&&!!ye(t.children??[],p.uri)&&d("open")},[e,t]),o.createElement(o.Fragment,null,o.createElement("tr",{className:(0,S.cx)(l.row,w&&l.disabledRow),key:t.id},o.createElement("td",{className:l.cell},o.createElement(ms,{level:s,isSelected:g,isDisabled:w,isOpen:h,entry:t,onToggleCollapse:f,onSelectedChange:a,isSelectable:i.some(p=>p===t.type),scrollIntoView:c})),o.createElement("td",{className:l.cell},t.typeLabel),o.createElement("td",{className:l.cell},t.location??"-")),h&&t.children&&Object.keys(t.children).length>0&&t.children.map(p=>o.createElement(yt,{key:p.uri,row:p,selectedRows:e,level:s+1,requestNestedRows:r,onRowSelectedChange:a,selectableEntryTypes:i,scrollIntoView:c,disableRow:n})),o.createElement(cs.n,{visible:u==="loading"},o.createElement("tr",null,o.createElement("td",{className:(0,S.cx)(l.cell,l.loadingCell),colSpan:3},o.createElement(Ke.u,{text:"Loading...",className:l.spinner})))))},wt=yt,vs=({searchFn:t})=>{const[e,s]=(0,o.useState)(""),r=(0,o.useMemo)(()=>(0,z.debounce)(t,600),[t]);return(0,o.useEffect)(()=>()=>{r.cancel()},[r]),o.createElement(x.I,{"aria-label":"resource search",prefix:o.createElement(ne.J,{name:"search"}),value:e,onChange:a=>{const i=a.currentTarget.value;s(i),r(i)},placeholder:"search for a resource","data-testid":N.components.queryEditor.resourcePicker.search.input})},ys=({resourcePickerData:t,resources:e,onApply:s,onCancel:r,selectableEntryTypes:a,queryType:i,disableRow:c,renderAdvanced:n,selectionNotice:l})=>{const u=(0,B.wW)(Me),[d,g]=(0,o.useState)(!1),[w,h]=(0,o.useState)([]),[f,p]=(0,o.useState)([]),[b,y]=(0,o.useState)(e),[k,E]=(0,o.useState)(void 0),[L,V]=(0,o.useState)(!1),le=l?.(f);(0,o.useEffect)(()=>{y(e)},[e]);const se=(0,o.useCallback)(async()=>{if(!d){try{g(!0);const A=await t.fetchInitialRows(i,de(b??{}));h(A)}catch(A){E(ve(A))}g(!1)}},[b,d,t,i]);(0,Be.Z)(()=>{se()});const Ie=A=>typeof A=="string"?A!=="":A.subscription&&A.resourceGroup&&A.resourceName&&A.metricNamespace;(0,o.useEffect)(()=>{b||p([]);const A=b.filter($=>Ie($)),P=b&&hs(w,Je(A));return A?.length>P.length?p(t.parseRows(A)):P&&P.length?p(P):p([])},[b,w,t]);const De=(0,o.useCallback)(async A=>{if(E(void 0),!A.children?.length)try{const P=await t.fetchAndAppendNestedRow(w,A,i);h(P)}catch(P){throw E(ve(P)),P}},[t,w,i]),Ue=(0,o.useCallback)((A,P)=>{if(P){const $=i==="logs"?A.uri:de([A.uri],A.location)[0],ke=b?b.concat($):[$];y(ke.filter(fe=>Ie(fe)))}else{const $=b?.filter(ke=>!vt(Ve(ke),A.uri));y($)}},[i,b,y]),ot=(0,o.useCallback)(()=>{b&&s(i==="logs"?b:de(b))},[i,b,s]),at=(0,o.useCallback)(async A=>{if(E(void 0),V(!1),!A){se();return}try{g(!0);const P=await t.search(A,i);h(P),P.length>=t.resultLimit&&V(!0)}catch(P){E(ve(P))}g(!1)},[se,t,i]);return o.createElement(o.Fragment,null,o.createElement(vs,{searchFn:at}),L?o.createElement("p",{className:u.resultLimit},"Showing first ",t.resultLimit," results"):o.createElement(H,{v:2}),o.createElement("table",{className:u.table},o.createElement("thead",null,o.createElement("tr",{className:(0,S.cx)(u.row,u.header)},o.createElement("td",{className:u.cell},"Scope"),o.createElement("td",{className:u.cell},"Type"),o.createElement("td",{className:u.cell},"Location")))),o.createElement("div",{className:(0,S.cx)(u.scrollableTable,u.tableScroller)},o.createElement("table",{className:u.table},o.createElement("tbody",null,d&&o.createElement("tr",{className:(0,S.cx)(u.row)},o.createElement("td",{className:u.cell},o.createElement(Ke.u,{text:"Loading..."}))),!d&&w.length===0&&o.createElement("tr",{className:(0,S.cx)(u.row)},o.createElement("td",{className:u.cell,"aria-live":"polite"},"No resources found")),!d&&w.map(A=>o.createElement(wt,{key:A.uri,row:A,selectedRows:f,level:0,requestNestedRows:De,onRowSelectedChange:Ue,selectableEntryTypes:a,scrollIntoView:!0,disableRow:c}))))),o.createElement("footer",{className:u.selectionFooter},f.length>0&&o.createElement(o.Fragment,null,o.createElement("h5",null,"Selection"),o.createElement("div",{className:(0,S.cx)(u.scrollableTable,u.selectedTableScroller)},o.createElement("table",{className:u.table},o.createElement("tbody",null,f.map(A=>o.createElement(wt,{key:A.uri,row:A,selectedRows:f,level:0,requestNestedRows:De,onRowSelectedChange:Ue,selectableEntryTypes:a,disableRow:()=>!1}))))),o.createElement(H,{v:2}),le?.length?o.createElement(J.b,{title:"",severity:"info"},le):null),o.createElement(ns,{resources:b,onChange:A=>y(A),renderAdvanced:n}),k&&o.createElement(o.Fragment,null,o.createElement(H,{v:2}),o.createElement(J.b,{severity:"error",title:"An error occurred while requesting resources from Azure Monitor"},k)),o.createElement(He.u.ButtonRow,null,o.createElement(_.zx,{onClick:r,variant:"secondary",fill:"outline"},"Cancel"),o.createElement(_.zx,{disabled:!!k||!b.every(Ie),onClick:ot,"data-testid":N.components.queryEditor.resourcePicker.apply.button},"Apply"))))},ws=({query:t,datasource:e,onQueryChange:s,selectableEntryTypes:r,queryType:a,resources:i,inlineField:c,labelWidth:n,disableRow:l,renderAdvanced:u,selectionNotice:d})=>{const g=(0,B.wW)(Me),[w,h]=(0,o.useState)(!1),f=(0,o.useCallback)(()=>{h(!0)},[]),p=(0,o.useCallback)(()=>{h(!1)},[]),b=(0,o.useCallback)(y=>{s(bs(t,a,y)),p()},[p,s,t,a]);return o.createElement("span",{"data-testid":N.components.queryEditor.resourcePicker.select.button},o.createElement(He.u,{className:g.modal,title:"Select a resource",isOpen:w,onDismiss:p,trapFocus:!1},o.createElement(ys,{resourcePickerData:e.resourcePickerData,resources:i,onApply:b,onCancel:p,selectableEntryTypes:r,queryType:a,disableRow:l,renderAdvanced:u,selectionNotice:d})),o.createElement(X,{label:"Resource",inlineField:c,labelWidth:n},o.createElement(_.zx,{className:g.resourceFieldButton,variant:"secondary",onClick:f,type:"button"},o.createElement(ks,{resources:i,datasource:e}))))},ks=({resources:t,datasource:e})=>{const[s,r]=(0,o.useState)(de(t));return(0,o.useEffect)(()=>{r(de(t))},[t]),t.length?o.createElement(Ss,{resources:s}):o.createElement(o.Fragment,null,"Select a resource")},Ss=({resources:t})=>{const e=(0,B.wW)(Me);let s="cube";const r=[];return t.forEach(a=>{if(a.resourceName){r.push(a.resourceName.split("/")[0]);return}if(a.resourceGroup){s="folder",r.push(a.resourceGroup);return}if(a.subscription){s="layer-group",r.push(a.subscription);return}}),o.createElement("span",{className:(0,S.cx)(e.truncated,e.resourceField)},o.createElement(ne.J,{name:s}),r.join(", "))},Ye=ws;var Oe=v(37890),kt=v(57445),zs=v(14607);const Es=t=>({resourceList:(0,S.css)({width:"100%",display:"flex",marginBlock:t.spacing(1)})}),St=({resources:t,onChange:e})=>{const s=(0,B.wW)(Es);(0,o.useEffect)(()=>{t.length===0&&e([""])},[t,e]);const r=(c,n)=>{const l=[...t];l[c]=n,e(l)},a=c=>{const n=[...t];n.splice(c,1),e(n)},i=()=>{e(t.concat(""))};return o.createElement(o.Fragment,null,o.createElement(kt._,null,o.createElement("h6",null,"Resource URI(s)"," ",o.createElement(zs.u,{content:o.createElement(o.Fragment,null,"Manually edit the"," ",o.createElement("a",{href:"https://docs.microsoft.com/en-us/azure/azure-monitor/logs/log-standard-columns#_resourceid",rel:"noopener noreferrer",target:"_blank"},"resource uri"),". Supports the use of multiple template variables (ex: /subscriptions/$subId/resourceGroups/$rg)"),placement:"right",interactive:!0},o.createElement(ne.J,{name:"info-circle"})))),t.map((c,n)=>o.createElement("div",{key:`resource-${n+1}`},o.createElement("div",{className:s.resourceList},o.createElement(x.I,{id:`input-advanced-resource-picker-${n+1}`,value:c,onChange:l=>r(n,l.currentTarget.value),placeholder:"ex: /subscriptions/$subId","data-testid":`input-advanced-resource-picker-${n+1}`}),o.createElement(Oe._,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:()=>a(n),"data-testid":"remove-resource",hidden:t.length===1})))),o.createElement(_.zx,{"aria-label":"Add",icon:"plus",variant:"secondary",onClick:i,type:"button"},"Add resource URI"))};function qe(t,e){return{...t,azureLogAnalytics:{...t.azureLogAnalytics,query:e}}}function As(t,e){return{...t,azureLogAnalytics:{...t.azureLogAnalytics,resultFormat:e}}}function Ts(t,e){return{...t,azureLogAnalytics:{...t.azureLogAnalytics,dashboardTime:e}}}function zt(t,e){return{...t,azureLogAnalytics:{...t.azureLogAnalytics,timeColumn:e}}}const Ns=({query:t,onQueryChange:e,schema:s})=>{const[r,a]=(0,o.useState)();(0,o.useEffect)(()=>{if(!s||!r)return;(async({monaco:l,editor:u},d)=>{try{const g=l.languages,w=u.getModel();w&&await(await(await g.kusto.getKustoWorker())(w?.uri)).setSchema(d)}catch(g){console.error(g)}})(r,s).catch(l=>console.error(l))},[s,r]);const i=(0,o.useCallback)((n,l)=>{a({monaco:l,editor:n})},[]),c=(0,o.useCallback)(n=>{e(qe(t,n))},[e,t]);return o.createElement(Xe.p,{value:t.azureLogAnalytics?.query??"",language:"kusto",height:200,width:"100%",showMiniMap:!1,onBlur:c,onSave:c,onEditorDidMount:i})};var Ms=v(5106);function Rs({query:t,onQueryChange:e,schema:s}){const[r,a]=(0,o.useState)(),[i,c]=(0,o.useState)(),n=(0,o.useCallback)(u=>e(zt(t,u)),[t,e]);(0,o.useEffect)(()=>{if(s&&t.azureLogAnalytics?.dashboardTime){const u=[],d=new Set,g=new Map,w=s.database;if(w)for(const f of w.tables){const p=f.columns.reduce((b,y,k)=>(y.type==="datetime"&&(!f.timespanColumn||f.timespanColumn!==y.name)&&(b.push({value:y.name,label:`${f.name} > ${y.name}`}),d.add(y.name)),b),[]);u.push(...p),f.timespanColumn&&!g.has(f.timespanColumn)&&g.set(f.timespanColumn,{value:f.timespanColumn,label:f.timespanColumn})}c(u);const h=Array.from(g.values());if(a(h),!t.azureLogAnalytics.timeColumn||t.azureLogAnalytics.timeColumn&&!d.has(t.azureLogAnalytics.timeColumn)&&!g.has(t.azureLogAnalytics.timeColumn))if(h&&h.length){n(h[0].value),n(h[0].value);return}else if(u&&u.length){n(u[0].value);return}else{n("TimeGenerated");return}}},[s,t.azureLogAnalytics?.dashboardTime,t.azureLogAnalytics?.timeColumn,n]);const l=(0,o.useCallback)(u=>{if(!u.value)return;const d=zt(t,u.value);e(d)},[e,t]);return o.createElement(o.Fragment,null,o.createElement(oe._,{label:"Time-range",tooltip:o.createElement("span",null,"Specifies the time-range used to query. The ",o.createElement("code",null,"Query")," option will only use time-ranges specified in the query. ",o.createElement("code",null,"Dashboard")," will only use the Grafana time-range.")},o.createElement(Ms.S,{options:[{label:"Query",value:!1},{label:"Dashboard",value:!0}],value:t.azureLogAnalytics?.dashboardTime??!1,size:"md",onChange:u=>e(Ts(t,u))})),t.azureLogAnalytics?.dashboardTime&&o.createElement(oe._,{label:"Time Column",tooltip:o.createElement("span",null,"Specifies the time column used for filtering. Defaults to the first tables ",o.createElement("code",null,"timeSpan")," column, the first ",o.createElement("code",null,"datetime")," column found or ",o.createElement("code",null,"TimeGenerated"),".")},o.createElement(D.Ph,{options:[{label:"Default time columns",options:r??[{value:"TimeGenerated",label:"TimeGenerated"}]},{label:"Other time columns",options:i??[]}],onChange:l,value:t.azureLogAnalytics?.timeColumn?t.azureLogAnalytics?.timeColumn:r?r[0]:i?i[0]:{value:"TimeGenerated",label:"TimeGenerated"},allowCustomValue:!0})))}async function Cs(t,e,s){if(e.azureLogAnalytics?.workspace!==void 0&&!e.azureLogAnalytics.resources){const r=bt(e.azureLogAnalytics.workspace);let a;r?a=await t.resourcePickerData.getResourceURIFromWorkspace(e.azureLogAnalytics.workspace):a=e.azureLogAnalytics.workspace;const i={...e,azureLogAnalytics:{...e.azureLogAnalytics,resource:a,workspace:void 0}};delete i.azureLogAnalytics.workspace,s(i)}}function Is(t,e,s){const[r,a]=(0,o.useState)();return(0,o.useEffect)(()=>{Cs(t,e,s).catch(i=>a({title:"Unable to migrate workspace as a resource",message:i.message}))},[t,e,s]),r}const Et=({query:t,datasource:e,subscriptionId:s,variableOptionGroup:r,onChange:a,setError:i,hideFormatAs:c,timeRange:n,data:l})=>{const u=Is(e,t,a),d=(f,p)=>{if(p.length===0)return!1;const b=j(f.uri,f.location).metricNamespace?.toLowerCase(),y=j(p[0].uri,p[0].location).metricNamespace?.toLowerCase();return b!==y},[g,w]=(0,o.useState)();(0,o.useEffect)(()=>{t.azureLogAnalytics?.resources&&t.azureLogAnalytics.resources.length&&e.azureLogAnalyticsDatasource.getKustoSchema(t.azureLogAnalytics.resources[0]).then(f=>{w(f)})},[t.azureLogAnalytics?.resources,e.azureLogAnalyticsDatasource]);let h=null;if(l?.series){const f=l.series.find(p=>p.refId===t.refId);f&&f.meta?.custom?.azurePortalLink&&(h=o.createElement(o.Fragment,null,o.createElement(_.Qj,{size:"md",target:"_blank",style:{marginTop:"22px"},href:f.meta?.custom?.azurePortalLink},"View query in Azure Portal")))}return o.createElement("span",{"data-testid":N.components.queryEditor.logsQueryEditor.container.input},o.createElement(Qe._,null,o.createElement(ee.p,null,o.createElement(te.s,null,o.createElement(Ye,{query:t,datasource:e,inlineField:!0,labelWidth:10,subscriptionId:s,variableOptionGroup:r,onQueryChange:a,setError:i,selectableEntryTypes:[I.Subscription,I.ResourceGroup,I.Resource,I.Variable],resources:t.azureLogAnalytics?.resources??[],queryType:"logs",disableRow:d,renderAdvanced:(f,p)=>o.createElement(St,{resources:f,onChange:p}),selectionNotice:()=>"You may only choose items of the same resource type."}),o.createElement(Rs,{query:t,datasource:e,variableOptionGroup:r,onQueryChange:a,setError:i,schema:g}))),o.createElement(Ns,{query:t,datasource:e,subscriptionId:s,variableOptionGroup:r,onQueryChange:a,setError:i,schema:g}),o.createElement(ee.p,null,o.createElement(te.s,null,!c&&o.createElement(ft,{query:t,datasource:e,subscriptionId:s,variableOptionGroup:r,onQueryChange:a,setError:i,inputId:"azure-monitor-logs",options:[{label:"Log",value:Z.Logs},{label:"Time series",value:Z.TimeSeries},{label:"Table",value:Z.Table}],defaultValue:Z.Logs,setFormatAs:As,resultFormat:t.azureLogAnalytics?.resultFormat}),h,u&&o.createElement(J.b,{title:u.title},u.message)))))};var At=v(50263),_e=v(72435),Ds=v(19609),Ls=v.n(Ds);function Fs({query:t,lang:e,className:s}){const r=(0,B.l4)(),a=Gs(r),i=Ls().highlight(t,e.grammar,e.name);return o.createElement("div",{className:(0,S.cx)(a.editorField,"prism-syntax-highlight",s),"aria-label":"selector",dangerouslySetInnerHTML:{__html:i}})}const Gs=t=>({editorField:(0,S.css)({fontFamily:t.typography.fontFamilyMonospace,fontSize:t.typography.bodySmall.fontSize})}),Ps=[{label:"fields",documentation:"Retrieves the specified fields from log events"},{label:"display",documentation:"Specifies which fields to display in the query results"},{label:"filter",documentation:"Filters the results of a query based on one or more conditions"},{label:"stats",documentation:"Calculates aggregate statistics based on the values of log fields"},{label:"sort",documentation:"Sorts the retrieved log events"},{label:"limit",documentation:"Specifies the number of log events returned by the query"},{label:"parse",documentation:"Extracts data from a log field, creating one or more ephemeral fields that you can process further in the query"}],ca=null,la=null,Qs=[{label:"abs",detail:"abs(a)",documentation:"Absolute value."},{label:"ceil",detail:"ceil(a)",documentation:"Round to ceiling (the smallest integer that is greater than the value of a)."},{label:"floor",detail:"floor(a)",documentation:"Round to floor (the largest integer that is smaller than the value of a)."},{label:"greatest",detail:"greatest(a,b, ... z)",documentation:"Returns the largest value."},{label:"least",detail:"least(a, b, ... z)",documentation:"Returns the smallest value."},{label:"log",detail:"log(a)",documentation:"Natural logarithm."},{label:"sqrt",detail:"sqrt(a)",documentation:"Square root."}],xs=[{label:"ispresent",detail:"ispresent(fieldname)",documentation:"Returns true if the field exists."},{label:"coalesce",detail:"coalesce(fieldname1, fieldname2, ... fieldnamex)",documentation:"Returns the first non-null value from the list."}],Vs=[{label:"isempty",detail:"isempty(fieldname)",documentation:"Returns true if the field is missing or is an empty string."},{label:"isblank",detail:"isblank(fieldname)",documentation:"Returns true if the field is missing, an empty string, or contains only white space."},{label:"concat",detail:"concat(string1, string2, ... stringz)",documentation:"Concatenates the strings."},{label:"ltrim",detail:"ltrim(string) or ltrim(string1, string2)",documentation:"Remove white space from the left of the string. If the function has a second string argument, it removes the characters of string2 from the left of string1."},{label:"rtrim",detail:"rtrim(string) or rtrim(string1, string2)",documentation:"Remove white space from the right of the string. If the function has a second string argument, it removes the characters of string2 from the right of string1."},{label:"trim",detail:"trim(string) or trim(string1, string2)",documentation:"Remove white space from both ends of the string. If the function has a second string argument, it removes the characters of string2 from both sides of string1."},{label:"strlen",detail:"strlen(string)",documentation:"Returns the length of the string in Unicode code points."},{label:"toupper",detail:"toupper(string)",documentation:"Converts the string to uppercase."},{label:"tolower",detail:"tolower(string)",documentation:"Converts the string to lowercase."},{label:"substr",detail:"substr(string1, x), or substr(string1, x, y)",documentation:"Returns a substring from the index specified by the number argument to the end of the string. If the function has a second number argument, it contains the length of the substring to be retrieved."},{label:"replace",detail:"replace(string1, string2, string3)",documentation:"Replaces all instances of string2 in string1 with string3."},{label:"strcontains",detail:"strcontains(string1, string2)",documentation:"Returns 1 if string1 contains string2 and 0 otherwise."}],Os=[{label:"bin",detail:"bin(period)",documentation:"Rounds the value of @timestamp to the given period and then truncates."},{label:"datefloor",detail:"datefloor(a, period)",documentation:"Truncates the timestamp to the given period."},{label:"dateceil",detail:"dateceil(a, period)",documentation:"Rounds up the timestamp to the given period and then truncates."},{label:"fromMillis",detail:"fromMillis(fieldname)",documentation:"Interprets the input field as the number of milliseconds since the Unix epoch and converts it to a timestamp."},{label:"toMillis",detail:"toMillis(fieldname)",documentation:"Converts the timestamp found in the named field into a number representing the milliseconds since the Unix epoch."}],Tt=[{label:"isValidIp",detail:"isValidIp(fieldname)",documentation:"Returns true if the field is a valid v4 or v6 IP address."},{label:"isValidIpV4",detail:"isValidIpV4(fieldname)",documentation:"Returns true if the field is a valid v4 IP address."},{label:"isValidIpV6",detail:"isValidIpV6(fieldname)",documentation:"Returns true if the field is a valid v6 IP address."},{label:"isIpInSubnet",detail:"isIpInSubnet(fieldname, string)",documentation:"Returns true if the field is a valid v4 or v6 IP address within the specified v4 or v6 subnet."},{label:"isIpv4InSubnet",detail:"isIpv4InSubnet(fieldname, string)",documentation:"Returns true if the field is a valid v4 IP address within the specified v4 subnet."},{label:"isIpv6InSubnet",detail:"isIpv6InSubnet(fieldname, string)",documentation:"Returns true if the field is a valid v6 IP address within the specified v6 subnet."}],ua=[{label:"ispresent",detail:"ispresent(fieldname)",documentation:"Returns true if the field exists."},{label:"isempty",detail:"isempty(fieldname)",documentation:"Returns true if the field is missing or is an empty string."},{label:"isblank",detail:"isblank(fieldname)",documentation:"Returns true if the field is missing, an empty string, or contains only white space."},{label:"strcontains",detail:"strcontains(string1, string2)",documentation:"Returns 1 if string1 contains string2 and 0 otherwise."},...Tt],$s=[{label:"avg",detail:"avg(NumericFieldname)",documentation:"The average of the values in the specified field."},{label:"count",detail:"count(fieldname) or count(*)",documentation:"Counts the log records."},{label:"count_distinct",detail:"count_distinct(fieldname)",documentation:"Returns the number of unique values for the field."},{label:"max",detail:"max(fieldname)",documentation:"The maximum of the values for this log field in the queried logs."},{label:"min",detail:"min(fieldname)",documentation:"The minimum of the values for this log field in the queried logs."},{label:"pct",detail:"pct(fieldname, value)",documentation:"A percentile indicates the relative standing of a value in a datas."},{label:"stddev",detail:"stddev(NumericFieldname)",documentation:"The standard deviation of the values in the specified field."},{label:"sum",detail:"sum(NumericFieldname)",documentation:"The sum of the values in the specified field."}],Ws=[{label:"earliest",detail:"earliest(fieldname)",documentation:"Returns the value of fieldName from the log event that has the earliest time stamp in the queried logs."},{label:"latest",detail:"latest(fieldname)",documentation:"Returns the value of fieldName from the log event that has the latest time stamp in the queried logs."},{label:"sortsFirst",detail:"sortsFirst(fieldname)",documentation:"Returns the value of fieldName that sorts first in the queried logs."},{label:"sortsLast",detail:"sortsLast(fieldname)",documentation:"Returns the value of fieldName that sorts last in the queried logs."}],Us=[...$s,...Ws],js=["as","like","by","in","desc","asc"],Xs=[...[...Qs,...xs,...Vs,...Os,...Tt],...Us],Bs={comment:{pattern:/^#.*/,greedy:!0},backticks:{pattern:/`.*?`/,alias:"string",greedy:!0},quote:{pattern:/".*?"/,alias:"string",greedy:!0},regex:{pattern:/\/.*?\/(?=\||\s*$|,)/,greedy:!0},"query-command":{pattern:new RegExp(`\\b(?:${Ps.map(t=>t.label).join("|")})\\b`,"i"),alias:"function"},function:{pattern:new RegExp(`\\b(?:${Xs.map(t=>t.label).join("|")})\\b`,"i")},keyword:{pattern:new RegExp(`(\\s+)(${js.join("|")})(?=\\s+)`,"i"),lookbehind:!0},"log-group-name":{pattern:/[\.\-_/#A-Za-z0-9]+/},"field-name":{pattern:/(@?[_a-zA-Z]+[_.0-9a-zA-Z]*)|(`((\\`)|([^`]))*?`)/,greedy:!0},number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/,"command-separator":{pattern:/\|/,alias:"punctuation"},"comparison-operator":{pattern:/([<>]=?)|(!?=)/},punctuation:/[{}()`,.]/,whitespace:/\s+/},Hs=t=>{const[e,s]=(0,o.useState)(null),[r,a]=(0,o.useState)({}),[i,c]=(0,o.useState)(null),[n,l]=(0,o.useState)(!0),[u,d]=(0,o.useState)(""),g=(0,B.wW)(Ks),w={grammar:Bs,name:"kql"},h=(0,o.useMemo)(()=>e?Object.keys(e).map(y=>({label:y,value:y})):[],[e]),f=async()=>{await t.datasource.getAzureLogAnalyticsCheatsheetQueries().then(y=>{y.categories.sort((E,L)=>E.displayName.toLowerCase()===L.displayName.toLowerCase()?0:E.displayName.toLowerCase()<L.displayName.toLowerCase()?-1:1);const k=y.categories.reduce((E,L)=>{const V=L.related.queries.map(le=>y.queries.find(se=>se.id===le));return E[L.displayName]=V,a({...r,[L.id]:!1}),E},{});return s(k),c(k),l(!1),k})};(0,o.useEffect)(()=>{e||f()});const p=y=>{const k=Object.keys(i);if(y.length>0&&e){const E=Object.keys(e).reduce((L,V)=>{const le=e[V].filter(se=>se.displayName.toLowerCase().includes(y.toLowerCase()));return k.includes(V)&&(L[V]=le),L},{});return c(E),E}else return Object.keys(i).length!==Object.keys(e).length?(c(i),i):(c(e),e)},b=y=>{if(y.length>0){const E=y.map(L=>L.label).reduce((L,V)=>(L[V]=e[V],L),{});c(E)}else c(e)};return o.createElement("div",null,!n&&i?o.createElement("div",null,o.createElement("div",{className:g.filterAlignment},o.createElement(x.I,{value:u,onChange:y=>{d(y.currentTarget.value);const k=p(y.currentTarget.value);c(k)},placeholder:"Search Logs queries",width:40}),o.createElement(O.g,{label:"Categories",className:g.categoryDropdown},o.createElement(D.Ph,{options:h,value:"",onChange:y=>b(y),allowCustomValue:!1,backspaceRemovesValue:!0,placeholder:"All categories",isClearable:!0,noOptionsMessage:"Unable to list all categories",formatCreateLabel:y=>`Category: ${y}`,isSearchable:!0,isMulti:!0,width:40}))),o.createElement("div",{className:g.spacing},"Query results:"," ",Object.keys(i).reduce((y,k)=>(y=i[k].length+y,y),0)),o.createElement(At.$,{showScrollIndicators:!0,autoHeightMax:"350px"},Object.keys(i).map(y=>{if(i[y].length)return o.createElement(gt.U,{label:y+` (${i[y].length})`,collapsible:!0,isOpen:r[y],onToggle:k=>a({...r,[y]:k}),key:y},i[y].map(k=>o.createElement(_e.Z,{className:g.card,key:k.id},o.createElement(_e.Z.Heading,null,k.displayName),o.createElement(At.$,{showScrollIndicators:!0,autoHeightMax:"100px"},o.createElement(Fs,{"aria-label":`${k.displayName} raw query`,query:k.body,lang:w,className:g.rawQuery})),o.createElement(_e.Z.Actions,null,o.createElement(_.zx,{size:"sm","aria-label":"use this query button",onClick:()=>{t.onChange({refId:"A",queryType:m.LogAnalytics,azureLogAnalytics:{query:k.body},datasource:t.datasource}),(0,Pe.ff)("grafana_azure_cheatsheet_logs_query_selected",{id:k.id,queryName:k.displayName,query:k.body,queryCategories:k.related.categories})}},"Use this query")))))}))):o.createElement(Ke.u,{text:"Loading..."}))},Ks=t=>({card:(0,S.css)({width:"90%",display:"flex",flexDirection:"column"}),rawQuery:(0,S.css)({backgroundColor:`${t.colors.background.primary}`,padding:`${t.spacing(1)}`,marginTop:`${t.spacing(1)}`}),spacing:(0,S.css)({marginBottom:`${t.spacing(1)}`}),filterAlignment:(0,S.css)({display:"flex"}),categoryDropdown:(0,S.css)({margin:"0 0 10px 10px",display:"flex",flexDirection:"row",alignItems:"center"})}),Js=t=>{const{isOpen:e,onClose:s,datasource:r,onChange:a}=t;return o.createElement(He.u,{"aria-label":"Kick start your query modal",isOpen:e,title:"Kick start your query",onDismiss:s},o.createElement(Hs,{onChange:i=>{a(i),s()},query:{refId:"A"},datasource:r}))},et={"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems":"Backup Items","microsoft.resources/subscriptions":"Subscriptions","microsoft.resources/subscriptions/resourcegroups":"Resource groups","citrix.services/xenappessentials":"Citrix Virtual Apps Essentials","citrix.services/xendesktopessentials":"Citrix Virtual Desktops Essentials","dynatrace.observability/monitors":"Dynatrace","github.enterprise/accounts":"GitHub AE","microsoft.aad/domainservices":"Azure AD Domain Services","microsoft.aadiam/privatelinkforazuread":"Private Link for Azure AD","microsoft.agfoodplatform/farmbeats":"Azure FarmBeats","microsoft.analysisservices/servers":"Analysis Services","microsoft.anybuild/clusters":"AnyBuild clusters","microsoft.apimanagement/service":"API Management services","microsoft.appconfiguration/configurationstores":"App Configuration","microsoft.appplatform/spring":"Azure Spring Cloud","microsoft.attestation/attestationproviders":"Attestation providers","microsoft.authorization/resourcemanagementprivatelinks":"Resource management private links","microsoft.automation/automationaccounts":"Automation Accounts","microsoft.automation/automationaccounts/runbooks":"Runbook","microsoft.autonomoussystems/workspaces":"Bonsai","microsoft.avs/privateclouds":"AVS Private clouds","microsoft.azureactivedirectory/b2cdirectories":"B2C Tenants","microsoft.azureactivedirectory/guestusages":"Guest Usages","microsoft.azurearcdata/datacontrollers":"Azure Arc data controllers","microsoft.azurearcdata/postgresinstances":"Azure Arc-enabled PostgreSQL Hyperscale server groups","microsoft.azurearcdata/sqlmanagedinstances":"SQL managed instances - Azure Arc","microsoft.azurearcdata/sqlserverinstances":"SQL Server - Azure Arc","microsoft.azuredata/sqlserverregistrations":"SQL Server registries","microsoft.azurepercept/accounts":"Azure Percept accounts","microsoft.azurestackhci/clusters":"Azure Stack HCI","microsoft.azurestackhci/virtualmachines":"Azure Stack HCI virtual machine - Azure Arc","microsoft.baremetal/crayservers":"Cray Servers","microsoft.baremetal/monitoringservers":"Monitoring Servers","microsoft.baremetalinfrastructure/baremetalinstances":"BareMetal Instances","microsoft.batch/batchaccounts":"Batch accounts","microsoft.bing/accounts":"Bing Resources","microsoft.botservice/botservices":"Bot Services","microsoft.cache/redis":"Azure Cache for Redis","microsoft.cache/redisenterprise":"Redis Enterprise","microsoft.cdn/cdnwebapplicationfirewallpolicies":"Content Delivery Network WAF policies","microsoft.cdn/profiles (front doors standard/premium":"Preview)","microsoft.cdn/profiles/afdendpoints":"Endpoints","microsoft.cdn/profiles/endpoints":"Endpoints","microsoft.certificateregistration/certificateorders":"App Service Certificates","microsoft.chaos/chaosexperiments":"Chaos Experiments (Classic)","microsoft.chaos/experiments":"Chaos Experiments","microsoft.classiccompute/domainnames":"Cloud services (classic)","microsoft.classiccompute/virtualmachines":"Virtual machines (classic)","microsoft.classicnetwork/networksecuritygroups":"Network security groups (classic)","microsoft.classicnetwork/reservedips":"Reserved IP addresses (classic)","microsoft.classicnetwork/virtualnetworks":"Virtual networks (classic)","microsoft.classicstorage/storageaccounts":"Storage accounts (classic)","microsoft.cloudtest/accounts":"CloudTest Accounts","microsoft.cloudtest/hostedpools":"1ES Hosted Pools","microsoft.cloudtest/images":"CloudTest Images","microsoft.cloudtest/pools":"CloudTest Pools","microsoft.clusterstor/nodes":"ClusterStors","microsoft.cognitiveservices/accounts":"Cognitive Services","microsoft.compute/availabilitysets":"Availability sets","microsoft.compute/capacityreservationgroups":"Capacity Reservation Groups","microsoft.compute/cloudservices":"Cloud services (extended support)","microsoft.compute/diskaccesses":"Disk Accesses","microsoft.compute/diskencryptionsets":"Disk Encryption Sets","microsoft.compute/disks":"Disks","microsoft.compute/galleries":"Azure compute galleries","microsoft.compute/galleries/applications":"VM application definitions","microsoft.compute/galleries/applications/versions":"VM application versions","microsoft.compute/galleries/images":"VM image definitions","microsoft.compute/galleries/images/versions":"VM image versions","microsoft.compute/hostgroups":"Host groups","microsoft.compute/hostgroups/hosts":"Hosts","microsoft.compute/images":"Images","microsoft.compute/proximityplacementgroups":"Proximity placement groups","microsoft.compute/restorepointcollections":"Restore Point Collections","microsoft.compute/snapshots":"Snapshots","microsoft.compute/sshpublickeys":"SSH keys","microsoft.compute/virtualmachines":"Virtual machines","microsoft.compute/virtualmachinescalesets":"Virtual machine scale sets","microsoft.confidentialledger/ledgers":"Confidential Ledgers","microsoft.confluent/organizations":"Confluent organizations","microsoft.connectedcache/cachenodes":"Connected Cache Resources","microsoft.connectedcache/enterprisecustomers":"Connected Cache Resources","microsoft.connectedvehicle/platformaccounts":"Connected Vehicle Platforms","microsoft.connectedvmwarevsphere/vcenters":"VMware vCenters","microsoft.connectedvmwarevsphere/virtualmachines":"VMware + AVS virtual machines","microsoft.containerinstance/containergroups":"Container instances","microsoft.containerregistry/registries":"Container registries","microsoft.containerregistry/registries/replications":"Container registry replications","microsoft.containerregistry/registries/webhooks":"Container registry webhooks","microsoft.containerservice/managedclusters":"Kubernetes services","microsoft.dashboard/grafana":"Grafana Workspaces","microsoft.databox/jobs":"Azure Data Box","microsoft.databoxedge/databoxedgedevices":"Azure Stack Edge / Data Box Gateway","microsoft.databricks/workspaces":"Azure Databricks Services","microsoft.datacatalog/catalogs":"Data Catalog","microsoft.datacollaboration/workspaces":"Project CI","microsoft.datadog/monitors":"Datadog","microsoft.datafactory/datafactories":"Data factories","microsoft.datafactory/factories":"Data factories (V2)","microsoft.datalakeanalytics/accounts":"Data Lake Analytics","microsoft.datalakestore/accounts":"Data Lake Storage Gen1","microsoft.datamigration/services":"Azure Database Migration Services","microsoft.datamigration/services/projects":"Azure Database Migration Projects","microsoft.datamigration/sqlmigrationservices":"Azure Database Migration Services","microsoft.dataprotection/backupvaults":"Backup vaults","microsoft.dataprotection/resourceguards":"Resource Guards (Preview)","microsoft.datareplication/replicationvaults":"Site Recovery Vaults","microsoft.datashare/accounts":"Data Shares","microsoft.dbformariadb/servers":"Azure Database for MariaDB servers","microsoft.dbformysql/flexibleservers":"Azure Database for MySQL flexible servers","microsoft.dbformysql/servers":"Azure Database for MySQL servers","microsoft.dbforpostgresql/flexibleservers":"Azure Database for PostgreSQL flexible servers","microsoft.dbforpostgresql/servergroups":"Azure Database for PostgreSQL server groups","microsoft.dbforpostgresql/servergroupsv2":"Azure Database for PostgreSQL server groups","microsoft.dbforpostgresql/servers":"Azure Database for PostgreSQL servers","microsoft.dbforpostgresql/serversv2":"Azure Database for PostgreSQL servers v2","microsoft.deploymentmanager/rollouts":"Rollouts","microsoft.desktopvirtualization/applicationgroups":"Application groups","microsoft.desktopvirtualization/hostpools":"Host pools","microsoft.desktopvirtualization/scalingplans":"Scaling plans","microsoft.desktopvirtualization/workspaces":"Workspaces","microsoft.devices/iothubs":"IoT Hub","microsoft.devices/provisioningservices":"Device Provisioning Services","microsoft.deviceupdate/accounts":"Device Update for IoT Hubs","microsoft.devops/pipelines":"DevOps Starter","microsoft.devtestlab/labs":"DevTest Labs","microsoft.devtestlab/labs/virtualmachines":"Virtual machines","microsoft.digitaltwins/digitaltwinsinstances":"Azure Digital Twins","microsoft.documentdb/cassandraclusters":"Azure Managed Instance for Apache Cassandra","microsoft.documentdb/databaseaccounts":"Azure Cosmos DB accounts","microsoft.domainregistration/domains":"App Service Domains","microsoft.edgeorder/addresses":"Azure Edge Hardware Center Address","microsoft.edgeorder/orderitems":"Azure Edge Hardware Center","microsoft.elastic/monitors":"Elasticsearch (Elastic Cloud)","microsoft.eventgrid/domains":"Event Grid Domains","microsoft.eventgrid/partnernamespaces":"Event Grid Partner Namespaces","microsoft.eventgrid/partnerregistrations":"Event Grid Partner Registrations","microsoft.eventgrid/partnertopics":"Event Grid Partner Topics","microsoft.eventgrid/systemtopics":"Event Grid System Topics","microsoft.eventgrid/topics":"Event Grid Topics","microsoft.eventhub/clusters":"Event Hubs Clusters","microsoft.eventhub/namespaces":"Event Hubs Namespaces","microsoft.experimentation/experimentworkspaces":"Experiment Workspaces","microsoft.extendedlocation/customlocations":"Custom locations","microsoft.fidalgo/devcenters":"Fidalgo DevCenters","microsoft.fidalgo/networksettings":"Network Configurations","microsoft.fidalgo/projects":"Fidalgo Projects","microsoft.fidalgo/projects/environments":"Fidalgo Environments","microsoft.fluidrelay/fluidrelayservers":"Fluid Relay","microsoft.genomics/accounts":"Genomics accounts","microsoft.hanaonazure/hanainstances":"SAP HANA on Azure","microsoft.hanaonazure/sapmonitors":"Azure Monitors for SAP Solutions","microsoft.hdinsight/clusterpools":"HDInsight cluster pools","microsoft.hdinsight/clusterpools/clusters":"HDInsight gen2 clusters","microsoft.hdinsight/clusterpools/clusters/sessionclusters":"HDInsight session clusters","microsoft.hdinsight/clusters":"HDInsight clusters","microsoft.healthbot/healthbots":"Azure Health Bot","microsoft.healthcareapis/services":"Azure API for FHIR","microsoft.healthcareapis/workspaces":"Healthcare APIs Workspaces","microsoft.healthcareapis/workspaces/dicomservices":"DICOM services","microsoft.healthcareapis/workspaces/fhirservices":"FHIR services","microsoft.healthcareapis/workspaces/iotconnectors":"IoT connectors","microsoft.hpcworkbench/instances":"HPC Workbenches (preview)","microsoft.hpcworkbench/instances/chambers":"Chambers (preview)","microsoft.hpcworkbench/instances/chambers/accessprofiles":"Chamber Profiles (preview)","microsoft.hpcworkbench/instances/chambers/workloads":"Chamber VMs (preview)","microsoft.hpcworkbench/instances/consortiums":"Consortiums (preview)","microsoft.hybridcompute/machines":"Servers - Azure Arc","microsoft.hybridcompute/privatelinkscopes":"Azure Arc Private Link Scopes","microsoft.hybridcontainerservice/provisionedclusters":"Provisioned clusters","microsoft.hybriddata/datamanagers":"StorSimple Data Managers","microsoft.hybridnetwork/devices":"Azure Network Function Manager \u2013 Devices","microsoft.hybridnetwork/networkfunctions":"Azure Network Function Manager \u2013 Network Functions","microsoft.importexport/jobs":"Import/export jobs","microsoft.insights/components":"Application Insights","microsoft.insights/datacollectionendpoints":"Data collection endpoints","microsoft.insights/datacollectionrules":"Data collection rules","microsoft.insights/privatelinkscopes":"Azure Monitor Private Link Scopes","microsoft.insights/webtests":"Availability tests","microsoft.insights/workbooks":"Azure Workbooks","microsoft.insights/workbooktemplates":"Azure Workbook Templates","microsoft.iotcentral/iotapps":"IoT Central Applications","microsoft.keyvault/vaults":"Key vaults","microsoft.kubernetes/connectedclusters":"Kubernetes - Azure Arc","microsoft.kusto/clusters":"Azure Data Explorer Clusters","microsoft.kusto/clusters/databases":"Azure Data Explorer Databases","microsoft.labservices/labaccounts":"Lab accounts","microsoft.labservices/labplans":"Lab plans","microsoft.labservices/labs":"Labs","microsoft.loadtestservice/loadtests":"Azure Load Testing","microsoft.logic/integrationaccounts":"Integration accounts","microsoft.logic/integrationserviceenvironments":"Integration Service Environments","microsoft.logic/integrationserviceenvironments/managedapis":"Managed Connector","microsoft.logic/workflows":"Logic apps","microsoft.logz/monitors":"Logz main account","microsoft.logz/monitors/accounts":"Logz sub account","microsoft.logz/monitors/metricssource":"Logz metrics data source","microsoft.machinelearning/commitmentplans":"Machine Learning Studio (classic) web service plans","microsoft.machinelearning/webservices":"Machine Learning Studio (classic) web services","microsoft.machinelearning/workspaces":"Machine Learning Studio (classic) workspaces","microsoft.machinelearningservices/workspaces":"Machine learning","microsoft.machinelearningservices/workspaces/onlineendpoints":"Machine learning online endpoints","microsoft.machinelearningservices/workspaces/onlineendpoints/deployments":"Machine learning online deployments","microsoft.maintenance/maintenanceconfigurations":"Maintenance Configurations","microsoft.managedidentity/userassignedidentities":"Managed Identities","microsoft.maps/accounts":"Azure Maps Accounts","microsoft.maps/accounts/creators":"Azure Maps Creator Resources","microsoft.media/mediaservices":"Media Services","microsoft.media/mediaservices/liveevents":"Live events","microsoft.media/mediaservices/streamingendpoints":"Streaming Endpoints","microsoft.media/videoanalyzers":"Video Analyzers","microsoft.migrate/projects":"Migration projects","microsoft.mixedreality/objectanchorsaccounts":"Object Anchors Accounts","microsoft.mixedreality/objectunderstandingaccounts":"Object Understanding Accounts","microsoft.mixedreality/remoterenderingaccounts":"Remote Rendering Accounts","microsoft.mixedreality/spatialanchorsaccounts":"Spatial Anchors Accounts","microsoft.mobilenetwork/mobilenetworks":"Mobile Networks","microsoft.mobilenetwork/mobilenetworks/datanetworks":"Data Networks","microsoft.mobilenetwork/mobilenetworks/services":"Services","microsoft.mobilenetwork/mobilenetworks/simpolicies":"Sim Policies","microsoft.mobilenetwork/mobilenetworks/sites":"Mobile Network Sites","microsoft.mobilenetwork/mobilenetworks/slices":"Slices","microsoft.mobilenetwork/packetcorecontrolplanes":"Packet Core Control Planes","microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes":"Packet Core Data Planes","microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes/attacheddatanetworks":"Attached Data Networks","microsoft.mobilenetwork/sims":"Sims","microsoft.netapp/netappaccounts":"NetApp accounts","microsoft.netapp/netappaccounts/capacitypools":"Capacity pools","microsoft.netapp/netappaccounts/capacitypools/volumes":"Volumes","microsoft.netapp/netappaccounts/capacitypools/volumes/snapshots":"Snapshots","microsoft.netapp/netappaccounts/snapshotpolicies":"Snapshot policies","microsoft.network/applicationgateways":"Application gateways","microsoft.network/applicationgatewaywebapplicationfirewallpolicies":"Application Gateway WAF policies","microsoft.network/applicationsecuritygroups":"Application security groups","microsoft.network/azurefirewalls":"Firewalls","microsoft.network/bastionhosts":"Bastions","microsoft.network/connections":"Connections","microsoft.network/customipprefixes":"Custom IP Prefixes","microsoft.network/ddosprotectionplans":"DDoS protection plans","microsoft.network/dnsforwardingrulesets":"Dns Forwarding Rulesets","microsoft.network/dnsresolvers":"DNS Private Resolvers","microsoft.network/dnszones":"DNS zones","microsoft.network/expressroutecircuits":"ExpressRoute circuits","microsoft.network/expressrouteports":"ExpressRoute Direct","microsoft.network/firewallpolicies":"Firewall Policies","microsoft.network/frontdoors":"Front Doors","microsoft.network/frontdoorwebapplicationfirewallpolicies":"Web Application Firewall policies (WAF)","microsoft.network/ipgroups":"IP Groups","microsoft.network/loadbalancers":"Load balancers","microsoft.network/localnetworkgateways":"Local network gateways","microsoft.network/natgateways":"NAT gateways","microsoft.network/networkexperimentprofiles":"Internet Analyzer profiles","microsoft.network/networkinterfaces":"Network interfaces","microsoft.network/networkmanagers":"Network Managers","microsoft.network/networksecuritygroups":"Network security groups","microsoft.network/networkwatchers":"Network Watchers","microsoft.network/networkwatchers/connectionmonitors":"Connection Monitors","microsoft.network/networkwatchers/flowlogs":"NSG Flow Logs","microsoft.network/privatednszones":"Private DNS zones","microsoft.network/privateendpoints":"Private endpoints","microsoft.network/privatelinkservices":"Private link services","microsoft.network/publicipaddresses":"Public IP addresses","microsoft.network/publicipprefixes":"Public IP Prefixes","microsoft.network/routefilters":"Route filters","microsoft.network/routetables":"Route tables","microsoft.network/serviceendpointpolicies":"Service endpoint policies","microsoft.network/trafficmanagerprofiles":"Traffic Manager profiles","microsoft.network/virtualnetworkgateways":"Virtual network gateways","microsoft.network/virtualnetworks":"Virtual networks","microsoft.network/virtualwans":"Virtual WANs","microsoft.notificationhubs/namespaces":"Notification Hub Namespaces","microsoft.notificationhubs/namespaces/notificationhubs":"Notification Hubs","microsoft.openenergyplatform/energyservices":"Project Oak Forest","microsoft.openlogisticsplatform/workspaces":"Open Supply Chain Platform","microsoft.operationalinsights/querypacks":"Log Analytics query packs","microsoft.operationalinsights/workspaces":"Log Analytics workspaces","microsoft.operationsmanagement/solutions":"Solutions","microsoft.orbital/contactprofiles":"Contact Profiles","microsoft.orbital/edgesites":"Edge Sites","microsoft.orbital/groundstations":"Ground Stations","microsoft.orbital/l2connections":"L2 Connections","microsoft.orbital/spacecrafts":"Spacecrafts","microsoft.peering/peerings":"Peerings","microsoft.peering/peeringservices":"Peering Services","microsoft.playfab/playeraccountpools":"PlayFab player account pools","microsoft.playfab/titles":"PlayFab titles","microsoft.portal/dashboards":"Shared dashboards","microsoft.powerbidedicated/capacities":"Power BI Embedded","microsoft.purview/accounts":"Microsoft Purview accounts","microsoft.quantum/workspaces":"Quantum Workspaces","microsoft.recommendationsservice/accounts":"Intelligent Recommendations Accounts","microsoft.recommendationsservice/accounts/modeling":"Modeling","microsoft.recommendationsservice/accounts/serviceendpoints":"Service Endpoints","microsoft.recoveryservices/vaults":"Recovery Services vaults","microsoft.redhatopenshift/openshiftclusters":"Azure Red Hat OpenShift","microsoft.relay/namespaces":"Relays","microsoft.resourceconnector/appliances":"Resource bridges","microsoft.resourcegraph/queries":"Resource Graph queries","microsoft.resources/deploymentscripts":"Deployment Scripts","microsoft.resources/templatespecs":"Template specs","microsoft.saas/applications":"Software as a Service (classic)","microsoft.saas/resources":"SaaS","microsoft.scom/managedinstances":"Aquila Instances","microsoft.scvmm/virtualmachines":"SCVMM virtual machine - Azure Arc","microsoft.scvmm/vmmservers":"SCVMM management servers","microsoft.search/searchservices":"Search services","microsoft.securitydetonation/chambers":"Security Detonation Chambers","microsoft.servicebus/namespaces":"Service Bus Namespaces","microsoft.servicefabric/clusters":"Service Fabric clusters","microsoft.servicefabric/managedclusters":"Service Fabric managed clusters","microsoft.serviceshub/connectors":"Services Hub Connectors","microsoft.signalrservice/signalr":"SignalR","microsoft.signalrservice/webpubsub":"Web PubSub Service","microsoft.solutions/applicationdefinitions":"Service catalog managed application definitions","microsoft.solutions/applications":"Managed applications","microsoft.sql/instancepools":"Instance pools","microsoft.sql/managedinstances":"SQL managed instances","microsoft.sql/managedinstances/databases":"Managed databases","microsoft.sql/servers":"SQL servers","microsoft.sql/servers/databases":"SQL databases","microsoft.sql/servers/elasticpools":"SQL elastic pools","microsoft.sql/servers/jobagents":"Elastic Job agents","microsoft.sql/virtualclusters":"Virtual clusters","microsoft.sqlvirtualmachine/sqlvirtualmachines":"SQL virtual machines","microsoft.storage/storageaccounts":"Storage accounts","microsoft.storagecache/amlfilesystems":"Lustre File Systems","microsoft.storagecache/caches":"HPC caches","microsoft.storagepool/diskpools":"Disk Pools","microsoft.storagesync/storagesyncservices":"Storage Sync Services","microsoft.storagesyncdev/storagesyncservices":"Storage Sync Services","microsoft.storagesyncint/storagesyncservices":"Storage Sync Services","microsoft.storsimple/managers":"StorSimple Device Managers","microsoft.streamanalytics/clusters":"Stream Analytics clusters","microsoft.streamanalytics/streamingjobs":"Stream Analytics jobs","microsoft.synapse/privatelinkhubs":"Azure Synapse Analytics (private link hubs)","microsoft.synapse/workspaces":"Azure Synapse Analytics","microsoft.synapse/workspaces/bigdatapools":"Apache Spark pools","microsoft.synapse/workspaces/kustopools":"Data Explorer pools (preview)","microsoft.synapse/workspaces/sqlpools":"Dedicated SQL pools","microsoft.testbase/testbaseaccounts":"Test Base Accounts","microsoft.testbase/testbaseaccounts/packages":"Test Base Packages","microsoft.timeseriesinsights/environments":"Time Series Insights environments","microsoft.timeseriesinsights/environments/eventsources":"Time Series Insights event sources","microsoft.timeseriesinsights/environments/referencedatasets":"Time Series Insights reference data sets","microsoft.videoindexer/accounts":"Video Analyzer for Media","microsoft.virtualmachineimages/imagetemplates":"Image Templates","microsoft.visualstudio/account":"Azure DevOps organizations","microsoft.visualstudio/account/project":"DevOps Starter","microsoft.vmwarecloudsimple/dedicatedcloudnodes":"CloudSimple Nodes","microsoft.vmwarecloudsimple/dedicatedcloudservices":"CloudSimple Services","microsoft.vmwarecloudsimple/virtualmachines":"CloudSimple Virtual Machines","microsoft.vsonline/plans":"Visual Studio Online Plans","microsoft.web/connectiongateways":"On-premises data gateways","microsoft.web/connections":"API Connections","microsoft.web/containerapps":"Container Apps","microsoft.web/customapis":"Logic Apps Custom Connector","microsoft.web/hostingenvironments":"App Service Environments","microsoft.web/kubeenvironments":"App Service Kubernetes Environments","microsoft.web/serverfarms":"App Service plans","microsoft.web/sites":"App Services","microsoft.web/sites/slots":"App Service (Slots)","microsoft.web/staticsites":"Static Web Apps","microsoft.windowsesu/multipleactivationkeys":"Windows Multiple Activation Keys","microsoft.windowsiot/deviceservices":"Windows 10 IoT Core Services","microsoft.workloads/monitors":"Azure Monitors for SAP Solutions (v2)","microsoft.workloads/phpworkloads":"Scalable WordPress on Linux","microsoft.workloads/sapvirtualinstances":"SAP Virtual Instances","microsoft.workloads/sapvirtualinstances/applicationinstances":"SAP app server instances","microsoft.workloads/sapvirtualinstances/centralinstances":"SAP central server instances","microsoft.workloads/sapvirtualinstances/databaseinstances":"SAP database server instances","nginx.nginxplus/nginxdeployments":"NGINX Deployment","providers.test/statefulibizaengines":"VLCentral Help","wandisco.fusion/fusiongroups":"LiveData Planes","wandisco.fusion/fusiongroups/azurezones":"Azure Zones","wandisco.fusion/fusiongroups/azurezones/plugins":"Plugins","wandisco.fusion/fusiongroups/hivereplicationrules":"Hive Replication Rules","wandisco.fusion/fusiongroups/managedonpremzones":"On-premises Zones","wandisco.fusion/fusiongroups/replicationrules":"Replication Rules","wandisco.fusion/migrators":"LiveData Migrators","wandisco.fusion/migrators/exclusiontemplates":"Exclusions","wandisco.fusion/migrators/livedatamigrations":"Migrations","wandisco.fusion/migrators/metadatamigrations":"Metadata Migrations","wandisco.fusion/migrators/metadatatargets":"Metadata Targets","wandisco.fusion/migrators/pathmappings":"Path Mappings","wandisco.fusion/migrators/targets":"Targets","microsoft.security/insights/classification":"Data Sensitivity Security Insights (Preview)","microsoft.security/locations/alerts":"Security Alerts"},Zs={"microsoft.cache/redis":!0,"microsoft.dbforpostgresql/flexibleservers":!0,"microsoft.storagecache/amlfilesystems":!0,"microsoft.databoxedge/databoxedgedevices":!0,"microsoft.dataprotection/backupvaults":!0,"microsoft.netapp/netappaccounts/capacitypools":!0,"microsoft.network/networkwatchers/connectionmonitors":!0,"microsoft.keyvault/vaults":!0,"microsoft.recoveryservices/vaults":!0,"microsoft.sql/servers/databases":!0,"microsoft.sql/servers/elasticpools":!0,"microsoft.compute/virtualmachinescalesets":!0,"microsoft.compute/virtualmachines":!0,"microsoft.signalrservice/webpubsub":!0},Ys=["microsoft.aad/domainservices","microsoft.aadiam/azureadmetrics","microsoft.analysisservices/servers","microsoft.apimanagement/service","microsoft.app/containerapps","microsoft.app/managedenvironments","microsoft.appconfiguration/configurationstores","microsoft.appplatform/spring","microsoft.automation/automationaccounts","microsoft.avs/privateclouds","microsoft.azuresphere/catalogs","microsoft.azurestackhci/clusters","microsoft.azurestackresourcemonitor/storageaccountmonitor","microsoft.batch/batchaccounts","microsoft.batchai/workspaces","microsoft.bing/accounts","microsoft.botservice/botservices","microsoft.botservice/botservices/channels","microsoft.botservice/botservices/connections","microsoft.botservice/checknameavailability","microsoft.botservice/hostsettings","microsoft.botservice/listauthserviceproviders","microsoft.botservice/listqnamakerendpointkeys","microsoft.cache/redis","microsoft.cache/redisenterprise","microsoft.cdn/cdnwebapplicationfirewallpolicies","microsoft.cdn/profiles","microsoft.classiccompute/domainnames","microsoft.classiccompute/domainnames/slots/roles","microsoft.classiccompute/virtualmachines","microsoft.classicstorage/storageaccounts","microsoft.classicstorage/storageaccounts/blobservices","microsoft.classicstorage/storageaccounts/fileservices","microsoft.classicstorage/storageaccounts/queueservices","microsoft.classicstorage/storageaccounts/tableservices","microsoft.cloudtest/hostedpools","microsoft.cloudtest/pools","microsoft.clusterstor/nodes","microsoft.codesigning/codesigningaccounts","microsoft.cognitiveservices/accounts","microsoft.communication/communicationservices","microsoft.compute/cloudservices","microsoft.compute/cloudservices/roles","microsoft.compute/disks","microsoft.compute/virtualmachines","microsoft.compute/virtualmachinescalesets","microsoft.compute/virtualmachinescalesets/virtualmachines","microsoft.connectedcache/cachenodes","microsoft.connectedcache/enterprisemcccustomers","microsoft.connectedcache/ispcustomers","microsoft.connectedvehicle/platformaccounts","microsoft.containerinstance/containergroups","microsoft.containerinstance/containerscalesets","microsoft.containerregistry/registries","microsoft.containerservice/managedclusters","microsoft.customerinsights/hubs","microsoft.customproviders/resourceproviders","microsoft.dashboard/grafana","microsoft.databoxedge/databoxedgedevices","microsoft.datacollaboration/workspaces","microsoft.datafactory/datafactories","microsoft.datafactory/factories","microsoft.datalakeanalytics/accounts","microsoft.datalakestore/accounts","microsoft.dataprotection/backupvaults","microsoft.datashare/accounts","microsoft.dbformariadb/servers","microsoft.dbformysql/flexibleservers","microsoft.dbformysql/servers","microsoft.dbforpostgresql/flexibleservers","microsoft.dbforpostgresql/servergroupsv2","microsoft.dbforpostgresql/servers","microsoft.dbforpostgresql/serversv2","microsoft.devices/iothubs","microsoft.devices/provisioningservices","microsoft.digitaltwins/digitaltwinsinstances","microsoft.documentdb/cassandraclusters","microsoft.documentdb/databaseaccounts","microsoft.documentdb/mongoclusters","microsoft.edgezones/edgezones","microsoft.enterpriseknowledgegraph/services","microsoft.eventgrid/domains","microsoft.eventgrid/eventsubscriptions","microsoft.eventgrid/extensiontopics","microsoft.eventgrid/namespaces","microsoft.eventgrid/partnernamespaces","microsoft.eventgrid/partnertopics","microsoft.eventgrid/systemtopics","microsoft.eventgrid/topics","microsoft.eventhub/clusters","microsoft.eventhub/namespaces","microsoft.fabric.admin/fabriclocations","microsoft.hdinsight/clusters","microsoft.healthcareapis/services","microsoft.healthcareapis/workspaces/dicomservices","microsoft.healthcareapis/workspaces/fhirservices","microsoft.healthcareapis/workspaces/iotconnectors","microsoft.healthmodel/healthmodels","microsoft.hybridcontainerservice/provisionedclusters","microsoft.hybridnetwork/networkfunctions","microsoft.hybridnetwork/virtualnetworkfunctions","microsoft.insights/autoscalesettings","microsoft.insights/components","microsoft.iotcentral/iotapps","microsoft.iotspaces/graph","microsoft.keyvault/managedhsms","microsoft.keyvault/vaults","microsoft.kubernetes/connectedclusters","microsoft.kubernetesconfiguration/extensions","microsoft.kusto/clusters","microsoft.logic/integrationserviceenvironments","microsoft.logic/workflows","microsoft.machinelearningservices/workspaces","microsoft.machinelearningservices/workspaces/onlineendpoints","microsoft.machinelearningservices/workspaces/onlineendpoints/deployments","microsoft.managednetworkfabric/internetgateways","microsoft.managednetworkfabric/l3isolationdomains","microsoft.managednetworkfabric/networkdevices","microsoft.maps/accounts","microsoft.media/mediaservices","microsoft.media/mediaservices/liveevents","microsoft.media/mediaservices/streamingendpoints","microsoft.media/videoanalyzers","microsoft.mixedreality/remoterenderingaccounts","microsoft.mixedreality/spatialanchorsaccounts","microsoft.mobilenetwork/packetcorecontrolplanes","microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes","microsoft.monitor/accounts","microsoft.netapp/netappaccounts/capacitypools","microsoft.netapp/netappaccounts/capacitypools/volumes","microsoft.network/applicationgateways","microsoft.network/azurefirewalls","microsoft.network/bastionhosts","microsoft.network/connections","microsoft.network/dnsforwardingrulesets","microsoft.network/dnsresolvers","microsoft.network/dnszones","microsoft.network/expressroutecircuits","microsoft.network/expressroutecircuits/peerings","microsoft.network/expressroutegateways","microsoft.network/expressrouteports","microsoft.network/frontdoors","microsoft.network/loadbalancers","microsoft.network/natgateways","microsoft.network/networkinterfaces","microsoft.network/networkmanagers/ipampools","microsoft.network/networkvirtualappliances","microsoft.network/networkwatchers","microsoft.network/networkwatchers/connectionmonitors","microsoft.network/p2svpngateways","microsoft.network/privatednszones","microsoft.network/privateendpoints","microsoft.network/privatelinkservices","microsoft.network/publicipaddresses","microsoft.network/publicipprefixes","microsoft.network/trafficmanagerprofiles","microsoft.network/virtualhubs","microsoft.network/virtualnetworkgateways","microsoft.network/virtualnetworks","microsoft.network/virtualrouters","microsoft.network/vpngateways","microsoft.networkanalytics/dataconnectors","microsoft.networkcloud/baremetalmachines","microsoft.networkcloud/clusters","microsoft.networkcloud/storageappliances","microsoft.networkfunction/azuretrafficcollectors","microsoft.notificationhubs/namespaces/notificationhubs","microsoft.operationalinsights/workspaces","microsoft.operationsmanagement/solutions","microsoft.orbital/contactprofiles","microsoft.orbital/l2connections","microsoft.orbital/spacecrafts","microsoft.orbital/terminals","microsoft.peering/peerings","microsoft.peering/peeringservices","microsoft.playfab/titles","microsoft.powerbidedicated/capacities","microsoft.purview/accounts","microsoft.recoveryservices/vaults","microsoft.relay/namespaces","microsoft.resources/subscriptions","microsoft.search/searchservices","microsoft.securitydetonation/chambers","microsoft.securitydetonation/securitydetonationchambers","microsoft.servicebus/namespaces","microsoft.servicefabricmesh/applications","microsoft.servicenetworking/trafficcontrollers","microsoft.signalrservice/signalr","microsoft.signalrservice/signalr/replicas","microsoft.signalrservice/webpubsub","microsoft.signalrservice/webpubsub/replicas","microsoft.singularity/accounts","microsoft.sql/managedinstances","microsoft.sql/servers/databases","microsoft.sql/servers/elasticpools","microsoft.sql/servers/jobagents","microsoft.storage/storageaccounts","microsoft.storage/storageaccounts/blobservices","microsoft.storage/storageaccounts/fileservices","microsoft.storage/storageaccounts/objectreplicationpolicies","microsoft.storage/storageaccounts/queueservices","microsoft.storage/storageaccounts/storagetasks","microsoft.storage/storageaccounts/tableservices","microsoft.storage/storagetasks","microsoft.storagecache/amlfilesystems","microsoft.storagecache/caches","microsoft.storagemover/storagemovers","microsoft.storagesync/storagesyncservices","microsoft.storagetasks/storagetasks","microsoft.streamanalytics/streamingjobs","microsoft.synapse/workspaces","microsoft.synapse/workspaces/bigdatapools","microsoft.synapse/workspaces/kustopools","microsoft.synapse/workspaces/scopepools","microsoft.synapse/workspaces/sqlpools","microsoft.timeseriesinsights/environments","microsoft.timeseriesinsights/environments/eventsources","microsoft.vmwarecloudsimple/virtualmachines","microsoft.voiceservices/communicationsgateways","microsoft.web/containerapps","microsoft.web/hostingenvironments","microsoft.web/hostingenvironments/multirolepools","microsoft.web/hostingenvironments/workerpools","microsoft.web/serverfarms","microsoft.web/sites","microsoft.web/sites/slots","microsoft.web/staticsites","nginx.nginxplus/nginxdeployments","wandisco.fusion/migrators","wandisco.fusion/migrators/datatransferagents","wandisco.fusion/migrators/livedatamigrations","wandisco.fusion/migrators/metadatamigrations"],qs=["microsoft.aad/domainservices","microsoft.aadiam/azureadmetrics","microsoft.aadiam/tenants","microsoft.agfoodplatform/farmbeats","microsoft.analysisservices/servers","microsoft.apimanagement/service","microsoft.appconfiguration/configurationstores","microsoft.appplatform/spring","microsoft.attestation/attestationproviders","microsoft.automation/automationaccounts","microsoft.autonomousdevelopmentplatform/accounts","microsoft.autonomousdevelopmentplatform/datapools","microsoft.autonomousdevelopmentplatform/workspaces","microsoft.avs/privateclouds","microsoft.azurestackresourcemonitor/storageaccountmonitor","microsoft.batch/batchaccounts","microsoft.batchai/workspaces","microsoft.blockchain/blockchainmembers","microsoft.blockchain/cordamembers","microsoft.botservice/botservices","microsoft.cache/redis","microsoft.cache/redisenterprise","microsoft.cdn/cdnwebapplicationfirewallpolicies","microsoft.cdn/profiles","microsoft.cdn/profiles/endpoints","microsoft.classiccompute/domainnames","microsoft.classiccompute/virtualmachines","microsoft.classicnetwork/networksecuritygroups","microsoft.classicstorage/storageaccounts","microsoft.cognitiveservices/accounts","microsoft.communication/communicationservices","microsoft.compute/disks","microsoft.compute/virtualmachines","microsoft.compute/virtualmachinescalesets","microsoft.connectedcache/cachenodes","microsoft.connectedvehicle/platformaccounts","microsoft.containerinstance/containergroups","microsoft.containerregistry/registries","microsoft.containerservice/managedclusters","microsoft.customerinsights/hubs","microsoft.customproviders/resourceproviders","microsoft.d365customerinsights/instances","microsoft.dashboard/grafana","microsoft.databoxedge/databoxedgedevices","microsoft.databricks/workspaces","microsoft.datacollaboration/workspaces","microsoft.datafactory/datafactories","microsoft.datafactory/factories","microsoft.datalakeanalytics/accounts","microsoft.datalakestore/accounts","microsoft.datashare/accounts","microsoft.dbformariadb/servers","microsoft.dbformysql/flexibleservers","microsoft.dbformysql/servers","microsoft.dbforpostgresql/flexibleservers","microsoft.dbforpostgresql/servergroupsv2","microsoft.dbforpostgresql/servers","microsoft.dbforpostgresql/serversv2","microsoft.desktopvirtualization/applicationgroups","microsoft.desktopvirtualization/hostpools","microsoft.desktopvirtualization/scalingplans","microsoft.desktopvirtualization/workspaces","microsoft.devices/elasticpools/iothubtenants","microsoft.devices/iothubs","microsoft.devices/provisioningservices","microsoft.digitaltwins/digitaltwinsinstances","microsoft.documentdb/cassandraclusters","microsoft.documentdb/databaseaccounts","microsoft.eventgrid/domains","microsoft.eventgrid/partnernamespaces","microsoft.eventgrid/partnertopics","microsoft.eventgrid/systemtopics","microsoft.eventgrid/topics","microsoft.eventhub/clusters","microsoft.eventhub/namespaces","microsoft.experimentation/experimentworkspaces","microsoft.fabric.admin/fabriclocations","microsoft.hdinsight/clusters","microsoft.healthcareapis/services","microsoft.healthcareapis/workspaces/dicomservices","microsoft.healthcareapis/workspaces/fhirservices","microsoft.insights/autoscalesettings","microsoft.insights/components","microsoft.insights/qos","microsoft.iotcentral/iotapps","microsoft.keyvault/managedhsms","microsoft.keyvault/vaults","microsoft.kubernetes/connectedclusters","microsoft.kusto/clusters","microsoft.loadtestservice/loadtests","microsoft.logic/integrationaccounts","microsoft.logic/integrationserviceenvironments","microsoft.logic/workflows","microsoft.machinelearningservices/workspaces","microsoft.media/mediaservices","microsoft.media/mediaservices/liveevents","microsoft.media/mediaservices/streamingendpoints","microsoft.media/videoanalyzers","microsoft.netapp/netappaccounts/capacitypools","microsoft.netapp/netappaccounts/capacitypools/volumes","microsoft.network/applicationgateways","microsoft.network/azurefirewalls","microsoft.network/bastionhosts","microsoft.network/connections","microsoft.network/dnszones","microsoft.network/expressroutecircuits","microsoft.network/expressroutegateways","microsoft.network/expressrouteports","microsoft.network/frontdoors","microsoft.network/loadbalancers","microsoft.network/natgateways","microsoft.network/networkinterfaces","microsoft.network/networksecuritygroups","microsoft.network/networksecurityperimeters","microsoft.network/networkvirtualappliances","microsoft.network/networkwatchers","microsoft.network/networkwatchers/connectionmonitors","microsoft.network/p2svpngateways","microsoft.network/privateendpoints","microsoft.network/privatelinkservices","microsoft.network/publicipaddresses","microsoft.network/trafficmanagerprofiles","microsoft.network/virtualnetworkgateways","microsoft.network/virtualnetworks","microsoft.network/vpngateways","microsoft.networkfunction/azuretrafficcollectors","microsoft.notificationhubs/namespaces","microsoft.notificationhubs/namespaces/notificationhubs","microsoft.openlogisticsplatform/workspaces","microsoft.operationalinsights/workspaces","microsoft.operationsmanagement/solutions","microsoft.peering/peeringservices","microsoft.powerbi/tenants","microsoft.powerbi/tenants/workspaces","microsoft.powerbidedicated/capacities","microsoft.purview/accounts","microsoft.recoveryservices/vaults","microsoft.relay/namespaces","microsoft.resources/subscriptions","microsoft.resources/subscriptions/resourcegroups","microsoft.search/searchservices","microsoft.security/antimalwaresettings","microsoft.securityinsights/settings","microsoft.servicebus/namespaces","microsoft.signalrservice/signalr","microsoft.signalrservice/webpubsub","microsoft.singularity/accounts","microsoft.sql/managedinstances","microsoft.sql/managedinstances/databases","microsoft.sql/servers/databases","microsoft.sql/servers/elasticpools","microsoft.storage/storageaccounts","microsoft.storage/storageaccounts/blobservices","microsoft.storage/storageaccounts/fileservices","microsoft.storage/storageaccounts/queueservices","microsoft.storage/storageaccounts/tableservices","microsoft.storagecache/caches","microsoft.storagesync/storagesyncservices","microsoft.streamanalytics/streamingjobs","microsoft.synapse/workspaces","microsoft.synapse/workspaces/bigdatapools","microsoft.synapse/workspaces/kustopools","microsoft.synapse/workspaces/scopepools","microsoft.synapse/workspaces/sqlpools","microsoft.timeseriesinsights/environments","microsoft.timeseriesinsights/environments/eventsources","microsoft.videoindexer/accounts","microsoft.vmwarecloudsimple/virtualmachines","microsoft.web/hostingenvironments","microsoft.web/hostingenvironments/workerpools","microsoft.web/serverfarms","microsoft.web/sites","microsoft.web/sites/slots"],_s=t=>({resourceList:(0,S.css)({display:"flex",columnGap:t.spacing(1),flexWrap:"wrap",marginBottom:t.spacing(1)}),resource:(0,S.css)({flex:"0 0 auto"}),resourceLabel:(0,S.css)({padding:t.spacing(1)}),resourceGroupAndName:(0,S.css)({display:"flex",columnGap:t.spacing(.5)})}),er=({resources:t,onChange:e})=>{const s=(0,B.wW)(_s);(0,o.useEffect)(()=>{t.length===0&&e([{}])},[t,e]);const r=(n,l)=>{const u=[...t];u[n]=l,e(u)},a=n=>{const l=[...t];l.splice(n,1),e(l)},i=()=>{e(t.concat({subscription:t[0]?.subscription,metricNamespace:t[0]?.metricNamespace,resourceGroup:"",resourceName:""}))},c=n=>{e(t.map(l=>({...l,...n})))};return o.createElement(o.Fragment,null,o.createElement(oe._,{label:"Subscription",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-subscription",labelWidth:15,"data-testid":N.components.queryEditor.resourcePicker.advanced.subscription.input},o.createElement(x.I,{id:"input-advanced-resource-picker-subscription",value:t[0]?.subscription??"",onChange:n=>c({subscription:n.currentTarget.value}),placeholder:"aaaaaaaa-bbbb-cccc-dddd-eeeeeeee"})),o.createElement(oe._,{label:"Namespace",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-metricNamespace",labelWidth:15,"data-testid":N.components.queryEditor.resourcePicker.advanced.namespace.input},o.createElement(x.I,{id:"input-advanced-resource-picker-metricNamespace",value:t[0]?.metricNamespace??"",onChange:n=>c({metricNamespace:n.currentTarget.value}),placeholder:"Microsoft.Insights/metricNamespaces"})),o.createElement(oe._,{label:"Region",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-region",labelWidth:15,"data-testid":N.components.queryEditor.resourcePicker.advanced.region.input,tooltip:"The code region of the resource. Optional for one resource but mandatory when selecting multiple ones."},o.createElement(x.I,{id:"input-advanced-resource-picker-region",value:t[0]?.region??"",onChange:n=>c({region:n.currentTarget.value}),placeholder:"northeurope"})),o.createElement("div",{className:s.resourceList},t.map((n,l)=>o.createElement("div",{key:`resource-${l+1}`,className:s.resource},t.length!==1&&o.createElement(kt._,{className:s.resourceLabel},"Resource ",l+1),o.createElement(oe._,{label:"Resource Group",transparent:!0,htmlFor:`input-advanced-resource-picker-resourceGroup-${l+1}`,labelWidth:15,"data-testid":N.components.queryEditor.resourcePicker.advanced.resourceGroup.input},o.createElement("div",{className:s.resourceGroupAndName},o.createElement(x.I,{id:`input-advanced-resource-picker-resourceGroup-${l+1}`,value:n?.resourceGroup??"",onChange:u=>r(l,{...n,resourceGroup:u.currentTarget.value}),placeholder:"resource-group"}),o.createElement(Oe._,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:()=>a(l),hidden:t.length===1,"data-testid":"remove-resource"}))),o.createElement(oe._,{label:"Resource Name",transparent:!0,htmlFor:`input-advanced-resource-picker-resourceName-${l+1}`,labelWidth:15,"data-testid":N.components.queryEditor.resourcePicker.advanced.resource.input},o.createElement(x.I,{id:`input-advanced-resource-picker-resourceName-${l+1}`,value:n?.resourceName??"",onChange:u=>r(l,{...n,resourceName:u.currentTarget.value}),placeholder:"name"}))))),o.createElement(_.zx,{"aria-label":"Add",icon:"plus",variant:"secondary",onClick:i,type:"button"},"Add resource"))};function Nt(t,e){return t.azureMonitor?.customNamespace===e?t:e?.toLowerCase().startsWith("microsoft.storage/storageaccounts/")?{...t,azureMonitor:{...t.azureMonitor,metricNamespace:e,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]}}:{...t,azureMonitor:{...t.azureMonitor,customNamespace:e,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]}}}function tr(t,e){return t.azureMonitor?.metricName===e?t:{...t,azureMonitor:{...t.azureMonitor,metricName:e,aggregation:void 0,timeGrain:"",dimensionFilters:[]}}}function sr(t,e){return t.azureMonitor?.aggregation===e?t:{...t,azureMonitor:{...t.azureMonitor,aggregation:e}}}function Mt(t,e){return t.azureMonitor?.timeGrain===e?t:{...t,azureMonitor:{...t.azureMonitor,timeGrain:e}}}function $e(t,e){return t.azureMonitor?.dimensionFilters===e?t:{...t,azureMonitor:{...t.azureMonitor,dimensionFilters:e}}}function rr(t,e="",s="eq",r=[]){const a=t.azureMonitor?.dimensionFilters??[];return $e(t,[...a,{dimension:e,operator:s,filters:r}])}function ga(t,e){const r=[...t.azureMonitor?.dimensionFilters??[]];return r.splice(e,1),$e(t,r)}function ha(t,e,s,r){const i=[...t.azureMonitor?.dimensionFilters??[]],c=i[e];return c[s]=r,(s==="dimension"||s==="operator")&&(c.filters=[]),$e(t,i)}function or(t,e){return t.azureMonitor?.top===e?t:{...t,azureMonitor:{...t.azureMonitor,top:e}}}function ar(t,e){return t.azureMonitor?.alias===e?t:{...t,azureMonitor:{...t.azureMonitor,alias:e}}}const ir=({query:t,variableOptionGroup:e,onQueryChange:s,aggregationOptions:r,isLoading:a})=>{const i=(0,o.useCallback)(n=>{if(!n.value)return;const l=sr(t,n.value);s(l)},[s,t]),c=R(r,e,t.azureMonitor?.aggregation);return o.createElement(X,{label:"Aggregation"},o.createElement(D.Ph,{inputId:"azure-monitor-metrics-aggregation-field",value:t.azureMonitor?.aggregation||null,onChange:i,options:c,isLoading:a}))};var Rt=v(25673),Ct=v(74042);const nr=(t,e)=>{const[s,r]=(0,o.useState)({});return(0,o.useEffect)(()=>{let a={};if(t?.series?.length){const n=t.series.flat().filter(l=>l.refId===e.refId).flatMap(l=>l.fields).map(l=>l.labels).flat().filter(l=>l!=null);for(const l of n)for(const[u,d]of Object.entries(l)){const g=u.toLowerCase();a[g]?a[g].add(d):a[g]=new Set([d])}}r(i=>{const c={},n=Object.keys(a);if(n.length===0)return i;for(const l of n)i[l]&&a[l].size<i[l].size?c[l]=i[l]:c[l]=a[l];return c})},[t?.series,e.refId]),s},cr=({data:t,query:e,dimensionOptions:s,onQueryChange:r})=>{const a=(0,o.useMemo)(()=>e.azureMonitor?.dimensionFilters??[],[e.azureMonitor?.dimensionFilters]),i=nr(t,e),c=[{label:"==",value:"eq"},{label:"!=",value:"ne"},{label:"starts with",value:"sw"}],n=(0,o.useMemo)(()=>{let p=s;return a.length&&(p=s.filter(b=>!a.some(y=>y.dimension===b.value))),p},[a,s]),l=(p,b,y,k)=>{b[p]=y,k(b)},u=p=>n.concat(s.filter(b=>b.value===p)),d=(p,b)=>{const y=Array.from(i[b.toLowerCase()]??[]);return y.find(k=>k===p)?y.map(k=>({value:k,label:k})):[...y,...p&&p!=="*"?[p]:[]].map(k=>({value:k,label:k}))},g=(p,b)=>{const y=d(void 0,b);if(p)for(const k of p)y.find(E=>E.value===k)||y.push({value:k,label:k});return y},w=p=>c.find(b=>b.value===p)?c:[...c,...p?[{label:p,value:p}]:[]],h=p=>{const b=p.map(y=>({dimension:y.dimension??"",operator:y.operator??"eq",filters:y.filters??[]}));r($e(e,b))},f=(p,b,y)=>o.createElement(Ct.Lh,{spacing:"none"},o.createElement(D.Ph,{menuShouldPortal:!0,placeholder:"Field",value:p.dimension,options:u(p.dimension||""),onChange:k=>l("dimension",p,k.value??"",b)}),o.createElement(D.Ph,{menuShouldPortal:!0,placeholder:"Operation",value:p.operator,options:w(p.operator||"eq"),onChange:k=>l("operator",p,k.value??"",b),allowCustomValue:!0}),p.operator==="eq"||p.operator==="ne"?o.createElement(D.NU,{menuShouldPortal:!0,placeholder:"Select value(s)",value:p.filters,options:g(p.filters,p.dimension??""),onChange:k=>l("filters",p,k.map(E=>E.value??""),b),"aria-label":"dimension-labels-select",allowCustomValue:!0}):o.createElement(D.Ph,{menuShouldPortal:!0,placeholder:"Select value",value:p.filters?p.filters[0]:"",allowCustomValue:!0,options:d(p.filters?p.filters[0]:"",p.dimension??""),onChange:k=>l("filters",p,[k?.value??""],b),isClearable:!0}),o.createElement(Oe._,{"aria-label":"Remove",icon:"times",variant:"secondary",onClick:y,type:"button"}));return o.createElement(X,{label:"Dimensions"},o.createElement(Rt.k,{items:a,onChange:h,renderItem:f}))},lr=({onQueryChange:t,query:e})=>{const[s,r]=(0,o.useState)(e.azureMonitor?.alias??""),a=(0,o.useCallback)(c=>{c.target instanceof HTMLInputElement&&r(c.target.value)},[]),i=(0,o.useCallback)(()=>{const c=ar(e,s);t(c)},[t,e,s]);return o.createElement(X,{label:"Legend format"},o.createElement(x.I,{id:"azure-monitor-metrics-legend-field",placeholder:"Alias patterns",value:s,onChange:a,onBlur:i,width:38}))},ur=({metricNames:t,query:e,variableOptionGroup:s,onQueryChange:r})=>{const a=(0,o.useCallback)(c=>{if(!c.value)return;const n=tr(e,c.value);r(n)},[r,e]),i=R(t,s,e.azureMonitor?.metricName);return o.createElement(X,{label:"Metric","data-testid":N.components.queryEditor.metricsQueryEditor.metricName.input},o.createElement(D.Ph,{inputId:"azure-monitor-metrics-metric-field",value:e.azureMonitor?.metricName??null,onChange:a,options:i,allowCustomValue:!0}))},mr=({metricNamespaces:t,query:e,variableOptionGroup:s,onQueryChange:r})=>{const a=(0,o.useCallback)(n=>{if(!n.value)return;const l=Nt(e,n.value);r(l)},[r,e]),i=e.azureMonitor?.customNamespace||e.azureMonitor?.metricNamespace,c=R(t,s,i);return o.createElement(X,{label:"Metric namespace"},o.createElement(D.Ph,{inputId:"azure-monitor-metrics-metric-namespace-field",value:i||null,onChange:a,options:c,allowCustomValue:!0}))},pr=({query:t,timeGrainOptions:e,variableOptionGroup:s,onQueryChange:r})=>{const a=(0,o.useCallback)(c=>{if(!c.value)return;const n=Mt(t,c.value);r(n)},[r,t]),i=(0,o.useMemo)(()=>{const c=W.findClosestTimeGrain("1m",e.map(u=>W.createKbnUnitFromISO8601Duration(u.value))||["1m","5m","15m","30m","1h","6h","12h","1d"]),n=e.map(u=>u.value==="auto"?{...u,description:c}:u);return R(n,s,t.azureMonitor?.timeGrain)},[e,s,t.azureMonitor?.timeGrain]);return o.createElement(X,{label:"Time grain"},o.createElement(D.Ph,{inputId:"azure-monitor-metrics-time-grain-field",value:t.azureMonitor?.timeGrain,onChange:a,options:i}))},dr=({onQueryChange:t,query:e})=>{const[s,r]=(0,o.useState)(e.azureMonitor?.top??""),a=(0,o.useCallback)(c=>{c.target instanceof HTMLInputElement&&r(c.target.value)},[]),i=(0,o.useCallback)(()=>{const c=or(e,s);t(c)},[t,e,s]);return o.createElement(X,{label:"Top"},o.createElement(x.I,{id:"azure-monitor-metrics-top-field",value:s,onChange:a,onBlur:i,width:16}))};function It(t,e,s){const[r]=(0,o.useState)(()=>Math.random()),[a,i]=(0,o.useState)(),c=(0,o.useMemo)(()=>a??[],[a]);return(0,o.useEffect)(()=>{t().then(n=>{i(n),e(r,void 0)}).catch(n=>{e(r,n)})},s),c}const tt=t=>!t||!t.length?{resourceGroup:"",resourceName:""}:{resourceGroup:t[0].resourceGroup??"",resourceName:t[0].resourceName??""},fr=(t,e,s,r)=>{const{subscription:a}=t,{metricNamespace:i,resources:c}=t.azureMonitor??{},{resourceGroup:n,resourceName:l}=tt(c);return It(async()=>{if(!a||!n||!l)return;const d=await e.azureMonitorDatasource.getMetricNamespaces({subscription:a,metricNamespace:i,resourceGroup:n,resourceName:l},!1),g=Lt(d,i);return!i&&g.length&&s(Nt(t,g[0].value)),g},r,[a,i,n,l])},gr=(t,e,s,r)=>{const{subscription:a}=t,{metricNamespace:i,metricName:c,resources:n,customNamespace:l}=t.azureMonitor??{},{resourceGroup:u,resourceName:d}=tt(n),g=(n&&n.length>1)??!1,w=t.azureMonitor?.region??"";return It(async()=>{if(!a||!i||!u||!d)return;const h=await e.azureMonitorDatasource.getMetricNames({subscription:a,resourceGroup:u,resourceName:d,metricNamespace:i,customNamespace:l},g,w);return Lt(h,c)},r,[a,u,d,i,l,g])},Dt={aggOptions:[],timeGrains:[],dimensions:[],isLoading:!1,supportedAggTypes:[],primaryAggType:void 0},hr=(t,e,s)=>{const[r,a]=(0,o.useState)(Dt),{subscription:i}=t,{resources:c,metricNamespace:n,metricName:l,aggregation:u,timeGrain:d,customNamespace:g,region:w}=t.azureMonitor??{},{resourceGroup:h,resourceName:f}=tt(c),p=(c&&c.length>1)??!1;return(0,o.useEffect)(()=>{if(!i||!h||!f||!n||!l){a(Dt);return}e.azureMonitorDatasource.getMetricMetadata({subscription:i,resourceGroup:h,resourceName:f,metricNamespace:n,metricName:l,customNamespace:g},p,w).then(b=>{const y=(b.supportedAggTypes||[b.primaryAggType]).map(k=>({label:k,value:k}));a({aggOptions:y,timeGrains:b.supportedTimeGrains,dimensions:b.dimensions,isLoading:!1,supportedAggTypes:b.supportedAggTypes??[],primaryAggType:b.primaryAggType})})},[w,e,i,h,f,n,l,g,p]),(0,o.useEffect)(()=>{const b=u||r.primaryAggType,y=d||"auto";(b!==u||y!==d)&&s({...t,azureMonitor:{...t.azureMonitor,aggregation:b,timeGrain:y,allowedTimeGrainsMs:r.timeGrains.filter(k=>k.value!=="auto").map(k=>Ee.intervalToMs(W.createKbnUnitFromISO8601Duration(k.value)))}})},[s,r,u,d,t]),r};function Lt(t,e){const s=t.map(C);return e&&!s.find(r=>r.value===e.toLowerCase())&&s.push({label:e,value:e}),s}const br=({data:t,query:e,datasource:s,variableOptionGroup:r,onChange:a,setError:i})=>{const c=hr(e,s,a),n=fr(e,s,a,i),l=gr(e,s,a,i),u=e.azureMonitor?.resources?.map(h=>({subscription:e.subscription,resourceGroup:h.resourceGroup,metricNamespace:e.azureMonitor?.metricNamespace,resourceName:h.resourceName,region:e.azureMonitor?.region}))??[],d=h=>Zs[h?.toLocaleLowerCase()??""]??!1,g=(h,f)=>{if(f.length===0)return!1;const p=j(h.uri,h.location),b=j(f[0].uri,f[0].location);return p.subscription!==b.subscription||p.region!==b.region||p.metricNamespace?.toLocaleLowerCase()!==b.metricNamespace?.toLocaleLowerCase()||!d(p.metricNamespace)},w=h=>{if(h.length===0)return"";const f=j(h[0].uri,h[0].location);return d(f.metricNamespace)?"You can select items of the same resource type and location. To select resources of a different resource type or location, please first uncheck your current selection.":""};return o.createElement("span",{"data-testid":N.components.queryEditor.metricsQueryEditor.container.input},o.createElement(Qe._,null,o.createElement(ee.p,null,o.createElement(te.s,null,o.createElement(Ye,{query:e,datasource:s,variableOptionGroup:r,onQueryChange:a,setError:i,selectableEntryTypes:[I.Resource],resources:u??[],queryType:"metrics",disableRow:g,renderAdvanced:(h,f)=>o.createElement(er,{resources:h,onChange:f}),selectionNotice:w}),o.createElement(mr,{metricNamespaces:n,query:e,datasource:s,variableOptionGroup:r,onQueryChange:a,setError:i}),o.createElement(ur,{metricNames:l,query:e,datasource:s,variableOptionGroup:r,onQueryChange:a,setError:i}),o.createElement(ir,{query:e,datasource:s,variableOptionGroup:r,onQueryChange:a,setError:i,aggregationOptions:c?.aggOptions??[],isLoading:c.isLoading}),o.createElement(pr,{query:e,datasource:s,variableOptionGroup:r,onQueryChange:a,setError:i,timeGrainOptions:c?.timeGrains??[]}))),o.createElement(ee.p,null,o.createElement(te.s,null,o.createElement(cr,{data:t,query:e,datasource:s,variableOptionGroup:r,onQueryChange:a,setError:i,dimensionOptions:c?.dimensions??[]}))),o.createElement(ee.p,null,o.createElement(te.s,null,o.createElement(dr,{query:e,datasource:s,variableOptionGroup:r,onQueryChange:a,setError:i}),o.createElement(lr,{query:e,datasource:s,variableOptionGroup:r,onQueryChange:a,setError:i})))))};var vr=v(86755),yr=v(27786);const wr=({query:t,onQueryChange:e})=>{const s=[{value:m.AzureMonitor,label:"Metrics"},{value:m.LogAnalytics,label:"Logs"},{value:m.AzureTraces,label:"Traces"},{value:m.AzureResourceGraph,label:"Azure Resource Graph"}],r=(0,o.useCallback)(a=>{a.value&&a.value!==t.queryType&&e({refId:t.refId,datasource:t.datasource,queryType:a.value})},[e,t]);return o.createElement("span",{"data-testid":N.components.queryEditor.header.select},o.createElement(vr.K,null,o.createElement(yr.X,{label:"Service",value:t.queryType,placeholder:"Service...",allowCustomValue:!0,options:s,onChange:r})))};var kr=v(69690),Ft=v(81838),Sr=v(81223),zr=v(9833),Er=v(12260),Ar=v(85722);const We=(t,e,s,r)=>{t==="filters"?e[t]=s.map(a=>a.value):(e[t]=s.value,t==="property"&&(e.filters=[])),r(e)},Tr=async(t,e,s,r,a,i,c)=>{const{azureTraces:n}=t;if(!n)return[];const{resources:l}=n;if(!l||!i)return[];const u=i.property;if(!u)return[];const d=`let ${u} = toscalar(union isfuzzy=true ${s.join(",")}
  | where $__timeFilter(timestamp)
  | summarize count=count() by ${u}
  | summarize make_list(pack_all()));
  print properties = bag_pack("${u}", ${u});`,g=await(0,Ft.n)(e.azureLogAnalyticsDatasource.query({requestId:"azure-traces-properties-req",interval:"",intervalMs:0,scopedVars:{},timezone:"",startTime:0,app:Sr.zj.Unknown,targets:[{...t,azureLogAnalytics:{resources:l,query:d},queryType:m.LogAnalytics}],range:c||(0,zr.JK)()}));if(g.data.length>0){const w=g.data[0];if(w.fields.length>0){const f=JSON.parse(w.fields[0].values.toArray()[0])[u].map(p=>{let b=p[u];return p[u]===""&&(b="<Empty>"),{label:b.toString(),value:p[u].toString(),count:p.count}});return r.set(u,f),a(r),f}}return[]};function Nr(t){function e(s,r,a){return o.createElement(Rr,{...t,item:s,onChange:r,onDelete:a})}return e}const Mr=t=>{const{data:e,innerProps:s,innerRef:r,isFocused:a,isSelected:i}=t,c=(0,B.l4)(),n=(0,Er.D)(c),l=u=>{t.selectOption({...e}),u.stopPropagation(),u.preventDefault()};return o.createElement("div",{ref:r,className:(0,S.cx)(n.option,a&&n.optionFocused,i&&n.optionSelected,e.isDisabled&&n.optionDisabled),...s,"aria-label":"Select option",title:e.title,onClick:l,onKeyDown:l,role:"checkbox","aria-checked":i,tabIndex:0},o.createElement("div",{className:n.optionBody},o.createElement(ht.X,{value:i,label:e.label?`${e.label} - (${e.count})`:""})))},Rr=t=>{const{query:e,datasource:s,propertyMap:r,setPropertyMap:a,queryTraceTypes:i,properties:c,item:n,onChange:l,onDelete:u,variableOptionGroup:d,range:g}=t,[w,h]=(0,o.useState)(!1),[f,p]=(0,o.useState)(R(r.get(n.property??"")??[],d)),[b,y]=(0,o.useState)(n.filters?n.filters.map(E=>({value:E,label:E===""?"<Empty>":E})):[]),k=async()=>{if(h(!0),n.property&&n.property!==""){const L=r.get(n.property??"");if(L)return p(R(L,d)),h(!1),Promise.resolve(L);{const V=await Tr(e,s,i,r,a,n,g);return p(R(V,d)),h(!1),V}}const E=[];return Promise.resolve(E)};return o.createElement(Ct.Lh,{spacing:"none"},o.createElement(D.Ph,{menuShouldPortal:!0,placeholder:"Property",value:n.property?{value:n.property,label:n.property}:null,options:R(c.map(E=>({label:E,value:E})),d),onChange:E=>We("property",n,E,l),width:25}),o.createElement(Ar.d,{placeholder:"Operator",value:n.operation?{label:n.operation==="eq"?"=":"!=",value:n.operation}:void 0,options:[{label:"=",value:"eq"},{label:"!=",value:"ne"}],onChange:E=>We("operation",n,E,l),defaultValue:"eq"}),o.createElement(D.M8,{blurInputOnSelect:!1,menuShouldPortal:!0,placeholder:"Value",value:b,loadOptions:k,isLoading:w,onOpenMenu:k,onChange:E=>{y(E),E.length===0&&We("filters",n,b,l)},width:35,defaultOptions:f,isClearable:!0,components:{Option:Mr},closeMenuOnSelect:!1,onCloseMenu:()=>We("filters",n,b,l),hideSelectedOptions:!1}),o.createElement(Oe._,{"aria-label":"Remove filter",icon:"times",variant:"secondary",onClick:u,type:"button"}))},Aa=null,Cr={availabilityResults:{label:"Availablity Results",description:"Availability test results."},dependencies:{label:"Dependencies",description:"Calls your application makes to other services such as databases or REST APIs."},customEvents:{label:"Custom Events",description:"Calls to TrackEvent that are inserted to monitor usage."},exceptions:{label:"Exceptions",description:"Exceptions that are logged via TrackException, or uncaught exceptions."},pageViews:{label:"Page Views",description:"Web client telemetry to create page view reports."},requests:{label:"Requests",description:"HTTP requests received by the application."},traces:{label:"Traces",description:"Diagnostic logs emitted using TrackTrace and similar methods. Note: Traces are not visualised if the result format is set to Trace"}},Ta={AppAvailabilityResults:"availabilityResults",AppDependencies:"dependencies",AppEvents:"events",AppExceptions:"exceptions",AppPageViews:"pageViews",AppRequests:"requests",AppTraces:"traces"},Ir=["operationId","duration","id","name","problemId","operation_ParentId","timestamp","customDimensions","operation_Name"],Re={appId:"ResourceGUID",application_Version:"AppVersion",appName:"_ResourceId",client_Browser:"ClientBrowser",client_City:"ClientCity",client_CountryOrRegion:"ClientCountryOrRegion",client_IP:"ClientIP",client_Model:"ClientModel",client_OS:"ClientOS",client_StateOrProvince:"ClientStateOrProvince",client_Type:"ClientType",cloud_RoleInstance:"AppRoleInstance",cloud_RoleName:"AppRoleName",customDimensions:"Properties",customMeasurements:"Measurements",duration:"DurationMs",id:"Id",iKey:"IKey",itemCount:"ItemCount",itemId:"_ItemId",itemType:"Type",name:"Name",operation_Id:"OperationId",operation_Name:"OperationName",operation_ParentId:"OperationParentId",operation_SyntheticSource:"OperationSyntheticSource",performanceBucket:"PerformanceBucket",sdkVersion:"SDKVersion",session_Id:"SessionId",success:"Success",timestamp:"TimeGenerated",user_AccountId:"UserAccountId",user_AuthenticatedId:"UserAuthenticatedId",user_Id:"UserId"},Dr={...Re,location:"Location",message:"Message",size:"Size"},Lr={...Re,data:"Data",resultCode:"ResultCode",target:"Target",type:"DependencyType"},Fr=(0,z.omit)(Re,["duration","id","success","performanceBucket"]),Gr=(0,z.omit)({...Re,url:"Url"},["success"]),Pr={resultCode:"ResultCode",source:"Source",url:"Url"},Qr=(0,z.omit)({...Re,assembly:"Assembly",details:"Details",handledAt:"HandledAt",innermostAssembly:"InnermostAssembly",innermostMessage:"InnermostMessage",innermostMethod:"InnermostMethod",innermostType:"InnermostType",message:"Message",method:"Method",outerAssembly:"OuterAssembly",outerMessage:"OuterMessage",outerMethod:"OuterMethod",outerType:"OuterType",problemId:"ProblemId",severityLevel:"SeverityLevel",type:"ExceptionType"},["duration","id","name","performanceBucket","success"]),xr=(0,z.omit)({message:"Message",severityLevel:"SeverityLevel"},["duration","id","name","performanceBucket","success"]),st={availabilityResults:Dr,dependencies:Lr,customEvents:Fr,exceptions:Qr,pageViews:Gr,requests:Pr,traces:xr},Na=Object.entries(st).reduce((t,[e,s])=>({...t,[e]:Object.keys((0,z.omit)(s,Ir)).join(",")}),{});function Vr(t,e){return{...t,azureTraces:{...t.azureTraces,operationId:e}}}function Or(t,e){return{...t,azureTraces:{...t.azureTraces,resultFormat:e}}}function Gt(t,e){return{...t,azureTraces:{...t.azureTraces,traceTypes:e}}}function $r(t,e){return{...t,azureTraces:{...t.azureTraces,filters:e}}}const Wr=({query:t,datasource:e,onQueryChange:s,variableOptionGroup:r,range:a})=>{const{azureTraces:i}=t,c=i?.traceTypes?i.traceTypes:Object.keys(st),n=new Set(["customDimensions","customMeasurements","details","duration","id","itemId","operation_Id","operation_ParentId","timestamp"]),l=(0,z.uniq)(c.map(p=>Object.keys(st[p])).flat()).filter(p=>!n.has(p)),[u,d]=(0,o.useState)(new Map),g=(0,o.useMemo)(()=>t.azureTraces?.filters??[],[t.azureTraces?.filters]),[w,h]=(0,o.useState)(g);(0,o.useEffect)(()=>{d(new Map)},[t.azureTraces?.resources,t.azureTraces?.traceTypes,t.azureTraces?.operationId]);const f=p=>{let b=!1;const y=p.map(k=>(k.property!==""&&k.filters&&k.filters.length>0&&k.operation!==""?b=!0:b=!1,{property:k.property??"",filters:k.filters??[],operation:k.operation??"eq"}));h(y),(b||g.length>0&&y.length===0)&&s($r(t,y))};return o.createElement(O.g,{label:"Filters"},o.createElement(Rt.k,{items:w,onChange:f,renderItem:Nr({query:t,datasource:e,propertyMap:u,setPropertyMap:d,queryTraceTypes:c,properties:l,variableOptionGroup:r,range:a})}))},Ur=({query:t,variableOptionGroup:e,onQueryChange:s})=>{const r=Object.entries(Cr).map(([n,l])=>({label:l.label,description:l.description,value:n})),a=(0,o.useCallback)(n=>{const l=Gt(t,n.map(u=>u.value??""));s(l)},[s,t]),i=(0,o.useMemo)(()=>[...r,e],[r,e]),c=()=>{const n=r.map(u=>u.value),l=Gt(t,n);return s(l),n};return o.createElement(X,{label:"Event Type"},o.createElement(D.NU,{placeholder:"Choose event types",inputId:"azure-monitor-traces-type-field",value:T([...r,...e.options],t.azureTraces?.traceTypes??c()),onChange:a,options:i,allowCustomValue:!0,isClearable:!0,"aria-label":N.components.queryEditor.tracesQueryEditor.traceTypes.select}))},jr=({query:t,datasource:e,subscriptionId:s,variableOptionGroup:r,onChange:a,setError:i,range:c})=>{const n=(h,f)=>{if(f.length===0)return!1;const p=j(h.uri,h.location).metricNamespace?.toLowerCase(),b=j(f[0].uri,f[0].location).metricNamespace?.toLowerCase();return p!==b},[l,u]=(0,o.useState)(t.azureTraces?.operationId??""),d=(0,kr.Z)(t.azureTraces?.operationId);(0,o.useEffect)(()=>{t.azureTraces?.operationId&&d!==t.azureTraces.operationId&&u(t.azureTraces.operationId)},[u,d,t,l]);const g=(0,o.useCallback)(h=>{h.target instanceof HTMLInputElement&&u(h.target.value)},[]),w=(0,o.useCallback)(h=>{const f=Vr(t,l);a(f)},[a,l,t]);return o.createElement("span",{"data-testid":N.components.queryEditor.tracesQueryEditor.container.input},o.createElement(Qe._,null,o.createElement(ee.p,null,o.createElement(te.s,null,o.createElement(Ye,{query:t,datasource:e,subscriptionId:s,variableOptionGroup:r,onQueryChange:a,setError:i,selectableEntryTypes:[I.Subscription,I.ResourceGroup,I.Resource,I.Variable],resources:t.azureTraces?.resources??[],queryType:"traces",disableRow:n,renderAdvanced:(h,f)=>o.createElement(St,{resources:h,onChange:f}),selectionNotice:()=>"You may only choose items of the same resource type.",range:c}))),o.createElement(ee.p,null,o.createElement(te.s,null,o.createElement(Ur,{datasource:e,onQueryChange:a,query:t,setError:i,variableOptionGroup:r,range:c}),o.createElement(X,{label:"Operation ID"},o.createElement(x.I,{id:"azure-monitor-traces-operation-id-field",value:l,onChange:g,onBlur:w,width:40})))),o.createElement(ee.p,null,o.createElement(te.s,null,o.createElement(Wr,{datasource:e,onQueryChange:a,query:t,setError:i,variableOptionGroup:r,range:c}))),o.createElement(ee.p,null,o.createElement(te.s,null,o.createElement(ft,{datasource:e,setError:i,query:t,variableOptionGroup:r,onQueryChange:a,inputId:"azure-monitor-traces",options:[{label:"Table",value:Z.Table},{label:"Trace",value:Z.Trace}],defaultValue:Z.Table,setFormatAs:Or,resultFormat:t.azureTraces?.resultFormat,range:c})))))};var Xr=v(52131),Br=v.n(Xr);const Hr="select";function rt(t){let e=t;return e.queryType||(e={...e,queryType:m.AzureMonitor}),e=Jr(e),e.queryType===m.AzureMonitor&&e.azureMonitor&&(e=Kr(e),e=Zr(e),e=Yr(e),e=qr(e),e=_r(e)),(e.azureMonitor?.resourceGroup||e.azureMonitor?.resourceName)&&(e=eo(e)),e.azureLogAnalytics?.resource&&(e={...e,azureLogAnalytics:{...e.azureLogAnalytics,resources:[e.azureLogAnalytics.resource]}},delete e.azureLogAnalytics?.resource),e.azureLogAnalytics&&e.azureLogAnalytics.dashboardTime===void 0&&(e.azureLogAnalytics.intersectTime?e={...e,azureLogAnalytics:{...e.azureLogAnalytics,dashboardTime:!0}}:e={...e,azureLogAnalytics:{...e.azureLogAnalytics,dashboardTime:!1}}),e}function Kr(t){let e=t;if(e.azureMonitor?.timeGrainUnit&&e.azureMonitor.timeGrain!=="auto"){const s=W.createISO8601Duration(e.azureMonitor.timeGrain??"auto",e.azureMonitor.timeGrainUnit);e=Mt(e,s),delete e.azureMonitor?.timeGrainUnit}return e}function Jr(t){let e=t;return e.azureLogAnalytics?.query?.match(/\$__from\s/gi)&&(e=qe(e,e.azureLogAnalytics.query.replace(/\$__from\s/gi,"$__timeFrom() "))),e.azureLogAnalytics?.query?.match(/\$__to\s/gi)&&(e=qe(e,e.azureLogAnalytics.query.replace(/\$__to\s/gi,"$__timeTo() "))),e}function Zr(t){return!(t.azureMonitor?.metricNamespace&&t.azureMonitor.metricNamespace!==Hr)&&t.azureMonitor?.metricDefinition?{...t,azureMonitor:{...t.azureMonitor,metricNamespace:t.azureMonitor.metricDefinition,metricDefinition:void 0}}:t}function Yr(t){let e=t;const s=e.azureMonitor?.dimension;return s&&s!=="None"&&(e=rr(e,s,"eq",[e.azureMonitor?.dimensionFilter||""])),delete e.azureMonitor?.dimension,delete e.azureMonitor?.dimensionFilter,e}function qr(t){const e=t.azureMonitor;if(!e)return t;const s=[],r=e.dimensionFilters;return r&&r.length>0&&(r.forEach(a=>{const i={dimension:a.dimension,operator:a.operator};if(!a.filters&&a.filter)s.push({...i,filters:[a.filter]});else{let c=!1;if(a.filters&&a.filter){for(const n of a.filters)if(a.filter===n){c=!0;break}!c&&a.filter!=="*"&&a.filters.push(a.filter),s.push({...i,filters:a.filters})}}}),s.length>0)?{...t,azureMonitor:{...e,dimensionFilters:s}}:t}function _r(t){if(t.azureMonitor?.resourceUri&&!t.azureMonitor.resourceUri.startsWith("$")){const e=j(t.azureMonitor.resourceUri),s=e?.subscription&&e?.resourceGroup&&e?.resourceName;return{...t,subscription:e?.subscription,azureMonitor:{...t.azureMonitor,resources:[{resourceGroup:e?.resourceGroup,resourceName:e?.resourceName}],metricNamespace:e?.metricNamespace,resourceUri:s?void 0:t.azureMonitor.resourceUri}}}return t}function eo(t){let e=t;return e.azureMonitor?.resourceGroup&&e.azureMonitor?.resourceName&&(e={...e,azureMonitor:{...e.azureMonitor,resources:[{resourceGroup:e.azureMonitor.resourceGroup,resourceName:e.azureMonitor.resourceName}]}},delete e.azureMonitor?.resourceGroup,delete e.azureMonitor?.resourceName),e}const to={queryType:m.AzureMonitor},so=t=>{const e=(0,z.defaults)({},t,to),s=rt(e);return Br()(s,t)?t:s},ro=(t,e)=>{const s=(0,o.useMemo)(()=>so(t),[t]);return(0,o.useEffect)(()=>{s!==t&&e(s)},[s,t,e]),s},oo=({query:t,datasource:e,onChange:s,onRunQuery:r,data:a,range:i})=>{const[c,n]=ut(),l=(0,o.useMemo)(()=>(0,z.debounce)(r,500),[r]),[u,d]=(0,o.useState)(!1),g=(0,o.useCallback)(p=>{s(p),l()},[s,l]),w=ro(t,g),h=w.subscription||e.azureMonitorDatasource.defaultSubscriptionId,f={label:"Template Variables",options:e.getVariables().map(p=>({label:p,value:p}))};return o.createElement("div",{"data-testid":"azure-monitor-query-editor"},o.createElement(Js,{datasource:e.azureLogAnalyticsDatasource,isOpen:u,onClose:()=>d(!1),onChange:p=>s({...p,queryType:m.LogAnalytics})}),o.createElement("div",{className:(0,S.css)({display:"flex",alignItems:"center"})},o.createElement(wr,{query:w,onQueryChange:g}),w.queryType===m.LogAnalytics&&o.createElement(_.zx,{"aria-label":"Azure logs kick start your query button",variant:"secondary",size:"sm",onClick:()=>{d(p=>!p),(0,Pe.ff)("grafana_azure_logs_query_patterns_opened",{version:"v2",editorMode:w.azureLogAnalytics})}},"Kick start your query")),o.createElement(ao,{data:a,subscriptionId:h,query:w,datasource:e,onChange:g,variableOptionGroup:f,setError:n,range:i}),c&&o.createElement(o.Fragment,null,o.createElement(H,{v:2}),o.createElement(J.b,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor"},c instanceof Error?c.message:c)))},ao=({data:t,subscriptionId:e,query:s,datasource:r,variableOptionGroup:a,onChange:i,setError:c,range:n})=>{switch(s.queryType){case m.AzureMonitor:return o.createElement(br,{data:t,query:s,datasource:r,onChange:i,variableOptionGroup:a,setError:c});case m.LogAnalytics:return o.createElement(Et,{data:t,subscriptionId:e,query:s,datasource:r,onChange:i,variableOptionGroup:a,setError:c,timeRange:n});case m.AzureResourceGraph:return o.createElement(dt,{subscriptionId:e,query:s,datasource:r,onChange:i,variableOptionGroup:a,setError:c});case m.AzureTraces:return o.createElement(jr,{subscriptionId:e,query:s,datasource:r,onChange:i,variableOptionGroup:a,setError:c,range:n});default:const l=s.queryType;return o.createElement(J.b,{title:"Unknown query type"},(l==="Application Insights"||l==="Insights Analytics")&&o.createElement(o.Fragment,null,l," was deprecated in Grafana 9. See the"," ",o.createElement("a",{href:"https://grafana.com/docs/grafana/latest/datasources/azuremonitor/deprecated-application-insights/",target:"_blank",rel:"noreferrer"},"deprecation notice")," ","to get more information about how to migrate your queries. This is the current query definition:",o.createElement(Xe.p,{height:"200px",readOnly:!0,language:"json",value:JSON.stringify(s,null,4)})))}},io=oo;var no=v(82846),co=v(21964),lo=v(98231),Pt=v(23757),Ce=v(32063);const uo=/([\w\W]+):([\w]+)(?:\s?=\s?([\w\W]+))?/;function mo(t){return t.functions?t.functions.map(e=>{const s=e.parameters&&e.parameters.split(", ").map(r=>{const a=r.match(uo);if(!a)return;const[,i,c,n]=a;return{name:i,type:c,defaultValue:n,cslDefaultValue:n}}).filter(r=>!!r);return{name:e.name,body:e.body,inputParameters:s||[]}}):[]}function po(t,e,s){const r={name:e,tables:t.tables,functions:mo(t),majorVersion:0,minorVersion:0};r.functions.push({name:"$__timeFilter",body:"{ true }",inputParameters:[{name:"timeColumn",type:"System.String",defaultValue:'""',cslDefaultValue:'""'}]},{name:"$__timeFrom",body:"{ datetime(2018-06-05T18:09:58.907Z) }",inputParameters:[]},{name:"$__timeTo",body:"{ datetime(2018-06-05T20:09:58.907Z) }",inputParameters:[]},{name:"$__escapeMulti",body:"{ @'\\grafana-vmNetwork(eth0)Total', @'\\hello!'}",inputParameters:[{name:"$myVar",type:"System.String",defaultValue:"$myVar",cslDefaultValue:"$myVar"}]},{name:"$__contains",body:"{ colName in ('value1','value2') }",inputParameters:[{name:"colName",type:"System.String",defaultValue:"colName",cslDefaultValue:"colName"},{name:"$myVar",type:"System.String",defaultValue:"$myVar",cslDefaultValue:"$myVar"}]});const a=s.map(i=>({name:`$${i.name}`,type:"dynamic"}));return{clusterType:"Engine",cluster:{connectionString:e,databases:[r]},database:r,globalScalarParameters:a}}class fo extends Ce.CK{constructor(e,s=(0,re.J)()){super(e),this.instanceSettings=e,this.templateSrv=s,this.resourcePath=`${F.logAnalytics}`,this.azureMonitorPath=`${F.azureMonitor}/subscriptions`;const r=lt(e);this.azurePortalUrl=ct(r),this.defaultSubscriptionId=this.instanceSettings.jsonData.subscriptionId||""}isConfigured(){return!this.validateDatasource()}filterQuery(e){return e.hide!==!0&&(!!e.azureLogAnalytics?.query&&(!!e.azureLogAnalytics.resources?.length||!!e.azureLogAnalytics.workspace)||!!e.azureTraces?.resources?.length)}async getSubscriptions(){if(!this.isConfigured())return[];const e=`${this.azureMonitorPath}?api-version=2019-03-01`;return await this.getResource(e).then(s=>Q.parseSubscriptions(s))}async getWorkspaces(e){const s=await this.getWorkspaceList(e);return(0,z.map)(s.value,r=>({text:r.name,value:r.id}))||[]}getWorkspaceList(e){const s=this.templateSrv.replace(e||this.defaultSubscriptionId),r=this.azureMonitorPath+`/${s}/providers/Microsoft.OperationalInsights/workspaces?api-version=2017-04-26-preview`;return this.getResource(r)}async getMetadata(e){const s=`${this.resourcePath}/v1${e}/metadata`;return await this.getResource(s)}async getKustoSchema(e){const s=this.templateSrv.replace(e,{},me),r=await this.getMetadata(s);return po(r,s,this.templateSrv.getVariables())}applyTemplateVariables(e,s){let r;if(e.queryType===m.LogAnalytics&&e.azureLogAnalytics){r=e.azureLogAnalytics;const a=this.expandResourcesForMultipleVariables(r.resources,s);let i=this.templateSrv.replace(r.workspace,s);!i&&!a&&this.firstWorkspace&&(i=this.firstWorkspace);const c=this.templateSrv.replace(r.query,s,me);return{...e,queryType:e.queryType||m.LogAnalytics,azureLogAnalytics:{resultFormat:r.resultFormat,query:c,resources:a,workspace:i,dashboardTime:r.dashboardTime,timeColumn:this.templateSrv.replace(r.timeColumn,s)}}}if(e.queryType===m.AzureTraces&&e.azureTraces){r=e.azureTraces;const a=this.expandResourcesForMultipleVariables(r.resources,s),i=this.templateSrv.replace(r.query,s,me),c=r.traceTypes?.map(l=>this.templateSrv.replace(l,s)),n=(r.filters??[]).filter(l=>!!l.property).map(l=>{const u=l.filters?.map(d=>this.templateSrv.replace(d??"",s));return{property:this.templateSrv.replace(l.property,s),operation:l.operation||"eq",filters:u||[]}});return{...e,queryType:e.queryType||m.AzureTraces,azureTraces:{resultFormat:r.resultFormat,query:i,resources:a,operationId:this.templateSrv.replace(e.azureTraces?.operationId,s),filters:n,traceTypes:c}}}return e}expandResourcesForMultipleVariables(e,s){if(!e)return;const r=[];return e.forEach(a=>{this.templateSrv.replace(a,s,"raw").split(",").forEach(n=>{r.push(n)})}),r}getDeprecatedDefaultWorkSpace(){return this.instanceSettings.jsonData.logAnalyticsDefaultWorkspace}async getDefaultOrFirstSubscription(){return this.defaultSubscriptionId?this.defaultSubscriptionId:(await this.getSubscriptions())[0]?.value}async getFirstWorkspace(){if(this.firstWorkspace)return this.firstWorkspace;const e=await this.getDefaultOrFirstSubscription();if(!e)return;const r=(await this.getWorkspaces(e))[0]?.value;return r&&(this.firstWorkspace=r),r}validateDatasource(){if(Ge(this.instanceSettings)==="clientsecret"){if(!this.isValidConfigField(this.instanceSettings.jsonData.tenantId))return{status:"error",message:"The Tenant Id field is required."};if(!this.isValidConfigField(this.instanceSettings.jsonData.clientId))return{status:"error",message:"The Client Id field is required."}}}isValidConfigField(e){return typeof e=="string"&&e.length>0}async getAzureLogAnalyticsCheatsheetQueries(){return await this.getResource(`${this.resourcePath}/v1/metadata`)}}const go="select";function we(t){return!!(t&&t!==go)}class ho extends Ce.CK{constructor(e,s=(0,re.J)()){super(e),this.instanceSettings=e,this.templateSrv=s,this.apiVersion="2018-01-01",this.apiPreviewVersion="2017-12-01-preview",this.listByResourceGroupApiVersion="2021-04-01",this.providerApiVersion="2021-04-01",this.locationsApiVersion="2020-01-01",this.defaultSubscriptionId=e.jsonData.subscriptionId;const r=lt(e);this.resourcePath=F.azureMonitor,this.azurePortalUrl=ct(r)}isConfigured(){return!this.validateDatasource()}filterQuery(e){const s=e?.azureMonitor?.resources&&e.azureMonitor.resources.length>0&&e.azureMonitor.resources.every(a=>we(a.resourceGroup)&&we(a.resourceName))&&we(e?.azureMonitor?.metricDefinition||e?.azureMonitor?.metricNamespace),r=we(e.azureMonitor?.resourceUri);return!!(e.hide!==!0&&(s||r)&&we(e?.azureMonitor?.metricName)&&we(e?.azureMonitor?.aggregation))}applyTemplateVariables(e,s){const r=e.azureMonitor;if(!r)throw new Error("Query is not a valid Azure Monitor Metrics query");r.resourceUri&&(r.resourceUri=this.templateSrv.replace(r.resourceUri,s)),r.metricDefinition&&(r.metricDefinition=this.templateSrv.replace(r.metricDefinition,s)),r.timeGrain&&r.timeGrainUnit&&r.timeGrain!=="auto"&&(r.timeGrain=W.createISO8601Duration(r.timeGrain,r.timeGrainUnit));const a=rt(e),i=a.azureMonitor;if(!i)throw new Error("Query is not a valid Azure Monitor Metrics query");const c=this.templateSrv.replace(a.subscription||this.defaultSubscriptionId,s),n=i.resources?.map(p=>this.replaceTemplateVariables(p,s)).flat(),l=this.templateSrv.replace(i.metricNamespace,s),u=this.templateSrv.replace(i.customNamespace,s),d=this.templateSrv.replace((i.timeGrain||"").toString(),s),g=this.templateSrv.replace(i.aggregation,s),w=this.templateSrv.replace(i.top||"",s),h=(i.dimensionFilters??[]).filter(p=>p.dimension&&p.dimension!=="None").map(p=>{const b=p.filters?.map(y=>this.templateSrv.replace(y??"",s));return{dimension:this.templateSrv.replace(p.dimension,s),operator:p.operator||"eq",filters:b||[]}}),f={...i,resources:n,metricNamespace:l,customNamespace:u,timeGrain:d,allowedTimeGrainsMs:i.allowedTimeGrainsMs,metricName:this.templateSrv.replace(i.metricName,s),region:this.templateSrv.replace(i.region,s),aggregation:g,dimensionFilters:h,top:w||"10",alias:i.alias};return{...e,subscription:c,queryType:m.AzureMonitor,azureMonitor:f}}async getSubscriptions(){return this.isConfigured()?this.getResource(`${this.resourcePath}/subscriptions?api-version=2019-03-01`).then(e=>Q.parseSubscriptions(e)):[]}getResourceGroups(e){return this.getResource(`${this.resourcePath}/subscriptions/${e}/resourceGroups?api-version=${this.listByResourceGroupApiVersion}`).then(s=>Q.parseResponseValues(s,"name","name"))}async getResourceNames(e,s){const r=this.replaceTemplateVariables(e).map(({metricNamespace:a,subscriptionId:i,resourceGroup:c,region:n})=>{const l=(0,z.startsWith)(a?.toLowerCase(),"microsoft.storage/storageaccounts/")?"microsoft.storage/storageaccounts":a;let u=`${this.resourcePath}/subscriptions/${i}`;c&&(u+=`/resourceGroups/${c}`),u+=`/resources?api-version=${this.listByResourceGroupApiVersion}`;const d=[];return l&&d.push(`resourceType eq '${l}'`),n&&d.push(`location eq '${n}'`),d.length>0&&(u+=`&$filter=${d.join(" and ")}`),s&&(u+=`&$skiptoken=${s}`),this.getResource(u).then(async g=>{let w=[];if((0,z.startsWith)(a?.toLowerCase(),"microsoft.storage/storageaccounts/")){w=Q.parseResourceNames(g,"microsoft.storage/storageaccounts");for(let h=0;h<w.length;h++)w[h].text+="/default",w[h].value+="/default"}else w=Q.parseResourceNames(g,a);if(g.nextLink){const f=new URL(g.nextLink).searchParams.get("$skiptoken");if(!f)throw Error("unable to request the next page of resources");const p=await this.getResourceNames({metricNamespace:a,subscriptionId:i,resourceGroup:c},f);w=w.concat(p)}return w})});return(await Promise.all(r)).flat()}getMetricNamespaces(e,s){const r=pe.buildAzureMonitorGetMetricNamespacesUrl(this.resourcePath,this.apiPreviewVersion,this.replaceSingleTemplateVariables(e),s,this.templateSrv);return this.getResource(r).then(a=>Q.parseResponseValues(a,"properties.metricNamespaceName","properties.metricNamespaceName")).then(a=>{if(r.toLowerCase().includes("microsoft.storage/storageaccounts")){const i=["microsoft.storage/storageaccounts","microsoft.storage/storageaccounts/blobservices","microsoft.storage/storageaccounts/fileservices","microsoft.storage/storageaccounts/tableservices","microsoft.storage/storageaccounts/queueservices"];for(const c of i)(0,z.find)(a,["value",c.toLowerCase()])||a.push({value:c,text:c})}return a})}getMetricNames(e,s,r){const a=s?this.apiPreviewVersion:this.apiVersion,i=pe.buildAzureMonitorGetMetricNamesUrl(this.resourcePath,a,this.replaceSingleTemplateVariables(e),this.templateSrv,s,r);return this.getResource(i).then(c=>Q.parseResponseValues(c,"name.localizedValue","name.value"))}getMetricMetadata(e,s,r){const{metricName:a}=e,i=s?this.apiPreviewVersion:this.apiVersion,c=pe.buildAzureMonitorGetMetricNamesUrl(this.resourcePath,i,this.replaceSingleTemplateVariables(e),this.templateSrv,s,r);return this.getResource(c).then(n=>Q.parseMetadata(n,this.templateSrv.replace(a)))}validateDatasource(){if(Ge(this.instanceSettings)==="clientsecret"){if(!this.isValidConfigField(this.instanceSettings.jsonData.tenantId))return{status:"error",message:"The Tenant Id field is required."};if(!this.isValidConfigField(this.instanceSettings.jsonData.clientId))return{status:"error",message:"The Client Id field is required."}}}isValidConfigField(e){return typeof e=="string"&&e.length>0}replaceSingleTemplateVariables(e,s){return this.replaceTemplateVariables(e,s)[0]}replaceTemplateVariables(e,s){const r=[{...e}];return Object.keys(e).forEach(i=>{const c=this.templateSrv.replace(r[0][i],s,"raw");if(c.includes(",")){const n=c.split(","),l=[...r];n.forEach((u,d)=>{l.forEach(g=>{d===0?g[i]=u:r.push({...g,[i]:u})})})}else r.forEach(n=>{n[i]=c})}),r}async getProvider(e){return await this.getResource(`${F.azureMonitor}/providers/${e}?api-version=${this.providerApiVersion}`)}async getLocations(e){const s=new Map;for(const r of e){const a=Q.parseLocations(await this.getResource(`${F.azureMonitor}/subscriptions/${this.templateSrv.replace(r)}/locations?api-version=${this.locationsApiVersion}`));for(const i of a)s.set(i.name,i)}return s}}class bo extends Ce.CK{filterQuery(e){return!!e.azureResourceGraph?.query&&!!e.subscriptions&&e.subscriptions.length>0}applyTemplateVariables(e,s){const r=(0,re.J)(),a=e.azureResourceGraph;if(!a)return e;const i=r.getVariables().map(d=>`$${d.name}`),c=be().find(e.subscriptions,d=>be().includes(i,d)),l=[...r.replace(c,s,d=>d).split(",").filter(d=>d.length>0),...be().filter(e.subscriptions,d=>!be().includes(i,d))],u=r.replace(a.query,s,me);return{...e,queryType:m.AzureResourceGraph,subscriptions:l,azureResourceGraph:{resultFormat:"table",query:u}}}}const vo="/providers/Microsoft.ResourceGraph/resources?api-version=2021-03-01",yo=qs.map(t=>`"${t}"`).join(",");class wo extends Ce.CK{constructor(e,s){super(e),this.resultLimit=200,this.supportedMetricNamespaces="",this.search=async(r,a)=>{let i="resources";a==="logs"&&(i+=`
      | union resourcecontainers`),i+=`
        | where id contains "${r}"
        ${await this.filterByType(a)}
        | order by tolower(name) asc
        | limit ${this.resultLimit}
      `;const{data:c}=await this.makeResourceGraphRequest(i);return c.map(n=>{const l=xe(n.id);if(!l||!(l.resourceName||l.resourceGroup||l.subscription))throw new Error("unable to fetch resource details");let u=l.subscription??"",d=I.Subscription;return l.resourceName?(u=l.resourceName,d=I.Resource):l.resourceGroup&&(u=l.resourceGroup,d=I.ResourceGroup),{name:n.name,id:u,uri:n.id,resourceGroupName:n.resourceGroup,type:d,typeLabel:et[n.type]||n.type,location:n.location}})},this.filterByType=async r=>(this.supportedMetricNamespaces===""&&r!=="logs"&&await this.fetchAllNamespaces(),r==="logs"?`| where type in (${yo})`:`| where type in (${this.supportedMetricNamespaces})`),this.resourcePath=`${F.resourceGraph}`,this.azureMonitorDatasource=s}async fetchInitialRows(e,s){const r=await this.getSubscriptions();if(!s)return r;let a=r;const i=s.map(c=>async()=>{if(c.subscription){const n=`/subscriptions/${c.subscription}/resourceGroups/${c.resourceGroup}`;if(c.resourceGroup&&!ye(a,n)){const u=await this.getResourceGroupsBySubscriptionId(c.subscription,e);a=Ze(a,`/subscriptions/${c.subscription}`,u)}const l=Ve(c);if(c.resourceName&&!ye(a,l)){const u=await this.getResourcesForResourceGroup(n,e);a=Ze(a,n,u)}}});for(const c of i)await c();return a}async fetchAndAppendNestedRow(e,s,r){const a=s.type===I.Subscription?await this.getResourceGroupsBySubscriptionId(s.id,r):await this.getResourcesForResourceGroup(s.id,r);return Ze(e,s.uri,a)}async getSubscriptions(){const e=`
    resources
    | join kind=inner (
              ResourceContainers
                | where type == 'microsoft.resources/subscriptions'
                | project subscriptionName=name, subscriptionURI=id, subscriptionId
              ) on subscriptionId
    | summarize count() by subscriptionName, subscriptionURI, subscriptionId
    | order by subscriptionName desc
  `;let s=[],r=!1,a;for(;!r;){let i={};a&&(i={$skipToken:a});const c=await this.makeResourceGraphRequest(e,1,i);if(!c.data.length)throw new Error("No subscriptions were found");s=s.concat(c.data),a=c.$skipToken,r=!a}return s.map(i=>({name:i.subscriptionName,id:i.subscriptionId,uri:`/subscriptions/${i.subscriptionId}`,typeLabel:"Subscription",type:I.Subscription,children:[]}))}async getResourceGroupsBySubscriptionId(e,s){const r=`
    resources
     | join kind=inner (
       ResourceContainers
       | where type == 'microsoft.resources/subscriptions/resourcegroups'
       | project resourceGroupURI=id, resourceGroupName=name, resourceGroup, subscriptionId
     ) on resourceGroup, subscriptionId

     ${await this.filterByType(s)}
     | where subscriptionId == '${e}'
     | summarize count() by resourceGroupName, resourceGroupURI
     | order by resourceGroupURI asc`;let a=[],i=!1,c;for(;!i;){let n={};c&&(n={$skipToken:c});const l=await this.makeResourceGraphRequest(r,1,n);a=a.concat(l.data),c=l.$skipToken,i=!c}return a.map(n=>{const l=xe(n.resourceGroupURI);if(!l||!l.resourceGroup)throw new Error("unable to fetch resource groups");return{name:n.resourceGroupName,uri:n.resourceGroupURI,id:l.resourceGroup,type:I.ResourceGroup,typeLabel:"Resource Group",children:[]}})}async getResourcesForResourceGroup(e,s){const{data:r}=await this.makeResourceGraphRequest(`
      resources
      | where id hasprefix "${e}"
      ${await this.filterByType(s)}
    `);return r.map(a=>{const i=xe(a.id);if(!i||!i.resourceName)throw new Error("unable to fetch resource details");return{name:a.name,id:i.resourceName,uri:a.id,resourceGroupName:a.resourceGroup,type:I.Resource,typeLabel:et[a.type]||a.type,locationDisplayName:a.location,location:a.location}})}async getResourceURIDisplayProperties(e){const{subscription:s,resourceGroup:r,resourceName:a}=j(e)??{};if(!s)throw new Error("Invalid resource URI passed");const i=`/subscriptions/${s}`,c=`${i}/resourceGroups/${r}`,n=`
    resourcecontainers
    | where type == "microsoft.resources/subscriptions"
    | where id =~ "${i}"
    | project subscriptionName=name, subscriptionId

    | join kind=leftouter (
      resourcecontainers            
            | where type == "microsoft.resources/subscriptions/resourcegroups"
            | where id =~ "${c}"
            | project resourceGroupName=name, resourceGroup, subscriptionId
        ) on subscriptionId

        | join kind=leftouter (
          resources
            | where id =~ "${e}"
            | project resourceName=name, subscriptionId
        ) on subscriptionId

        | project subscriptionName, resourceGroupName, resourceName
    `,{data:l}=await this.makeResourceGraphRequest(n);if(!l.length)throw new Error("unable to fetch resource details");const{subscriptionName:u,resourceGroupName:d,resourceName:g}=l[0];return{subscription:u||s,resourceGroup:d||r,resourceName:g||a}}async getResourceURIFromWorkspace(e){const{data:s}=await this.makeResourceGraphRequest(`
      resources
      | where properties['customerId'] == "${e}"
      | project id
    `);if(!s.length)throw new Error("unable to find resource for workspace "+e);return s[0].id}async makeResourceGraphRequest(e,s=1,r){try{return await this.postResource(this.resourcePath+vo,{query:e,options:{resultFormat:"objectArray",...r}})}catch(a){if(s>0)return this.makeResourceGraphRequest(e,s-1);throw a}}async fetchAllNamespaces(){const e=await this.getSubscriptions();(0,Pe.ff)("grafana_ds_azuremonitor_subscriptions_loaded",{subscriptions:e.length});let s=[];for await(const r of e){const a=await this.azureMonitorDatasource.getMetricNamespaces({resourceUri:`/subscriptions/${r.id}`},!0);if(a){const i=a.map(c=>`"${c.value.toLocaleLowerCase()}"`);s=s.concat(i)}}if(s.length===0)throw new Error("Unable to resolve a list of valid metric namespaces. Validate the datasource configuration is correct and required permissions have been granted for all subscriptions. Grafana requires at least the Reader role to be assigned.");this.supportedMetricNamespaces=(0,z.uniq)(s.concat(Ys.map(r=>`"${r}"`))).join(",")}parseRows(e){const s=de(e),r=[];return s.forEach((a,i)=>{let c=a.resourceName,n=a.resourceName,l=I.Resource;c||(c=a.resourceGroup,n=a.resourceGroup,l=I.ResourceGroup,c||(c=a.subscription,n=a.subscription,l=I.Subscription)),r.push({id:c??"",name:n??"",type:l,uri:Ve(a),typeLabel:et[a.metricNamespace?.toLowerCase()??""]??a.metricNamespace??"",location:a.region})}),r}}function ko(t){const e=typeof t.rawQuery=="string"?t.rawQuery:null,s=typeof t.workspace=="string"?t.workspace:null;if(!(e&&s&&!t.target?.azureLogAnalytics?.query))return t;const r={...t.target??{},refId:t.target?.refId??"Anno",queryType:m.LogAnalytics,azureLogAnalytics:{query:e,resources:[s]}};return{...t,rawQuery:void 0,workspace:void 0,subscription:void 0,queryType:void 0,target:r}}var So=v(16226),zo=v(23361),ce=v(45878);const Qt=t=>({subscriptions:t.match(/^Subscriptions\(\)/i),resourceGroups:t.match(/^ResourceGroups\(\)/i),resourceGroupsWithSub:t.match(/^ResourceGroups\(([^\)]+?)(,\s?([^,]+?))?\)/i),namespaces:t.match(/^Namespaces\(([^\)]+?)(,\s?([^,]+?))?\)/i),namespacesWithSub:t.match(/^Namespaces\(([^,]+?),\s?([^,]+?)\)/i),resourceNames:t.match(/^ResourceNames\(([^,]+?),\s?([^,]+?)\)/i),resourceNamesWithSub:t.match(/^ResourceNames\(([^,]+?),\s?([^,]+?),\s?(.+?)\)/i),metricNamespace:t.match(/^MetricNamespace\(([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNamespaceWithSub:t.match(/^metricnamespace\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNames:t.match(/^MetricNames\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNamesWithSub:t.match(/^MetricNames\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?(.+?)\)/i),appInsightsMetricNameQuery:t.match(/^AppInsightsMetricNames\(\)/i),appInsightsGroupByQuery:t.match(/^AppInsightsGroupBys\(([^\)]+?)(,\s?([^,]+?))?\)/i),workspacesQuery:t.match(/^workspaces\(\)/i),workspacesQueryWithSub:t.match(/^workspaces\(["']?([^\)]+?)["']?\)/i)}),Eo=t=>{const e=Qt(t);return Object.keys(e).some(s=>!!e[s])},Ao=(t,e)=>{const s=Qt(t),r=e.azureMonitorDatasource.defaultSubscriptionId,a=()=>s.appInsightsMetricNameQuery?{rawQuery:t,kind:"AppInsightsMetricNameQuery"}:s.appInsightsGroupByQuery?{kind:"AppInsightsGroupByQuery",rawQuery:t,metricName:s.appInsightsGroupByQuery[1]}:s.subscriptions?{kind:"SubscriptionsQuery",rawQuery:t}:s.resourceGroupsWithSub?{kind:"ResourceGroupsQuery",rawQuery:t,subscription:s.resourceGroupsWithSub[1]}:s.resourceGroups&&r?{kind:"ResourceGroupsQuery",rawQuery:t,subscription:r}:s.namespacesWithSub?{kind:"MetricNamespaceQuery",rawQuery:t,subscription:s.namespacesWithSub[1],resourceGroup:s.namespacesWithSub[2]}:s.namespaces&&r?{kind:"MetricNamespaceQuery",rawQuery:t,subscription:r,resourceGroup:s.namespaces[1]}:s.resourceNamesWithSub?{kind:"ResourceNamesQuery",rawQuery:t,subscription:s.resourceNamesWithSub[1],resourceGroup:s.resourceNamesWithSub[2],metricNamespace:s.resourceNamesWithSub[3]}:s.resourceNames&&r?{kind:"ResourceNamesQuery",rawQuery:t,subscription:r,resourceGroup:s.resourceNames[1],metricNamespace:s.resourceNames[2]}:s.metricNamespaceWithSub?{kind:"MetricNamespaceQuery",rawQuery:t,subscription:s.metricNamespaceWithSub[1],resourceGroup:s.metricNamespaceWithSub[2],metricNamespace:s.metricNamespaceWithSub[3],resourceName:s.metricNamespaceWithSub[4]}:s.metricNamespace&&r?{kind:"MetricNamespaceQuery",rawQuery:t,subscription:r,resourceGroup:s.metricNamespace[1],metricNamespace:s.metricNamespace[2],resourceName:s.metricNamespace[3]}:s.metricNames&&r&&s.metricNames[3].indexOf(",")===-1?{kind:"MetricNamesQuery",rawQuery:t,subscription:r,resourceGroup:s.metricNames[1],metricNamespace:s.metricNames[2],resourceName:s.metricNames[3]}:s.metricNamesWithSub?{kind:"MetricNamesQuery",rawQuery:t,subscription:s.metricNamesWithSub[1],resourceGroup:s.metricNamesWithSub[2],metricNamespace:s.metricNamesWithSub[3],resourceName:s.metricNamesWithSub[4]}:s.workspacesQueryWithSub?{kind:"WorkspacesQuery",rawQuery:t,subscription:(s.workspacesQueryWithSub[1]||"").trim()}:s.workspacesQuery&&r?{kind:"WorkspacesQuery",rawQuery:t,subscription:r}:{kind:"SubscriptionsQuery",rawQuery:t};return{refId:"A",queryType:m.GrafanaTemplateVariableFn,grafanaTemplateVariableFn:a(),subscription:r}},To=async(t,e)=>{const s=e.azureMonitorDatasource.defaultSubscriptionId;let r="";if(t){const a=e.azureLogAnalyticsDatasource.getDeprecatedDefaultWorkSpace();a?bt(a)?r=await e.resourcePickerData.getResourceURIFromWorkspace(a):r=a:r=await e.azureLogAnalyticsDatasource.getFirstWorkspace()||""}return{refId:"A",queryType:m.LogAnalytics,azureLogAnalytics:{query:t,resources:r?[r]:[]},subscription:s}},No=t=>{const{queryType:e,grafanaTemplateVariableFn:s}=t;if(e!==m.GrafanaTemplateVariableFn||!s)return t;const r={...t};switch("subscription"in s&&(r.subscription=s.subscription),"resourceGroup"in s&&(r.resourceGroup=s.resourceGroup),"metricNamespace"in s&&(r.namespace=s.metricNamespace),"resourceName"in s&&(r.resource=s.resourceName),s.kind){case"SubscriptionsQuery":r.queryType=m.SubscriptionsQuery;break;case"ResourceGroupsQuery":r.queryType=m.ResourceGroupsQuery;break;case"ResourceNamesQuery":r.queryType=m.ResourceNamesQuery;break;case"MetricNamespaceQuery":r.queryType=m.NamespacesQuery;break;case"MetricDefinitionsQuery":r.queryType=m.NamespacesQuery;break;case"MetricNamesQuery":r.queryType=m.MetricNamesQuery;break;case"WorkspacesQuery":r.queryType=m.WorkspacesQuery;break}return r},xt=async(t,e)=>typeof t!="string"?t:Eo(t)?Ao(t,e.datasource):To(t,e.datasource),Vt=async(t,e)=>{let s=await xt(t,e);return s.queryType===m.GrafanaTemplateVariableFn&&(s=No(s)),s},Mo=({query:t,updateQuery:e,datasource:s})=>{const[r,a]=(0,o.useState)("");(0,o.useEffect)(()=>{a(t.grafanaTemplateVariableFn?.rawQuery||"")},[t.grafanaTemplateVariableFn?.rawQuery]);const i=(0,o.useCallback)(n=>{xt(n,{datasource:s}).then(l=>{l.queryType===m.GrafanaTemplateVariableFn?e(l):e({...t,grafanaTemplateVariableFn:{kind:"UnknownQuery",rawQuery:n}})})},[s,t,e]),c=n=>{a(n.target.value)};return o.createElement(oe._,{label:"Grafana template variable function"},o.createElement(x.I,{placeholder:"type a grafana template variable function, ex: Subscriptions()",value:r,onChange:c,onBlur:()=>i(r)}))},Ot={label:"-",value:""},Ro=t=>{const{query:e,onChange:s,datasource:r}=t,a=[{label:"Subscriptions",value:m.SubscriptionsQuery},{label:"Resource Groups",value:m.ResourceGroupsQuery},{label:"Namespaces",value:m.NamespacesQuery},{label:"Regions",value:m.LocationsQuery},{label:"Resource Names",value:m.ResourceNamesQuery},{label:"Metric Names",value:m.MetricNamesQuery},{label:"Workspaces",value:m.WorkspacesQuery},{label:"Resource Graph",value:m.AzureResourceGraph},{label:"Logs",value:m.LogAnalytics}];typeof t.query=="object"&&t.query.queryType===m.GrafanaTemplateVariableFn&&a.push({label:"Grafana Query Function",value:m.GrafanaTemplateVariableFn});const[i,c]=(0,o.useState)({label:"Template Variables",options:[]}),[n,l]=(0,o.useState)(!1),[u,d]=(0,o.useState)(!1),[g,w]=(0,o.useState)(!1),[h,f]=(0,o.useState)(!1),[p,b]=(0,o.useState)(!1),[y,k]=(0,o.useState)(!1),[E,L]=(0,o.useState)(!1),[V,le]=(0,o.useState)([]),[se,Ie]=(0,o.useState)([]),[De,Ue]=(0,o.useState)([]),[ot,at]=(0,o.useState)([]),[A,P]=(0,o.useState)([]),[$,ke]=ut(),fe=typeof e=="string"?"":e.queryType;(0,o.useEffect)(()=>{Vt(e,{datasource:r}).then(M=>{(0,z.isEqual)(e,M)||s(M)})},[e,r,s]),(0,o.useEffect)(()=>{switch(l(!1),d(!1),w(!1),b(!1),k(!1),L(!1),fe){case m.ResourceGroupsQuery:case m.WorkspacesQuery:l(!0);break;case m.NamespacesQuery:l(!0),d(!0);break;case m.ResourceNamesQuery:l(!0),d(!0),w(!0),f(!0);break;case m.MetricNamesQuery:l(!0),b(!0),k(!0),L(!0);break;case m.LocationsQuery:l(!0);break}},[fe]),(0,o.useEffect)(()=>{const M=[];r.getVariablesRaw().forEach(G=>{(0,z.get)(G,"query.queryType")!==fe&&M.push({label:G.label||G.name,value:`$${G.name}`})}),c({label:"Template Variables",options:M})},[r,fe]),(0,Be.Z)(()=>{r.getSubscriptions().then(M=>{le(M.map(G=>({label:G.text,value:G.value})))})});const K=typeof e=="object"&&e.subscription;(0,o.useEffect)(()=>{K&&r.getResourceGroups(K).then(M=>{Ie(M.map(G=>({label:G.text,value:G.value})))})},[r,K]);const Le=typeof e=="object"&&e.resourceGroup||"";(0,o.useEffect)(()=>{K&&r.getMetricNamespaces(K,Le).then(M=>{Ue(M.map(G=>({label:G.text,value:G.value})))})},[r,K,Le]),(0,o.useEffect)(()=>{K&&r.azureMonitorDatasource.getLocations([K]).then(M=>{const G=[];M.forEach(Ut=>G.push({label:Ut.displayName,value:Ut.name})),P(G)})},[r,K,Le]);const $t=typeof e=="object"&&e.namespace||"";if((0,o.useEffect)(()=>{K&&r.getResourceNames(K,Le,$t).then(M=>{at(M.map(G=>({label:G.text,value:G.value})))})},[r,K,Le,$t]),typeof e=="string")return null;const Po=M=>{M.value&&s({...e,queryType:M.value,subscription:void 0,resourceGroup:void 0,namespace:void 0,resource:void 0})},Qo=M=>{M.value&&s({...e,subscription:M.value,resourceGroup:void 0,namespace:void 0,resource:void 0})},xo=M=>{s({...e,resourceGroup:M.value,namespace:void 0,resource:void 0})},Vo=M=>{s({...e,namespace:M.value,resource:void 0})},Oo=M=>{s({...e,region:M.value})},$o=M=>{s({...e,resource:M.value})},Wt=M=>{s(M)};return o.createElement(o.Fragment,null,o.createElement(O.g,{label:"Query Type","data-testid":N.components.variableEditor.queryType.input},o.createElement(D.Ph,{"aria-label":"select query type",onChange:Po,options:a,width:25,value:fe})),e.queryType===m.LogAnalytics&&o.createElement(o.Fragment,null,o.createElement(Et,{subscriptionId:e.subscription,query:e,datasource:r,onChange:Wt,variableOptionGroup:i,setError:ke,hideFormatAs:!0}),$&&o.createElement(o.Fragment,null,o.createElement(H,{v:2}),o.createElement(J.b,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor"},$ instanceof Error?$.message:$))),e.queryType===m.GrafanaTemplateVariableFn&&o.createElement(Mo,{query:e,updateQuery:t.onChange,datasource:r}),n&&o.createElement(O.g,{label:"Subscription","data-testid":N.components.variableEditor.subscription.input},o.createElement(D.Ph,{"aria-label":"select subscription",onChange:Qo,options:V.concat(i),width:25,value:e.subscription||null})),(p||u)&&o.createElement(O.g,{label:"Resource Group","data-testid":N.components.variableEditor.resourceGroup.input},o.createElement(D.Ph,{"aria-label":"select resource group",onChange:xo,options:p?se.concat(i):se.concat(i,Ot),width:25,value:e.resourceGroup||null,placeholder:p?void 0:"Optional"})),(y||g)&&o.createElement(O.g,{label:"Namespace","data-testid":N.components.variableEditor.namespace.input},o.createElement(D.Ph,{"aria-label":"select namespace",onChange:Vo,options:y?De.concat(i):De.concat(i,Ot),width:25,value:e.namespace||null,placeholder:y?void 0:"Optional"})),h&&o.createElement(O.g,{label:"Region","data-testid":N.components.variableEditor.region.input},o.createElement(D.Ph,{"aria-label":"select region",onChange:Oo,options:A.concat(i),width:25,value:e.region||null,placeholder:"Optional"})),E&&o.createElement(O.g,{label:"Resource","data-testid":N.components.variableEditor.resource.input},o.createElement(D.Ph,{"aria-label":"select resource",onChange:$o,options:ot.concat(i),width:25,value:e.resource||null})),e.queryType===m.AzureResourceGraph&&o.createElement(o.Fragment,null,o.createElement(dt,{subscriptionId:r.azureLogAnalyticsDatasource.defaultSubscriptionId,query:e,datasource:r,onChange:Wt,variableOptionGroup:i,setError:ke}),$&&o.createElement(o.Fragment,null,o.createElement(H,{v:2}),o.createElement(J.b,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor"},$ instanceof Error?$.message:$))))};class Co extends zo.Mg{constructor(e,s=(0,re.J)()){super(),this.datasource=e,this.templateSrv=s,this.editor=Ro,this.datasource=e}hasValue(...e){return e.every(s=>!!this.templateSrv.replace(s))}query(e){const s=async()=>{const r=await Vt(e.targets[0],{datasource:this.datasource});try{switch(r.queryType){case m.SubscriptionsQuery:const a=await this.datasource.getSubscriptions();return{data:a?.length?[(0,ce.g0)(a)]:[]};case m.ResourceGroupsQuery:if(r.subscription&&this.hasValue(r.subscription)){const c=await this.datasource.getResourceGroups(r.subscription);return{data:c?.length?[(0,ce.g0)(c)]:[]}}return{data:[]};case m.NamespacesQuery:if(r.subscription&&this.hasValue(r.subscription)){const c=await this.datasource.getMetricNamespaces(r.subscription,r.resourceGroup);return{data:c?.length?[(0,ce.g0)(c)]:[]}}return{data:[]};case m.ResourceNamesQuery:if(r.subscription&&this.hasValue(r.subscription)){const c=await this.datasource.getResourceNames(r.subscription,r.resourceGroup,r.namespace,r.region);return{data:c?.length?[(0,ce.g0)(c)]:[]}}return{data:[]};case m.MetricNamesQuery:if(r.subscription&&r.resourceGroup&&r.namespace&&r.resource&&this.hasValue(r.subscription,r.resourceGroup,r.namespace,r.resource)){const c=await this.datasource.getMetricNames(r.subscription,r.resourceGroup,r.namespace,r.resource);return{data:c?.length?[(0,ce.g0)(c)]:[]}}return{data:[]};case m.WorkspacesQuery:if(r.subscription&&this.hasValue(r.subscription)){const c=await this.datasource.getAzureLogAnalyticsWorkspaces(r.subscription);return{data:c?.length?[(0,ce.g0)(c)]:[]}}return{data:[]};case m.GrafanaTemplateVariableFn:if(r.grafanaTemplateVariableFn){const c=await this.callGrafanaTemplateVariableFn(r.grafanaTemplateVariableFn);return{data:c?.length?[(0,ce.g0)(c)]:[]}}return{data:[]};case m.LocationsQuery:if(r.subscription&&this.hasValue(r.subscription)){const c=await this.datasource.azureMonitorDatasource.getLocations([r.subscription]),n=[];return c.forEach(l=>{n.push({text:l.displayName,value:l.name})}),{data:n?.length?[(0,ce.g0)(n)]:[]}}default:e.targets[0]=r;const i=await(0,Ft.n)(this.datasource.query(e));return{data:i.data,error:i.error?new Error(ve(i.error)):void 0}}}catch(a){return{data:[],error:new Error(ve(a))}}};return(0,So.D)(s())}callGrafanaTemplateVariableFn(e){return e.kind==="SubscriptionsQuery"?this.datasource.getSubscriptions():e.kind==="ResourceGroupsQuery"?this.datasource.getResourceGroups(this.replaceVariable(e.subscription)):e.kind==="ResourceNamesQuery"?this.datasource.getResourceNames(this.replaceVariable(e.subscription),this.replaceVariable(e.resourceGroup),this.replaceVariable(e.metricNamespace)):e.kind==="MetricNamespaceQuery"?this.datasource.azureMonitorDatasource.getMetricNamespaces(e,!0):e.kind==="MetricNamesQuery"?this.datasource.azureMonitorDatasource.getMetricNames(e):e.kind==="WorkspacesQuery"?this.datasource.azureLogAnalyticsDatasource.getWorkspaces(this.replaceVariable(e.subscription)):null}replaceVariable(e){return this.templateSrv.replace((e||"").trim())}}class Io extends Ce.CK{constructor(e,s=(0,re.J)()){super(e),this.templateSrv=s,this.annotations={prepareAnnotation:ko},this.pseudoDatasource={},this.azureMonitorDatasource=new ho(e),this.azureLogAnalyticsDatasource=new fo(e),this.azureResourceGraphDatasource=new bo(e),this.resourcePickerData=new wo(e,this.azureMonitorDatasource),this.pseudoDatasource={[m.AzureMonitor]:this.azureMonitorDatasource,[m.LogAnalytics]:this.azureLogAnalyticsDatasource,[m.AzureResourceGraph]:this.azureResourceGraphDatasource},this.variables=new Co(this)}filterQuery(e){return e.queryType?this.pseudoDatasource[e.queryType]?.filterQuery?.(e)??!0:!1}query(e){const s=new Map;for(const a of e.targets){const i=rt(a);if(!i.queryType||i.hide||!Do(i))continue;if(!s.has(i.queryType)){const n=(0,z.cloneDeep)(e);n.requestId=`${n.requestId}-${i.refId}`,n.targets=[],s.set(i.queryType,n)}s.get(i.queryType)?.targets.push(i)}const r=Array.from(s.entries()).map(([a,i])=>{const c=a===m.AzureTraces?m.LogAnalytics:a,n=this.pseudoDatasource[c];if(!n)throw new Error("Data source not created for query type "+a);return n.query(i)});return r.length===1?r[0]:r.length>1?(0,no.D)(r).pipe((0,lo.U)(a=>{const i=[];for(const c of a)for(const n of c.data)i.push(n);return{state:Pt.Gu.Done,data:i}})):(0,co.of)({state:Pt.Gu.Done,data:[]})}targetContainsTemplate(e){if(e.subscription&&this.templateSrv.containsTemplate(e.subscription))return!0;let s;return e.queryType===m.AzureMonitor?s=JSON.stringify(e.azureMonitor):e.queryType===m.LogAnalytics?s=JSON.stringify(e.azureLogAnalytics):e.queryType===m.AzureResourceGraph&&(s=JSON.stringify([e.azureResourceGraph,e.subscriptions])),!!s&&this.templateSrv.containsTemplate(s)}getResourceGroups(e){return this.azureMonitorDatasource.getResourceGroups(this.templateSrv.replace(e))}getMetricNamespaces(e,s){let r=`/subscriptions/${e}`;return s&&(r+=`/resourceGroups/${s};`),this.azureMonitorDatasource.getMetricNamespaces({resourceUri:r},!0)}getResourceNames(e,s,r,a){return this.azureMonitorDatasource.getResourceNames({subscriptionId:e,resourceGroup:s,metricNamespace:r,region:a})}getMetricNames(e,s,r,a){return this.azureMonitorDatasource.getMetricNames({subscription:e,resourceGroup:s,metricNamespace:r,resourceName:a})}getAzureLogAnalyticsWorkspaces(e){return this.azureLogAnalyticsDatasource.getWorkspaces(e)}getSubscriptions(){return this.azureMonitorDatasource.getSubscriptions()}interpolateVariablesInQueries(e,s){return e.map(a=>{if(!a.queryType)return a;const i=a.queryType===m.AzureTraces?m.LogAnalytics:a.queryType,c=this.pseudoDatasource[i];return{datasource:c?.getRef(),...c?.applyTemplateVariables(a,s)??a}})}getVariables(){return this.templateSrv.getVariables().map(e=>`$${e.name}`)}getVariablesRaw(){return this.templateSrv.getVariables()}modifyQuery(e,s){if(!s.options)return e;let r=e.azureLogAnalytics?.query;if(r===void 0)return e;switch(s.type){case"ADD_FILTER":{r+=`
| where ${s.options.key} == "${s.options.value}"`;break}case"ADD_FILTER_OUT":{r+=`
| where ${s.options.key} != "${s.options.value}"`;break}}return{...e,azureLogAnalytics:{...e.azureLogAnalytics,query:r}}}}function Do(t){switch(t.queryType){case m.AzureMonitor:return!!t.azureMonitor;case m.LogAnalytics:return!!t.azureLogAnalytics;case m.AzureResourceGraph:return!!t.azureResourceGraph;case m.AzureTraces:return!!t.azureTraces;case m.GrafanaTemplateVariableFn:return!!t.grafanaTemplateVariableFn;default:return!1}}var Lo=v(40507);const Fo=t=>{(0,Pe.ff)("grafana_ds_azuremonitor_dashboard_loaded",t)},Go=new Y.hf(Io).setConfigEditor(_t).setQueryEditor(io);(0,ue.N$)().subscribe(q.Pl,({payload:{dashboardId:t,orgId:e,userId:s,grafanaVersion:r,queries:a}})=>{const i=a[Lo.id],c={hidden:0,visible:0,multiResource:0,count:0};let n={[m.AzureMonitor]:{...c},[m.LogAnalytics]:{...c,grafanaTime:0,queryTime:0},[m.AzureResourceGraph]:{...c},[m.AzureTraces]:{...c,table:0,trace:0,operationIdSpecified:0,eventTypesSpecified:0,filtersSpecified:0},[m.SubscriptionsQuery]:{...c},[m.ResourceGroupsQuery]:{...c},[m.NamespacesQuery]:{...c},[m.ResourceNamesQuery]:{...c},[m.MetricNamesQuery]:{...c},[m.WorkspacesQuery]:{...c},[m.GrafanaTemplateVariableFn]:{...c},[m.LocationsQuery]:{...c},unknown:{...c}};i.forEach(l=>{switch(l.queryType===m.AzureMonitor&&(n[m.AzureMonitor][l.hide?"hidden":"visible"]++,l.azureMonitor?.resources&&l.azureMonitor.resources.length>1&&n[m.AzureMonitor].multiResource++),l.queryType===m.LogAnalytics&&(n[m.LogAnalytics][l.hide?"hidden":"visible"]++,n[m.LogAnalytics][l.azureLogAnalytics?.dashboardTime?"grafanaTime":"queryTime"]++,l.azureLogAnalytics?.resources&&l.azureLogAnalytics.resources.length>1&&n[m.LogAnalytics].multiResource++),l.queryType===m.AzureResourceGraph&&(n[m.AzureResourceGraph][l.hide?"hidden":"visible"]++,l.subscriptions&&l.subscriptions.length>1&&n[m.AzureResourceGraph].multiResource++),l.queryType===m.AzureTraces&&(n[m.AzureTraces][l.hide?"hidden":"visible"]++,l.azureTraces&&(l.azureTraces.resultFormat&&n[m.AzureTraces][l.azureTraces.resultFormat===Z.Trace?Z.Trace:Z.Table]++,l.azureTraces.resources&&l.azureTraces.resources.length>1&&n[m.AzureTraces].multiResource++,l.azureTraces.operationId&&l.azureTraces.operationId!==""&&n[m.AzureTraces].operationIdSpecified++,l.azureTraces.traceTypes&&l.azureTraces.traceTypes.length>0&&n[m.AzureTraces].eventTypesSpecified++,l.azureTraces.filters&&l.azureTraces.filters.length>0&&n[m.AzureTraces].filtersSpecified++)),l.queryType){case m.AzureMonitor:case m.LogAnalytics:case m.AzureResourceGraph:case m.AzureTraces:case m.SubscriptionsQuery:case m.ResourceGroupsQuery:case m.NamespacesQuery:case m.ResourceNamesQuery:case m.MetricNamesQuery:case m.WorkspacesQuery:case m.GrafanaTemplateVariableFn:case m.LocationsQuery:n[l.queryType].count++;break;default:n.unknown.count++}}),i&&i.length>0&&Fo({grafana_version:r,dashboard_id:t,org_id:e,azure_monitor_queries:n[m.AzureMonitor].visible,azure_monitor_queries_hidden:n[m.AzureMonitor].hidden,azure_monitor_multiple_resource:n[m.AzureMonitor].multiResource,azure_monitor_query:n[m.AzureMonitor].count,azure_log_analytics_queries:n[m.LogAnalytics].visible,azure_log_analytics_queries_hidden:n[m.LogAnalytics].hidden,azure_log_multiple_resource:n[m.LogAnalytics].multiResource,azure_log_analytics_queries_grafana_time:n[m.LogAnalytics].grafanaTime,azure_log_analytics_queries_query_time:n[m.LogAnalytics].queryTime,azure_log_query:n[m.LogAnalytics].count,azure_resource_graph_queries:n[m.AzureResourceGraph].visible,azure_resource_graph_queries_hidden:n[m.AzureResourceGraph].hidden,azure_resource_graph_multiple_subscription:n[m.AzureResourceGraph].multiResource,azure_resource_graph_query:n[m.AzureResourceGraph].count,azure_traces_queries:n[m.AzureTraces].visible,azure_traces_queries_hidden:n[m.AzureTraces].hidden,azure_traces_multiple_resource:n[m.AzureTraces].multiResource,azure_traces_table:n[m.AzureTraces].table,azure_traces_trace:n[m.AzureTraces].trace,azure_traces_operation_id_specified:n[m.AzureTraces].operationIdSpecified,azure_traces_event_type_specified:n[m.AzureTraces].eventTypesSpecified,azure_traces_filters:n[m.AzureTraces].filtersSpecified,azure_traces_query:n[m.AzureTraces].count,azure_subscriptions_query:n[m.SubscriptionsQuery].count,azure_resource_groups_query:n[m.ResourceGroupsQuery].count,azure_namespaces_query:n[m.NamespacesQuery].count,azure_resource_names_query:n[m.ResourceNamesQuery].count,azure_metric_names_query:n[m.MetricNamesQuery].count,azure_workspaces_query:n[m.WorkspacesQuery].count,azure_grafana_template_variable_query:n[m.GrafanaTemplateVariableFn].count,azure_locations_query:n[m.LocationsQuery].count,azure_unknown_query:n.unknown.count})})},72555:()=>{}}]);

//# sourceMappingURL=642.40d1c0904ca59223600e.js.map