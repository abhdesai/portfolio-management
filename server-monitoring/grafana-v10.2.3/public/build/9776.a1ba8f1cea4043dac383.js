"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9776],{84237:(z,O,t)=>{t.d(O,{C0:()=>N,Uv:()=>R,Xq:()=>M});var e=t(85960),U=t(49199),f=t(67192),R=(c=>(c.ContactPoint="contact point",c.Template="template",c.MuteTiming="mute timing",c.AlertRule="alert rule",c.RootNotificationPolicy="root notification policy",c))(R||{});const M=({resource:c})=>e.createElement(U.b,{title:`This ${c} cannot be edited through the UI`,severity:"info"},"This ",c," has been provisioned, that means it was created by config. Please contact your server admin to update this ",c,"."),N=()=>e.createElement(f.C,{text:"Provisioned",color:"purple"})},99776:(z,O,t)=>{t.r(O),t.d(O,{default:()=>L});var e=t(85960),U=t(79468),f=t(13086),R=t(29165),M=t(97666),N=t(49199),c=t(70523),B=t(94439),T=t(10305),u=t(40377),h=t(25119),H=t(95454),J=t(6005);function Q(r){const{chrome:o}=(0,J.p)();(0,e.useLayoutEffect)(()=>{r?.name&&o.update({pageNav:{text:r.name}})},[o,r]),r&&(document.title=`${r.name} - Alerting - ${H.c.AppTitle}`)}var b=t(94498),$=t(60956),x=t(9001),F=t(66681),I=t(47257),W=t(14607);const n=r=>{const o=(0,I.wW)(a,r);return e.createElement(W.u,{content:String(r.state),placement:"top"},e.createElement("div",{className:o.dot}))},a=(r,o)=>{const i=r.spacing(1.25);return{dot:(0,F.css)`
      width: ${i};
      height: ${i};

      border-radius: 100%;

      background-color: ${r.colors.secondary.main};
      outline: solid calc(${i} / 2.5) ${r.colors.secondary.transparent};

      ${o.state===h.bj.Normal&&(0,F.css)`
        background-color: ${r.colors.success.main};
        outline-color: ${r.colors.success.transparent};
      `}

      ${o.state===h.bj.Pending&&(0,F.css)`
        background-color: ${r.colors.warning.main};
        outline-color: ${r.colors.warning.transparent};
      `}

      ${o.state===h.bj.Alerting&&(0,F.css)`
        background-color: ${r.colors.error.main};
        outline-color: ${r.colors.error.transparent};
      `}
    `}};var s=t(84237),l=t(99586);const v=()=>e.createElement(e.Fragment,null,"History"),m=()=>e.createElement(e.Fragment,null,"Instances"),E=()=>e.createElement(e.Fragment,null,"Query results"),D=()=>e.createElement(e.Fragment,null,"Routing");var g=(r=>(r[r.Instances=0]="Instances",r[r.Query=1]="Query",r[r.Routing=2]="Routing",r[r.History=3]="History",r))(g||{});const P=({match:r})=>{const[o,i]=(0,e.useState)(0),y=$.s4(r.params),p=(0,e.useMemo)(()=>{if(!y)throw new Error("Rule ID is required");return $.Qc(y,!0)},[y]),{loading:C,error:A,result:d}=(0,b.HO)({ruleIdentifier:p});if(Q(d),C)return e.createElement(U.u,{text:"Loading..."});if(A)return String(A);if(d){const j=d.annotations.summary,V=d.promRule,Y=(0,x.x_)(V)?V.alerts?.length:void 0,X=(0,x.Jq)(d.group),Z=(0,x.Pc)(d.rulerRule)&&!!d.rulerRule.grafana_alert.provenance;return e.createElement(e.Fragment,null,e.createElement(f.K,{direction:"column",gap:3},e.createElement(f.K,null,e.createElement(S,{folder:d.namespace.name,evaluationGroup:d.group.name}),e.createElement(l.L,null),e.createElement(f.K,{gap:1},e.createElement(R.zx,{variant:"secondary",icon:"pen"},"Edit"),e.createElement(R.zx,{variant:"secondary"},e.createElement(f.K,{alignItems:"center",gap:1},"More ",e.createElement(M.J,{name:"angle-down"}))))),e.createElement(f.K,{direction:"column",gap:1},e.createElement(f.K,{alignItems:"center"},e.createElement(G,{name:d.name,state:h.bj.Alerting})),j&&e.createElement(K,{text:j})),X&&e.createElement(N.b,{severity:"info",title:"This rule is part of a federated rule group."},e.createElement(f.K,{direction:"column"},"Federated rule groups are currently an experimental feature.",e.createElement(R.zx,{fill:"text",icon:"book"},e.createElement("a",{href:"https://grafana.com/docs/metrics-enterprise/latest/tenant-management/tenant-federation/#cross-tenant-alerting-and-recording-rule-federation"},"Read documentation")))),Z&&e.createElement(s.Xq,{resource:s.Uv.AlertRule}),e.createElement(c.J,null,e.createElement(B.O,{label:"Instances",active:!0,counter:Y,onChangeTab:()=>i(0)}),e.createElement(B.O,{label:"Query",onChangeTab:()=>i(1)}),e.createElement(B.O,{label:"Routing",onChangeTab:()=>i(2)}),e.createElement(B.O,{label:"History",onChangeTab:()=>i(3)})),e.createElement(T.I,null,o===0&&e.createElement(m,null),o===1&&e.createElement(E,null),o===2&&e.createElement(D,null),o===3&&e.createElement(v,null))))}return null},S=({folder:r,evaluationGroup:o})=>e.createElement(f.K,{alignItems:"center",gap:.5},e.createElement(u.x,{color:"secondary"},e.createElement(M.J,{name:"folder"})),e.createElement(u.x,{variant:"body",color:"primary"},r),e.createElement(u.x,{variant:"body",color:"secondary"},e.createElement(M.J,{name:"angle-right"})),e.createElement(u.x,{variant:"body",color:"primary"},o)),G=({name:r,state:o})=>e.createElement("header",null,e.createElement(f.K,{alignItems:"center",gap:1},e.createElement(n,{size:"md",state:o}),e.createElement(u.x,{element:"h1",variant:"h2",weight:"bold"},r))),K=({text:r})=>e.createElement(u.x,{variant:"body",color:"secondary"},r),L=P},94498:(z,O,t)=>{t.d(O,{F3:()=>Q,HO:()=>x,eq:()=>W});var e=t(85960),U=t(81445),f=t(95162),R=t(14411),M=t(80679),N=t(5970),c=t(76679),B=t(30422),T=t(60956),u=t(9001),h=t(68700),H=t(92746);function J(n,a){const s=b(a),l=useCombinedRuleNamespaces(a),v=useMemo(()=>{if(!n||!a||l.length===0)return[];const m=[];for(const E of l)for(const D of E.groups)for(const g of D.rules)g.name===n&&m.push(g);return m},[n,a,l]);return{...s,result:v}}function Q(n,a,s){const l=(0,c.c$)(a),{dsFeatures:v,isLoadingDsFeatures:m}=W(a),{currentData:E=[],isLoading:D,error:g}=R.alertRuleApi.endpoints.prometheusRuleNamespaces.useQuery({ruleSourceName:a,ruleName:n,namespace:s?.namespace,groupName:s?.groupName}),[P]=R.alertRuleApi.endpoints.rulerRuleGroup.useLazyQuery(),{loading:S,error:G,value:K}=(0,U.Z)(async()=>{if(!l)throw new Error("Unable to obtain data source settings");if(g)throw new Error("Unable to obtain Prometheus rules");const L=[];if(v?.rulerConfig){const i=v.rulerConfig,y=E.map(p=>p.groups.map(C=>({namespace:p,group:C}))).flat();await Promise.allSettled(y.map(async p=>{const C=await P({rulerConfig:i,namespace:p.namespace.name,group:p.group.name}).unwrap();L.push(C)}))}return E.map(i=>(0,h.K$)(l,i,L)).flatMap(i=>i.groups.flatMap(y=>y.rules))},[l,v,D,g,E,P]);return{loading:m||S,error:G,rules:K}}function b(n,a){const s=useDispatch(),l=useUnifiedAlertingSelector(g=>g.promRules),v=$(n,l),m=useUnifiedAlertingSelector(g=>g.rulerRules),E=$(n,m),{loading:D}=useAsync(async()=>{n&&await s(fetchPromAndRulerRulesAction({rulesSourceName:n,identifier:a}))},[s,n]);return{loading:D,error:v.error??isRulerNotSupportedResponse(E)?void 0:E.error,dispatched:v.dispatched&&E.dispatched}}function $(n,a){if(!n)return initialAsyncRequestState;const s=a[n];return s||initialAsyncRequestState}function x({ruleIdentifier:n}){const{ruleSourceName:a}=n,s=(0,c.c$)(a),{dsFeatures:l,isLoadingDsFeatures:v}=W(a),{currentData:m,isLoading:E,error:D}=R.alertRuleApi.endpoints.prometheusRuleNamespaces.useQuery({ruleSourceName:n.ruleSourceName,namespace:(0,u.qE)(n)||(0,u.E4)(n)?n.namespace:void 0,groupName:(0,u.qE)(n)||(0,u.E4)(n)?n.groupName:void 0,ruleName:(0,u.qE)(n)||(0,u.E4)(n)?n.ruleName:void 0}),[g,{currentData:P,isLoading:S,error:G}]=R.alertRuleApi.endpoints.rulerRuleGroup.useLazyQuery(),[K,{currentData:L,isLoading:r,error:o}]=R.alertRuleApi.endpoints.rulerRules.useLazyQuery();(0,e.useEffect)(()=>{l?.rulerConfig&&(l.rulerConfig&&(0,u.E4)(n)?g({rulerConfig:l.rulerConfig,namespace:n.namespace,group:n.groupName}):(0,u.Kl)(n)&&K({rulerConfig:l.rulerConfig}))},[l,g,K,n]);const i=(0,e.useMemo)(()=>{if(m){if((0,u.Kl)(n)){const y=(0,h.bU)("grafana",m,L);for(const p of y)for(const C of p.groups)for(const A of C.rules){const d=T.Yd(a,A);if(T.Dg(d,n))return A}}if(s&&m.length>0&&((0,u.E4)(n)||(0,u.qE)(n))){const y=m.map(p=>(0,h.K$)(s,p,P?[P]:[]));for(const p of y)for(const C of p.groups)for(const A of C.rules){const d=T.Yd(a,A);if(T.Dg(d,n))return A}}}},[n,a,m,P,L,s]);return{loading:v||E||S||r,error:D??G??o,result:i}}const I={rulerConfig:{dataSourceName:c.GC,apiVersion:"legacy"}};function W(n){const a=(0,c.HY)(n),{currentData:s,isLoading:l}=M.T.endpoints.discoverDsFeatures.useQuery({rulesSourceName:n},{skip:a});return a?{isLoadingDsFeatures:!1,dsFeatures:I}:{isLoadingDsFeatures:l,dsFeatures:s}}}}]);

//# sourceMappingURL=9776.a1ba8f1cea4043dac383.js.map